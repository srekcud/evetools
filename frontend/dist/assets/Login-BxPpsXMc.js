import{d as _,u as S,o as C,s as h,c,a as b,b as t,t as y,e as w,f as A,g as I,r as f,h as d}from"./index-DyXu58aN.js";const V={class:"min-h-screen bg-eve-dark flex items-center justify-center relative overflow-hidden"},j={class:"relative z-10 eve-card p-12 max-w-md w-full mx-4"},z={key:0,class:"mb-6 p-4 bg-amber-500/20 border border-amber-500/50 rounded-lg"},B={class:"flex items-center gap-3"},L={class:"text-amber-200/70 text-xs mt-1"},G={key:1,class:"mb-6 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm text-center"},M={key:2,class:"flex flex-col items-center gap-4"},T=_({__name:"Login",setup(O){const p=A(),u=I(),o=S(),i=f(!1),a=f(""),r=f(!1),v=f(null);async function m(){try{const s=await fetch("https://esi.evetech.net/status.json",{method:"GET",headers:{Accept:"application/json"}});if(!s.ok){s.status===503&&(r.value=!0,v.value="ESI is currently in maintenance mode");return}const e=await h(s);Array.isArray(e)&&e.every(n=>n.status!=="green")&&(r.value=!0,v.value="ESI services are degraded")}catch{r.value=!0,v.value="Cannot reach ESI servers"}}C(async()=>{m();const s=p.query.code;if(s){i.value=!0;try{const n=sessionStorage.getItem("eve_oauth_action"),x=o.token||localStorage.getItem("jwt_token"),g={};n&&x&&(g.Authorization=`Bearer ${x}`);const E=await fetch(`/auth/eve/exchange?code=${encodeURIComponent(s)}`,{headers:g}),l=await h(E);if(sessionStorage.removeItem("eve_oauth_action"),sessionStorage.removeItem("eve_oauth_state"),sessionStorage.removeItem("eve_oauth_character_id"),n==="add-character"||n==="reauthorize"){l.error?a.value=l.message||"Failed to add character":(await o.fetchUser(),u.push("/characters"));return}if(l.token){o.setToken(l.token),await o.fetchUser(),u.push("/dashboard");return}else a.value=l.message||"Authentication failed"}catch(n){await m(),r.value?a.value="Authentication failed - EVE servers may be under maintenance":a.value="Authentication error",console.error(n)}finally{i.value=!1}return}const e=p.query.token;if(e){o.setToken(e),await o.fetchUser(),u.push("/dashboard");return}o.isAuthenticated&&u.push("/dashboard")});async function k(){i.value=!0,a.value="";try{const s=await fetch("/auth/eve/redirect"),e=await h(s);e.redirect_url?(sessionStorage.setItem("eve_oauth_state",e.state||""),window.location.href=e.redirect_url):a.value="Failed to get redirect URL"}catch(s){await m(),r.value?a.value="Cannot connect - EVE servers may be under maintenance":a.value="Connection error",console.error(s)}finally{i.value=!1}}return(s,e)=>(d(),c("div",V,[e[7]||(e[7]=b('<div class="absolute inset-0"><div class="absolute inset-0 bg-gradient-to-br from-eve-dark via-[#0d1015] to-eve-dark"></div><div class="absolute inset-0 opacity-10"><div class="absolute top-1/4 left-1/4 w-96 h-96 bg-eve-accent rounded-full filter blur-[100px] animate-pulse-slow"></div><div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-eve-accent-dim rounded-full filter blur-[100px] animate-pulse-slow" style="animation-delay:1s;"></div></div><div class="absolute inset-0 opacity-5" style="background-image:linear-gradient(rgba(0,212,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0,212,255,0.1) 1px, transparent 1px);background-size:50px 50px;"></div></div>',1)),t("div",j,[e[4]||(e[4]=b('<div class="text-center mb-10"><div class="inline-flex items-center justify-center w-20 h-20 mb-6"><svg viewBox="0 0 100 100" class="w-full h-full"><defs><linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00d4ff;"></stop><stop offset="100%" style="stop-color:#0099bb;"></stop></linearGradient></defs><polygon fill="url(#logoGrad)" points="50,5 95,27.5 95,72.5 50,95 5,72.5 5,27.5"></polygon><text x="50" y="62" text-anchor="middle" fill="#0a0c0f" font-family="Rajdhani, sans-serif" font-size="36" font-weight="bold">E</text></svg></div><h1 class="text-4xl font-bold text-eve-text-bright mb-2 tracking-wide">EVE Tools</h1><p class="text-eve-text">Industrial Management Suite</p></div>',1)),r.value?(d(),c("div",z,[t("div",B,[e[1]||(e[1]=t("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("div",null,[e[0]||(e[0]=t("p",{class:"text-amber-200 text-sm font-medium"},"EVE Online servers are under maintenance",-1)),t("p",L,y(v.value),1)])])])):w("",!0),a.value?(d(),c("div",G,y(a.value),1)):w("",!0),i.value?(d(),c("div",M,[...e[2]||(e[2]=[t("svg",{class:"w-10 h-10 animate-spin text-eve-accent",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("p",{class:"text-eve-text"},"Connecting to EVE Online...",-1)])])):(d(),c("button",{key:3,onClick:k,class:"w-full flex justify-center transition-all duration-300 hover:scale-105 hover:drop-shadow-[0_0_15px_rgba(0,212,255,0.4)] focus:outline-none focus:ring-2 focus:ring-eve-accent/50 rounded"},[...e[3]||(e[3]=[t("img",{src:"https://web.ccpgamescdn.com/eveonlineassets/developers/eve-sso-login-black-large.png",alt:"Log in with EVE Online",class:"h-auto max-w-full"},null,-1)])])),e[5]||(e[5]=t("p",{class:"text-center text-eve-text/60 text-sm mt-8"}," Secure authentication via EVE Online SSO ",-1)),e[6]||(e[6]=t("p",{class:"text-center text-eve-text/40 text-xs mt-2"}," Your credentials are never shared with this application ",-1))]),e[8]||(e[8]=t("div",{class:"absolute bottom-4 left-1/2 -translate-x-1/2 text-eve-text/40 font-mono text-xs"}," v0.1.0-alpha ",-1))]))}});export{T as default};
