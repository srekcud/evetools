import{d as te,u as se,x as O,o as oe,i as ae,w as le,p as u,r as d,h as a,b as s,c as l,n as N,l as V,t as r,e as b,y as B,z as q,F as f,m as S,A as ne,k as C}from"./index-eOzsbP3j.js";import{u as re}from"./useEveImages-B3tDia7r.js";import{_ as ie}from"./MainLayout.vue_vue_type_style_index_0_lang-BsVw6yHB.js";const ue={class:"flex items-center justify-between mb-6"},de=["disabled"],ce={key:0,class:"mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 flex items-center justify-between"},me={class:"flex flex-col gap-4 mb-6"},ve={class:"flex flex-col sm:flex-row gap-4"},pe={class:"flex bg-slate-900 rounded-lg p-1"},fe=["value"],xe={class:"flex-1 relative"},ye={class:"flex flex-col sm:flex-row gap-4"},he={class:"relative"},ge={value:""},be=["value"],we={class:"relative"},ke={value:""},_e=["value"],Ne={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6"},Se={class:"bg-slate-900 rounded-lg p-4 border border-slate-800"},Ce={class:"text-2xl font-bold text-cyan-400"},Ie={class:"bg-slate-900 rounded-lg p-4 border border-slate-800"},Me={class:"text-2xl font-bold text-indigo-400"},je={class:"bg-slate-900 rounded-lg p-4 border border-slate-800"},Ae={class:"text-2xl font-bold text-amber-400"},Le={class:"bg-slate-900 rounded-lg p-4 border border-slate-800"},Be={class:"text-2xl font-bold text-emerald-400"},Ee={key:1,class:"flex flex-col items-center justify-center py-20"},$e={key:2,class:"text-center py-20"},Te=["disabled"],Ve={key:3,class:"space-y-4"},qe=["onClick"],ze={class:"flex items-center gap-3"},Fe={class:"w-10 h-10 rounded-lg bg-slate-700/50 flex items-center justify-center"},Re={class:"font-medium text-slate-200"},He={class:"flex items-center gap-2"},De={key:0,class:"text-xs text-cyan-400"},Pe={class:"text-xs text-slate-500"},Qe={class:"text-sm text-cyan-400 font-mono"},Ue={key:0,class:"divide-y divide-slate-800"},Oe=["onClick"],We={class:"flex items-center gap-3"},Ge=["src","alt"],Je={class:"flex items-center gap-2"},Ke={class:"text-slate-200"},Xe={key:0,class:"flex items-center gap-1 text-xs text-amber-400"},Ye={key:1,class:"text-xs text-slate-500"},Ze={class:"text-slate-400 font-mono text-sm"},et={key:0,class:"bg-slate-950/50 border-l-2 border-amber-500/30"},tt={class:"flex items-center gap-3"},st=["src","alt"],ot={class:"text-slate-300 text-sm"},at={class:"text-slate-500 font-mono text-sm"},lt={key:4,class:"text-center py-12"},ct=te({__name:"Assets",setup(nt){const E=se(),{getTypeIconUrl:z,onImageError:j}=re(),W=u(()=>E.user),A=u(()=>{var t;return((t=W.value)==null?void 0:t.characters)||[]}),x=d(null),i=d([]),I=d(!1),p=d(!1),w=d(""),k=d(""),c=d("character"),m=d(""),y=d(""),h=d(new Set),g=d(new Set),F=u(()=>{const t=new Set;for(const e of i.value)e.solarSystemName&&t.add(e.solarSystemName);return Array.from(t).sort()}),R=u(()=>{const t=new Map;for(const o of i.value)o.locationName.startsWith("Structure #")||o.locationName.startsWith("Location #")||t.has(o.locationName)||t.set(o.locationName,{solarSystemName:o.solarSystemName});let e=Array.from(t.entries()).map(([o,n])=>({name:o,solarSystemName:n.solarSystemName}));return m.value&&(e=e.filter(o=>o.solarSystemName===m.value)),e.sort((o,n)=>o.name.localeCompare(n.name))}),H=u(()=>new Set(i.value.map(t=>t.itemId))),D=u(()=>{const t=new Map;for(const e of i.value)if(e.locationType==="item"&&H.value.has(e.locationId)){const o=e.locationId;t.has(o)||t.set(o,[]),t.get(o).push(e)}return t});function M(t){return D.value.has(t.itemId)}function $(t){return D.value.get(t.itemId)||[]}function G(t){h.value.has(t)?h.value.delete(t):h.value.add(t),h.value=new Set(h.value)}function J(t){g.value.has(t)?g.value.delete(t):g.value.add(t),g.value=new Set(g.value)}const P=u(()=>{let t=i.value;if(m.value&&(t=t.filter(e=>e.solarSystemName===m.value)),y.value&&(t=t.filter(e=>e.locationName===y.value)),k.value.trim()){const e=k.value.toLowerCase();t=t.filter(o=>o.typeName.toLowerCase().includes(e)||o.locationName.toLowerCase().includes(e)||o.solarSystemName&&o.solarSystemName.toLowerCase().includes(e))}return t}),K=u(()=>{const t={};for(const e of P.value){if(e.locationType==="item"&&H.value.has(e.locationId))continue;const o=e.locationName||`Location ${e.locationId}`;if(t[o]||(t[o]={locationId:e.locationId,locationName:o,solarSystemName:e.solarSystemName,assets:[],totalQuantity:0}),t[o].assets.push(e),t[o].totalQuantity+=e.quantity,M(e))for(const n of $(e))t[o].totalQuantity+=n.quantity}return Object.values(t).sort((e,o)=>e.locationName.localeCompare(o.locationName))});O(m,()=>{y.value=""});const X=u(()=>i.value.reduce((t,e)=>t+e.quantity,0)),Y=u(()=>new Set(i.value.map(t=>t.typeId)).size),Z=u(()=>new Set(i.value.map(t=>t.locationId)).size),ee=u(()=>new Set(i.value.filter(t=>t.solarSystemName).map(t=>t.solarSystemName)).size);async function T(){if(!(c.value==="character"&&!x.value)){I.value=!0,w.value="";try{const t=c.value==="character"?`/api/me/characters/${x.value}/assets`:"/api/me/corporation/assets",e=await fetch(t,{headers:{Authorization:`Bearer ${E.token}`}});if(!e.ok)throw new Error("Failed to fetch assets");const o=await e.json();i.value=o.items||[]}catch(t){w.value="Failed to load assets",console.error(t)}finally{I.value=!1}}}async function Q(){if(!(c.value==="character"&&!x.value)){p.value=!0,w.value="";try{const t=c.value==="character"?`/api/me/characters/${x.value}/assets/refresh`:"/api/me/corporation/assets/refresh",e=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${E.token}`}});if(!e.ok){const n=await e.json();throw new Error(n.error||"Failed to refresh")}if((await e.json()).status==="pending"){let n=0;const v=12,L=async()=>{n++,await T(),i.value.length>0||n>=v?p.value=!1:setTimeout(L,5e3)};setTimeout(L,3e3)}else await T(),p.value=!1}catch(t){w.value=t instanceof Error?t.message:"Failed to refresh assets",p.value=!1}}}oe(()=>{if(A.value.length>0){const t=A.value.find(e=>e.isMain);x.value=(t==null?void 0:t.id)||A.value[0].id}}),O([x,c],()=>{m.value="",y.value="",k.value="",h.value=new Set,g.value=new Set,T()},{immediate:!0});function _(t){return t.toLocaleString()}function U(t){return t.itemName?`${t.itemName} (${t.typeName})`:t.typeName}return(t,e)=>(a(),ae(ie,null,{default:le(()=>[s("div",ue,[e[11]||(e[11]=s("p",{class:"text-slate-400"},"Parcourir vos assets EVE",-1)),s("button",{onClick:Q,disabled:p.value||I.value,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[(a(),l("svg",{class:N(["w-4 h-4",p.value&&"animate-spin"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[10]||(e[10]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),V(" "+r(p.value?"Sync...":"Rafraîchir"),1)],8,de)]),s("div",null,[w.value?(a(),l("div",ce,[s("span",null,r(w.value),1),s("button",{onClick:e[0]||(e[0]=o=>w.value=""),class:"text-red-400 hover:text-red-300"},[...e[12]||(e[12]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):b("",!0),s("div",me,[s("div",ve,[s("div",pe,[s("button",{onClick:e[1]||(e[1]=o=>c.value="character"),class:N(["px-4 py-2 rounded-md text-sm font-medium transition-colors",c.value==="character"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])}," Personnage ",2),s("button",{onClick:e[2]||(e[2]=o=>c.value="corporation"),class:N(["px-4 py-2 rounded-md text-sm font-medium transition-colors",c.value==="corporation"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])}," Corporation ",2)]),c.value==="character"?B((a(),l("select",{key:0,"onUpdate:modelValue":e[3]||(e[3]=o=>x.value=o),class:"bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-cyan-500"},[(a(!0),l(f,null,S(A.value,o=>(a(),l("option",{key:o.id,value:o.id},r(o.name)+" "+r(o.isMain?"(Main)":""),9,fe))),128))],512)),[[q,x.value]]):b("",!0),s("div",xe,[e[13]||(e[13]=s("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),B(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>k.value=o),type:"text",placeholder:"Rechercher items, emplacements ou systèmes...",class:"w-full bg-slate-900 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[ne,k.value]])])]),s("div",ye,[s("div",he,[B(s("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),class:"bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 pr-8 text-sm focus:outline-none focus:border-cyan-500 min-w-[200px]"},[s("option",ge,"Tous les systèmes ("+r(F.value.length)+")",1),(a(!0),l(f,null,S(F.value,o=>(a(),l("option",{key:o,value:o},r(o),9,be))),128))],512),[[q,m.value]])]),s("div",we,[B(s("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>y.value=o),class:"bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 pr-8 text-sm focus:outline-none focus:border-cyan-500 min-w-[250px]"},[s("option",ke,"Tous les emplacements ("+r(R.value.length)+")",1),(a(!0),l(f,null,S(R.value,o=>(a(),l("option",{key:o.name,value:o.name},r(o.name),9,_e))),128))],512),[[q,y.value]])]),m.value||y.value||k.value?(a(),l("button",{key:0,onClick:e[7]||(e[7]=o=>{m.value="",y.value="",k.value=""}),class:"px-3 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-slate-200 text-sm flex items-center gap-2"},[...e[14]||(e[14]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),V(" Effacer filtres ",-1)])])):b("",!0)])]),s("div",Ne,[s("div",Se,[s("p",Ce,r(_(X.value)),1),e[15]||(e[15]=s("p",{class:"text-sm text-slate-500"},"Items total",-1))]),s("div",Ie,[s("p",Me,r(_(Y.value)),1),e[16]||(e[16]=s("p",{class:"text-sm text-slate-500"},"Types d'items",-1))]),s("div",je,[s("p",Ae,r(_(ee.value)),1),e[17]||(e[17]=s("p",{class:"text-sm text-slate-500"},"Systèmes",-1))]),s("div",Le,[s("p",Be,r(_(Z.value)),1),e[18]||(e[18]=s("p",{class:"text-sm text-slate-500"},"Emplacements",-1))])]),I.value?(a(),l("div",Ee,[...e[19]||(e[19]=[s("svg",{class:"w-10 h-10 animate-spin text-cyan-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),s("p",{class:"text-slate-400"},"Chargement des assets...",-1)])])):i.value.length===0?(a(),l("div",$e,[p.value?(a(),l(f,{key:0},[e[20]||(e[20]=s("svg",{class:"w-16 h-16 mx-auto text-cyan-500 mb-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),e[21]||(e[21]=s("p",{class:"text-slate-300 font-medium mb-2"},"Synchronisation en cours...",-1)),e[22]||(e[22]=s("p",{class:"text-slate-500 text-sm max-w-md mx-auto"}," Récupération de vos assets depuis l'API EVE Online. Cette opération peut prendre quelques minutes lors de la première synchronisation. ",-1))],64)):(a(),l(f,{key:1},[e[23]||(e[23]=s("svg",{class:"w-16 h-16 mx-auto text-slate-700 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),e[24]||(e[24]=s("p",{class:"text-slate-500 mb-4"},"Aucun asset trouvé",-1)),s("button",{onClick:Q,disabled:p.value,class:"text-cyan-400 hover:underline text-sm"}," Rafraîchir depuis l'API EVE ",8,Te)],64))])):(a(),l("div",Ve,[(a(!0),l(f,null,S(K.value,o=>(a(),l("div",{key:o.locationName,class:"bg-slate-900 rounded-lg border border-slate-800 overflow-hidden"},[s("div",{class:"px-5 py-4 bg-slate-800/50 border-b border-slate-800 flex items-center justify-between cursor-pointer hover:bg-slate-800/70 transition-colors",onClick:n=>J(o.locationName)},[s("div",ze,[s("div",Fe,[(a(),l("svg",{class:N(["w-5 h-5 text-slate-400 transition-transform",g.value.has(o.locationName)&&"-rotate-90"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[25]||(e[25]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),s("div",null,[s("h3",Re,r(o.locationName),1),s("div",He,[o.solarSystemName&&!o.locationName.startsWith(o.solarSystemName)?(a(),l("span",De,r(o.solarSystemName),1)):b("",!0),s("span",Pe,r(o.assets.length)+" types d'items",1)])])]),s("span",Qe,r(_(o.totalQuantity))+" items",1)],8,qe),g.value.has(o.locationName)?b("",!0):(a(),l("div",Ue,[(a(!0),l(f,null,S(o.assets,n=>(a(),l(f,{key:n.id},[s("div",{class:N(["px-5 py-3 flex items-center justify-between transition-colors",M(n)?"hover:bg-slate-800/50 cursor-pointer":"hover:bg-slate-800/30"]),onClick:v=>M(n)&&G(n.itemId)},[s("div",We,[s("img",{src:C(z)(n.typeId,32),alt:n.typeName,class:"w-8 h-8 rounded",onError:e[8]||(e[8]=(...v)=>C(j)&&C(j)(...v))},null,40,Ge),s("div",Je,[s("span",Ke,r(U(n)),1),M(n)?(a(),l("span",Xe,[e[27]||(e[27]=s("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),V(" "+r($(n).length)+" items ",1),(a(),l("svg",{class:N(["w-3 h-3 transition-transform",h.value.has(n.itemId)&&"rotate-180"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[26]||(e[26]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])):n.locationFlag?(a(),l("span",Ye,"("+r(n.locationFlag)+")",1)):b("",!0)])]),s("span",Ze,"x"+r(_(n.quantity)),1)],10,Oe),M(n)&&h.value.has(n.itemId)?(a(),l("div",et,[(a(!0),l(f,null,S($(n),v=>(a(),l("div",{key:v.id,class:"px-5 py-2 pl-12 flex items-center justify-between hover:bg-slate-800/20 transition-colors"},[s("div",tt,[s("img",{src:C(z)(v.typeId,32),alt:v.typeName,class:"w-6 h-6 rounded",onError:e[9]||(e[9]=(...L)=>C(j)&&C(j)(...L))},null,40,st),s("span",ot,r(U(v)),1)]),s("span",at,"x"+r(_(v.quantity)),1)]))),128))])):b("",!0)],64))),128))]))]))),128))])),!I.value&&i.value.length>0&&P.value.length===0?(a(),l("div",lt,[...e[28]||(e[28]=[s("p",{class:"text-slate-500"},"Aucun item correspondant à vos filtres",-1)])])):b("",!0)])]),_:1}))}});export{ct as default};
