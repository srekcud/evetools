import{E as Dt,r as v,G as ue,H as Ht,d as Qe,h as s,c as o,B as ce,D as fe,b as e,k as c,F as Z,m as me,y as Te,t as n,e as x,x as xe,n as G,z as et,l as te,i as De,T as dt,p as de,I as yt,J as Ut,u as Ft,o as ct,A as Ct,q as ut,j as Ot,s as Kt,C as $t,a as Qt,K as Xt,w as Wt}from"./index-DyXu58aN.js";import{_ as Zt}from"./MainLayout.vue_vue_type_style_index_0_lang-KV4uLK8U.js";import{u as bt}from"./useFormatters-SlNtu6dn.js";import{u as Yt}from"./sync-DMjL0LCj.js";import{u as pt}from"./useEveImages-B3tDia7r.js";function xt(B,u){return Ht(B)?B.violations.map(T=>T.message).join(" | "):B instanceof Error?B.message:u}const rt=Dt("industry",()=>{const B=v([]),u=v(null),T=v([]),E=v(null),l=v([]),Q=v(null),I=v([]),_=v(!1),C=v(null),W=v(0),se=v(2);function oe(f){se.value=f}async function ee(f){if(f.length<2){T.value=[];return}try{const k=await ue(`/industry/search?q=${encodeURIComponent(f)}`);T.value=k.results}catch{T.value=[]}}async function S(f,k,A,L=0,q=2,Y){C.value=null;try{const X=await ue("/industry/projects",{method:"POST",body:JSON.stringify({typeId:f,runs:k,meLevel:A,teLevel:L,maxJobDurationDays:q,name:Y})});return B.value.unshift(X),X}catch(X){throw C.value=xt(X,"Échec de création du projet"),X}}async function j(){_.value=!0,C.value=null;try{const f=await ue("/industry/projects");B.value=f.projects,W.value=f.totalProfit}catch(f){C.value=f instanceof Error?f.message:"Failed to fetch projects"}finally{_.value=!1}}async function J(f){_.value=!0,C.value=null;try{u.value=await ue(`/industry/projects/${f}`)}catch(k){C.value=k instanceof Error?k.message:"Failed to fetch project"}finally{_.value=!1}}async function D(f,k){var A;C.value=null;try{const L=await ue(`/industry/projects/${f}`,{method:"PATCH",body:JSON.stringify(k)}),q=B.value.findIndex(Y=>Y.id===f);return q!==-1&&(B.value[q]={...B.value[q],...L}),((A=u.value)==null?void 0:A.id)===f&&(u.value={...u.value,...L}),L}catch(L){throw C.value=L instanceof Error?L.message:"Failed to update project",L}}async function le(f){C.value=null;try{await ue(`/industry/projects/${f}`,{method:"DELETE"}),B.value=B.value.filter(k=>k.id!==f)}catch(k){C.value=k instanceof Error?k.message:"Failed to delete project"}}async function ae(f,k,A){var L;try{const q=await ue(`/industry/projects/${f}/steps/${k}`,{method:"PATCH",body:JSON.stringify({purchased:A})});if((L=u.value)!=null&&L.steps){const Y=u.value.steps.findIndex(X=>X.id===k);Y!==-1&&(u.value.steps[Y]=q)}}catch(q){throw C.value=xt(q,"Échec de mise à jour de l'étape"),q}}async function w(f,k,A){var L;try{const q=await ue(`/industry/projects/${f}/steps/${k}`,{method:"PATCH",body:JSON.stringify({inStockQuantity:A})});if((L=u.value)!=null&&L.steps){const Y=u.value.steps.findIndex(X=>X.id===k);Y!==-1&&(u.value.steps[Y]=q)}}catch(q){throw C.value=xt(q,"Échec de mise à jour de l'étape"),q}}async function p(f,k,A){var L;try{const q=await ue(`/industry/projects/${f}/steps/${k}`,{method:"PATCH",body:JSON.stringify(A)});if((L=u.value)!=null&&L.steps){const Y=u.value.steps.findIndex(X=>X.id===k);Y!==-1&&(u.value.steps[Y]=q)}return q}catch(q){throw C.value=q instanceof Error?q.message:"Failed to update step",q}}async function d(f,k){var A;try{const L=await ue(`/industry/projects/${f}/steps/${k}`,{method:"PATCH",body:JSON.stringify({clearJobData:!0})});if((A=u.value)!=null&&A.steps){const q=u.value.steps.findIndex(Y=>Y.id===k);q!==-1&&(u.value.steps[q]=L)}return L}catch(L){throw C.value=L instanceof Error?L.message:"Failed to clear step job data",L}}async function V(f,k,A,L,q){var Y;try{const X={typeId:k,runs:A};L!==void 0&&(X.meLevel=L),q!==void 0&&(X.teLevel=q);const i=await ue(`/industry/projects/${f}/steps`,{method:"POST",body:JSON.stringify(X)});return((Y=u.value)==null?void 0:Y.id)===f&&u.value.steps&&u.value.steps.push(i),i}catch(X){throw C.value=X instanceof Error?X.message:"Failed to create step",X}}async function ie(f,k,A,L){var q,Y;try{const X={runs:L};if(k?X.splitGroupId=k:A&&(X.stepId=A),A){const i=await ue(`/industry/projects/${f}/steps`,{method:"POST",body:JSON.stringify(X)});if(((q=u.value)==null?void 0:q.id)===f&&u.value.steps){const y=u.value.steps.findIndex(ne=>ne.id===A);y!==-1&&(u.value.steps[y]=i.updatedStep),u.value.steps.push(i.newStep)}return i.newStep}else{const i=await ue(`/industry/projects/${f}/steps`,{method:"POST",body:JSON.stringify(X)});return((Y=u.value)==null?void 0:Y.id)===f&&u.value.steps&&u.value.steps.push(i),i}}catch(X){throw C.value=X instanceof Error?X.message:"Failed to add child job",X}}async function Ee(f,k){var A;try{await ue(`/industry/projects/${f}/steps/${k}`,{method:"DELETE"}),((A=u.value)==null?void 0:A.id)===f&&u.value.steps&&(u.value.steps=u.value.steps.filter(L=>L.id!==k))}catch(L){throw C.value=L instanceof Error?L.message:"Failed to delete step",L}}async function He(f,k,A){var L;try{const q=await ue(`/industry/projects/${f}/steps/${k}`,{method:"PATCH",body:JSON.stringify({runs:A})});if(((L=u.value)==null?void 0:L.id)===f&&u.value.steps){const Y=u.value.steps.findIndex(X=>X.id===k);Y!==-1&&(u.value.steps[Y]=q)}return q}catch(q){throw C.value=q instanceof Error?q.message:"Failed to update step runs",q}}async function ke(f){var k;try{const A=await ue(`/industry/projects/${f}/match-jobs`,{method:"POST"});return((k=u.value)==null?void 0:k.id)===f&&(u.value.steps=A.steps,u.value.jobsCost=A.jobsCost),A.warning}catch(A){return C.value=A instanceof Error?A.message:"Failed to match jobs",null}}async function Xe(f,k,A){try{const L=new URLSearchParams;k&&L.set("structureId",k.toString()),A!==void 0&&L.set("transportCost",A.toString());const q=L.toString()?`?${L.toString()}`:"";return await ue(`/industry/projects/${f}/shopping-list${q}`)}catch(L){return C.value=L instanceof Error?L.message:"Failed to fetch shopping list",null}}async function _e(){try{E.value=await ue("/industry/blacklist")}catch(f){C.value=f instanceof Error?f.message:"Failed to fetch blacklist"}}async function je(f,k){try{E.value=await ue("/industry/blacklist",{method:"PUT",body:JSON.stringify({groupIds:f,typeIds:k})})}catch(A){C.value=A instanceof Error?A.message:"Failed to update blacklist"}}async function Re(f){if(f.length<2)return[];try{return(await ue(`/industry/blacklist/search?q=${encodeURIComponent(f)}`)).results}catch{return[]}}async function Ue(){try{const f=await ue("/industry/structures");l.value=f.structures,Q.value=f.rigOptions}catch(f){C.value=f instanceof Error?f.message:"Failed to fetch structures"}}async function Je(){try{const f=await ue("/industry/corporation-structures");I.value=f.structures}catch(f){console.error("Failed to fetch corporation structures:",f)}}async function Ce(f){try{const k=await ue("/industry/structures",{method:"POST",body:JSON.stringify({...f,isDefault:!1})});return l.value.push(k),k}catch(k){throw C.value=k instanceof Error?k.message:"Failed to create structure",k}}async function re(f,k){try{const A=await ue(`/industry/structures/${f}`,{method:"PATCH",body:JSON.stringify(k)}),L=l.value.findIndex(q=>q.id===f);return L!==-1&&(l.value[L]=A),A}catch(A){throw C.value=A instanceof Error?A.message:"Failed to update structure",A}}async function Be(f){try{await ue(`/industry/structures/${f}`,{method:"DELETE"}),l.value=l.value.filter(k=>k.id!==f)}catch(k){throw C.value=k instanceof Error?k.message:"Failed to delete structure",k}}async function ge(f){if(f.length<3)return{structures:[]};try{return{structures:(await ue(`/industry/search-structure?q=${encodeURIComponent(f)}`)).structures}}catch(k){const A=k instanceof Error?k.message:"Erreur de recherche";return console.error("Failed to search structures:",k),{structures:[],error:A}}}function $e(){C.value=null}return{projects:B,currentProject:u,searchResults:T,blacklist:E,structures:l,rigOptions:Q,corporationStructures:I,isLoading:_,error:C,totalProfit:W,defaultMaxJobDurationDays:se,searchProducts:ee,createProject:S,fetchProjects:j,fetchProject:J,updateProject:D,deleteProject:le,toggleStepPurchased:ae,toggleStepInStock:w,updateStepJobData:p,clearStepJobData:d,matchJobs:ke,fetchShoppingList:Xe,fetchBlacklist:_e,updateBlacklist:je,searchBlacklistItems:Re,fetchStructures:Ue,fetchCorporationStructures:Je,createStructure:Ce,updateStructure:re,deleteStructure:Be,searchStructures:ge,createStep:V,addChildJob:ie,deleteStep:Ee,updateStepRuns:He,setDefaultMaxJobDurationDays:oe,clearError:$e}}),Gt={class:"relative"},es={key:0,class:"absolute z-20 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto"},ts=["onMousedown"],ss=["src"],os=Qe({__name:"ProductSearch",emits:["select"],setup(B,{expose:u,emit:T}){const E=T,l=rt(),Q=v(""),I=v(!1);let _=null;function C(){if(_&&clearTimeout(_),Q.value.length<2){l.searchResults=[],I.value=!1;return}_=setTimeout(async()=>{await l.searchProducts(Q.value),I.value=l.searchResults.length>0},300)}function W(ee){E("select",ee),Q.value=ee.typeName,I.value=!1,l.searchResults=[]}function se(){setTimeout(()=>{I.value=!1},200)}function oe(){Q.value="",l.searchResults=[],I.value=!1}return u({clear:oe}),(ee,S)=>(s(),o("div",Gt,[ce(e("input",{"onUpdate:modelValue":S[0]||(S[0]=j=>Q.value=j),onInput:C,onFocus:S[1]||(S[1]=j=>I.value=c(l).searchResults.length>0),onBlur:se,type:"text",placeholder:"Rechercher un produit (ex: Nomad, Raven...)",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-cyan-500 pr-10"},null,544),[[fe,Q.value]]),S[3]||(S[3]=e("svg",{class:"absolute right-3 top-3 w-4 h-4 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),I.value&&c(l).searchResults.length>0?(s(),o("div",es,[(s(!0),o(Z,null,me(c(l).searchResults,j=>(s(),o("button",{key:j.typeId,onMousedown:Te(J=>W(j),["prevent"]),class:"w-full px-4 py-2.5 text-left hover:bg-slate-700 text-sm flex items-center gap-3 transition-colors"},[e("img",{src:`https://images.evetech.net/types/${j.typeId}/icon?size=32`,class:"w-6 h-6 rounded",onError:S[2]||(S[2]=J=>J.target.style.display="none")},null,40,ss),e("span",null,n(j.typeName),1)],40,ts))),128))])):x("",!0)]))}});function ns(B){if(!B||B.trim()==="")return null;let u=B.trim().replace(/[\s,]/g,"");const T=u.slice(-1).toLowerCase();let E=1;T==="k"?(E=1e3,u=u.slice(0,-1)):T==="m"?(E=1e6,u=u.slice(0,-1)):T==="b"&&(E=1e9,u=u.slice(0,-1));const l=parseFloat(u);return isNaN(l)?null:Math.round(l*E*100)/100}const rs={class:"overflow-x-auto"},ls={class:"w-full text-sm"},as={class:"divide-y divide-slate-800"},is={class:"py-3 px-3"},us=["onClick"],ds={class:"inline-flex items-center justify-center w-5 h-5 text-xs bg-cyan-500/20 text-cyan-400 rounded-full"},cs={key:0,class:"text-slate-500 text-xs"},ps={key:0,class:"text-xs text-slate-500 mt-0.5 pl-7"},vs={class:"py-3 px-2"},ms={key:0,class:"text-slate-500 text-xs",title:"Plusieurs produits"},fs=["onKeydown","onBlur"],xs=["onDblclick","title"],ys={class:"py-3 px-2 text-slate-300"},bs={class:"py-3 px-2 text-slate-300"},gs={class:"py-3 px-2 text-center"},hs=["onClick","disabled","title"],ks=["onKeydown","onBlur"],ws=["onDblclick","title"],_s={class:"py-3 px-2 text-right font-mono text-slate-400"},Cs=["onKeydown","onBlur"],$s=["onDblclick","title"],Ss={class:"py-3 px-2 text-center"},Ms=["onClick"],Ts={class:"py-3 px-2 text-center"},js={class:"flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Ps=["onClick"],Is=["onClick"],Es={key:0},Bs={class:"border-t border-slate-600 font-semibold text-slate-200"},Ls={key:0,class:"text-center py-12 text-slate-500"},Rs=Qe({__name:"ProjectTable",emits:["view-project"],setup(B,{emit:u}){const T=u,E=rt(),{formatIsk:l}=bt();function Q(w){return w.replace(/\s*\(BPC\)\s*$/i,"").trim()}const I=v(null),_=v("");function C(w,p){if(w.status==="completed")return;const d=w[p];_.value=d!=null?String(d):"",I.value={id:w.id,field:p}}async function W(w){if(!I.value)return;const p=I.value.field;let d;if(p==="runs"){const V=parseInt(_.value,10);d=isNaN(V)||V<1?w.runs:V}else d=ns(_.value);I.value=null,await E.updateProject(w.id,{[p]:d}),await E.fetchProjects()}function se(){I.value=null}function oe(w,p){var d,V;return((d=I.value)==null?void 0:d.id)===w&&((V=I.value)==null?void 0:V.field)===p}function ee(w){return w==null?"-":l(w)}function S(w){return w==null?"text-slate-400":w>=0?"text-emerald-400":"text-red-400"}async function j(w){const p=w.status==="active"?"completed":"active";await E.updateProject(w.id,{status:p}),await E.fetchProjects()}async function J(w){await E.deleteProject(w)}async function D(w){w.status!=="completed"&&(await E.updateProject(w.id,{personalUse:!w.personalUse}),await E.fetchProjects())}const le=["bpoCost","materialCost","transportCost"],ae=["taxAmount","sellPrice"];return(w,p)=>(s(),o("div",rs,[e("table",ls,[p[11]||(p[11]=e("thead",null,[e("tr",{class:"border-b border-slate-700 text-slate-400 text-xs uppercase tracking-wider"},[e("th",{class:"text-left py-3 px-3"},"Produit"),e("th",{class:"text-left py-3 px-2"},"Runs"),e("th",{class:"text-left py-3 px-2"},"ME"),e("th",{class:"text-left py-3 px-2"},"TE"),e("th",{class:"text-center py-3 px-2"},"Perso"),e("th",{class:"text-right py-3 px-2"},"BPC Kit"),e("th",{class:"text-right py-3 px-2"},"Matériaux"),e("th",{class:"text-right py-3 px-2"},"Transport"),e("th",{class:"text-right py-3 px-2"},"Jobs"),e("th",{class:"text-right py-3 px-2"},"Taxes"),e("th",{class:"text-right py-3 px-2"},"Vente"),e("th",{class:"text-right py-3 px-2"},"Profit"),e("th",{class:"text-right py-3 px-2"},"%"),e("th",{class:"text-center py-3 px-2"},"Status"),e("th",{class:"text-center py-3 px-2"})])],-1)),e("tbody",as,[(s(!0),o(Z,null,me(c(E).projects,d=>(s(),o("tr",{key:d.id,class:"hover:bg-slate-800/50 group"},[e("td",is,[e("button",{onClick:V=>T("view-project",d.id),class:"text-cyan-400 hover:text-cyan-300 font-medium text-left flex items-center gap-2"},[d.rootProducts&&d.rootProducts.length>1?(s(),o(Z,{key:0},[e("span",ds,n(d.rootProducts.length),1),e("span",null,n(d.displayName),1)],64)):(s(),o(Z,{key:1},[e("span",null,n(d.displayName),1),d.name?(s(),o("span",cs,"("+n(d.productTypeName)+")",1)):x("",!0)],64))],8,us),d.rootProducts&&d.rootProducts.length>1?(s(),o("div",ps,n(d.rootProducts.map(V=>{const ie=V.meLevel??d.meLevel;return`${Q(V.typeName)} ×${V.runs} (ME${ie})`}).join(", ")),1)):x("",!0)]),e("td",vs,[d.rootProducts&&d.rootProducts.length>1?(s(),o("span",ms,"Multi")):(s(),o(Z,{key:1},[oe(d.id,"runs")?ce((s(),o("input",{key:0,"onUpdate:modelValue":p[0]||(p[0]=V=>_.value=V),type:"number",min:"1",class:"w-16 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-sm focus:outline-none",onKeydown:[xe(V=>W(d),["enter"]),xe(se,["escape"])],onBlur:V=>W(d),autofocus:""},null,40,fs)),[[fe,_.value]]):(s(),o("span",{key:1,onDblclick:V=>C(d,"runs"),class:G(["text-slate-300",d.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:d.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},n(d.runs),43,xs))],64))]),e("td",ys,n(d.meLevel),1),e("td",bs,n(d.teLevel),1),e("td",gs,[e("button",{onClick:V=>D(d),disabled:d.status==="completed",class:G(["text-xs px-2 py-1 rounded",d.personalUse?"bg-amber-500/20 text-amber-400":"bg-slate-600/20 text-slate-500",d.status==="completed"?"opacity-50 cursor-not-allowed":""]),title:d.status==="completed"?"Projet terminé":d.personalUse?"Usage personnel":"À vendre"},n(d.personalUse?"Perso":"Vente"),11,hs)]),(s(),o(Z,null,me(le,V=>e("td",{key:V,class:"py-3 px-2 text-right"},[oe(d.id,V)?ce((s(),o("input",{key:0,"onUpdate:modelValue":p[1]||(p[1]=ie=>_.value=ie),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[xe(ie=>W(d),["enter"]),xe(se,["escape"])],onBlur:ie=>W(d),autofocus:""},null,40,ks)),[[fe,_.value]]):(s(),o("span",{key:1,onDblclick:ie=>C(d,V),class:G(["font-mono text-slate-300",d.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:d.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},n(ee(d[V])),43,ws))])),64)),e("td",_s,n(ee(d.jobsCost)),1),d.personalUse?(s(),o(Z,{key:1},[p[3]||(p[3]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),p[4]||(p[4]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),p[5]||(p[5]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),p[6]||(p[6]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1))],64)):(s(),o(Z,{key:0},[(s(),o(Z,null,me(ae,V=>e("td",{key:V,class:"py-3 px-2 text-right"},[oe(d.id,V)?ce((s(),o("input",{key:0,"onUpdate:modelValue":p[2]||(p[2]=ie=>_.value=ie),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[xe(ie=>W(d),["enter"]),xe(se,["escape"])],onBlur:ie=>W(d),autofocus:""},null,40,Cs)),[[fe,_.value]]):(s(),o("span",{key:1,onDblclick:ie=>C(d,V),class:G(["font-mono text-slate-300",d.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:d.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},n(ee(d[V])),43,$s))])),64)),e("td",{class:G(["py-3 px-2 text-right font-mono",S(d.profit)])},n(ee(d.profit)),3),e("td",{class:G(["py-3 px-2 text-right font-mono",S(d.profitPercent)])},n(d.profitPercent!=null?`${d.profitPercent}%`:"-"),3)],64)),e("td",Ss,[e("button",{onClick:V=>j(d),class:G(["text-xs px-2 py-1 rounded",d.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-cyan-500/20 text-cyan-400"])},n(d.status==="completed"?"Terminé":"Actif"),11,Ms)]),e("td",Ts,[e("div",js,[e("button",{onClick:V=>T("view-project",d.id),class:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-cyan-400",title:"Détails"},[...p[7]||(p[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,Ps),e("button",{onClick:V=>J(d.id),class:"p-1 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400",title:"Supprimer"},[...p[8]||(p[8]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Is)])])]))),128))]),c(E).projects.length>0?(s(),o("tfoot",Es,[e("tr",Bs,[p[9]||(p[9]=e("td",{colspan:"11",class:"py-3 px-3 text-right"},"Total Profit",-1)),e("td",{class:G(["py-3 px-2 text-right font-mono",S(c(E).totalProfit)])},n(ee(c(E).totalProfit)),3),p[10]||(p[10]=e("td",{colspan:"3"},null,-1))])])):x("",!0)]),c(E).projects.length===0?(s(),o("div",Ls," Aucun projet. Créez votre premier projet de construction ci-dessus. ")):x("",!0)]))}}),Ns={class:"space-y-6"},As={class:"text-xs font-semibold uppercase tracking-wider text-slate-500 mb-2"},zs={class:"space-y-1"},Js=["onClick"],Vs=["src"],qs={class:"flex-1 min-w-0"},Ds={class:"flex items-center gap-2 flex-wrap"},Hs={class:"font-medium text-slate-200"},Us={key:0,class:"text-xs text-slate-500"},Fs=["title"],Os={class:"text-emerald-400"},Ks={class:"flex items-center gap-3 mt-1 text-xs"},Qs={key:0,class:"text-red-400"},Xs={key:1,class:"text-slate-500"},Ws={key:2,class:"text-cyan-400"},Zs={key:3,class:"text-emerald-400"},Ys={key:4,class:"text-slate-500 flex items-center gap-1"},Gs=["checked","disabled","onChange"],eo=["src"],to={class:"flex-1 min-w-0"},so={class:"flex items-center gap-2 flex-wrap"},oo={class:"font-medium text-slate-200"},no={class:"text-xs text-slate-500"},ro={key:0,class:"inline-flex items-center gap-1"},lo=["onKeydown","onBlur"],ao=["onDblclick"],io=["title"],uo={key:2,class:"text-xs text-slate-500"},co={key:3,class:"text-xs px-1.5 py-0.5 rounded bg-blue-500/20 text-blue-400",title:"Lie a un job ESI"},po=["title"],vo={key:0,class:"flex items-center gap-2 mt-1 text-xs flex-wrap"},mo={key:0,class:"text-slate-500"},fo={key:1,class:"text-slate-600"},xo={key:2,class:"text-slate-500"},yo={key:3,class:"text-amber-400"},bo={key:1,class:"flex items-center gap-1 mt-1 text-xs text-slate-500"},go={key:0,class:"text-slate-600"},ho=["checked","disabled","onChange"],ko={key:1,class:"text-xs font-mono text-slate-400"},wo=["onClick"],_o={key:3,class:"w-7"},Co={key:0,class:"flex items-center gap-3 p-3 ml-6 rounded-lg border border-dashed border-slate-600 hover:border-cyan-500/50 transition-colors"},$o={key:0,class:"flex items-center gap-2 flex-1"},So=["onKeydown"],Mo=["onClick"],To=["onClick"],jo={class:"text-slate-400 mb-6"},Po={class:"text-slate-200 font-medium"},Io=Qe({__name:"StepTree",props:{steps:{},readonly:{type:Boolean}},emits:["toggle-purchased","update-step-runs","delete-step","add-child-job"],setup(B,{emit:u}){const T=B,E=u,l=v(null),Q=v(0),I=v(null),_=v(1),C=v(null),W=v(!1),se=v(null),oe=v(""),ee=v(null);et(()=>T.steps,i=>{if(C.value){const y=i.find(ne=>ne.id===C.value);y!=null&&y.splitGroupId&&w.value.add(y.splitGroupId),C.value=null}},{deep:!0});const{formatIsk:S}=bt(),{getTypeIconUrl:j,onImageError:J}=pt();function D(i){if(i===null||i<=0)return"-";const y=Math.floor(i/86400),ne=Math.floor(i%86400/3600),P=Math.floor(i%3600/60);return y>0?`${y}j ${ne}h`:ne>0?`${ne}h ${P}m`:`${P}m`}function le(i){return i.timePerRun===null?null:i.timePerRun*i.runs}function ae(i){let y=0,ne=!1;for(const P of i){if(P.purchased||P.inStock)continue;const h=le(P);h!==null&&(ne=!0,y=Math.max(y,h))}return ne?y:null}const w=v(new Set);function p(i){w.value.has(i)?w.value.delete(i):w.value.add(i)}function d(i){return i.inStock?4:i.purchased?3:i.esiJobStatus==="delivered"||i.esiJobStatus==="ready"?2:i.esiJobStatus==="active"?1:0}function V(i){return i.children.length===0?99:Math.min(...i.children.map(d))}function ie(i){let y=0,ne=0,P=0;for(const h of i)h.purchased||h.inStock||(h.esiJobId?h.esiJobStatus==="active"?ne+=h.runs:h.esiJobStatus==="delivered"||h.esiJobStatus==="ready"?P+=h.runs:ne+=h.runs:y+=h.runs);return{toLaunch:y,inProgress:ne,completed:P}}const Ee=de(()=>{var h;const i=new Map;for(const N of T.steps){const pe=`${N.blueprintTypeId}_${N.activityType}`;let ve=i.get(pe);if(!ve){const ye=T.steps.filter(he=>he.blueprintTypeId===N.blueprintTypeId&&he.activityType===N.activityType),Fe=((h=ye.find(he=>he.totalGroupRuns))==null?void 0:h.totalGroupRuns)??ye.reduce((he,we)=>he+we.runs,0);ve={splitGroupId:pe,productTypeName:N.productTypeName,productTypeId:N.productTypeId,activityType:N.activityType,depth:N.depth,totalExpectedRuns:Fe,children:[],actualTotalRuns:0,isValid:!1,runsToLaunch:0,runsInProgress:0,runsCompleted:0,recommendedStructureName:N.recommendedStructureName,structureBonus:N.structureBonus},i.set(pe,ve)}ve.children.push(N)}for(const N of i.values()){N.children.sort((ve,ye)=>ye.runs-ve.runs),N.actualTotalRuns=N.children.reduce((ve,ye)=>ve+ye.runs,0),N.isValid=N.actualTotalRuns===N.totalExpectedRuns;const pe=ie(N.children);N.runsToLaunch=pe.toLaunch,N.runsInProgress=pe.inProgress,N.runsCompleted=pe.completed}const y=new Map;for(const N of i.values()){if(N.children.length===0)continue;const pe=N.children[0],ve=He(pe);let ye=y.get(ve);ye||(ye={label:ve,items:[]},y.set(ve,ye)),ye.items.push(N)}const ne=Array.from(y.values());for(const N of ne)N.items.sort((pe,ve)=>{const ye=V(pe)-V(ve);return ye!==0?ye:pe.productTypeName.localeCompare(ve.productTypeName)});const P={copy:0,reaction:1,manufacturing:2};return ne.sort((N,pe)=>{var Ye,Le,Oe,Pe;const ve=Math.min(...N.items.map(V)),ye=Math.min(...pe.items.map(V));if(ve!==ye)return ve-ye;const Fe=(Ye=N.items[0])==null?void 0:Ye.activityType,he=(Le=pe.items[0])==null?void 0:Le.activityType,we=(P[Fe??""]??99)-(P[he??""]??99);if(we!==0)return we;const We=((Oe=N.items[0])==null?void 0:Oe.depth)??0;return(((Pe=pe.items[0])==null?void 0:Pe.depth)??0)-We}),ne});function He(i){return`${i.activityType==="reaction"?"Réactions":i.activityType==="copy"?"Copies (BPC)":"Manufacturing"} — Niveau ${i.depth}`}function ke(i){return i==="reaction"?"bg-purple-500/20 text-purple-400":i==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function Xe(i){return i==="reaction"?"Réaction":i==="copy"?"BPC":"Fab"}function _e(i){return i.esiJobId!==null}function je(i){return i.map(y=>`${y.characterName}: ${y.runs} runs (${y.status==="active"?"en cours":"termine"})`).join(`
`)}function Re(i){if(i.inStockQuantity<=0||i.runs<=0)return 0;const y=i.quantity/i.runs;return Math.floor(i.inStockQuantity/y)}function Ue(i){if(i.inStock)return"En stock";if(i.inStockQuantity>0){const y=Re(i);return y>=i.runs?"En stock":`${y}/${i.runs} runs`}return i.purchased?"Acheté":i.esiJobStatus==="active"?"En cours":i.esiJobStatus==="delivered"||i.esiJobStatus==="ready"?"Terminé":"À lancer"}function Je(i){return i.inStock?"bg-green-500/20 text-green-400":i.inStockQuantity>0||i.purchased?"bg-amber-500/20 text-amber-400":i.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":i.esiJobStatus==="delivered"||i.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400"}function Ce(i){T.readonly||E("toggle-purchased",i.id,!i.purchased)}function re(i){return i.length>0&&i.every(y=>y.purchased)}function Be(i){if(T.readonly)return;const y=!re(i);for(const ne of i)ne.purchased!==y&&E("toggle-purchased",ne.id,y)}function ge(i,y){T.readonly||(se.value=i,oe.value=y,W.value=!0,yt(()=>{var ne;return(ne=ee.value)==null?void 0:ne.focus()}))}function $e(){se.value&&E("delete-step",se.value),W.value=!1,se.value=null,oe.value=""}function f(){W.value=!1,se.value=null,oe.value=""}function k(i){T.readonly||(l.value=i.id,Q.value=i.runs)}function A(i){Q.value>=1&&E("update-step-runs",i,Q.value),l.value=null}function L(){l.value=null}function q(i){T.readonly||(I.value=i,_.value=1)}function Y(i,y){_.value>=1&&(C.value=y,w.value.add(i),E("add-child-job",null,y,_.value)),I.value=null}function X(){I.value=null}return(i,y)=>(s(),o("div",Ns,[(s(!0),o(Z,null,me(Ee.value,ne=>(s(),o("div",{key:ne.label},[e("h5",As,n(ne.label),1),e("div",zs,[(s(!0),o(Z,null,me(ne.items,P=>(s(),o(Z,{key:P.splitGroupId},[e("div",{class:G(["flex items-center gap-3 p-3 rounded-lg border cursor-pointer",[P.isValid?"bg-slate-800/70 border-slate-600":"bg-red-900/20 border-red-500/50"]]),onClick:h=>p(P.splitGroupId)},[(s(),o("svg",{class:G(["w-4 h-4 text-slate-400 transition-transform",{"rotate-90":w.value.has(P.splitGroupId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...y[8]||(y[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),e("img",{src:c(j)(P.productTypeId,32),class:"w-8 h-8 rounded",onError:y[0]||(y[0]=(...h)=>c(J)&&c(J)(...h))},null,40,Vs),e("div",qs,[e("div",Ds,[e("span",Hs,n(P.productTypeName),1),P.children.length>1?(s(),o("span",Us,"("+n(P.children.length)+" jobs)",1)):x("",!0),e("span",{class:G(["text-xs px-1.5 py-0.5 rounded",ke(P.activityType)])},n(Xe(P.activityType)),3),P.recommendedStructureName?(s(),o("span",{key:1,class:"text-xs text-slate-500 flex items-center gap-1",title:`Bonus: ${P.structureBonus}%`},[y[9]||(y[9]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),te(" "+n(P.recommendedStructureName)+" ",1),e("span",Os,"("+n(P.structureBonus)+"%)",1)],8,Fs)):x("",!0)]),e("div",Ks,[e("span",{class:G(["font-mono",P.isValid?"text-slate-400":"text-red-400"])},n(P.actualTotalRuns)+" / "+n(P.totalExpectedRuns)+" runs ",3),P.isValid?x("",!0):(s(),o("span",Qs," ("+n(P.actualTotalRuns>P.totalExpectedRuns?"+":"")+n(P.actualTotalRuns-P.totalExpectedRuns)+") ",1)),P.runsToLaunch>0?(s(),o("span",Xs,n(P.runsToLaunch)+" à lancer ",1)):x("",!0),P.runsInProgress>0?(s(),o("span",Ws,n(P.runsInProgress)+" en cours ",1)):x("",!0),P.runsCompleted>0?(s(),o("span",Zs,n(P.runsCompleted)+" terminés ",1)):x("",!0),ae(P.children)?(s(),o("span",Ys,[y[10]||(y[10]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),te(" "+n(D(ae(P.children))),1)])):x("",!0)])]),P.depth>0?(s(),o("label",{key:0,class:G(["flex items-center gap-1.5",B.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:y[1]||(y[1]=Te(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:re(P.children),disabled:B.readonly,onChange:h=>Be(P.children),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,Gs),y[11]||(y[11]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)):x("",!0)],10,Js),w.value.has(P.splitGroupId)?(s(),o(Z,{key:0},[(s(!0),o(Z,null,me(P.children,h=>(s(),o("div",{key:h.id,class:"flex items-center gap-3 p-3 ml-6 rounded-lg bg-slate-800/50 border border-slate-700"},[e("img",{src:c(j)(h.productTypeId,32),class:"w-8 h-8 rounded",onError:y[2]||(y[2]=(...N)=>c(J)&&c(J)(...N))},null,40,eo),e("div",to,[e("div",so,[e("span",oo,n(h.productTypeName),1),e("span",no,"×"+n(h.quantity.toLocaleString()),1),!_e(h)&&!B.readonly?(s(),o(Z,{key:0},[l.value===h.id?(s(),o("span",ro,[y[12]||(y[12]=e("span",{class:"text-xs text-slate-600"},"(",-1)),ce(e("input",{"onUpdate:modelValue":y[3]||(y[3]=N=>Q.value=N),type:"number",min:"1",class:"w-16 px-1 py-0.5 bg-slate-700 border border-cyan-500 rounded text-xs text-slate-200 focus:outline-none",onKeydown:[xe(N=>A(h.id),["enter"]),xe(L,["escape"])],onBlur:N=>A(h.id),onFocus:y[4]||(y[4]=N=>N.target.select()),onClick:y[5]||(y[5]=Te(()=>{},["stop"])),autofocus:""},null,40,lo),[[fe,Q.value,void 0,{number:!0}]]),y[13]||(y[13]=e("span",{class:"text-xs text-slate-600"},"runs)",-1))])):(s(),o("span",{key:1,onDblclick:Te(N=>k(h),["stop"]),class:"text-xs text-slate-600 cursor-pointer hover:text-cyan-400",title:"Double-cliquer pour modifier"}," ("+n(h.runs)+" runs) ",41,ao))],64)):(s(),o("span",{key:1,class:"text-xs text-slate-600",title:_e(h)?"Lié à ESI - non modifiable":"Projet terminé"}," ("+n(h.runs)+" runs) ",9,io)),h.isSplit?(s(),o("span",uo,"#"+n(h.splitIndex+1),1)):x("",!0),_e(h)?(s(),o("span",co," ESI ")):x("",!0),h.similarJobs&&h.similarJobs.length>0?(s(),o("span",{key:4,class:"text-xs px-1.5 py-0.5 rounded bg-amber-500/20 text-amber-400 cursor-help",title:je(h.similarJobs)},n(h.similarJobs.length)+" job"+n(h.similarJobs.length>1?"s":"")+" similaire"+n(h.similarJobs.length>1?"s":""),9,po)):x("",!0)]),h.esiJobId||h.manualJobData?(s(),o("div",vo,[h.esiJobCharacterName?(s(),o("span",mo,n(h.esiJobCharacterName),1)):x("",!0),h.esiJobsCount&&h.esiJobsCount>1?(s(),o("span",fo," ("+n(h.esiJobsCount)+" jobs) ",1)):x("",!0),e("span",{class:G(["font-mono",h.esiJobsTotalRuns&&h.esiJobsTotalRuns>=h.runs?"text-emerald-400":"text-amber-400"])},n(h.esiJobsTotalRuns||h.esiJobRuns||0)+" / "+n(h.runs)+" runs ",3),h.esiJobsActiveRuns||h.esiJobsDeliveredRuns?(s(),o("span",xo," ("+n(h.esiJobsDeliveredRuns||0)+" livrés, "+n(h.esiJobsActiveRuns||0)+" en cours) ",1)):x("",!0),h.manualJobData?(s(),o("span",yo,"(manuel)")):x("",!0)])):x("",!0),le(h)&&!h.purchased&&!h.inStock?(s(),o("div",bo,[y[14]||(y[14]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),te(" "+n(D(le(h)))+" ",1),h.runs>1?(s(),o("span",go,"("+n(D(h.timePerRun))+"/run)",1)):x("",!0)])):x("",!0)]),e("span",{class:G(["text-xs px-2 py-1 rounded",Je(h)])},n(Ue(h)),3),h.depth>0&&!h.inStock?(s(),o("label",{key:0,class:G(["flex items-center gap-1.5",B.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:y[6]||(y[6]=Te(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:h.purchased,disabled:B.readonly,onChange:N=>Ce(h),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,ho),y[15]||(y[15]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)):x("",!0),h.esiJobCost?(s(),o("span",ko,n(c(S)(h.esiJobCost)),1)):x("",!0),!_e(h)&&!B.readonly?(s(),o("button",{key:2,onClick:Te(N=>ge(h.id,h.productTypeName),["stop"]),class:"p-1.5 text-slate-500 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer cette étape"},[...y[16]||(y[16]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,wo)):(s(),o("div",_o))]))),128)),B.readonly?x("",!0):(s(),o("div",Co,[I.value===P.splitGroupId?(s(),o("div",$o,[y[17]||(y[17]=e("span",{class:"text-sm text-slate-400"},"Runs:",-1)),ce(e("input",{"onUpdate:modelValue":y[7]||(y[7]=h=>_.value=h),type:"number",min:"1",class:"w-20 px-2 py-1 bg-slate-700 border border-cyan-500 rounded text-sm text-slate-200 focus:outline-none",onKeydown:[xe(h=>{var N;return Y(P.splitGroupId,(N=P.children[0])==null?void 0:N.id)},["enter"]),xe(X,["escape"])],autofocus:""},null,40,So),[[fe,_.value,void 0,{number:!0}]]),e("button",{onClick:h=>{var N;return Y(P.splitGroupId,(N=P.children[0])==null?void 0:N.id)},class:"px-3 py-1 bg-cyan-600 hover:bg-cyan-500 rounded text-sm text-white"}," Ajouter ",8,Mo),e("button",{onClick:X,class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm text-slate-300"}," Annuler ")])):(s(),o("button",{key:1,onClick:h=>q(P.splitGroupId),class:"flex items-center gap-2 text-slate-500 hover:text-cyan-400 transition-colors"},[...y[18]||(y[18]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"text-sm"},"Ajouter un job",-1)])],8,To))]))],64)):x("",!0)],64))),128))])]))),128)),(s(),De(dt,{to:"body"},[W.value?(s(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",onKeydown:[xe($e,["enter"]),xe(f,["escape"])]},[e("div",{class:"absolute inset-0 bg-black/70",onClick:f}),e("div",{class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 p-6",tabindex:"-1",ref_key:"deleteModalRef",ref:ee},[y[21]||(y[21]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-2"},"Supprimer l'étape",-1)),e("p",jo,[y[19]||(y[19]=te(" Voulez-vous vraiment supprimer l'étape ",-1)),e("span",Po,'"'+n(oe.value)+'"',1),y[20]||(y[20]=te(" ? ",-1))]),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:f,class:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg text-slate-300 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:$e,class:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white text-sm font-medium transition-colors"}," Supprimer ")])],512)],32)):x("",!0)]))]))}}),Eo={class:"space-y-2"},Bo={class:"bg-slate-800/50 border border-slate-700 rounded-lg p-3"},Lo={class:"flex items-center gap-3"},Ro=["src"],No={class:"flex-1 min-w-0"},Ao={class:"flex items-center gap-2 flex-wrap"},zo={class:"font-medium text-slate-200"},Jo={class:"text-xs text-slate-500"},Vo={class:"text-xs text-slate-600"},qo={key:0,class:"text-xs text-slate-500 flex items-center gap-1 mt-1"},Do={class:"text-emerald-400"},Ho=["checked","disabled"],Uo={key:0,class:"pl-6 border-l-2 border-slate-700 ml-4 space-y-2"},Fo={key:0,class:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-2"},Oo={class:"flex items-center gap-2"},Ko=["src"],Qo={class:"text-sm text-slate-400"},Xo={class:"text-xs text-slate-500 ml-auto"},Wo=Qe({__name:"StepHierarchyTree",props:{tree:{},steps:{},readonly:{type:Boolean}},emits:["toggle-purchased"],setup(B,{emit:u}){const T=B,E=u,{getTypeIconUrl:l,onImageError:Q}=pt();function I(S){return T.steps.find(j=>j.blueprintTypeId===S.blueprintTypeId&&j.activityType===S.activityType)}function _(S){return S==="reaction"?"bg-purple-500/20 text-purple-400":S==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function C(S){return S==="reaction"?"Réaction":S==="copy"?"BPC":"Fab"}function W(S){if(!S||S.inStockQuantity<=0||S.runs<=0)return 0;const j=S.quantity/S.runs;return Math.floor(S.inStockQuantity/j)}function se(S){if(!S)return"-";if(S.inStock)return"En stock";if(S.inStockQuantity>0){const j=W(S);return j>=S.runs?"En stock":`${j}/${S.runs} runs`}return S.purchased?"Acheté":S.esiJobStatus==="active"?"En cours":S.esiJobStatus==="delivered"||S.esiJobStatus==="ready"?"Terminé":"À lancer"}function oe(S){return S?S.inStock?"bg-green-500/20 text-green-400":S.inStockQuantity>0||S.purchased?"bg-amber-500/20 text-amber-400":S.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":S.esiJobStatus==="delivered"||S.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400":"bg-slate-500/20 text-slate-400"}function ee(S){T.readonly||E("toggle-purchased",S.id,!S.purchased)}return(S,j)=>{var D,le,ae;const J=Ut("StepHierarchyTree",!0);return s(),o("div",Eo,[e("div",Bo,[e("div",Lo,[e("img",{src:c(l)(B.tree.productTypeId,32),class:"w-8 h-8 rounded",onError:j[0]||(j[0]=(...w)=>c(Q)&&c(Q)(...w))},null,40,Ro),e("div",No,[e("div",Ao,[e("span",zo,n(B.tree.productTypeName),1),e("span",Jo,"×"+n(B.tree.quantity.toLocaleString()),1),e("span",Vo,"("+n(B.tree.runs)+" runs)",1),e("span",{class:G(["text-xs px-1.5 py-0.5 rounded",_(B.tree.activityType)])},n(C(B.tree.activityType)),3)]),B.tree.structureName?(s(),o("div",qo,[j[4]||(j[4]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),te(" "+n(B.tree.structureName)+" ",1),e("span",Do,"("+n(B.tree.structureBonus)+"%)",1)])):x("",!0)]),I(B.tree)?(s(),o(Z,{key:0},[e("span",{class:G(["text-xs px-2 py-1 rounded",oe(I(B.tree))])},n(se(I(B.tree))),3),(((D=I(B.tree))==null?void 0:D.depth)??0)>0&&!((le=I(B.tree))!=null&&le.inStock)?(s(),o("label",{key:0,class:G(["flex items-center gap-1.5",B.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"])},[e("input",{type:"checkbox",checked:(ae=I(B.tree))==null?void 0:ae.purchased,disabled:B.readonly,onChange:j[1]||(j[1]=w=>ee(I(B.tree))),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,Ho),j[5]||(j[5]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)):x("",!0)],64)):x("",!0)])]),B.tree.materials&&B.tree.materials.length>0?(s(),o("div",Uo,[(s(!0),o(Z,null,me(B.tree.materials,w=>(s(),o("div",{key:w.typeId,class:"relative"},[j[6]||(j[6]=e("div",{class:"absolute -left-6 top-4 w-6 h-0.5 bg-slate-700"},null,-1)),w.isBuildable?w.blueprint?(s(),De(J,{key:1,tree:w.blueprint,steps:B.steps,readonly:B.readonly,onTogglePurchased:j[3]||(j[3]=(p,d)=>E("toggle-purchased",p,d))},null,8,["tree","steps","readonly"])):x("",!0):(s(),o("div",Fo,[e("div",Oo,[e("img",{src:c(l)(w.typeId,32),class:"w-6 h-6 rounded",onError:j[2]||(j[2]=(...p)=>c(Q)&&c(Q)(...p))},null,40,Ko),e("span",Qo,n(w.typeName),1),e("span",Xo,"×"+n(w.quantity.toLocaleString()),1)])]))]))),128))])):x("",!0)])}}}),Zo={class:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden"},Yo={class:"px-6 py-4 border-b border-slate-800 flex items-center justify-between group"},Go={class:"flex items-center gap-4"},en={key:0,class:"flex items-center gap-3"},tn=["src"],sn={key:1,class:"flex -space-x-2"},on=["src","title"],nn={key:0,class:"w-10 h-10 rounded border-2 border-slate-900 bg-slate-700 flex items-center justify-center text-xs text-slate-300"},rn={class:"flex items-center gap-2"},ln={key:0,class:"text-lg font-semibold text-slate-100"},an={key:0,class:"text-sm text-slate-500"},un={key:0,class:"text-slate-400"},dn={key:1,class:"text-sm text-slate-500"},cn={class:"flex flex-wrap gap-x-3 gap-y-1"},pn={class:"text-slate-500"},vn={class:"mt-1"},mn={class:"flex items-center gap-2"},fn=["disabled"],xn={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yn={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},bn={class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gn={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},hn={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},kn={key:0,class:"p-8 text-center text-slate-500"},wn={key:1,class:"p-6"},_n={key:0,class:"mb-4 p-3 bg-amber-500/20 border border-amber-500/50 rounded-lg flex items-center gap-3"},Cn={class:"text-amber-200 text-sm"},$n={class:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6"},Sn={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},Mn={class:"text-lg font-mono text-slate-200 mt-1"},Tn={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},jn={class:"text-lg font-mono text-slate-200 mt-1"},Pn={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},In={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},En={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},Bn={class:"text-lg font-mono text-cyan-400 mt-1"},Ln={class:"flex gap-4 mb-4 border-b border-slate-700"},Rn=["disabled","title"],Nn={key:1},An={class:"mb-4 flex items-center justify-between"},zn={class:"flex items-center gap-4"},Jn={class:"flex items-center gap-1 bg-slate-800 rounded-lg p-1"},Vn={key:0},qn={key:0},Dn={key:1,class:"text-center py-8 text-slate-500"},Hn={key:1},Un={key:0},Fn={key:1,class:"text-center py-8 text-slate-500"},On={key:2},Kn={key:0,class:"text-center py-8 text-slate-500"},Qn={key:1,class:"text-center py-8"},Xn={class:"bg-red-900/20 border border-red-500/30 rounded-xl p-6 max-w-md mx-auto"},Wn={class:"text-slate-400 text-sm mb-4"},Zn={key:2,class:"text-center py-8 text-slate-500"},Yn={key:3,class:"space-y-4"},Gn={class:"flex flex-wrap items-start justify-between gap-4"},er={class:"flex items-center gap-3"},tr={class:"flex items-center gap-1.5 px-2.5 py-1 bg-emerald-900/30 border border-emerald-500/30 rounded-full cursor-help",title:"Matériaux complets - quantité en stock suffisante"},sr={class:"text-emerald-400 text-sm font-bold"},or={class:"flex items-center gap-1.5 px-2.5 py-1 bg-amber-900/30 border border-amber-500/30 rounded-full cursor-help",title:"Matériaux partiels - quantité en stock insuffisante"},nr={class:"text-amber-400 text-sm font-bold"},rr={class:"flex items-center gap-1.5 px-2.5 py-1 bg-red-900/30 border border-red-500/30 rounded-full cursor-help",title:"Matériaux manquants - rien en stock"},lr={class:"text-red-400 text-sm font-bold"},ar={key:0,class:"text-xs text-slate-500 flex items-center gap-1 cursor-help",title:"Nombre total d'items différents dans votre stock"},ir={key:0,class:"flex flex-wrap items-end gap-3"},ur={class:"relative min-w-[220px]"},dr={class:"relative"},cr=["placeholder"],pr={class:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center"},vr={key:0,class:"w-4 h-4 animate-spin text-cyan-400",fill:"none",viewBox:"0 0 24 24"},mr={key:0,class:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-48 overflow-y-auto"},fr=["onMousedown"],xr={class:"truncate"},yr={key:0,class:"px-3 py-2 text-slate-400 text-sm"},br={class:"flex items-center gap-1.5"},gr={key:0,class:"p-3 bg-cyan-900/20 border border-cyan-500/30 rounded-lg flex items-center gap-3"},hr={class:"flex-1"},kr={class:"text-sm text-cyan-300"},wr={key:0,class:"mt-1 h-1.5 bg-slate-700 rounded-full overflow-hidden"},_r={class:"bg-cyan-900/20 border border-cyan-500/20 rounded-lg px-3 py-2 flex items-center gap-2"},Cr={class:"text-cyan-300/80 text-xs"},$r={key:0,class:"ml-auto text-xs text-slate-500 flex items-center gap-1"},Sr={key:1,class:"bg-amber-900/30 border border-amber-500/50 rounded-lg p-3"},Mr={class:"flex items-center justify-between gap-3"},Tr={class:"flex items-center gap-3"},jr={class:"text-sm"},Pr={class:"text-amber-400/70 text-xs mt-0.5"},Ir=["disabled"],Er={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Br={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Lr={key:2,class:"p-3 bg-red-900/20 border border-red-500/30 rounded-lg flex items-center gap-2"},Rr={class:"text-red-400 text-sm"},Nr={class:"flex gap-3 items-start"},Ar={class:"flex flex-col gap-2"},zr=["disabled"],Jr={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Vr={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qr={class:"px-4 py-3 cursor-pointer flex items-center gap-2 select-none hover:bg-slate-700/30 rounded-lg"},Dr={class:"text-sm font-semibold text-slate-200"},Hr={key:0,class:"text-xs text-cyan-400"},Ur={class:"p-4 border-t border-slate-700"},Fr={class:"grid grid-cols-3 gap-2 mb-3 text-xs"},Or={class:"bg-emerald-900/20 border border-emerald-500/20 rounded px-2 py-1 text-center"},Kr={class:"font-bold text-emerald-400"},Qr={class:"bg-amber-900/20 border border-amber-500/20 rounded px-2 py-1 text-center"},Xr={class:"font-bold text-amber-400"},Wr={class:"bg-slate-700/50 border border-slate-600/50 rounded px-2 py-1 text-center"},Zr={class:"font-bold text-slate-400"},Yr={class:"space-y-2 max-h-64 overflow-y-auto"},Gr={class:"flex items-center gap-3 flex-1 min-w-0"},el=["src"],tl={class:"min-w-0 flex-1"},sl={class:"flex items-center gap-2"},ol={class:"text-sm text-slate-200 truncate"},nl={class:"flex items-center gap-2 text-xs"},rl={class:"text-slate-500"},ll={class:"flex items-center gap-2 flex-shrink-0"},al=["value","onChange"],il={class:"px-4 py-3 cursor-pointer flex items-center justify-between select-none hover:bg-slate-700/30 rounded-lg"},ul={class:"flex items-center gap-2"},dl={class:"text-sm font-semibold text-slate-200"},cl={key:0,class:"text-xs text-amber-400"},pl={class:"p-4 border-t border-slate-700"},vl={class:"grid grid-cols-3 gap-2 mb-3 text-xs"},ml={class:"bg-emerald-900/20 border border-emerald-500/20 rounded px-2 py-1 text-center"},fl={class:"font-bold text-emerald-400"},xl={class:"bg-amber-900/20 border border-amber-500/20 rounded px-2 py-1 text-center"},yl={class:"font-bold text-amber-400"},bl={class:"bg-slate-700/50 border border-slate-600/50 rounded px-2 py-1 text-center"},gl={class:"font-bold text-slate-400"},hl={class:"space-y-2 max-h-80 overflow-y-auto"},kl={class:"flex items-center gap-3 flex-1 min-w-0"},wl=["src"],_l={class:"min-w-0 flex-1"},Cl={class:"text-sm text-slate-200 truncate"},$l={class:"flex items-center gap-2 text-xs"},Sl={class:"text-slate-500"},Ml={key:0,class:"text-amber-400"},Tl={class:"flex items-center gap-2 flex-shrink-0"},jl=["value","onChange"],Pl={class:"bg-slate-800/50 rounded-xl p-4 border border-slate-700"},Il={class:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-4"},El={class:"text-lg font-mono text-slate-200"},Bl={class:"text-sm font-mono text-slate-400"},Ll={class:"text-sm font-mono text-emerald-400"},Rl={class:"md:col-span-2"},Nl={class:"text-xl font-mono text-amber-400 font-bold"},Al={class:"flex flex-wrap items-center gap-3 pt-3 border-t border-slate-700"},zl={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Jl={key:1,class:"w-4 h-4 text-green-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Vl={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ql={key:1,class:"w-4 h-4 text-green-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Dl={key:2,class:"flex items-center gap-3"},Hl={class:"text-sm text-slate-400"},Ul={class:"font-mono text-emerald-400"},Fl={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},Ol={class:"px-6 py-4"},Kl={class:"px-6 py-4 border-t border-slate-700 flex justify-end gap-3"},Ql=["disabled"],Xl={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wl={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Zl={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},Yl={class:"px-6 py-4 border-b border-slate-700 flex items-center justify-between"},Gl={class:"px-6 py-4"},ea={class:"text-sm text-slate-500 mt-2"},ta={class:"px-6 py-4 border-t border-slate-700 flex justify-end gap-3"},sa="C-J6MT - 1st Taj Mahgoon",oa=Qe({__name:"ProjectDetail",props:{projectId:{}},emits:["close"],setup(B,{emit:u}){const T=B,E=u,l=rt(),Q=Ft(),I=Yt(),{formatIsk:_,formatDateTime:C}=bt(),{getTypeIconUrl:W,onImageError:se}=pt(),oe=v("steps"),ee=v("flat"),S=v([]),j=v(""),J=v(!1),D=v(!1),le=v(null),ae=v(null),w=v(null),p=v(!1),d=v(!1),V=v(1200),ie=v(!1),Ee=v(null),He=v(!1),ke=de(()=>I.getSyncProgress("market-structure")),Xe=de(()=>I.getSyncProgress("industry-project"));et(ke,r=>{(r==null?void 0:r.status)==="completed"&&oe.value==="shopping"&&ze()}),et(Xe,r=>{(r==null?void 0:r.status)==="completed"&&(l.fetchProject(T.projectId),He.value=!1)});const _e=v(!1),je=v("");function Re(){var r,t;je.value=((r=l.currentProject)==null?void 0:r.name)||((t=l.currentProject)==null?void 0:t.productTypeName)||"",_e.value=!0}async function Ue(){var M,R;if(!_e.value)return;_e.value=!1;const r=je.value.trim(),t=r&&r!==((M=l.currentProject)==null?void 0:M.productTypeName)?r:null;t!==((R=l.currentProject)==null?void 0:R.name)&&await l.updateProject(T.projectId,{name:t})}function Je(){_e.value=!1}const Ce=v(""),re=v([]),Be=v([]),ge=v([]),$e=v(null),f=v(!1),k=v(!1),A=v(!1),L=v(!0),q=v(new Map);et(()=>{var r;return(r=l.currentProject)==null?void 0:r.tree},r=>{r&&Tt(r)},{immediate:!0});const Y=de(()=>Be.value.filter(r=>!r.isIntermediate)),X=v(!1),i=v(!1);function y(r){if(r===null||r<=0)return"-";const t=Math.floor(r/86400),M=Math.floor(r%86400/3600),R=Math.floor(r%3600/60);return t>0?M>0?`${t}j ${M}h`:`${t}j`:M>0?`${M}h ${R}m`:`${R}m`}const ne=de(()=>{var R;const r=(R=l.currentProject)==null?void 0:R.steps;if(!r||r.length===0)return null;const t=new Map;for(const z of r){if(z.purchased||z.inStock||z.timePerRun===null)continue;const F=z.timePerRun*z.runs,O=z.depth,b=t.get(O)??0;F>b&&t.set(O,F)}let M=0;for(const z of t.values())M+=z;return M>0?M:null}),P=de(()=>{var M;const r=(M=l.currentProject)==null?void 0:M.steps;if(!r||r.length===0)return[];const t=new Map;for(const R of r)if(R.depth===0&&(R.activityType==="manufacturing"||R.activityType==="reaction")){const z=t.get(R.productTypeId);z?z.runs+=R.runs:t.set(R.productTypeId,{typeId:R.productTypeId,typeName:R.productTypeName,runs:R.runs})}return Array.from(t.values())}),h=de(()=>P.value.length>1),N=de(()=>he.value.filter(r=>(r.bestLocation==="jita"||r.bestLocation===null)&&r.missing>0)),pe=de(()=>he.value.filter(r=>r.bestLocation==="structure"&&r.missing>0)),ve=de(()=>N.value.map(r=>`${r.typeName}	${r.missing}`).join(`
`)),ye=de(()=>pe.value.map(r=>`${r.typeName}	${r.missing}`).join(`
`)),Fe=de(()=>{var r;return((r=j.value)==null?void 0:r.split(" - ")[0])||"Structure"}),he=de(()=>{const r=new Map;for(const t of re.value){const M=t.name.toLowerCase();r.set(M,(r.get(M)??0)+t.quantity)}return S.value.map(t=>{const M=t.typeName.toLowerCase(),R=r.get(M)??0,z=Math.max(0,t.quantity-R);let F="missing";R>=t.quantity?F="ok":R>0&&(F="partial");let O=null;return t.bestPrice!==null&&t.quantity>0?O=z/t.quantity*t.bestPrice:t.jitaWithImport!==null&&t.quantity>0&&(O=z/t.quantity*t.jitaWithImport),{...t,inStock:R,missing:z,missingPrice:O,status:F}})}),we=de(()=>{let r=0,t=0;for(const M of he.value)M.missing>0&&M.missingPrice!==null&&(r+=M.missingPrice),M.missing>0&&M.volume&&(t+=M.volume*M.missing);return{price:r,volume:t}}),We=de(()=>{const r=he.value.filter(R=>R.status==="ok").length,t=he.value.filter(R=>R.status==="partial").length,M=he.value.filter(R=>R.status==="missing").length;return{ok:r,partial:t,missing:M}});function Ze(){return`industry_stock_${T.projectId}`}function Ye(){const r=localStorage.getItem(Ze());if(r)try{const t=JSON.parse(r);Ce.value=t.raw||"",re.value=t.parsed||[]}catch{}}function Le(){localStorage.setItem(Ze(),JSON.stringify({raw:Ce.value,parsed:re.value}))}const Oe=v(!1),Pe=v(""),tt=v(!1),Ne=v({id:null,name:""}),Ae=v(""),Ve=v([]),$=v(!1),a=v(!1);let g=null;et(Ae,r=>{if(g&&clearTimeout(g),r.length<3){Ve.value=[];return}g=setTimeout(()=>{be(r)},300)});async function be(r){$.value=!0;try{const t=await Ot(`/api/shopping-list/search-structures?q=${encodeURIComponent(r)}`,{headers:{Authorization:`Bearer ${Q.token}`,"X-Requested-With":"XMLHttpRequest"}});if(t.ok){const M=await Kt(t);Ve.value=M.results,a.value=!0}}catch(t){console.error("Structure search failed:",t)}finally{$.value=!1}}function Ie(r){Ne.value={id:r.id,name:r.name},Ae.value="",Ve.value=[],a.value=!1}function lt(){Ne.value={id:null,name:""},Ae.value="",Ve.value=[]}function qe(){setTimeout(()=>{a.value=!1},200)}ct(async()=>{await l.fetchProject(T.projectId),Ye(),re.value.length>0&&await st()});async function st(){if(re.value.length!==0){if(S.value.length===0){f.value=!0;try{await ze()}finally{f.value=!1}}Ge()}}async function Se(r,t){await l.toggleStepPurchased(T.projectId,r,t),await ze(),Ge()}async function at(){ie.value=!0,Ee.value=null;try{const r=await l.matchJobs(T.projectId);Ee.value=r,await l.fetchProject(T.projectId)}finally{ie.value=!1}}function it(r){return Math.ceil(r/1e6)*1e6}async function ze(){p.value=!0,w.value=null;try{const r=Ne.value.id??void 0,t=await l.fetchShoppingList(T.projectId,r,V.value);if(t){if(S.value=t.materials,j.value=t.structureName,J.value=t.structureAccessible,D.value=t.structureFromCache,le.value=t.structureLastSync,ae.value=t.totals,w.value=t.priceError,l.currentProject&&(l.currentProject.materialCost===null||l.currentProject.materialCost===0)&&t.totals.best>0){const M=it(t.totals.best);await l.updateProject(T.projectId,{materialCost:M})}}else S.value=[],ae.value=null,J.value=!1,w.value=l.error}catch(r){S.value=[],ae.value=null,J.value=!1,w.value=r instanceof Error?r.message:"Erreur lors du chargement"}finally{p.value=!1}}async function vt(){d.value=!0,w.value=null;try{const r=Ne.value.id??void 0;await ue("/shopping-list/sync-structure-market",{method:"POST",body:JSON.stringify({structureId:r})}),await ze()}catch(r){w.value=r instanceof Error?r.message:"Sync failed"}finally{d.value=!1}}async function mt(){if(!ae.value||!l.currentProject)return;const r=we.value.price>0?we.value.price:ae.value.best,t=it(r);await l.updateProject(T.projectId,{materialCost:t})}async function gt(r){var t;if(oe.value=r,r==="shopping"&&((t=l.currentProject)==null?void 0:t.status)!=="completed"){if(S.value.length===0){f.value=!0;try{await ze()}finally{f.value=!1}}Ge()}}function Mt(r){if(!r.trim())return[];const t=r.trim().split(/\r?\n/),M=[];function R(z){const F=z.trim().replace(/[\s,]/g,"").replace(/\.(?=\d{3})/g,"");return parseInt(F,10)}for(const z of t){const F=z.trim();if(!F||F.toLowerCase().startsWith("total:"))continue;if(F.includes("	")){const U=F.split(/\t+/);if(U.length>=2){const H=U[0].trim(),K=R(U[1]);if(H&&/[A-Za-z]/.test(H)&&!isNaN(K)&&K>0){M.push({name:H,quantity:K});continue}}}const O=F.match(/^(.+?)\s+([\d\s,.]+)\s*(?:m[³3]|units?)?\s*$/i);if(O){const U=O[1].trim(),H=R(O[2]);if(U&&/[A-Za-z]/.test(U)&&!isNaN(H)&&H>0){M.push({name:U,quantity:H});continue}}const b=F.split(/\s+/);if(b.length>=2){const U=b[b.length-1],H=R(U);if(!isNaN(H)&&H>0&&/^\d/.test(U)){const K=b.slice(0,-1).join(" ").trim();if(K&&/[A-Za-z]/.test(K)){M.push({name:K,quantity:H});continue}}}/[A-Za-z]/.test(F)&&!F.includes("	")&&M.push({name:F,quantity:1})}return M}function Ge(){var O;if(S.value.length===0){Be.value=[],ge.value=[];return}const r=new Map;for(const b of re.value){const U=b.name.toLowerCase();r.set(U,(r.get(U)??0)+b.quantity)}const t=new Map,M=((O=l.currentProject)==null?void 0:O.steps)??[],R=new Set(M.filter(b=>b.depth===0&&(b.activityType==="manufacturing"||b.activityType==="reaction")).map(b=>b.productTypeId));for(const b of M){if(b.activityType!=="manufacturing"&&b.activityType!=="reaction"||R.has(b.productTypeId)||b.purchased||b.inStock)continue;const U=b.productTypeName.toLowerCase(),H=r.get(U)??0,K=t.get(b.productTypeId);if(K)K.needed+=b.quantity,K.runsNeeded+=b.runs,K.runsCovered=K.needed>0?Math.min(K.runsNeeded,Math.floor(K.runsNeeded*K.inStock/K.needed)):0,K.inStock>=K.needed?K.status="ok":K.inStock>0?K.status="partial":K.status="missing";else{const Ke=b.quantity>0?Math.min(b.runs,Math.floor(b.runs*H/b.quantity)):0;let nt="missing";H>=b.quantity?nt="ok":H>0&&(nt="partial"),t.set(b.productTypeId,{typeId:b.productTypeId,name:b.productTypeName,inStock:H,needed:b.quantity,stepId:b.id,blueprintTypeId:b.blueprintTypeId,runsNeeded:b.runs,runsCovered:Ke,status:nt,activityType:b.activityType})}}ge.value=Array.from(t.values()).sort((b,U)=>b.inStock>0&&U.inStock===0?-1:b.inStock===0&&U.inStock>0?1:b.name.localeCompare(U.name));const z=[];for(const b of S.value){const U=b.typeName.toLowerCase(),H=r.get(U)??0;if(H>0||b.quantity>0){const K=Math.max(0,b.quantity-H);let Ke="missing";H>=b.quantity?Ke="ok":H>0&&(Ke="partial"),z.push({typeId:b.typeId,name:b.typeName,needed:b.quantity,inStock:H,missing:K,status:Ke})}}const F={missing:0,partial:1,ok:2};z.sort((b,U)=>F[b.status]!==F[U.status]?F[b.status]-F[U.status]:b.name.localeCompare(U.name)),Be.value=z}function Tt(r){q.value.clear();function t(M){var F,O;const R=`${M.blueprintTypeId}_${M.activityType}`,z=[];for(const b of M.materials)z.push({typeId:b.typeId,typeName:b.typeName,blueprintTypeId:((F=b.blueprint)==null?void 0:F.blueprintTypeId)??0,activityType:((O=b.blueprint)==null?void 0:O.activityType)??"",quantityPerUnit:M.quantity>0?b.quantity/M.quantity:0,isBuildable:b.isBuildable}),b.isBuildable&&b.blueprint&&t(b.blueprint);z.length>0&&q.value.set(R,z)}t(r)}async function ft(r,t,M){var F,O;const R=`${r}_${t}`,z=q.value.get(R);if(!(!z||M<=0))for(const b of z){const U=Math.ceil(M*b.quantityPerUnit);if(b.isBuildable&&b.blueprintTypeId>0){const H=(O=(F=l.currentProject)==null?void 0:F.steps)==null?void 0:O.find(K=>K.blueprintTypeId===b.blueprintTypeId&&K.activityType===b.activityType);if(H&&H.depth>0){const K=Math.min(H.inStockQuantity+U,H.quantity);K>H.inStockQuantity&&await l.toggleStepInStock(T.projectId,H.id,K)}await ft(b.blueprintTypeId,b.activityType,U)}else{const H=re.value.findIndex(K=>K.name.toLowerCase()===b.typeName.toLowerCase());H>=0?re.value[H].quantity+=U:re.value.push({name:b.typeName,quantity:U})}}}async function jt(r,t){var b,U;const M=Math.max(0,t),R=r.inStock,z=Math.max(0,M-R),F=r.name.toLowerCase(),O=re.value.findIndex(H=>H.name.toLowerCase()===F);if(O>=0?M===0?re.value.splice(O,1):re.value[O].quantity=M:M>0&&re.value.push({name:r.name,quantity:M}),z>0&&r.blueprintTypeId>0){const H=(U=(b=l.currentProject)==null?void 0:b.steps)==null?void 0:U.find(K=>K.id===r.stepId);if(H){const K=Math.min(H.inStockQuantity+z,H.quantity);K>H.inStockQuantity&&await l.toggleStepInStock(T.projectId,H.id,K),await ft(H.blueprintTypeId,H.activityType,z)}Le(),await l.fetchProject(T.projectId)}else Le();Ge()}async function Pt(){var z,F;if($e.value=null,!Ce.value.trim()){$e.value="Collez votre inventaire EVE dans la zone de texte";return}const r=Mt(Ce.value);if(r.length===0){$e.value="Aucun item détecté. Vérifiez le format (copier depuis EVE avec Ctrl+A puis Ctrl+C)",Be.value=[],ge.value=[];return}for(const O of r){const b=re.value.findIndex(U=>U.name.toLowerCase()===O.name.toLowerCase());b>=0?re.value[b].quantity=O.quantity:re.value.push(O)}if(Ce.value="",Le(),S.value.length===0){f.value=!0;try{await ze()}finally{f.value=!1}}if(S.value.length===0){$e.value="Impossible de charger la liste de courses. Réessayez.",Be.value=[];return}const t=((z=l.currentProject)==null?void 0:z.steps)??[],M=new Set(t.filter(O=>O.depth===0&&(O.activityType==="manufacturing"||O.activityType==="reaction")).map(O=>O.productTypeId));let R=!1;for(const O of r){const b=t.find(U=>U.productTypeName.toLowerCase()===O.name.toLowerCase()&&(U.activityType==="manufacturing"||U.activityType==="reaction")&&!M.has(U.productTypeId)&&U.depth>0&&!U.purchased&&!U.inStock);if(b&&O.quantity>0){const U=(((F=re.value.find(K=>K.name.toLowerCase()===O.name.toLowerCase()))==null?void 0:F.quantity)??0)-O.quantity,H=Math.max(0,O.quantity-Math.max(0,U));if(H>0){const K=Math.min(b.inStockQuantity+H,b.quantity);K>b.inStockQuantity&&await l.toggleStepInStock(T.projectId,b.id,K),await ft(b.blueprintTypeId,b.activityType,H),R=!0}}}R&&(Le(),await l.fetchProject(T.projectId)),Ge()}function It(r,t){const M=Math.max(0,t),R=r.toLowerCase(),z=re.value.findIndex(F=>F.name.toLowerCase()===R);z>=0?M===0?re.value.splice(z,1):re.value[z].quantity=M:M>0&&re.value.push({name:r,quantity:M}),Le(),Ge()}function Et(){Ce.value="",re.value=[],$e.value=null,localStorage.removeItem(Ze()),k.value=!1,Ge()}function Bt(){k.value=!0}async function Lt(r){await l.deleteStep(T.projectId,r)}async function Rt(r,t,M){await l.addChildJob(T.projectId,r,t,M)}async function Nt(r,t){await l.updateStepRuns(T.projectId,r,t)}async function At(){if(!l.currentProject)return;const r=l.currentProject.status==="completed"?"active":"completed";await l.updateProject(T.projectId,{status:r}),r==="completed"&&(oe.value="steps")}function zt(){Pe.value="",Oe.value=!0}function ot(){Oe.value=!1,Pe.value=""}async function ht(){var r;if((r=l.currentProject)!=null&&r.steps){tt.value=!0;try{let t=0;if(Pe.value.trim()){const z=Pe.value.trim().toLowerCase().replace(/,/g,".").match(/^([\d.]+)\s*([kmb])?$/);if(z){let F=parseFloat(z[1]);const O=z[2];O==="k"?F*=1e3:O==="m"?F*=1e6:O==="b"&&(F*=1e9),t=Math.round(F)}}const M=l.currentProject.steps.filter(R=>R.activityType==="copy"&&R.depth>0);for(const R of M)if(!R.purchased)try{await l.toggleStepPurchased(T.projectId,R.id,!0)}catch{}t>=0&&await l.updateProject(T.projectId,{bpoCost:t}),ot()}finally{tt.value=!1}}}function Jt(){var r,t;return((t=(r=l.currentProject)==null?void 0:r.steps)==null?void 0:t.some(M=>M.activityType==="copy"))??!1}function kt(r,t){r&&(navigator.clipboard.writeText(r),t==="jita"?(X.value=!0,setTimeout(()=>X.value=!1,2e3)):(i.value=!0,setTimeout(()=>i.value=!1,2e3)))}function Vt(r){if(!r)return"";const t=new Date(r),R=new Date().getTime()-t.getTime(),z=Math.floor(R/6e4),F=Math.floor(z/60);return z<1?"il y a moins d'une minute":z<60?`il y a ${z} min`:F<24?`il y a ${F}h`:C(r)}return(r,t)=>{var M,R,z,F,O,b,U,H,K,Ke,nt,wt,_t;return s(),o(Z,null,[e("div",Zo,[e("div",Yo,[e("div",Go,[e("button",{onClick:t[0]||(t[0]=m=>E("close")),class:"p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-slate-200"},[...t[24]||(t[24]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),c(l).currentProject?(s(),o("div",en,[h.value?(s(),o("div",sn,[(s(!0),o(Z,null,me(P.value.slice(0,4),(m,Me)=>(s(),o("img",{key:m.typeId,src:c(W)(m.typeId,64),class:"w-10 h-10 rounded border-2 border-slate-900",style:Ct({zIndex:10-Me}),title:m.typeName,onError:t[2]||(t[2]=(...qt)=>c(se)&&c(se)(...qt))},null,44,on))),128)),P.value.length>4?(s(),o("div",nn," +"+n(P.value.length-4),1)):x("",!0)])):(s(),o("img",{key:0,src:c(W)(c(l).currentProject.productTypeId,64),class:"w-10 h-10 rounded",onError:t[1]||(t[1]=(...m)=>c(se)&&c(se)(...m))},null,40,tn)),e("div",null,[e("div",rn,[_e.value?ce((s(),o("input",{key:1,"onUpdate:modelValue":t[3]||(t[3]=m=>je.value=m),type:"text",class:"text-lg font-semibold bg-slate-800 border border-cyan-500 rounded px-2 py-0.5 focus:outline-none",onKeydown:[xe(Ue,["enter"]),xe(Je,["escape"])],onBlur:Ue,autofocus:""},null,544)),[[fe,je.value]]):(s(),o("h3",ln,n(c(l).currentProject.displayName),1)),!_e.value&&c(l).currentProject.status!=="completed"?(s(),o("button",{key:2,onClick:Re,class:"p-1 text-slate-500 hover:text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Modifier le nom"},[...t[25]||(t[25]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])])):x("",!0)]),h.value?(s(),o("div",dn,[e("div",cn,[(s(!0),o(Z,null,me(P.value,m=>(s(),o("span",{key:m.typeId,class:"text-slate-400"},[te(n(m.typeName)+" ",1),e("span",pn,"×"+n(m.runs),1)]))),128))]),e("p",vn,n(P.value.length)+" produits - Créé le "+n(c(C)(c(l).currentProject.createdAt)),1)])):(s(),o("p",an,[c(l).currentProject.name?(s(),o("span",un,n(c(l).currentProject.productTypeName)+" · ",1)):x("",!0),te(" "+n(c(l).currentProject.runs)+" runs - ME "+n(c(l).currentProject.meLevel)+" - TE "+n(c(l).currentProject.teLevel)+" - Créé le "+n(c(C)(c(l).currentProject.createdAt)),1)]))])])):x("",!0)]),e("div",mn,[((M=c(l).currentProject)==null?void 0:M.status)!=="completed"?(s(),o("button",{key:0,onClick:at,disabled:ie.value,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-cyan-800 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium flex items-center gap-2"},[ie.value?(s(),o("svg",xn,[...t[26]||(t[26]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(s(),o("svg",yn,[...t[27]||(t[27]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"},null,-1)])])),te(" "+n(ie.value?"Synchronisation...":"Lier jobs ESI"),1)],8,fn)):x("",!0),e("button",{onClick:At,class:G(["px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2",((R=c(l).currentProject)==null?void 0:R.status)==="completed"?"bg-amber-600 hover:bg-amber-500 text-white":"bg-emerald-600 hover:bg-emerald-500 text-white"])},[(s(),o("svg",bn,[((z=c(l).currentProject)==null?void 0:z.status)==="completed"?(s(),o("path",gn)):(s(),o("path",hn))])),te(" "+n(((F=c(l).currentProject)==null?void 0:F.status)==="completed"?"Réactiver":"Terminé"),1)],2)])]),c(l).isLoading?(s(),o("div",kn,[...t[28]||(t[28]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),te(" Chargement... ",-1)])])):c(l).currentProject?(s(),o("div",wn,[Ee.value?(s(),o("div",_n,[t[30]||(t[30]=e("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",Cn,n(Ee.value),1),e("button",{onClick:t[4]||(t[4]=m=>Ee.value=null),class:"ml-auto p-1 hover:bg-amber-500/30 rounded text-amber-400"},[...t[29]||(t[29]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):x("",!0),e("div",$n,[e("div",Sn,[t[31]||(t[31]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Coût total",-1)),e("p",Mn,n(c(_)(c(l).currentProject.totalCost)),1)]),e("div",Tn,[t[32]||(t[32]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Coût jobs",-1)),e("p",jn,n(c(_)(c(l).currentProject.jobsCost)),1)]),e("div",Pn,[t[33]||(t[33]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Prix de vente",-1)),e("p",{class:G(["text-lg font-mono mt-1",c(l).currentProject.personalUse?"text-slate-600":"text-slate-200"])},n(c(l).currentProject.personalUse?"N/A":c(l).currentProject.sellPrice!==null?c(_)(c(l).currentProject.sellPrice):"-"),3)]),e("div",In,[t[34]||(t[34]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Profit",-1)),e("p",{class:G(["text-lg font-mono mt-1",c(l).currentProject.personalUse?"text-slate-600":c(l).currentProject.profit!==null?c(l).currentProject.profit>=0?"text-emerald-400":"text-red-400":"text-slate-400"])},n(c(l).currentProject.personalUse?"N/A":c(l).currentProject.profit!==null?c(_)(c(l).currentProject.profit):"-"),3)]),e("div",En,[t[35]||(t[35]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider flex items-center gap-1"},[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),te(" Durée estimée ")],-1)),e("p",Bn,n(ne.value?y(ne.value):"-"),1)])]),e("div",Ln,[e("button",{onClick:t[5]||(t[5]=m=>gt("steps")),class:G(["pb-2 text-sm font-medium border-b-2 -mb-px",oe.value==="steps"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 hover:text-slate-300"])}," Étapes de production ",2),e("button",{onClick:t[6]||(t[6]=m=>{var Me;return((Me=c(l).currentProject)==null?void 0:Me.status)!=="completed"&&gt("shopping")}),disabled:((O=c(l).currentProject)==null?void 0:O.status)==="completed",class:G(["pb-2 text-sm font-medium border-b-2 -mb-px",((b=c(l).currentProject)==null?void 0:b.status)==="completed"?"border-transparent text-slate-600 cursor-not-allowed":oe.value==="shopping"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 hover:text-slate-300"]),title:((U=c(l).currentProject)==null?void 0:U.status)==="completed"?"Non disponible pour les projets terminés":""}," Matériaux & Stock ",10,Rn)]),oe.value==="steps"?(s(),o("div",Nn,[e("div",An,[e("div",zn,[Jt()&&((H=c(l).currentProject)==null?void 0:H.status)!=="completed"?(s(),o("button",{key:0,onClick:zt,class:"flex items-center gap-2 text-sm px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/50 rounded-lg text-blue-400"},[...t[36]||(t[36]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),te(" BPC Kit ",-1)])])):x("",!0)]),e("div",Jn,[e("button",{onClick:t[7]||(t[7]=m=>ee.value="flat"),class:G(["px-3 py-1.5 text-xs font-medium rounded transition-colors",ee.value==="flat"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...t[37]||(t[37]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})]),te(" Liste ")],-1)])],2),e("button",{onClick:t[8]||(t[8]=m=>ee.value="tree"),class:G(["px-3 py-1.5 text-xs font-medium rounded transition-colors",ee.value==="tree"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...t[38]||(t[38]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4h4v4H3V4zm0 8h4v4H3v-4zm0 8h4v4H3v-4zm8-16h10M11 12h10M11 20h10"})]),te(" Arbre ")],-1)])],2)])]),ee.value==="flat"?(s(),o("div",Vn,[c(l).currentProject.steps&&c(l).currentProject.steps.length>0?(s(),o("div",qn,[ut(Io,{steps:c(l).currentProject.steps,readonly:c(l).currentProject.status==="completed",onTogglePurchased:Se,onUpdateStepRuns:Nt,onDeleteStep:Lt,onAddChildJob:Rt},null,8,["steps","readonly"])])):(s(),o("div",Dn," Aucune étape de production "))])):ee.value==="tree"?(s(),o("div",Hn,[c(l).currentProject.tree&&c(l).currentProject.steps?(s(),o("div",Un,[ut(Wo,{tree:c(l).currentProject.tree,steps:c(l).currentProject.steps,readonly:c(l).currentProject.status==="completed",onTogglePurchased:Se},null,8,["tree","steps","readonly"])])):(s(),o("div",Fn," Arbre de production non disponible "))])):x("",!0)])):x("",!0),oe.value==="shopping"?(s(),o("div",On,[p.value||f.value?(s(),o("div",Kn,[...t[39]||(t[39]=[e("svg",{class:"w-6 h-6 animate-spin mx-auto mb-2 text-cyan-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),te(" Chargement... ",-1)])])):w.value&&S.value.length===0?(s(),o("div",Qn,[e("div",Xn,[t[41]||(t[41]=e("svg",{class:"w-10 h-10 mx-auto mb-3 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t[42]||(t[42]=e("p",{class:"text-red-400 font-medium mb-2"},"Erreur de chargement",-1)),e("p",Wn,n(w.value),1),e("button",{onClick:ze,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2 mx-auto"},[...t[40]||(t[40]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),te(" Réessayer ",-1)])])])])):S.value.length===0?(s(),o("div",Zn,[...t[43]||(t[43]=[e("svg",{class:"w-12 h-12 mx-auto mb-3 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",null,"Aucun matériau requis pour ce projet",-1)])])):(s(),o("div",Yn,[e("div",Gn,[e("div",er,[e("div",tr,[e("span",sr,n(We.value.ok),1),t[44]||(t[44]=e("span",{class:"text-emerald-300/70 text-xs"},"✓",-1))]),e("div",or,[e("span",nr,n(We.value.partial),1),t[45]||(t[45]=e("span",{class:"text-amber-300/70 text-xs"},"◐",-1))]),e("div",rr,[e("span",lr,n(We.value.missing),1),t[46]||(t[46]=e("span",{class:"text-red-300/70 text-xs"},"✗",-1))]),re.value.length>0?(s(),o("span",ar,[t[47]||(t[47]=e("svg",{class:"w-3.5 h-3.5 text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),te(" "+n(re.value.length)+" items en stock ",1)])):x("",!0)]),((K=c(l).currentProject)==null?void 0:K.status)!=="completed"?(s(),o("div",ir,[e("div",ur,[t[50]||(t[50]=e("label",{class:"block text-xs text-slate-500 mb-1"},"Structure",-1)),e("div",dr,[ce(e("input",{"onUpdate:modelValue":t[9]||(t[9]=m=>Ae.value=m),type:"text",placeholder:Ne.value.id?Ne.value.name:sa.split(" - ")[0],class:G(["w-full bg-slate-800 border rounded pl-3 pr-8 py-1.5 text-sm focus:outline-none",Ne.value.id?"border-cyan-500/50 text-cyan-400 placeholder-cyan-400":"border-slate-600 text-slate-200 placeholder-slate-400 focus:border-cyan-500/50"]),onFocus:t[10]||(t[10]=m=>a.value=!0),onBlur:qe},null,42,cr),[[fe,Ae.value]]),e("div",pr,[$.value?(s(),o("svg",vr,[...t[48]||(t[48]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):Ne.value.id||Ae.value?(s(),o("button",{key:1,onMousedown:Te(lt,["prevent"]),class:"text-slate-400 hover:text-slate-200",title:"Revenir au défaut"},[...t[49]||(t[49]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],32)):x("",!0)]),a.value&&(Ve.value.length>0||Ae.value.length>=3&&!$.value)?(s(),o("div",mr,[(s(!0),o(Z,null,me(Ve.value,m=>(s(),o("button",{key:m.id,onMousedown:Te(Me=>Ie(m),["prevent"]),class:"w-full px-3 py-2 text-left text-sm text-slate-200 hover:bg-slate-700/50 transition-colors border-b border-slate-700/50 last:border-0"},[e("div",xr,n(m.name),1)],40,fr))),128)),Ae.value.length>=3&&Ve.value.length===0&&!$.value?(s(),o("div",yr," Aucune structure trouvée ")):x("",!0)])):x("",!0)])]),e("div",null,[t[52]||(t[52]=e("label",{class:"block text-xs text-slate-500 mb-1"},"Transport",-1)),e("div",br,[ce(e("input",{"onUpdate:modelValue":t[11]||(t[11]=m=>V.value=m),type:"number",min:"0",step:"100",class:"w-20 px-2 py-1.5 bg-slate-800 border border-slate-600 rounded text-slate-200 text-sm font-mono focus:outline-none focus:border-cyan-500"},null,512),[[fe,V.value,void 0,{number:!0}]]),t[51]||(t[51]=e("span",{class:"text-xs text-slate-500"},"ISK/m³",-1))])]),e("button",{onClick:ze,class:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded text-white text-sm font-medium"}," Recalculer ")])):x("",!0)]),ke.value&&(ke.value.status==="started"||ke.value.status==="in_progress")?(s(),o("div",gr,[t[53]||(t[53]=e("svg",{class:"w-5 h-5 text-cyan-400 animate-spin flex-shrink-0",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),e("div",hr,[e("div",kr,n(ke.value.message||"Synchronisation du marché..."),1),ke.value.progress!==null?(s(),o("div",wr,[e("div",{class:"h-full bg-cyan-500 transition-all duration-300",style:Ct({width:`${ke.value.progress}%`})},null,4)])):x("",!0)])])):x("",!0),e("div",_r,[t[55]||(t[55]=e("svg",{class:"w-4 h-4 text-cyan-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Cr," Prix = ordres de vente les plus bas (Jita Sell + import vs "+n(Fe.value)+" Sell) ",1),D.value&&le.value?(s(),o("div",$r,[t[54]||(t[54]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),te(" "+n(Vt(le.value)),1)])):x("",!0)]),J.value===!1&&!w.value&&((Ke=c(l).currentProject)==null?void 0:Ke.status)!=="completed"?(s(),o("div",Sr,[e("div",Mr,[e("div",Tr,[t[57]||(t[57]=e("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",jr,[t[56]||(t[56]=e("p",{class:"text-amber-300"},"Prix de la structure non disponibles",-1)),e("p",Pr," Les données de marché pour "+n(j.value)+" n'ont pas été synchronisées. ",1)])]),e("button",{onClick:vt,disabled:d.value||((nt=ke.value)==null?void 0:nt.status)==="started"||((wt=ke.value)==null?void 0:wt.status)==="in_progress",class:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[d.value?(s(),o("svg",Er,[...t[58]||(t[58]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(s(),o("svg",Br,[...t[59]||(t[59]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])),t[60]||(t[60]=te(" Synchroniser ",-1))],8,Ir)])])):x("",!0),$e.value?(s(),o("div",Lr,[t[61]||(t[61]=e("svg",{class:"w-5 h-5 text-red-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",Rr,n($e.value),1)])):x("",!0),e("div",Nr,[ce(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=m=>Ce.value=m),placeholder:"Coller votre inventaire EVE ici (Ctrl+A puis Ctrl+C depuis le jeu)...",class:"flex-1 h-16 bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm font-mono text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500 resize-none"},null,512),[[fe,Ce.value]]),e("div",Ar,[e("button",{onClick:Pt,disabled:f.value,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-cyan-800 disabled:cursor-wait rounded-lg text-white text-sm font-medium flex items-center gap-2",title:"Mettre à jour le stock"},[f.value?(s(),o("svg",Jr,[...t[62]||(t[62]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(s(),o("svg",Vr,[...t[63]||(t[63]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"},null,-1)])])),t[64]||(t[64]=te(" Mettre à jour ",-1))],8,zr),re.value.length>0?(s(),o("button",{key:0,onClick:Bt,class:"px-4 py-2 text-red-400 hover:bg-red-500/10 border border-red-500/30 rounded-lg text-sm font-medium flex items-center gap-2",title:"Effacer tout le stock"},[...t[65]||(t[65]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),te(" Effacer ",-1)])])):x("",!0)])]),ge.value.length>0?(s(),o("details",{key:3,class:"bg-slate-800/50 border border-slate-700 rounded-lg",onToggle:t[14]||(t[14]=m=>A.value=m.target.open)},[e("summary",qr,[(s(),o("svg",{class:G(["w-4 h-4 text-slate-400 transition-transform",{"rotate-90":A.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[66]||(t[66]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),t[67]||(t[67]=e("svg",{class:"w-5 h-5 text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})],-1)),e("span",Dr," Produits intermédiaires ("+n(ge.value.length)+") ",1),ge.value.some(m=>m.inStock>0)?(s(),o("span",Hr,n(ge.value.filter(m=>m.inStock>0).length)+" en stock ",1)):x("",!0)]),e("div",Ur,[t[71]||(t[71]=e("p",{class:"text-xs text-slate-400 mb-3"}," Produits à fabriquer ou réagir. Les items en stock peuvent être utilisés directement. ",-1)),e("div",Fr,[e("div",Or,[e("span",Kr,n(ge.value.filter(m=>m.status==="ok").length),1),t[68]||(t[68]=e("span",{class:"text-emerald-300/70 ml-1"},"en stock",-1))]),e("div",Qr,[e("span",Xr,n(ge.value.filter(m=>m.status==="partial").length),1),t[69]||(t[69]=e("span",{class:"text-amber-300/70 ml-1"},"partiel",-1))]),e("div",Wr,[e("span",Zr,n(ge.value.filter(m=>m.status==="missing").length),1),t[70]||(t[70]=e("span",{class:"text-slate-500 ml-1"},"à produire",-1))])]),e("div",Yr,[(s(!0),o(Z,null,me(ge.value,m=>(s(),o("div",{key:m.stepId,class:G(["flex items-center justify-between rounded-lg px-3 py-2",m.status==="ok"?"bg-emerald-900/20 border border-emerald-500/30":m.status==="partial"?"bg-amber-900/20 border border-amber-500/30":"bg-slate-800/30 border border-slate-700/50"])},[e("div",Gr,[e("img",{src:c(W)(m.typeId,32),class:"w-6 h-6 rounded flex-shrink-0",onError:t[13]||(t[13]=(...Me)=>c(se)&&c(se)(...Me))},null,40,el),e("div",tl,[e("div",sl,[e("p",ol,n(m.name),1),e("span",{class:G(["text-[10px] px-1.5 py-0.5 rounded flex-shrink-0",m.activityType==="reaction"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"])},n(m.activityType==="reaction"?"Réaction":"Manuf."),3)]),e("div",nl,[e("span",rl,n(m.needed.toLocaleString())+" requis",1),m.inStock>0?(s(),o("span",{key:0,class:G(m.status==="ok"?"text-emerald-400":"text-amber-400")}," ("+n(m.runsCovered)+"/"+n(m.runsNeeded)+" runs) ",3)):x("",!0)])])]),e("div",ll,[e("input",{type:"number",value:m.inStock,onChange:Me=>jt(m,parseInt(Me.target.value)||0),min:"0",class:G(["w-24 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm font-mono text-right focus:outline-none focus:border-cyan-500",m.status==="ok"?"text-emerald-400":m.status==="partial"?"text-amber-400":"text-slate-500"])},null,42,al),e("span",{class:G(["w-5 text-center text-sm",[m.status==="ok"?"text-emerald-400":m.status==="partial"?"text-amber-400":"text-red-400"]])},n(m.status==="ok"?"✓":m.status==="partial"?"◐":"✗"),3)])],2))),128))])])],32)):x("",!0),Y.value.length>0?(s(),o("details",{key:4,class:"bg-slate-800/50 border border-slate-700 rounded-lg",open:!0,onToggle:t[16]||(t[16]=m=>L.value=m.target.open)},[e("summary",il,[e("div",ul,[(s(),o("svg",{class:G(["w-4 h-4 text-slate-400 transition-transform",{"rotate-90":L.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[72]||(t[72]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),t[73]||(t[73]=e("svg",{class:"w-5 h-5 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),e("span",dl," Matières premières ("+n(Y.value.length)+") ",1),Y.value.some(m=>m.inStock>0)?(s(),o("span",cl,n(Y.value.filter(m=>m.inStock>0).length)+" en stock ",1)):x("",!0)])]),e("div",pl,[t[77]||(t[77]=e("p",{class:"text-xs text-slate-400 mb-3"}," Matériaux de base à acheter ou collecter (minerais, PI, gaz, etc.) ",-1)),e("div",vl,[e("div",ml,[e("span",fl,n(Y.value.filter(m=>m.status==="ok").length),1),t[74]||(t[74]=e("span",{class:"text-emerald-300/70 ml-1"},"complet",-1))]),e("div",xl,[e("span",yl,n(Y.value.filter(m=>m.status==="partial").length),1),t[75]||(t[75]=e("span",{class:"text-amber-300/70 ml-1"},"partiel",-1))]),e("div",bl,[e("span",gl,n(Y.value.filter(m=>m.status==="missing").length),1),t[76]||(t[76]=e("span",{class:"text-slate-500 ml-1"},"manquant",-1))])]),e("div",hl,[(s(!0),o(Z,null,me(Y.value,m=>(s(),o("div",{key:m.typeId,class:G(["flex items-center justify-between rounded-lg px-3 py-2",m.status==="ok"?"bg-emerald-900/20 border border-emerald-500/30":m.status==="partial"?"bg-amber-900/20 border border-amber-500/30":"bg-slate-800/30 border border-slate-700/50"])},[e("div",kl,[e("img",{src:c(W)(m.typeId,32),class:"w-6 h-6 rounded flex-shrink-0",onError:t[15]||(t[15]=(...Me)=>c(se)&&c(se)(...Me))},null,40,wl),e("div",_l,[e("p",Cl,n(m.name),1),e("div",$l,[e("span",Sl,n(m.needed.toLocaleString())+" requis",1),m.missing>0?(s(),o("span",Ml," ("+n(m.missing.toLocaleString())+" manquant) ",1)):x("",!0)])])]),e("div",Tl,[e("input",{type:"number",value:m.inStock,onChange:Me=>It(m.name,parseInt(Me.target.value)||0),min:"0",class:G(["w-24 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-sm font-mono text-right focus:outline-none focus:border-cyan-500",m.status==="ok"?"text-emerald-400":m.status==="partial"?"text-amber-400":"text-slate-500"])},null,42,jl),e("span",{class:G(["w-5 text-center text-sm",[m.status==="ok"?"text-emerald-400":m.status==="partial"?"text-amber-400":"text-red-400"]])},n(m.status==="ok"?"✓":m.status==="partial"?"◐":"✗"),3)])],2))),128))])])],32)):x("",!0),e("div",Pl,[e("div",Il,[e("div",null,[t[78]||(t[78]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Volume manquant",-1)),e("p",El,n(we.value.volume.toLocaleString())+" m³",1)]),e("div",null,[t[79]||(t[79]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Coût total",-1)),e("p",Bl,n(ae.value?c(_)(ae.value.best):"-"),1)]),e("div",null,[t[80]||(t[80]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"En stock (valeur)",-1)),e("p",Ll,n(ae.value?c(_)(ae.value.best-we.value.price):"-"),1)]),e("div",Rl,[t[81]||(t[81]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"À acheter",-1)),e("p",Nl,n(c(_)(we.value.price)),1)])]),e("div",Al,[N.value.length>0?(s(),o("button",{key:0,onClick:t[17]||(t[17]=m=>kt(ve.value,"jita")),class:"flex items-center gap-2 px-3 py-1.5 bg-cyan-700 hover:bg-cyan-600 rounded-lg text-white text-sm font-medium transition-colors"},[X.value?(s(),o("svg",Jl,[...t[83]||(t[83]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("svg",zl,[...t[82]||(t[82]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])),te(" "+n(X.value?"Copié !":`Copier Jita (${N.value.length})`),1)])):x("",!0),pe.value.length>0?(s(),o("button",{key:1,onClick:t[18]||(t[18]=m=>kt(ye.value,"structure")),class:"flex items-center gap-2 px-3 py-1.5 bg-purple-700 hover:bg-purple-600 rounded-lg text-white text-sm font-medium transition-colors"},[i.value?(s(),o("svg",ql,[...t[85]||(t[85]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("svg",Vl,[...t[84]||(t[84]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])),te(" "+n(i.value?"Copié !":`Copier ${Fe.value} (${pe.value.length})`),1)])):x("",!0),t[88]||(t[88]=e("div",{class:"flex-1"},null,-1)),ae.value&&ae.value.best>0&&((_t=c(l).currentProject)==null?void 0:_t.status)!=="completed"?(s(),o("div",Dl,[e("span",Hl,[t[86]||(t[86]=te(" Arrondi: ",-1)),e("span",Ul,n(c(_)(it(we.value.price>0?we.value.price:ae.value.best))),1)]),e("button",{onClick:mt,class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-500 rounded-lg text-white text-sm font-medium flex items-center gap-2"},[...t[87]||(t[87]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),te(" Appliquer comme coût matériaux ",-1)])])])):x("",!0)])])]))])):x("",!0)])):x("",!0)]),(s(),De(dt,{to:"body"},[Oe.value?(s(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",onKeydown:xe(ot,["escape"])},[e("div",{class:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:ot}),e("div",Fl,[e("div",{class:"px-6 py-4 border-b border-slate-700 flex items-center justify-between"},[t[90]||(t[90]=e("h3",{class:"text-lg font-semibold text-slate-100 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),te(" BPC Kit ")],-1)),e("button",{onClick:ot,class:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-slate-200"},[...t[89]||(t[89]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ol,[t[93]||(t[93]=e("p",{class:"text-sm text-slate-400 mb-4"}," Cette action va marquer toutes les étapes BPC comme achetées et définir le coût du kit. ",-1)),e("div",null,[t[91]||(t[91]=e("label",{class:"block text-sm font-medium text-slate-300 mb-2"}," Prix du kit BPC ",-1)),ce(e("input",{"onUpdate:modelValue":t[19]||(t[19]=m=>Pe.value=m),type:"text",placeholder:"ex: 50M, 1.5B, 500000 (vide = 0)",class:"w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 font-mono",onKeydown:[xe(ht,["enter"]),xe(ot,["escape"])],autofocus:""},null,544),[[fe,Pe.value]]),t[92]||(t[92]=e("p",{class:"text-xs text-slate-500 mt-2"}," Formats acceptés : 50M, 1.5B, 500K, 1000000 ",-1))])]),e("div",Kl,[e("button",{onClick:ot,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:ht,disabled:tt.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-blue-800 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[tt.value?(s(),o("svg",Xl,[...t[94]||(t[94]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(s(),o("svg",Wl,[...t[95]||(t[95]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),t[96]||(t[96]=te(" Confirmer ",-1))],8,Ql)])])],32)):x("",!0)])),(s(),De(dt,{to:"body"},[k.value?(s(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",onKeydown:t[23]||(t[23]=xe(m=>k.value=!1,["escape"]))},[e("div",{class:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:t[20]||(t[20]=m=>k.value=!1)}),e("div",Zl,[e("div",Yl,[t[98]||(t[98]=e("h3",{class:"text-lg font-semibold text-slate-100 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),te(" Effacer le stock ? ")],-1)),e("button",{onClick:t[21]||(t[21]=m=>k.value=!1),class:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-slate-200"},[...t[97]||(t[97]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Gl,[t[99]||(t[99]=e("p",{class:"text-sm text-slate-400"}," Cette action supprimera toutes les données de stock enregistrées pour ce projet. ",-1)),e("p",ea,n(re.value.length)+" item(s) seront effacés. ",1)]),e("div",ta,[e("button",{onClick:t[22]||(t[22]=m=>k.value=!1),class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:Et,class:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[...t[100]||(t[100]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),te(" Effacer ",-1)])])])])],32)):x("",!0)]))],64)}}}),na={class:"space-y-6"},ra={key:0,class:"text-center py-8 text-slate-500"},la={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},aa=["checked","onChange"],ia={class:"text-sm text-slate-200"},ua={class:"relative mb-3"},da={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ca=["onMousedown"],pa=["src"],va={class:"text-sm text-slate-200"},ma={key:0,class:"text-xs text-slate-500 ml-auto"},fa={key:0,class:"space-y-1 max-h-64 overflow-y-auto"},xa=["src"],ya={class:"font-medium text-slate-200 flex-1"},ba=["onClick"],ga={key:1,class:"text-sm text-slate-500"},ha=Qe({__name:"BlacklistConfig",setup(B){const u=rt(),{getTypeIconUrl:T,onImageError:E}=pt(),l=v(""),Q=v([]),I=v(!1);let _=null;ct(()=>{u.fetchBlacklist()});const C=de(()=>{if(!u.blacklist)return new Set;const j=new Set;for(const J of u.blacklist.categories)if(J.blacklisted)for(const D of J.groupIds)j.add(D);return j}),W=de(()=>u.blacklist?new Set(u.blacklist.items.map(j=>j.typeId)):new Set);async function se(j){if(!u.blacklist)return;const J=u.blacklist.categories.find(ae=>ae.key===j);if(!J)return;const D=[...C.value];let le;J.blacklisted?le=D.filter(ae=>!J.groupIds.includes(ae)):le=[...new Set([...D,...J.groupIds])],await u.updateBlacklist(le,[...W.value])}async function oe(j){const J=[...W.value].filter(D=>D!==j);await u.updateBlacklist([...C.value],J)}async function ee(j){if(W.value.has(j))return;const J=[...W.value,j];await u.updateBlacklist([...C.value],J),l.value="",Q.value=[],I.value=!1}et(l,j=>{if(_&&clearTimeout(_),j.length<2){Q.value=[],I.value=!1;return}_=setTimeout(async()=>{Q.value=await u.searchBlacklistItems(j),I.value=Q.value.length>0},300)});function S(){window.setTimeout(()=>{I.value=!1},200)}return(j,J)=>(s(),o("div",na,[J[7]||(J[7]=e("div",null,[e("h3",{class:"text-lg font-semibold text-slate-100 mb-1"},"Construction Blacklist"),e("p",{class:"text-sm text-slate-400"}," Sélectionnez les catégories et items que vous ne fabriquez pas. Ils seront traités comme des achats dans tous vos projets. ")],-1)),c(u).blacklist?(s(),o(Z,{key:1},[e("div",null,[J[4]||(J[4]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Catégories",-1)),e("div",la,[(s(!0),o(Z,null,me(c(u).blacklist.categories,D=>(s(),o("label",{key:D.key,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700 cursor-pointer hover:bg-slate-800"},[e("input",{type:"checkbox",checked:D.blacklisted,onChange:le=>se(D.key),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-red-500 focus:ring-red-500 focus:ring-offset-slate-900"},null,40,aa),e("span",ia,n(D.label),1)]))),128))])]),e("div",null,[J[6]||(J[6]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Items individuels",-1)),e("div",ua,[ce(e("input",{"onUpdate:modelValue":J[0]||(J[0]=D=>l.value=D),type:"text",placeholder:"Rechercher un item à blacklister...",class:"w-full px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",onFocus:J[1]||(J[1]=D=>I.value=Q.value.length>0),onBlur:S},null,544),[[fe,l.value]]),I.value?(s(),o("div",da,[(s(!0),o(Z,null,me(Q.value,D=>(s(),o("button",{key:D.typeId,onMousedown:Te(le=>ee(D.typeId),["prevent"]),class:G(["w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-700 text-left",W.value.has(D.typeId)?"opacity-50":""])},[e("img",{src:c(T)(D.typeId,32),class:"w-6 h-6 rounded",onError:J[2]||(J[2]=(...le)=>c(E)&&c(E)(...le))},null,40,pa),e("span",va,n(D.typeName),1),W.value.has(D.typeId)?(s(),o("span",ma," déjà ajouté ")):x("",!0)],42,ca))),128))])):x("",!0)]),c(u).blacklist.items.length>0?(s(),o("div",fa,[(s(!0),o(Z,null,me(c(u).blacklist.items,D=>(s(),o("div",{key:D.typeId,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700"},[e("img",{src:c(T)(D.typeId,32),class:"w-8 h-8 rounded",onError:J[3]||(J[3]=(...le)=>c(E)&&c(E)(...le))},null,40,xa),e("span",ya,n(D.typeName),1),e("button",{onClick:le=>oe(D.typeId),class:"p-1 hover:bg-slate-700 rounded text-slate-500 hover:text-red-400"},[...J[5]||(J[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ba)]))),128))])):(s(),o("p",ga," Aucun item individuel blacklisté. "))])],64)):(s(),o("div",ra," Chargement... "))]))}}),ka={class:"space-y-4"},wa={class:"flex items-center justify-between"},_a={key:0,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700"},Ca={class:"text-sm font-medium text-slate-300 mb-4"},$a={class:"space-y-4"},Sa={key:0},Ma={key:0,class:"text-xs text-slate-500"},Ta={key:1,class:"text-xs text-slate-500 bg-slate-900/50 rounded-lg p-2 border border-slate-700"},ja=["value"],Pa={class:"mt-3 relative"},Ia={key:0,class:"absolute right-3 top-7"},Ea={key:1,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ba=["onMousedown"],La={class:"text-sm text-slate-200"},Ra={key:0,class:"text-slate-400"},Na={class:"text-xs text-slate-500"},Aa={key:2,class:"mt-1 text-xs text-amber-400"},za={key:1,class:"bg-cyan-900/20 border border-cyan-700/50 rounded-lg p-3"},Ja={class:"flex gap-3"},Va=["value"],qa={class:"text-sm text-slate-300"},Da={class:"block text-xs text-slate-400 mb-2"},Ha={class:"relative"},Ua=["placeholder","disabled"],Fa={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Oa=["onMousedown"],Ka={class:"flex items-center justify-between"},Qa={class:"text-sm text-slate-200"},Xa={class:"text-xs ml-2"},Wa={class:"text-emerald-400"},Za={class:"text-amber-400 ml-1"},Ya={key:1,class:"text-emerald-400"},Ga={class:"text-slate-500 ml-1"},ei={class:"text-xs text-slate-500 mt-0.5"},ti={key:1,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg p-3 text-sm text-slate-400"},si={key:0,class:"mt-3 space-y-1"},oi={class:"flex items-center justify-between"},ni={class:"flex items-center gap-2 flex-1 min-w-0"},ri={class:"text-sm text-slate-300 truncate"},li={class:"text-xs shrink-0"},ai={class:"text-emerald-400"},ii={class:"text-amber-400 ml-1"},ui={key:1,class:"text-emerald-400"},di={class:"text-slate-500 ml-1"},ci=["onClick"],pi={class:"text-xs text-slate-500 mt-0.5"},vi={key:1,class:"mt-2 text-xs text-slate-500"},mi={class:"bg-slate-900/50 rounded-lg p-3 border border-slate-700"},fi={class:"space-y-2"},xi={key:0,class:"flex flex-wrap gap-4"},yi={class:"text-sm text-emerald-400 ml-1"},bi={class:"text-sm text-amber-400 ml-1"},gi={key:1,class:"flex flex-wrap gap-4"},hi={class:"text-sm text-emerald-400 ml-1"},ki={class:"text-sm text-amber-400 ml-1"},wi={key:2,class:"text-slate-500 text-sm"},_i={class:"flex gap-3 pt-2"},Ci=["disabled"],$i={key:1,class:"space-y-2"},Si={class:"flex items-start justify-between"},Mi={class:"flex-1"},Ti={class:"flex items-center gap-2"},ji={class:"text-sm font-medium text-slate-200"},Pi={key:0,class:"px-1.5 py-0.5 bg-cyan-900/50 text-cyan-400 text-xs rounded border border-cyan-700/50"},Ii={class:"text-xs text-slate-500 mt-1"},Ei={class:"flex flex-wrap gap-x-4 gap-y-1 mt-2"},Bi={class:"text-sm text-emerald-400 ml-1"},Li={class:"text-sm text-amber-400 ml-1"},Ri={class:"text-sm text-emerald-400 ml-1"},Ni={class:"text-sm text-amber-400 ml-1"},Ai={key:0,class:"mt-2 flex flex-wrap gap-1"},zi={class:"flex items-center gap-2"},Ji=["onClick"],Vi=["onClick"],qi={key:2,class:"text-center py-8 text-slate-500"},Di={class:"text-slate-400 mb-6"},Hi={class:"text-slate-200 font-medium"},St=3,Ui=Qe({__name:"StructureConfig",setup(B){const u=rt(),T=v(!1),E=v(null),l=v(""),Q=v(null),I=v("nullsec"),_=v("raitaru"),C=v([]),W=v(""),se=v(!1),oe=v(""),ee=v([]),S=v(!1),j=v(!1),J=v(!1);ct(async()=>{u.fetchStructures(),await u.fetchCorporationStructures(),J.value=!0});const D=v(null),le=v(!1);function ae(){if(D.value){const $=D.value;l.value=$.locationName,Q.value=$.locationId,$.isCorporationOwned&&(le.value=!0),$.sharedConfig?(I.value=$.sharedConfig.securityType,_.value=$.sharedConfig.structureType,C.value=[...$.sharedConfig.rigs]):$.structureType&&(_.value=$.structureType),D.value=null}}function w(){Q.value=null,le.value=!1}let p;const d=v(null);function V(){if(clearTimeout(p),d.value=null,oe.value.length<3){ee.value=[],j.value=!1;return}p=window.setTimeout(async()=>{S.value=!0;const $=await u.searchStructures(oe.value);ee.value=$.structures,d.value=$.error||null,j.value=$.structures.length>0,S.value=!1},500)}function ie($){l.value=$.locationName,Q.value=$.locationId,$.structureType&&(_.value=$.structureType),$.isCorporationOwned&&(le.value=!0),oe.value="",ee.value=[],j.value=!1}function Ee(){window.setTimeout(()=>{j.value=!1},200)}const He={highsec:1,lowsec:1.9,nullsec:2.1},ke={highsec:"High-Sec (x1.0)",lowsec:"Low-Sec (x1.9)",nullsec:"Null-Sec (x2.1)"},Xe={station:"Station NPC (aucun bonus)",raitaru:"Raitaru (EC Medium) - 1% ME",azbel:"Azbel (EC Large) - 1% ME, 20% TE",sotiyo:"Sotiyo (EC X-Large) - 1% ME, 30% TE",athanor:"Athanor (Refinery Medium) - 25% TE",tatara:"Tatara (Refinery Large) - 25% TE",engineering_complex:"Engineering Complex (legacy)",refinery:"Refinery (legacy)"},_e={raitaru:"M",azbel:"L",sotiyo:"XL",athanor:"M",tatara:"L"},je=de(()=>{if(!u.rigOptions)return[];const $=_e[_.value];if(["athanor","tatara","refinery"].includes(_.value)){const a=u.rigOptions.reaction;return $?a.filter(g=>g.size===$):a}if(["raitaru","azbel","sotiyo","engineering_complex"].includes(_.value)){const a=u.rigOptions.manufacturing;return $?a.filter(g=>g.size===$):a}return[]}),Re=de(()=>{const $=W.value.toLowerCase().trim();return $.length<2?[]:je.value.filter(a=>C.value.includes(a.name)?!1:a.name.toLowerCase().includes($)).slice(0,10)}),Ue=de(()=>C.value.map($=>je.value.find(g=>g.name===$)||{name:$,bonus:0,category:"",size:"M",targetCategories:[]}));et(_,()=>{W.value="";const $=new Set(je.value.map(a=>a.name));C.value=C.value.filter(a=>$.has(a))});function Je(){l.value="",Q.value=null,I.value="nullsec",_.value="raitaru",C.value=[],le.value=!1,E.value=null,W.value="",se.value=!1,D.value=null,oe.value="",ee.value=[],j.value=!1}const Ce=de(()=>["athanor","tatara","refinery"].includes(_.value)),re=de(()=>["raitaru","azbel","sotiyo","engineering_complex"].includes(_.value));function Be(){Je(),T.value=!0}function ge($){l.value=$.name,Q.value=$.locationId,I.value=$.securityType,_.value=$.structureType,C.value=[...$.rigs],E.value=$,W.value="",se.value=!1,T.value=!0}function $e(){T.value=!1,Je()}const f=v(!1),k=v(!1);function A(){if(!E.value||!E.value.isCorporationStructure)return!1;const $=[...E.value.rigs].sort(),a=[...C.value].sort();return JSON.stringify($)!==JSON.stringify(a)||E.value.structureType!==_.value||E.value.securityType!==I.value}async function L(){if(E.value&&A()&&!k.value){f.value=!0,yt(()=>{var $;return($=P.value)==null?void 0:$.focus()});return}try{E.value?await u.updateStructure(E.value.id,{name:l.value,securityType:I.value,structureType:_.value,rigs:C.value}):await u.createStructure({name:l.value,locationId:Q.value,securityType:I.value,structureType:_.value,rigs:C.value}),T.value=!1,Je(),k.value=!1}catch{k.value=!1}}async function q(){f.value=!1,k.value=!0,await L()}function Y(){f.value=!1,k.value=!1}const X=v(!1),i=v(null),y=v(""),ne=v(null),P=v(null);function h($){i.value=$.id,y.value=$.name,X.value=!0,yt(()=>{var a;return(a=ne.value)==null?void 0:a.focus()})}async function N(){i.value&&await u.deleteStructure(i.value),X.value=!1,i.value=null,y.value=""}function pe(){X.value=!1,i.value=null,y.value=""}const ve=de(()=>C.value.length<St);function ye($){ve.value&&(C.value.includes($.name)||C.value.push($.name),W.value="",se.value=!1)}function Fe($){const a=C.value.indexOf($);a!==-1&&C.value.splice(a,1)}function he(){window.setTimeout(()=>{se.value=!1},200)}function we($){return $.replace("Standup M-Set ","").replace("Standup L-Set ","").replace("Standup XL-Set ","")}const We={basic_small_ship:"T1 Small Ships",basic_medium_ship:"T1 Medium Ships",basic_large_ship:"T1 Large Ships",advanced_small_ship:"T2 Small Ships",advanced_medium_ship:"T2 Medium Ships",advanced_large_ship:"T2 Large Ships",capital_ship:"Capitals",basic_capital_component:"Capital Components",advanced_component:"T2/T3 Components",structure_component:"Structure Components",equipment:"Modules",ammunition:"Ammo",drone:"Drones",fighter:"Fighters",structure:"Structures",composite_reaction:"Composites",biochemical_reaction:"Biochem",hybrid_reaction:"Hybrid",research:"Research/Invention/Copy"};function Ze($){return!$||$.length===0?"":$.map(a=>We[a]||a).join(", ")}function Ye($){const a=$.includes("Efficiency")&&!$.includes("Material Efficiency"),g=$.includes("L-Set")||$.includes("XL-Set"),be=$.includes("Reactor Efficiency");return a&&g||be}function Le($,a,g){if(!u.rigOptions)return 0;const be=a==="reaction"?u.rigOptions.reaction:u.rigOptions.manufacturing;let Ie=0;for(const qe of $){const st=be.find(Se=>Se.name===qe);st&&(Ie+=st.bonus)}const lt=He[g]??1;return Math.round(Ie*lt*100)/100}const Oe={highsec:1,lowsec:1,nullsec:1.1};function Pe($,a,g,be){let Ie=0;if(g==="manufacturing"?Ie={raitaru:15,azbel:20,sotiyo:30}[$]??0:Ie={athanor:25,tatara:25}[$]??0,!u.rigOptions)return Ie;const lt=g==="reaction"?u.rigOptions.reaction:u.rigOptions.manufacturing;let qe=0;for(const Se of a){const at=lt.find(mt=>mt.name===Se);if(!at)continue;const it=Se.includes("Efficiency")&&!Se.includes("Material Efficiency"),ze=Se.includes("L-Set")||Se.includes("XL-Set"),vt=Se.includes("Reactor Efficiency");(g==="manufacturing"&&it&&ze||g==="reaction"&&vt)&&(qe+=at.bonus)}const st=g==="reaction"?Oe[be]??1:He[be]??1;if(qe*=st,Ie>0||qe>0){const Se=1-(1-Ie/100)*(1-qe/100);return Math.round(Se*1e4)/100}return 0}const tt=de(()=>Le(C.value,"manufacturing",I.value)),Ne=de(()=>Le(C.value,"reaction",I.value)),Ae=de(()=>Pe(_.value,C.value,"manufacturing",I.value)),Ve=de(()=>Pe(_.value,C.value,"reaction",I.value));return($,a)=>(s(),o("div",ka,[e("div",wa,[a[10]||(a[10]=e("h3",{class:"text-lg font-semibold text-slate-200"},"Structures de production",-1)),T.value?x("",!0):(s(),o("button",{key:0,onClick:Be,class:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2"},[...a[9]||(a[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),te(" Ajouter ",-1)])]))]),a[41]||(a[41]=e("p",{class:"text-sm text-slate-400"}," Configurez vos structures de production pour calculer les bonus de matériaux appliqués aux projets. ",-1)),a[42]||(a[42]=e("p",{class:"text-xs text-cyan-400/80 bg-cyan-500/10 border border-cyan-500/20 rounded px-3 py-2"}," Le calcul des temps de réaction suppose que tous les personnages ont le skill Reactions V (-20%). ",-1)),T.value?(s(),o("div",_a,[e("h4",Ca,n(E.value?"Modifier la structure":"Nouvelle structure"),1),e("div",$a,[E.value?x("",!0):(s(),o("div",Sa,[a[15]||(a[15]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Structures partagées par la corporation",-1)),J.value?c(u).corporationStructures.length===0?(s(),o("div",Ta," Aucune structure trouvée. Vérifiez que les assets de corporation sont synchronisés. ")):(s(),o(Z,{key:2},[ce(e("select",{"onUpdate:modelValue":a[0]||(a[0]=g=>D.value=g),onChange:ae,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},[a[11]||(a[11]=e("option",{value:null},"-- Sélectionner une structure --",-1)),(s(!0),o(Z,null,me(c(u).corporationStructures,g=>(s(),o("option",{key:g.locationId,value:g},n(g.locationName)+" ("+n(g.solarSystemName||"Système inconnu")+") "+n(g.sharedConfig?" - Rigs configurés":""),9,ja))),128))],544),[[$t,D.value]]),a[12]||(a[12]=e("p",{class:"text-xs text-slate-500 mt-1"}," Sélectionnez une structure ou laissez vide pour une configuration personnalisée ",-1))],64)):(s(),o("div",Ma," Chargement... ")),e("div",Pa,[a[14]||(a[14]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Ou rechercher par nom (ESI)",-1)),ce(e("input",{"onUpdate:modelValue":a[1]||(a[1]=g=>oe.value=g),type:"text",placeholder:"Rechercher une structure...",onInput:V,onFocus:a[2]||(a[2]=g=>j.value=ee.value.length>0),onBlur:Ee,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},null,544),[[fe,oe.value]]),S.value?(s(),o("div",Ia,[...a[13]||(a[13]=[e("svg",{class:"animate-spin h-4 w-4 text-slate-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):x("",!0),j.value&&ee.value.length>0?(s(),o("div",Ea,[(s(!0),o(Z,null,me(ee.value,g=>(s(),o("button",{key:g.locationId,onMousedown:Te(be=>ie(g),["prevent"]),class:"w-full px-3 py-2 hover:bg-slate-700 text-left"},[e("div",La,[te(n(g.isCorporationOwned?"★ ":"")+n(g.locationName)+" ",1),g.solarSystemName?(s(),o("span",Ra,"("+n(g.solarSystemName)+")",1)):x("",!0)]),e("div",Na,n(g.structureType?g.structureType.charAt(0).toUpperCase()+g.structureType.slice(1):"Structure")+" "+n(g.isCorporationOwned?" - Structure corpo":""),1)],40,Ba))),128))])):x("",!0),d.value?(s(),o("div",Aa,n(d.value),1)):x("",!0)])])),Q.value?(s(),o("div",za,[e("div",{class:"flex items-center justify-between"},[a[16]||(a[16]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-4 h-4 text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})]),e("span",{class:"text-sm text-cyan-300"},"Structure de corporation")],-1)),e("button",{onClick:w,class:"text-xs text-slate-400 hover:text-slate-200"}," Passer en mode personnalisé ")]),a[17]||(a[17]=e("p",{class:"text-xs text-slate-400 mt-1"}," Les rigs configurés seront partagés avec les autres membres de votre corporation. ",-1))])):x("",!0),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Nom",-1)),ce(e("input",{"onUpdate:modelValue":a[3]||(a[3]=g=>l.value=g),type:"text",placeholder:"Ex: Tatara C-J6MT",class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[fe,l.value]])]),e("div",null,[a[20]||(a[20]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Type de structure",-1)),ce(e("select",{"onUpdate:modelValue":a[4]||(a[4]=g=>_.value=g),class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},[...a[19]||(a[19]=[Qt('<optgroup label="NPC"><option value="station">Station NPC (aucun bonus)</option></optgroup><optgroup label="Engineering Complex"><option value="raitaru">Raitaru (Medium) - 1% ME, 15% TE</option><option value="azbel">Azbel (Large) - 1% ME, 20% TE</option><option value="sotiyo">Sotiyo (X-Large) - 1% ME, 30% TE</option></optgroup><optgroup label="Refinery"><option value="athanor">Athanor (Medium) - 25% TE reactions</option><option value="tatara">Tatara (Large) - 25% TE reactions</option></optgroup>',3)])],512),[[$t,_.value]])]),e("div",null,[a[21]||(a[21]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Sécurité",-1)),e("div",Ja,[(s(),o(Z,null,me(ke,(g,be)=>e("label",{key:be,class:"flex items-center gap-2 cursor-pointer"},[ce(e("input",{type:"radio",value:be,"onUpdate:modelValue":a[5]||(a[5]=Ie=>I.value=Ie),class:"text-cyan-500 focus:ring-cyan-500"},null,8,Va),[[Xt,I.value]]),e("span",qa,n(g),1)])),64))])]),e("div",null,[e("label",Da," Rigs (bonus matériaux) - "+n(C.value.length)+"/"+n(St),1),e("div",Ha,[ce(e("input",{"onUpdate:modelValue":a[6]||(a[6]=g=>W.value=g),type:"text",placeholder:ve.value?"Rechercher un rig...":"Maximum de rigs atteint",disabled:!ve.value,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed",onFocus:a[7]||(a[7]=g=>se.value=Re.value.length>0),onBlur:he,onInput:a[8]||(a[8]=g=>se.value=!0)},null,40,Ua),[[fe,W.value]]),se.value&&Re.value.length>0?(s(),o("div",Fa,[(s(!0),o(Z,null,me(Re.value,g=>(s(),o("button",{key:g.name,onMousedown:Te(be=>ye(g),["prevent"]),class:"w-full px-3 py-2 hover:bg-slate-700 text-left"},[e("div",Ka,[e("span",Qa,n(we(g.name)),1),e("span",Xa,[Ye(g.name)?(s(),o(Z,{key:0},[e("span",Wa,"ME: -"+n(g.bonus)+"%",1),e("span",Za,"TE: -"+n(g.bonus)+"%",1)],64)):(s(),o("span",Ya,"ME: -"+n(g.bonus)+"%",1)),e("span",Ga,"("+n(g.size)+")",1)])]),e("div",ei,n(Ze(g.targetCategories)),1)],40,Oa))),128))])):x("",!0),se.value&&W.value.length>=2&&Re.value.length===0?(s(),o("div",ti," Aucun rig trouvé ")):x("",!0)]),C.value.length>0?(s(),o("div",si,[(s(!0),o(Z,null,me(Ue.value,g=>(s(),o("div",{key:g.name,class:"bg-slate-900/50 rounded-lg px-3 py-2"},[e("div",oi,[e("div",ni,[e("span",ri,n(we(g.name)),1),e("span",li,[Ye(g.name)?(s(),o(Z,{key:0},[e("span",ai,"ME: -"+n(g.bonus)+"%",1),e("span",ii,"TE: -"+n(g.bonus)+"%",1)],64)):(s(),o("span",ui,"ME: -"+n(g.bonus)+"%",1)),e("span",di,"("+n(g.size)+")",1)])]),e("button",{onClick:be=>Fe(g.name),class:"ml-2 p-1 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded shrink-0",title:"Retirer"},[...a[22]||(a[22]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ci)]),e("div",pi,n(Ze(g.targetCategories)),1)]))),128))])):(s(),o("p",vi," Aucun rig sélectionné. Recherchez et ajoutez des rigs pour appliquer des bonus. "))]),e("div",mi,[a[27]||(a[27]=e("p",{class:"text-xs text-slate-400 mb-2"},"Bonus calculé (base structure + rigs × sécurité)",-1)),e("div",fi,[re.value?(s(),o("div",xi,[e("div",null,[a[23]||(a[23]=e("span",{class:"text-xs text-slate-500"},"ME Manufacturing:",-1)),e("span",yi,"-"+n(tt.value)+"%",1)]),e("div",null,[a[24]||(a[24]=e("span",{class:"text-xs text-slate-500"},"TE Manufacturing:",-1)),e("span",bi,"-"+n(Ae.value)+"%",1)])])):x("",!0),Ce.value?(s(),o("div",gi,[e("div",null,[a[25]||(a[25]=e("span",{class:"text-xs text-slate-500"},"ME Reactions:",-1)),e("span",hi,"-"+n(Ne.value)+"%",1)]),e("div",null,[a[26]||(a[26]=e("span",{class:"text-xs text-slate-500"},"TE Reactions:",-1)),e("span",ki,"-"+n(Ve.value)+"%",1)])])):x("",!0),_.value==="station"?(s(),o("div",wi," Les stations NPC n'ont pas de bonus ")):x("",!0)])]),e("div",_i,[e("button",{onClick:L,disabled:!l.value.trim(),class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-600 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium"},n(E.value?"Enregistrer":"Ajouter"),9,Ci),e("button",{onClick:$e,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm"}," Annuler ")])])])):x("",!0),c(u).structures.length>0?(s(),o("div",$i,[(s(!0),o(Z,null,me(c(u).structures,g=>(s(),o("div",{key:g.id,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700 hover:border-slate-600"},[e("div",Si,[e("div",Mi,[e("div",Ti,[e("h4",ji,n(g.name),1),g.isCorporationStructure?(s(),o("span",Pi," CORPO ")):x("",!0)]),e("p",Ii,n(Xe[g.structureType])+" - "+n(ke[g.securityType]),1),e("div",Ei,[g.manufacturingMaterialBonus>0||g.manufacturingTimeBonus>0?(s(),o(Z,{key:0},[e("div",null,[a[28]||(a[28]=e("span",{class:"text-xs text-slate-500"},"ME Manuf:",-1)),e("span",Bi,"-"+n(g.manufacturingMaterialBonus)+"%",1)]),e("div",null,[a[29]||(a[29]=e("span",{class:"text-xs text-slate-500"},"TE Manuf:",-1)),e("span",Li,"-"+n(g.manufacturingTimeBonus)+"%",1)])],64)):x("",!0),g.reactionMaterialBonus>0||g.reactionTimeBonus>0?(s(),o(Z,{key:1},[e("div",null,[a[30]||(a[30]=e("span",{class:"text-xs text-slate-500"},"ME Reactions:",-1)),e("span",Ri,"-"+n(g.reactionMaterialBonus)+"%",1)]),e("div",null,[a[31]||(a[31]=e("span",{class:"text-xs text-slate-500"},"TE Reactions:",-1)),e("span",Ni,"-"+n(g.reactionTimeBonus)+"%",1)])],64)):x("",!0)]),g.rigs.length>0?(s(),o("div",Ai,[(s(!0),o(Z,null,me(g.rigs,be=>(s(),o("span",{key:be,class:"px-2 py-0.5 bg-slate-700 text-slate-300 text-xs rounded"},n(we(be)),1))),128))])):x("",!0)]),e("div",zi,[e("button",{onClick:be=>ge(g),class:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded",title:"Modifier"},[...a[32]||(a[32]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Ji),e("button",{onClick:be=>h(g),class:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer"},[...a[33]||(a[33]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Vi)])])]))),128))])):T.value?x("",!0):(s(),o("div",qi,[...a[34]||(a[34]=[e("p",null,"Aucune structure configurée",-1),e("p",{class:"text-sm mt-1"},"Ajoutez vos structures pour calculer les bonus de matériaux",-1)])])),(s(),De(dt,{to:"body"},[X.value?(s(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:Te(pe,["self"]),onKeydown:[xe(N,["enter"]),xe(pe,["escape"])]},[e("div",{class:"bg-slate-900 rounded-xl border border-slate-700 max-w-md w-full p-6",tabindex:"-1",ref_key:"deleteModalRef",ref:ne},[a[37]||(a[37]=e("h3",{class:"text-lg font-semibold text-slate-200 mb-2"},"Supprimer la structure",-1)),e("p",Di,[a[35]||(a[35]=te(" Voulez-vous vraiment supprimer ",-1)),e("span",Hi,n(y.value),1),a[36]||(a[36]=te(" ? ",-1))]),e("div",{class:"flex gap-3"},[e("button",{onClick:pe,class:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300"}," Annuler "),e("button",{onClick:N,class:"flex-1 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white font-medium"}," Supprimer ")])],512)],32)):x("",!0)])),(s(),De(dt,{to:"body"},[f.value?(s(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:Te(Y,["self"]),onKeydown:[xe(q,["enter"]),xe(Y,["escape"])]},[e("div",{class:"bg-slate-900 rounded-xl border border-amber-700/50 max-w-md w-full p-6",tabindex:"-1",ref_key:"corpEditModalRef",ref:P},[a[38]||(a[38]=e("div",{class:"flex items-center gap-3 mb-4"},[e("div",{class:"p-2 bg-amber-500/20 rounded-lg"},[e("svg",{class:"w-6 h-6 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])]),e("h3",{class:"text-lg font-semibold text-slate-200"},"Modifier une structure corpo")],-1)),a[39]||(a[39]=e("p",{class:"text-slate-400 mb-2"}," Cette structure est partagée avec votre corporation. ",-1)),a[40]||(a[40]=e("p",{class:"text-slate-400 mb-6"}," Les modifications (rigs, type, sécurité) seront visibles par tous les membres de la corpo. Voulez-vous continuer ? ",-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:Y,class:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300"}," Annuler "),e("button",{onClick:q,class:"flex-1 py-2 bg-amber-600 hover:bg-amber-500 rounded-lg text-white font-medium"}," Confirmer ")])],512)],32)):x("",!0)]))]))}}),Fi={class:"mb-6 flex items-center justify-between"},Oi={key:0,class:"flex gap-2"},Ki={key:0,class:"mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 flex items-center justify-between"},Qi={key:2,class:"space-y-6"},Xi={class:"bg-slate-900 rounded-xl border border-slate-800 p-6"},Wi={class:"flex items-center gap-4"},Zi={class:"w-48"},Yi=["value"],Gi={class:"bg-slate-900 rounded-xl border border-slate-800 p-6"},eu={class:"bg-slate-900 rounded-xl border border-slate-800 p-6"},tu={class:"bg-slate-900 rounded-xl border border-slate-800 p-6 mb-6"},su={key:0,class:"mb-4"},ou={key:1,class:"mb-4 space-y-2"},nu={class:"flex-1 text-slate-200"},ru={class:"flex items-center gap-1"},lu=["onUpdate:modelValue"],au={class:"flex items-center gap-1"},iu=["onUpdate:modelValue"],uu={class:"flex items-center gap-1"},du=["onUpdate:modelValue"],cu=["onClick"],pu={class:"flex items-end gap-4 flex-wrap"},vu={class:"flex-1 relative min-w-[200px]"},mu={class:"block text-sm text-slate-400 mb-1"},fu={key:0,class:"text-cyan-400 ml-2"},xu={class:"w-24"},yu={class:"w-24"},bu={class:"w-24"},gu=["disabled"],hu=["disabled"],ku={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wu={class:"bg-slate-900 rounded-xl border border-slate-800"},_u={key:0,class:"p-8 text-center text-slate-500"},ju=Qe({__name:"Industry",setup(B){const u=rt(),T=v(null),E=v(1),l=v(0),Q=v(0),I=v(""),_=v([]),C=v(!1),W=v(null);function se(w){return w.replace(/\s*\(BPC\)\s*$/i,"").trim()}const oe=v(null),ee=v("projects");ct(()=>{u.fetchProjects()});function S(w){T.value=w}function j(){var w;T.value&&(_.value.push({typeId:T.value.typeId,typeName:se(T.value.typeName),runs:E.value,meLevel:l.value,teLevel:Q.value}),T.value=null,E.value=1,l.value=0,Q.value=0,(w=W.value)==null||w.clear())}function J(w){_.value.splice(w,1)}async function D(){if(_.value.length===0&&T.value&&j(),_.value.length!==0){C.value=!0;try{const w=_.value[0],p=await u.createProject(w.typeId,w.runs,w.meLevel,w.teLevel,u.defaultMaxJobDurationDays,I.value.trim()||null);for(let d=1;d<_.value.length;d++){const V=_.value[d];await u.createStep(p.id,V.typeId,V.runs,V.meLevel,V.teLevel)}T.value=null,E.value=1,l.value=0,Q.value=0,I.value="",_.value=[],await u.fetchProjects()}finally{C.value=!1}}}function le(w){oe.value=w}function ae(){oe.value=null,u.fetchProjects()}return(w,p)=>(s(),De(Zt,null,{default:Wt(()=>[e("div",Fi,[p[8]||(p[8]=e("p",{class:"text-slate-400"},"Suivi de projets de construction",-1)),oe.value?x("",!0):(s(),o("div",Oi,[e("button",{onClick:p[0]||(p[0]=d=>ee.value="projects"),class:G(["px-4 py-2 rounded-lg text-sm font-medium",ee.value==="projects"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Projets ",2),e("button",{onClick:p[1]||(p[1]=d=>ee.value="config"),class:G(["px-4 py-2 rounded-lg text-sm font-medium",ee.value==="config"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Configuration ",2)]))]),c(u).error?(s(),o("div",Ki,[e("span",null,n(c(u).error),1),e("button",{onClick:p[2]||(p[2]=d=>c(u).clearError()),class:"text-red-400 hover:text-red-300"},[...p[9]||(p[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):x("",!0),oe.value?(s(),De(oa,{key:1,"project-id":oe.value,onClose:ae},null,8,["project-id"])):ee.value==="config"?(s(),o("div",Qi,[e("div",Xi,[p[12]||(p[12]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-4"},"Paramètres généraux",-1)),e("div",Wi,[e("div",Zi,[p[10]||(p[10]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Durée max job (jours)",-1)),e("input",{value:c(u).defaultMaxJobDurationDays.toFixed(1),onChange:p[3]||(p[3]=d=>c(u).setDefaultMaxJobDurationDays(parseFloat(d.target.value)||2)),type:"number",min:"0.5",step:"0.1",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,40,Yi)]),p[11]||(p[11]=e("p",{class:"text-xs text-slate-500 self-end pb-2"}," Les jobs dépassant cette durée seront découpés en plusieurs étapes. ",-1))])]),e("div",Gi,[ut(ha)]),e("div",eu,[ut(Ui)])])):(s(),o(Z,{key:3},[e("div",tu,[p[24]||(p[24]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-4"},"Nouveau projet",-1)),_.value.length>0||I.value?(s(),o("div",su,[p[13]||(p[13]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Nom du projet",-1)),ce(e("input",{"onUpdate:modelValue":p[4]||(p[4]=d=>I.value=d),type:"text",placeholder:"Ex: Rorqual Fleet",class:"w-64 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500 placeholder-slate-600"},null,512),[[fe,I.value]])])):x("",!0),_.value.length>0?(s(),o("div",ou,[(s(!0),o(Z,null,me(_.value,(d,V)=>(s(),o("div",{key:V,class:"flex items-center gap-3 bg-slate-800/50 rounded-lg px-4 py-2"},[e("span",nu,n(d.typeName),1),e("div",ru,[ce(e("input",{"onUpdate:modelValue":ie=>d.runs=ie,type:"number",min:"1",class:"w-16 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm text-center"},null,8,lu),[[fe,d.runs,void 0,{number:!0}]]),p[14]||(p[14]=e("span",{class:"text-slate-500 text-xs"},"runs",-1))]),e("div",au,[p[15]||(p[15]=e("span",{class:"text-slate-500 text-xs"},"ME",-1)),ce(e("input",{"onUpdate:modelValue":ie=>d.meLevel=ie,type:"number",min:"0",max:"10",class:"w-12 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm text-center"},null,8,iu),[[fe,d.meLevel,void 0,{number:!0}]])]),e("div",uu,[p[16]||(p[16]=e("span",{class:"text-slate-500 text-xs"},"TE",-1)),ce(e("input",{"onUpdate:modelValue":ie=>d.teLevel=ie,type:"number",min:"0",max:"20",class:"w-12 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm text-center"},null,8,du),[[fe,d.teLevel,void 0,{number:!0}]])]),e("button",{onClick:ie=>J(V),class:"p-1 text-slate-500 hover:text-red-400",title:"Retirer"},[...p[17]||(p[17]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,cu)]))),128))])):x("",!0),e("div",pu,[e("div",vu,[e("label",mu,[te(n(_.value.length>0?"Ajouter un produit":"Produit")+" ",1),T.value?(s(),o("span",fu," — "+n(T.value.typeName),1)):x("",!0)]),ut(os,{ref_key:"productSearchRef",ref:W,onSelect:S},null,512)]),e("div",xu,[p[18]||(p[18]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Runs",-1)),ce(e("input",{"onUpdate:modelValue":p[5]||(p[5]=d=>E.value=d),type:"number",min:"1",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[fe,E.value,void 0,{number:!0}]])]),e("div",yu,[p[19]||(p[19]=e("label",{class:"block text-sm text-slate-400 mb-1"},"ME",-1)),ce(e("input",{"onUpdate:modelValue":p[6]||(p[6]=d=>l.value=d),type:"number",min:"0",max:"10",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[fe,l.value,void 0,{number:!0}]])]),e("div",bu,[p[20]||(p[20]=e("label",{class:"block text-sm text-slate-400 mb-1"},"TE",-1)),ce(e("input",{"onUpdate:modelValue":p[7]||(p[7]=d=>Q.value=d),type:"number",min:"0",max:"20",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[fe,Q.value,void 0,{number:!0}]])]),_.value.length>0?(s(),o("button",{key:0,onClick:j,disabled:!T.value,class:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-white text-sm font-medium disabled:opacity-50 flex items-center gap-2",title:"Ajouter à la liste"},[...p[21]||(p[21]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),te(" Ajouter ",-1)])],8,gu)):x("",!0),e("button",{onClick:D,disabled:!T.value&&_.value.length===0||C.value,class:"px-6 py-2.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium disabled:opacity-50 flex items-center gap-2"},[C.value?(s(),o("svg",ku,[...p[22]||(p[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):x("",!0),te(" "+n(C.value?"Création...":_.value.length>0?"Créer le projet":"Créer"),1)],8,hu),_.value.length===0&&T.value?(s(),o("button",{key:1,onClick:j,class:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm font-medium flex items-center gap-2",title:"Ajouter un autre produit"},[...p[23]||(p[23]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),te(" Multi-produit ",-1)])])):x("",!0)])]),e("div",wu,[p[26]||(p[26]=e("div",{class:"px-6 py-4 border-b border-slate-800"},[e("h3",{class:"text-lg font-semibold text-slate-100"},"Historique des projets")],-1)),c(u).isLoading?(s(),o("div",_u,[...p[25]||(p[25]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),te(" Chargement... ",-1)])])):(s(),De(Rs,{key:1,onViewProject:le}))])],64))]),_:1}))}});export{ju as default};
