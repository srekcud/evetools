import{d as k,u as E,o as _,c,a as x,b as t,t as b,e as y,f as S,g as C,r as f,h as u}from"./index-BmJN7W-L.js";const A={class:"min-h-screen bg-eve-dark flex items-center justify-center relative overflow-hidden"},j={class:"relative z-10 eve-card p-12 max-w-md w-full mx-4"},I={key:0,class:"mb-6 p-4 bg-amber-500/20 border border-amber-500/50 rounded-lg"},V={class:"flex items-center gap-3"},O={class:"text-amber-200/70 text-xs mt-1"},z={key:1,class:"mb-6 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm text-center"},B={key:2,class:"flex flex-col items-center gap-4"},M=k({__name:"Login",setup(L){const p=S(),d=C(),n=E(),l=f(!1),s=f(""),r=f(!1),v=f(null);async function h(){try{const a=await fetch("https://esi.evetech.net/status.json",{method:"GET",headers:{Accept:"application/json"}});if(!a.ok){a.status===503&&(r.value=!0,v.value="ESI is currently in maintenance mode");return}const e=await a.json();Array.isArray(e)&&e.every(o=>o.status!=="green")&&(r.value=!0,v.value="ESI services are degraded")}catch{r.value=!0,v.value="Cannot reach ESI servers"}}_(async()=>{h();const a=p.query.code;if(a){l.value=!0;try{const o=sessionStorage.getItem("eve_oauth_action"),m=n.token||localStorage.getItem("jwt_token");console.log("[OAuth Callback] Action:",o),console.log("[OAuth Callback] Has existing token:",!!m);const g={};o&&m&&(g.Authorization=`Bearer ${m}`),console.log("[OAuth Callback] Calling /auth/eve/exchange...");const i=await(await fetch(`/auth/eve/exchange?code=${encodeURIComponent(a)}`,{headers:g})).json();if(console.log("[OAuth Callback] Response:",i),sessionStorage.removeItem("eve_oauth_action"),sessionStorage.removeItem("eve_oauth_state"),sessionStorage.removeItem("eve_oauth_character_id"),o==="add-character"||o==="reauthorize"){i.error?s.value=i.message||"Failed to add character":(await n.fetchUser(),d.push("/characters"));return}if(i.token){n.setToken(i.token),await n.fetchUser(),d.push("/dashboard");return}else s.value=i.message||"Authentication failed"}catch(o){await h(),r.value?s.value="Authentication failed - EVE servers may be under maintenance":s.value="Authentication error",console.error(o)}finally{l.value=!1}return}const e=p.query.token;if(e){n.setToken(e),await n.fetchUser(),d.push("/dashboard");return}n.isAuthenticated&&d.push("/dashboard")});async function w(){l.value=!0,s.value="";try{const e=await(await fetch("/auth/eve/redirect")).json();e.redirect_url?(sessionStorage.setItem("eve_oauth_state",e.state),window.location.href=e.redirect_url):s.value="Failed to get redirect URL"}catch(a){await h(),r.value?s.value="Cannot connect - EVE servers may be under maintenance":s.value="Connection error",console.error(a)}finally{l.value=!1}}return(a,e)=>(u(),c("div",A,[e[7]||(e[7]=x('<div class="absolute inset-0"><div class="absolute inset-0 bg-gradient-to-br from-eve-dark via-[#0d1015] to-eve-dark"></div><div class="absolute inset-0 opacity-10"><div class="absolute top-1/4 left-1/4 w-96 h-96 bg-eve-accent rounded-full filter blur-[100px] animate-pulse-slow"></div><div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-eve-accent-dim rounded-full filter blur-[100px] animate-pulse-slow" style="animation-delay:1s;"></div></div><div class="absolute inset-0 opacity-5" style="background-image:linear-gradient(rgba(0,212,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0,212,255,0.1) 1px, transparent 1px);background-size:50px 50px;"></div></div>',1)),t("div",j,[e[4]||(e[4]=x('<div class="text-center mb-10"><div class="inline-flex items-center justify-center w-20 h-20 mb-6"><svg viewBox="0 0 100 100" class="w-full h-full"><defs><linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00d4ff;"></stop><stop offset="100%" style="stop-color:#0099bb;"></stop></linearGradient></defs><polygon fill="url(#logoGrad)" points="50,5 95,27.5 95,72.5 50,95 5,72.5 5,27.5"></polygon><text x="50" y="62" text-anchor="middle" fill="#0a0c0f" font-family="Rajdhani, sans-serif" font-size="36" font-weight="bold">E</text></svg></div><h1 class="text-4xl font-bold text-eve-text-bright mb-2 tracking-wide">EVE Tools</h1><p class="text-eve-text">Industrial Management Suite</p></div>',1)),r.value?(u(),c("div",I,[t("div",V,[e[1]||(e[1]=t("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("div",null,[e[0]||(e[0]=t("p",{class:"text-amber-200 text-sm font-medium"},"EVE Online servers are under maintenance",-1)),t("p",O,b(v.value),1)])])])):y("",!0),s.value?(u(),c("div",z,b(s.value),1)):y("",!0),l.value?(u(),c("div",B,[...e[2]||(e[2]=[t("svg",{class:"w-10 h-10 animate-spin text-eve-accent",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("p",{class:"text-eve-text"},"Connecting to EVE Online...",-1)])])):(u(),c("button",{key:3,onClick:w,class:"w-full flex justify-center transition-all duration-300 hover:scale-105 hover:drop-shadow-[0_0_15px_rgba(0,212,255,0.4)] focus:outline-none focus:ring-2 focus:ring-eve-accent/50 rounded"},[...e[3]||(e[3]=[t("img",{src:"https://web.ccpgamescdn.com/eveonlineassets/developers/eve-sso-login-black-large.png",alt:"Log in with EVE Online",class:"h-auto max-w-full"},null,-1)])])),e[5]||(e[5]=t("p",{class:"text-center text-eve-text/60 text-sm mt-8"}," Secure authentication via EVE Online SSO ",-1)),e[6]||(e[6]=t("p",{class:"text-center text-eve-text/40 text-xs mt-2"}," Your credentials are never shared with this application ",-1))]),e[8]||(e[8]=t("div",{class:"absolute bottom-4 left-1/2 -translate-x-1/2 text-eve-text/40 font-mono text-xs"}," v0.1.0-alpha ",-1))]))}});export{M as default};
