import{d as P,u as U,z as V,i as B,w as X,h as o,b as t,B as _,D as T,n as j,c as i,y as I,e as v,F as J,m as H,t as N,l as O,r as l,p as D,j as g,s as p}from"./index-BrHa6dug.js";import{_ as W}from"./MainLayout.vue_vue_type_style_index_0_lang-DJ721N8Q.js";import{_ as K}from"./ShoppingListResults.vue_vue_type_script_setup_true_lang-GK6hnXM5.js";import"./useFormatters-CV5q413z.js";import"./useEveImages-B3tDia7r.js";const Q={class:"space-y-6"},G={class:"bg-slate-900 border border-cyan-500/20 rounded-xl p-6"},Y={class:"space-y-4"},Z={class:"flex flex-wrap items-end gap-4"},ee={class:"flex-1 min-w-[300px] max-w-[450px]"},te={class:"relative"},se=["placeholder"],ae={class:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1"},re={key:0,class:"w-4 h-4 animate-spin text-cyan-400",fill:"none",viewBox:"0 0 24 24"},le={key:0,class:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto"},oe=["onMousedown"],ne={class:"font-medium truncate"},ue={key:0,class:"px-3 py-2 text-slate-400 text-sm"},ie=["disabled"],ce=["disabled"],de={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},ve={key:0,class:"bg-red-900/30 border border-red-500/30 rounded-xl p-4 text-red-400"},ge=P({__name:"ShoppingList",setup(pe){const x=U(),m=l(""),w=l(1200),n=l({id:null,name:""}),u=l(""),c=l([]),f=l(!1),h=l(!1),b=l(!1),k=l(!1),S=l(!1),y=l(null),d=l(""),a=l(null),C=D(()=>m.value.trim().length>0);let M=null;V(u,s=>{if(M&&clearTimeout(M),s.length<3){c.value=[];return}M=setTimeout(()=>{F(s)},300)});async function F(s){f.value=!0;try{const e=await g(`/api/shopping-list/search-structures?q=${encodeURIComponent(s)}`,{headers:{Authorization:`Bearer ${x.token}`,"X-Requested-With":"XMLHttpRequest"}});if(e.ok){const r=await p(e);c.value=r.results,h.value=!0}}catch(e){console.error("Structure search failed:",e)}finally{f.value=!1}}function L(s){n.value={id:s.id,name:s.name},u.value="",c.value=[],h.value=!1}function R(){n.value={id:null,name:""},u.value="",c.value=[]}function A(){setTimeout(()=>{h.value=!1},200)}async function z(){if(C.value){b.value=!0,d.value="",a.value=null,y.value=null;try{const s=await g("/api/shopping-list/parse",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x.token}`,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({text:m.value,transportCost:w.value,structureId:n.value.id})});if(!s.ok){const e=await p(s);throw new Error(e.error||"Failed to parse items")}a.value=await p(s)}catch(s){d.value=s instanceof Error?s.message:"An error occurred"}finally{b.value=!1}}}function E(){m.value="",a.value=null,d.value="",y.value=null}async function $(){if(a.value){k.value=!0;try{const s=await g("/api/shopping-list/sync-structure-market",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x.token}`,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({structureId:a.value.structureId||n.value.id})});if(!s.ok){const e=await p(s);throw new Error(e.error||"Sync failed")}await z()}catch(s){d.value=s instanceof Error?s.message:"Sync failed"}finally{k.value=!1}}}async function q(){if(a.value){S.value=!0,y.value=null;try{const s=await g("/api/shopping-list/share",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x.token}`,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({items:a.value.items,notFound:a.value.notFound,totals:a.value.totals,transportCostPerM3:a.value.transportCostPerM3,structureId:a.value.structureId,structureName:a.value.structureName})});if(!s.ok){const r=await p(s);throw new Error(r.error||"Failed to create share link")}const e=await p(s);y.value=e.shareUrl,e.shareUrl&&navigator.clipboard.writeText(e.shareUrl)}catch(s){d.value=s instanceof Error?s.message:"Failed to share"}finally{S.value=!1}}}return(s,e)=>(o(),B(W,null,{default:X(()=>[t("div",Q,[e[13]||(e[13]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-400"}," Liste de courses "),t("p",{class:"text-slate-400 text-sm mt-1"}," Collez une liste d'items pour calculer les prix et volumes ")])],-1)),t("div",G,[t("div",Y,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-slate-300 mb-2"}," Collez votre liste d'items ",-1)),_(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=r=>m.value=r),rows:"8",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/50 font-mono text-sm",placeholder:`Tritanium	10000
Pyerite	5000
Megacyte 100
200x Nocxium
...`},null,512),[[T,m.value]]),e[5]||(e[5]=t("p",{class:"text-xs text-slate-500 mt-2"},' Formats supportes: "Item Name 123", "Item Name 123", "123x Item Name", "Item Name x 123" ',-1))]),t("div",Z,[t("div",ee,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"}," Structure de comparaison (avec Jita) ",-1)),t("div",te,[_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>u.value=r),type:"text",placeholder:n.value.id?n.value.name:"C-J6MT - 1st Taj Mahgoon (défaut)",onFocus:e[2]||(e[2]=r=>h.value=!0),onBlur:A,class:j(["w-full rounded-lg pl-3 pr-10 py-2 focus:outline-none",n.value.id?"bg-slate-800 border-2 border-cyan-500/50 text-cyan-400 placeholder-cyan-400":"bg-slate-800 border border-slate-700 text-slate-200 placeholder-slate-400 focus:border-cyan-500/50"])},null,42,se),[[T,u.value]]),t("div",ae,[f.value?(o(),i("svg",re,[...e[6]||(e[6]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):n.value.id||u.value?(o(),i("button",{key:1,onMousedown:I(R,["prevent"]),class:"text-slate-400 hover:text-slate-200",title:"Revenir au defaut"},[...e[7]||(e[7]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],32)):v("",!0)]),h.value&&(c.value.length>0||u.value.length>=3&&!f.value)?(o(),i("div",le,[(o(!0),i(J,null,H(c.value,r=>(o(),i("button",{key:r.id,onMousedown:I(me=>L(r),["prevent"]),class:"w-full px-3 py-2 text-left text-slate-200 hover:bg-slate-700/50 transition-colors border-b border-slate-800 last:border-0"},[t("div",ne,N(r.name),1)],40,oe))),128)),u.value.length>=3&&c.value.length===0&&!f.value?(o(),i("div",ue," Aucune structure trouvee (verifiez le dock access) ")):v("",!0)])):v("",!0)])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"}," Transport (ISK/m³) ",-1)),_(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>w.value=r),type:"number",min:"0",step:"100",class:"w-28 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-slate-200 focus:outline-none focus:border-cyan-500/50"},null,512),[[T,w.value,void 0,{number:!0}]])]),e[12]||(e[12]=t("div",{class:"flex-1"},null,-1)),t("button",{onClick:E,disabled:!C.value&&!a.value,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Effacer ",8,ie),t("button",{onClick:z,disabled:!C.value||b.value,class:"px-6 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[b.value?(o(),i("svg",de,[...e[10]||(e[10]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):v("",!0),e[11]||(e[11]=O(" Calculer les prix ",-1))],8,ce)])])]),d.value?(o(),i("div",ve,N(d.value),1)):v("",!0),a.value?(o(),B(K,{key:1,items:a.value.items,totals:a.value.totals,"structure-name":a.value.structureName||"C-J6MT Keepstar","not-found":a.value.notFound,"price-error":a.value.priceError,"structure-accessible":a.value.structureAccessible,"structure-from-cache":a.value.structureFromCache,"structure-last-sync":a.value.structureLastSync,"is-syncing":k.value,"is-sharing":S.value,"share-url":y.value,onSyncStructure:$,onShare:q},null,8,["items","totals","structure-name","not-found","price-error","structure-accessible","structure-from-cache","structure-last-sync","is-syncing","is-sharing","share-url"])):v("",!0)])]),_:1}))}});export{ge as default};
