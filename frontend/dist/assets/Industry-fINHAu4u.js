import{I as Ut,E as yt,r as x,G as ne,d as Ve,h as t,c as s,B as de,D as be,b as e,k as a,F as O,m as pe,y as ke,t as o,e as h,x as xe,n as G,p as le,z as Ge,l as se,i as et,T as ft,J as St,K as qt,q as Ye,u as Ft,A as Et,j as Ht,s as Ot,o as ct,L as jt,C as Tt,a as Bt,M as Kt,w as Qt}from"./index-BrHa6dug.js";import{_ as Wt}from"./MainLayout.vue_vue_type_style_index_0_lang-DJ721N8Q.js";import{u as bt}from"./useFormatters-CV5q413z.js";import{u as dt}from"./useEveImages-B3tDia7r.js";import{u as Lt}from"./sync-Y-kYcwfb.js";function ze(n,c){return Ut(n)?n.violations.map(m=>m.message).join(" | "):n instanceof Error?n.message:c}function Ze(n){const c=n.purchasedQuantity>0?n.purchasedQuantity:n.inStockQuantity;if(n.inStock=c>=n.quantity&&c>0,n.isSplit=n.splitGroupId!==null,n.jobMatches&&n.jobMatches.length>0){const m=n.jobMatches[0];n.esiJobId=m.esiJobId,n.esiJobCost=m.cost,n.esiJobStatus=m.status,n.esiJobEndDate=m.endDate,n.esiJobRuns=m.runs,n.esiJobCharacterName=m.characterName,n.esiJobsCount=n.jobMatches.length,n.esiJobsTotalRuns=n.jobMatches.reduce((i,l)=>i+l.runs,0),n.esiJobsActiveRuns=n.jobMatches.filter(i=>i.status==="active").reduce((i,l)=>i+l.runs,0),n.esiJobsDeliveredRuns=n.jobMatches.filter(i=>i.status==="delivered").reduce((i,l)=>i+l.runs,0),(!n.similarJobs||n.similarJobs.length===0)&&(n.similarJobs=n.jobMatches)}else n.esiJobId=null,n.esiJobCost=null,n.esiJobStatus=null,n.esiJobEndDate=null,n.esiJobRuns=null,n.esiJobCharacterName=null,n.esiJobsCount=null,n.esiJobsTotalRuns=null,n.esiJobsActiveRuns=null,n.esiJobsDeliveredRuns=null,(!n.similarJobs||n.similarJobs.length===0)&&(n.similarJobs=[]);return n.manualJobData=n.jobMatchMode==="manual",n.recommendedStructureName=n.structureConfigName,n.structureBonus=n.structureMaterialBonus,n.timePerRun!==null&&n.runs>0?n.estimatedDurationDays=n.timePerRun*n.runs/86400:n.estimatedDurationDays=null,n}function vt(n){return n.steps&&(n.steps=n.steps.map(Ze)),n}const Nt=yt("industry-projects",()=>{const n=x([]),c=x(null),m=x([]),i=x(!1),l=x(null),v=x(0),f=x(2);function C(B){f.value=B}async function I(B){if(B.length<2){m.value=[];return}try{const w=await ne(`/industry/search?q=${encodeURIComponent(B)}`);m.value=w.results}catch{m.value=[]}}async function D(B,w,b,u=0,T=2,j){l.value=null;try{const N=vt(await ne("/industry/projects",{method:"POST",body:JSON.stringify({typeId:B,runs:w,meLevel:b,teLevel:u,maxJobDurationDays:T,name:j})}));return n.value.unshift(N),N}catch(N){throw l.value=ze(N,"Échec de création du projet"),N}}async function q(){i.value=!0,l.value=null;try{const B=await ne("/industry/projects");n.value=B.projects.map(vt),v.value=B.totalProfit}catch(B){l.value=B instanceof Error?B.message:"Failed to fetch projects"}finally{i.value=!1}}async function J(B){i.value=!0,l.value=null;try{c.value=vt(await ne(`/industry/projects/${B}`))}catch(w){l.value=w instanceof Error?w.message:"Failed to fetch project"}finally{i.value=!1}}async function Q(B,w){var b;l.value=null;try{const u=vt(await ne(`/industry/projects/${B}`,{method:"PATCH",body:JSON.stringify(w)})),{steps:T,tree:j,...N}=u,S=n.value.findIndex(W=>W.id===B);return S!==-1&&(n.value[S]={...n.value[S],...N}),((b=c.value)==null?void 0:b.id)===B&&(c.value={...c.value,...N}),u}catch(u){throw l.value=u instanceof Error?u.message:"Failed to update project",u}}async function k(B){l.value=null;try{await ne(`/industry/projects/${B}`,{method:"DELETE"}),n.value=n.value.filter(w=>w.id!==B)}catch(w){l.value=w instanceof Error?w.message:"Failed to delete project"}}async function E(B){var w,b;try{const u=await ne(`/industry/projects/${B}/match-jobs`,{method:"POST",body:"{}"});return((w=c.value)==null?void 0:w.id)===B&&(c.value.steps=(b=u.steps)==null?void 0:b.map(Ze),c.value.jobsCost=u.jobsCost),u.warning}catch(u){return l.value=u instanceof Error?u.message:"Failed to match jobs",null}}async function H(B,w,b){try{const u=new URLSearchParams;w&&u.set("structureId",w.toString()),b!==void 0&&u.set("transportCost",b.toString());const T=u.toString()?`?${u.toString()}`:"";return await ne(`/industry/projects/${B}/shopping-list${T}`)}catch(u){return l.value=u instanceof Error?u.message:"Failed to fetch shopping list",null}}async function F(B,w){var b;try{const u=await ne(`/industry/projects/${B}/apply-stock`,{method:"POST",body:JSON.stringify({items:w})});if(((b=c.value)==null?void 0:b.id)===B&&c.value.steps&&Array.isArray(u))for(const T of u.map(Ze)){const j=c.value.steps.findIndex(N=>N.id===T.id);j!==-1&&(c.value.steps[j]=T)}return u}catch(u){throw l.value=ze(u,"Échec de l'application du stock"),u}}async function P(B){var w;try{const b=vt(await ne(`/industry/projects/${B}/adapt-stock`,{method:"POST",body:"{}"}));return((w=c.value)==null?void 0:w.id)===B&&(c.value=b),b}catch(b){throw l.value=ze(b,"Échec de l'adaptation du plan"),b}}function z(){l.value=null}return{projects:n,currentProject:c,searchResults:m,isLoading:i,error:l,totalProfit:v,defaultMaxJobDurationDays:f,setDefaultMaxJobDurationDays:C,searchProducts:I,createProject:D,fetchProjects:q,fetchProject:J,updateProject:Q,deleteProject:k,matchJobs:E,fetchShoppingList:H,applyStock:F,adaptStock:P,clearError:z}}),Rt=yt("industry-steps",()=>{const n=Nt(),c=x([]),m=x(!1);function i(w,b){var u;if(((u=n.currentProject)==null?void 0:u.id)===w&&n.currentProject.steps){const T=n.currentProject.steps.findIndex(j=>j.id===b.id);T!==-1&&(n.currentProject.steps[T]=b)}}function l(w,b){var u;if(((u=n.currentProject)==null?void 0:u.id)===w&&n.currentProject.steps)for(const T of b){const j=n.currentProject.steps.findIndex(N=>N.id===T.id);j!==-1&&(n.currentProject.steps[j]=T)}}async function v(w,b,u){try{const T=Ze(await ne(`/industry/projects/${w}/steps/${b}`,{method:"PATCH",body:JSON.stringify({purchased:u})}));i(w,T)}catch(T){throw n.error=ze(T,"Échec de mise à jour de l'étape"),T}}async function f(w,b,u){try{const T=Ze(await ne(`/industry/projects/${w}/steps/${b}`,{method:"PATCH",body:JSON.stringify({inStockQuantity:u})}));i(w,T)}catch(T){throw n.error=ze(T,"Échec de mise à jour de l'étape"),T}}async function C(w,b,u){try{const T=await ne(`/industry/projects/${w}/steps/${b}`,{method:"PATCH",body:JSON.stringify(u)});if(Array.isArray(T)){const j=T.map(Ze);return l(w,j),j[0]}else{const j=Ze(T);return i(w,j),j}}catch(T){throw n.error=ze(T,"Échec de mise à jour de l'étape"),T}}async function I(w,b,u){return C(w,b,{runs:u})}async function D(w,b,u){return C(w,b,{meLevel:u})}async function q(w,b,u){return C(w,b,{teLevel:u})}async function J(w,b,u){return C(w,b,{structureConfigId:u})}async function Q(w,b,u,T,j){var N;try{const S={typeId:b,runs:u};T!==void 0&&(S.meLevel=T),j!==void 0&&(S.teLevel=j);const W=Ze(await ne(`/industry/projects/${w}/steps`,{method:"POST",body:JSON.stringify(S)}));return((N=n.currentProject)==null?void 0:N.id)===w&&n.currentProject.steps&&n.currentProject.steps.push(W),W}catch(S){throw n.error=S instanceof Error?S.message:"Failed to create step",S}}async function k(w,b,u,T){var j,N;try{const S={runs:T};if(b?S.splitGroupId=b:u&&(S.stepId=u),u){const W=await ne(`/industry/projects/${w}/steps`,{method:"POST",body:JSON.stringify(S)});if(((j=n.currentProject)==null?void 0:j.id)===w&&n.currentProject.steps){const ie=n.currentProject.steps.findIndex($e=>$e.id===u);ie!==-1&&(n.currentProject.steps[ie]=W.updatedStep),n.currentProject.steps.push(W.newStep)}return W.newStep}else{const W=await ne(`/industry/projects/${w}/steps`,{method:"POST",body:JSON.stringify(S)});return((N=n.currentProject)==null?void 0:N.id)===w&&n.currentProject.steps&&n.currentProject.steps.push(W),W}}catch(S){throw n.error=S instanceof Error?S.message:"Failed to add child job",S}}async function E(w,b){var u;try{await ne(`/industry/projects/${w}/steps/${b}`,{method:"DELETE"}),((u=n.currentProject)==null?void 0:u.id)===w&&n.currentProject.steps&&(n.currentProject.steps=n.currentProject.steps.filter(T=>T.id!==b))}catch(T){throw n.error=T instanceof Error?T.message:"Failed to delete step",T}}async function H(w,b,u){var T;try{const j=await ne(`/industry/projects/${w}/steps/${b}/split`,{method:"POST",body:JSON.stringify({numberOfJobs:u})});return((T=n.currentProject)==null?void 0:T.id)===w&&await n.fetchProject(w),j}catch(j){throw n.error=ze(j,"Échec du split"),j}}async function F(w,b){var u;try{const T=await ne(`/industry/projects/${w}/steps/${b}/merge`,{method:"POST",body:"{}"});return((u=n.currentProject)==null?void 0:u.id)===w&&await n.fetchProject(w),T}catch(T){throw n.error=ze(T,"Échec de la fusion"),T}}async function P(w){m.value=!0;try{c.value=await ne(`/industry/projects/${w}/available-jobs`)}catch(b){n.error=ze(b,"Échec du chargement des jobs ESI")}finally{m.value=!1}}async function z(w,b,u){try{const T=Ze(await ne(`/industry/projects/${w}/steps/${b}/link-job`,{method:"POST",body:JSON.stringify({esiJobId:u})}));return i(w,T),await P(w),T}catch(T){throw n.error=ze(T,"Échec de la liaison du job"),T}}async function B(w,b){try{await ne(`/industry/step-job-matches/${b}`,{method:"DELETE"}),await n.fetchProject(w),await P(w)}catch(u){throw n.error=ze(u,"Échec de la suppression du lien"),u}}return{availableJobs:c,availableJobsLoading:m,toggleStepPurchased:v,toggleStepInStock:f,updateStep:C,updateStepRuns:I,updateStepMeLevel:D,updateStepTeLevel:q,updateStepStructure:J,createStep:Q,addChildJob:k,deleteStep:E,splitStep:H,mergeSteps:F,fetchAvailableJobs:P,linkJob:z,unlinkJob:B}}),_t=yt("industry-structures",()=>{const n=x([]),c=x(null),m=x([]),i=x(null),l=x([]),v=x(null);async function f(){try{const P=await ne("/industry/structures");n.value=P.structures,c.value=P.rigOptions}catch(P){v.value=P instanceof Error?P.message:"Failed to fetch structures"}}async function C(){try{const P=await ne("/industry/corporation-structures");m.value=P.structures}catch(P){console.error("Failed to fetch corporation structures:",P)}}async function I(P){try{const z=await ne("/industry/structures",{method:"POST",body:JSON.stringify({...P,isDefault:!1})});return n.value.push(z),z}catch(z){throw v.value=z instanceof Error?z.message:"Failed to create structure",z}}async function D(P,z){try{const B=await ne(`/industry/structures/${P}`,{method:"PATCH",body:JSON.stringify(z)}),w=n.value.findIndex(b=>b.id===P);return w!==-1&&(n.value[w]=B),B}catch(B){throw v.value=B instanceof Error?B.message:"Failed to update structure",B}}async function q(P){try{await ne(`/industry/structures/${P}`,{method:"DELETE"}),n.value=n.value.filter(z=>z.id!==P)}catch(z){throw v.value=z instanceof Error?z.message:"Failed to delete structure",z}}async function J(P){if(P.length<3)return{structures:[]};try{return{structures:(await ne(`/industry/search-structure?q=${encodeURIComponent(P)}`)).structures}}catch(z){const B=z instanceof Error?z.message:"Erreur de recherche";return console.error("Failed to search structures:",z),{structures:[],error:B}}}async function Q(){try{i.value=await ne("/industry/settings")}catch(P){console.error("Failed to fetch user settings:",P)}}async function k(P){try{return i.value=await ne("/industry/settings",{method:"PATCH",body:JSON.stringify(P)}),i.value}catch(z){throw v.value=z instanceof Error?z.message:"Failed to update settings",z}}async function E(){try{const P=await ne("/industry/character-skills");l.value=P.characters}catch(P){console.error("Failed to fetch character skills:",P)}}async function H(){try{const P=await ne("/industry/character-skills/sync",{method:"POST",body:"{}"});return l.value=P.characters,P.warning||null}catch(P){throw v.value=P instanceof Error?P.message:"Failed to sync skills",P}}async function F(P,z){try{const B=await ne(`/industry/character-skills/${P}`,{method:"PATCH",body:JSON.stringify(z)}),w=l.value.findIndex(b=>b.characterId===P);return w!==-1&&(l.value[w]=B),B}catch(B){throw v.value=B instanceof Error?B.message:"Failed to update skill",B}}return{structures:n,rigOptions:c,corporationStructures:m,userSettings:i,characterSkills:l,error:v,fetchStructures:f,fetchCorporationStructures:C,createStructure:I,updateStructure:D,deleteStructure:q,searchStructures:J,fetchUserSettings:Q,updateUserSettings:k,fetchCharacterSkills:E,syncCharacterSkills:H,updateCharacterSkill:F}}),Xt=yt("industry-blacklist",()=>{const n=x(null),c=x(null);async function m(){try{n.value=await ne("/industry/blacklist")}catch(v){c.value=v instanceof Error?v.message:"Failed to fetch blacklist"}}async function i(v,f){try{n.value=await ne("/industry/blacklist",{method:"PUT",body:JSON.stringify({groupIds:v,typeIds:f})})}catch(C){c.value=C instanceof Error?C.message:"Failed to update blacklist"}}async function l(v){if(v.length<2)return[];try{return(await ne(`/industry/blacklist/search?q=${encodeURIComponent(v)}`)).results}catch{return[]}}return{blacklist:n,error:c,fetchBlacklist:m,updateBlacklist:i,searchBlacklistItems:l}});function ot(){const n=Nt(),c=Rt(),m=_t(),i=Xt();return{get projects(){return n.projects},get currentProject(){return n.currentProject},get searchResults(){return n.searchResults},set searchResults(l){n.searchResults=l},get isLoading(){return n.isLoading},get error(){return n.error},set error(l){n.error=l},get totalProfit(){return n.totalProfit},get defaultMaxJobDurationDays(){return n.defaultMaxJobDurationDays},setDefaultMaxJobDurationDays:n.setDefaultMaxJobDurationDays,searchProducts:n.searchProducts,createProject:n.createProject,fetchProjects:n.fetchProjects,fetchProject:n.fetchProject,updateProject:n.updateProject,deleteProject:n.deleteProject,matchJobs:n.matchJobs,fetchShoppingList:n.fetchShoppingList,clearError:n.clearError,toggleStepPurchased:c.toggleStepPurchased,toggleStepInStock:c.toggleStepInStock,updateStepJobData:(l,v,f)=>c.updateStep(l,v,f),clearStepJobData:(l,v)=>c.updateStep(l,v,{clearJobData:!0}),createStep:c.createStep,addChildJob:c.addChildJob,deleteStep:c.deleteStep,updateStepRuns:c.updateStepRuns,get structures(){return m.structures},get rigOptions(){return m.rigOptions},get corporationStructures(){return m.corporationStructures},fetchStructures:m.fetchStructures,fetchCorporationStructures:m.fetchCorporationStructures,createStructure:m.createStructure,updateStructure:m.updateStructure,deleteStructure:m.deleteStructure,searchStructures:m.searchStructures,get blacklist(){return i.blacklist},fetchBlacklist:i.fetchBlacklist,updateBlacklist:i.updateBlacklist,searchBlacklistItems:i.searchBlacklistItems}}const Zt={class:"relative"},Yt={key:0,class:"absolute z-20 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto"},Gt=["onMousedown"],es=["src"],ts=Ve({__name:"ProductSearch",emits:["select"],setup(n,{expose:c,emit:m}){const i=m,l=ot(),v=x(""),f=x(!1);let C=null;function I(){if(C&&clearTimeout(C),v.value.length<2){l.searchResults=[],f.value=!1;return}C=setTimeout(async()=>{await l.searchProducts(v.value),f.value=l.searchResults.length>0},300)}function D(Q){i("select",Q),v.value=Q.typeName,f.value=!1,l.searchResults=[]}function q(){setTimeout(()=>{f.value=!1},200)}function J(){v.value="",l.searchResults=[],f.value=!1}return c({clear:J}),(Q,k)=>(t(),s("div",Zt,[de(e("input",{"onUpdate:modelValue":k[0]||(k[0]=E=>v.value=E),onInput:I,onFocus:k[1]||(k[1]=E=>f.value=a(l).searchResults.length>0),onBlur:q,type:"text",placeholder:"Rechercher un produit (ex: Nomad, Raven...)",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-cyan-500 pr-10"},null,544),[[be,v.value]]),k[3]||(k[3]=e("svg",{class:"absolute right-3 top-3 w-4 h-4 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),f.value&&a(l).searchResults.length>0?(t(),s("div",Yt,[(t(!0),s(O,null,pe(a(l).searchResults,E=>(t(),s("button",{key:E.typeId,onMousedown:ke(H=>D(E),["prevent"]),class:"w-full px-4 py-2.5 text-left hover:bg-slate-700 text-sm flex items-center gap-3 transition-colors"},[e("img",{src:`https://images.evetech.net/types/${E.typeId}/icon?size=32`,class:"w-6 h-6 rounded",onError:k[2]||(k[2]=H=>H.target.style.display="none")},null,40,es),e("span",null,o(E.typeName),1)],40,Gt))),128))])):h("",!0)]))}});function $t(n){if(!n||n.trim()==="")return null;let c=n.trim().replace(/[\s,]/g,"");const m=c.slice(-1).toLowerCase();let i=1;m==="k"?(i=1e3,c=c.slice(0,-1)):m==="m"?(i=1e6,c=c.slice(0,-1)):m==="b"&&(i=1e9,c=c.slice(0,-1));const l=parseFloat(c);return isNaN(l)?null:Math.round(l*i*100)/100}const ss={class:"overflow-x-auto"},os={class:"w-full text-sm"},ns={class:"divide-y divide-slate-800"},rs={class:"py-3 px-3"},as=["onClick"],ls={class:"inline-flex items-center justify-center w-5 h-5 text-xs bg-cyan-500/20 text-cyan-400 rounded-full"},is=["src"],us={key:0,class:"text-slate-500 text-xs"},cs={key:0,class:"text-xs text-slate-500 mt-0.5 pl-7"},ds={class:"py-3 px-2"},ps={key:0,class:"text-slate-500 text-xs",title:"Plusieurs produits"},ms=["onKeydown","onBlur"],xs=["onDblclick","title"],vs={class:"py-3 px-2 text-slate-300"},fs={class:"py-3 px-2 text-slate-300"},ys={class:"py-3 px-2 text-center"},bs=["onClick","disabled","title"],hs=["onKeydown","onBlur"],gs=["onDblclick","title"],ks={class:"py-3 px-2 text-right font-mono text-slate-400"},ws=["onKeydown","onBlur"],Ss=["onDblclick","title"],$s={class:"py-3 px-2 text-center"},_s=["onClick"],Cs={class:"py-3 px-2 text-center"},Ps={class:"flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},js=["onClick"],Ts=["onClick"],Ms=["onClick"],Is={key:0},Es={class:"border-t border-slate-600 font-semibold text-slate-200"},Bs={key:0,class:"text-center py-12 text-slate-500"},Ls=Ve({__name:"ProjectTable",emits:["view-project","duplicate-project"],setup(n,{emit:c}){const m=c,i=ot(),{formatIsk:l}=bt(),{getTypeIconUrl:v,onImageError:f}=dt();function C(j){return j.replace(/\s*\(BPC\)\s*$/i,"").trim()}const I=x(null),D=x("");function q(j,N){if(j.status==="completed")return;const S=j[N];D.value=S!=null?String(S):"",I.value={id:j.id,field:N}}async function J(j){if(!I.value)return;const N=I.value.field;let S;if(N==="runs"){const W=parseInt(D.value,10);S=isNaN(W)||W<1?j.runs:W}else S=$t(D.value);I.value=null,await i.updateProject(j.id,{[N]:S}),await i.fetchProjects()}function Q(){I.value=null}function k(j,N){var S,W;return((S=I.value)==null?void 0:S.id)===j&&((W=I.value)==null?void 0:W.field)===N}function E(j){return j==null?"-":l(j)}function H(j){return j==null?"text-slate-400":j>=0?"text-emerald-400":"text-red-400"}async function F(j){const N=j.status==="active"?"completed":"active";await i.updateProject(j.id,{status:N}),await i.fetchProjects()}async function P(j){await i.deleteProject(j)}async function z(j){j.status!=="completed"&&(await i.updateProject(j.id,{personalUse:!j.personalUse}),await i.fetchProjects())}function B(j){return j.rootProducts?j.rootProducts.length>1?!0:j.rootProducts.length===1&&(j.rootProducts[0].count??1)>1:!1}function w(j){return j.rootProducts?j.rootProducts.reduce((N,S)=>N+(S.count??1),0):0}function b(j){return j.rootProducts?j.rootProducts.map(N=>{const S=N.meLevel??j.meLevel,W=N.count??1;return W>1?`${C(N.typeName)} ${W}×${N.runs/W} runs (ME${S})`:`${C(N.typeName)} ×${N.runs} (ME${S})`}).join(", "):""}const u=["bpoCost","materialCost","transportCost"],T=["taxAmount","sellPrice"];return(j,N)=>(t(),s("div",ss,[e("table",os,[N[13]||(N[13]=e("thead",null,[e("tr",{class:"border-b border-slate-700 text-slate-400 text-xs uppercase tracking-wider"},[e("th",{class:"text-left py-3 px-3"},"Produit"),e("th",{class:"text-left py-3 px-2"},"Runs"),e("th",{class:"text-left py-3 px-2"},"ME"),e("th",{class:"text-left py-3 px-2"},"TE"),e("th",{class:"text-center py-3 px-2"},"Perso"),e("th",{class:"text-right py-3 px-2"},"BPC Kit"),e("th",{class:"text-right py-3 px-2"},"Matériaux"),e("th",{class:"text-right py-3 px-2"},"Transport"),e("th",{class:"text-right py-3 px-2"},"Jobs"),e("th",{class:"text-right py-3 px-2"},"Taxes"),e("th",{class:"text-right py-3 px-2"},"Vente"),e("th",{class:"text-right py-3 px-2"},"Profit"),e("th",{class:"text-right py-3 px-2"},"%"),e("th",{class:"text-center py-3 px-2"},"Status"),e("th",{class:"text-center py-3 px-2"})])],-1)),e("tbody",ns,[(t(!0),s(O,null,pe(a(i).projects,S=>(t(),s("tr",{key:S.id,class:"hover:bg-slate-800/50 group"},[e("td",rs,[e("button",{onClick:W=>m("view-project",S.id),class:"text-cyan-400 hover:text-cyan-300 font-medium text-left flex items-center gap-2"},[S.rootProducts&&B(S)?(t(),s(O,{key:0},[e("span",ls,o(w(S)),1),e("span",null,o(S.displayName),1)],64)):(t(),s(O,{key:1},[e("img",{src:a(v)(S.productTypeId,32),class:"w-6 h-6 rounded",onError:N[0]||(N[0]=(...W)=>a(f)&&a(f)(...W))},null,40,is),e("span",null,o(S.displayName),1),S.name?(t(),s("span",us,"("+o(S.productTypeName)+")",1)):h("",!0)],64))],8,as),S.rootProducts&&B(S)?(t(),s("div",cs,o(b(S)),1)):h("",!0)]),e("td",ds,[S.rootProducts&&S.rootProducts.length>1?(t(),s("span",ps,"Multi")):(t(),s(O,{key:1},[k(S.id,"runs")?de((t(),s("input",{key:0,"onUpdate:modelValue":N[1]||(N[1]=W=>D.value=W),type:"number",min:"1",class:"w-16 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-sm focus:outline-none",onKeydown:[xe(W=>J(S),["enter"]),xe(Q,["escape"])],onBlur:W=>J(S),autofocus:""},null,40,ms)),[[be,D.value]]):(t(),s("span",{key:1,onDblclick:W=>q(S,"runs"),class:G(["text-slate-300",S.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:S.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},o(S.runs),43,xs))],64))]),e("td",vs,o(S.meLevel),1),e("td",fs,o(S.teLevel),1),e("td",ys,[e("button",{onClick:W=>z(S),disabled:S.status==="completed",class:G(["text-xs px-2 py-1 rounded",S.personalUse?"bg-amber-500/20 text-amber-400":"bg-slate-600/20 text-slate-500",S.status==="completed"?"opacity-50 cursor-not-allowed":""]),title:S.status==="completed"?"Projet terminé":S.personalUse?"Usage personnel":"À vendre"},o(S.personalUse?"Perso":"Vente"),11,bs)]),(t(),s(O,null,pe(u,W=>e("td",{key:W,class:"py-3 px-2 text-right"},[k(S.id,W)?de((t(),s("input",{key:0,"onUpdate:modelValue":N[2]||(N[2]=ie=>D.value=ie),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[xe(ie=>J(S),["enter"]),xe(Q,["escape"])],onBlur:ie=>J(S),autofocus:""},null,40,hs)),[[be,D.value]]):(t(),s("span",{key:1,onDblclick:ie=>q(S,W),class:G(["font-mono text-slate-300",S.status!=="completed"?"editable":""]),title:S.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},o(E(S[W])),43,gs))])),64)),e("td",ks,o(E(S.jobsCost)),1),S.personalUse?(t(),s(O,{key:1},[N[4]||(N[4]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),N[5]||(N[5]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),N[6]||(N[6]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),N[7]||(N[7]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1))],64)):(t(),s(O,{key:0},[(t(),s(O,null,pe(T,W=>e("td",{key:W,class:"py-3 px-2 text-right"},[k(S.id,W)?de((t(),s("input",{key:0,"onUpdate:modelValue":N[3]||(N[3]=ie=>D.value=ie),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[xe(ie=>J(S),["enter"]),xe(Q,["escape"])],onBlur:ie=>J(S),autofocus:""},null,40,ws)),[[be,D.value]]):(t(),s("span",{key:1,onDblclick:ie=>q(S,W),class:G(["font-mono text-slate-300",S.status!=="completed"?"editable":""]),title:S.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},o(E(S[W])),43,Ss))])),64)),e("td",{class:G(["py-3 px-2 text-right font-mono",H(S.profit)])},o(E(S.profit)),3),e("td",{class:G(["py-3 px-2 text-right font-mono",H(S.profitPercent)])},o(S.profitPercent!=null?`${S.profitPercent}%`:"-"),3)],64)),e("td",$s,[e("button",{onClick:W=>F(S),class:G(["text-xs px-2 py-1 rounded",S.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-cyan-500/20 text-cyan-400"])},o(S.status==="completed"?"Terminé":"Actif"),11,_s)]),e("td",Cs,[e("div",Ps,[e("button",{onClick:W=>m("view-project",S.id),class:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-cyan-400",title:"Détails"},[...N[8]||(N[8]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,js),e("button",{onClick:W=>m("duplicate-project",S),class:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-cyan-400",title:"Dupliquer"},[...N[9]||(N[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,Ts),e("button",{onClick:W=>P(S.id),class:"p-1 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400",title:"Supprimer"},[...N[10]||(N[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ms)])])]))),128))]),a(i).projects.length>0?(t(),s("tfoot",Is,[e("tr",Es,[N[11]||(N[11]=e("td",{colspan:"11",class:"py-3 px-3 text-right"},"Total Profit",-1)),e("td",{class:G(["py-3 px-2 text-right font-mono",H(a(i).totalProfit)])},o(E(a(i).totalProfit)),3),N[12]||(N[12]=e("td",{colspan:"3"},null,-1))])])):h("",!0)]),a(i).projects.length===0?(t(),s("div",Bs," Aucun projet. Créez votre premier projet de construction ci-dessus. ")):h("",!0)]))}});function ut(n){if(n===null||n<=0)return"-";const c=Math.floor(n/86400),m=Math.floor(n%86400/3600),i=Math.floor(n%3600/60);return c>0?m>0?`${c}j ${m}h`:`${c}j`:m>0?`${m}h ${i}m`:`${i}m`}function Ns(n){return{estimatedProjectTime:le(()=>{var v;const m=(v=n.value)==null?void 0:v.steps;if(!m||m.length===0)return null;const i=new Map;for(const f of m){if(f.purchased||f.inStock||f.timePerRun===null)continue;const C=f.timePerRun*f.runs,I=i.get(f.depth)??0;C>I&&i.set(f.depth,C)}let l=0;for(const f of i.values())l+=f;return l>0?l:null}),formatDuration:ut}}const Rs={class:"space-y-6"},Js={class:"text-xs font-semibold uppercase tracking-wider text-slate-500 mb-2"},As={class:"space-y-1"},Ds=["onClick"],zs=["src"],Vs={class:"flex-1 min-w-0"},Us={class:"flex items-center gap-2 flex-wrap"},qs={class:"font-medium text-slate-200"},Fs={key:0,class:"text-xs text-slate-500"},Hs=["title"],Os={class:"text-emerald-400"},Ks={key:2,class:"text-xs text-amber-400 flex items-center gap-1"},Qs={key:3,class:"text-xs px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-400 border border-amber-500/20"},Ws={class:"flex items-center gap-3 mt-1 text-xs"},Xs={key:0,class:"text-red-400"},Zs={key:1,class:"text-slate-500"},Ys={key:2,class:"text-cyan-400"},Gs={key:3,class:"text-emerald-400"},eo={key:4,class:"text-slate-500 flex items-center gap-1"},to=["onClick"],so=["checked","disabled","onChange"],oo={key:0,class:"w-1 h-6 bg-cyan-500/30 rounded-full"},no=["src"],ro={class:"flex-1 min-w-0"},ao={class:"flex items-center gap-2 flex-wrap"},lo={class:"font-medium text-slate-200"},io={class:"text-xs text-slate-500"},uo={key:0,class:"inline-flex items-center gap-1"},co=["onKeydown","onBlur"],po=["onDblclick"],mo=["title"],xo={key:2,class:"text-xs text-slate-500"},vo=["value","onChange"],fo=["value","onChange"],yo={class:"text-xs text-slate-600"},bo={class:"text-xs text-slate-600"},ho=["title"],go={key:6,class:"inline-flex items-center gap-1"},ko=["onClick"],wo={key:7,class:"px-2 py-1 rounded text-xs bg-cyan-500/10 text-cyan-400 border border-cyan-500/20"},So={key:8,class:"px-2 py-1 rounded text-xs bg-indigo-500/10 text-indigo-400 border border-indigo-500/20",title:"Personnage recommandé (meilleurs skills)"},$o={key:9,class:"text-xs text-amber-400"},_o={key:10,class:"text-xs px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-400 border border-amber-500/20"},Co=["title"],Po={key:0,class:"flex items-center gap-2 mt-1 text-xs flex-wrap"},jo={key:0,class:"text-slate-600"},To={key:1,class:"text-slate-500"},Mo={key:2,class:"text-amber-400"},Io={key:1,class:"flex items-center gap-1 mt-1 text-xs text-slate-500"},Eo={key:0,class:"text-slate-600"},Bo=["checked","disabled","onChange"],Lo=["onKeydown"],No=["onClick"],Ro=["onClick"],Jo={key:3,class:"text-xs font-mono text-slate-400"},Ao=["onClick"],Do={key:5,class:"w-7"},zo={key:0,class:"flex items-center gap-3 p-3 ml-6 rounded-lg border border-dashed border-slate-600 hover:border-cyan-500/50 transition-colors"},Vo={key:0,class:"flex items-center gap-2 flex-1"},Uo=["onKeydown"],qo=["onClick"],Fo=["onClick"],Ho={class:"text-slate-400 mb-6"},Oo={class:"text-slate-200 font-medium"},Ko=Ve({__name:"StepTree",props:{steps:{},readonly:{type:Boolean}},emits:["toggle-purchased","update-step-runs","update-step-me","update-step-te","delete-step","add-child-job","split-step","merge-steps","unlink-job"],setup(n,{emit:c}){const m=n,i=c,l=x(null),v=x(0),f=x(null),C=x(1),I=x(null),D=x(null),q=x(2),J=x(!1),Q=x(null),k=x(""),E=x(null);Ge(()=>m.steps,M=>{if(I.value){const $=M.find(ce=>ce.id===I.value);$!=null&&$.splitGroupId&&w.value.add($.splitGroupId),I.value=null}},{deep:!0});const{formatIsk:H}=bt(),{getTypeIconUrl:F,onImageError:P}=dt();function z(M){return M.timePerRun===null?null:M.timePerRun*M.runs}function B(M){let $=0,ce=!1;for(const A of M){if(A.purchased||A.inStock)continue;const Se=z(A);Se!==null&&(ce=!0,$=Math.max($,Se))}return ce?$:null}const w=x(new Set);function b(M){w.value.has(M)?w.value.delete(M):w.value.add(M)}function u(M){return M.inStock?4:M.purchased?3:M.esiJobStatus==="delivered"||M.esiJobStatus==="ready"?2:M.esiJobStatus==="active"?1:0}function T(M){return M.children.length===0?99:Math.min(...M.children.map(u))}function j(M){let $=0,ce=0,A=0;for(const Se of M)Se.purchased||Se.inStock||(Se.esiJobId?Se.esiJobStatus==="active"?ce+=Se.runs:Se.esiJobStatus==="delivered"||Se.esiJobStatus==="ready"?A+=Se.runs:ce+=Se.runs:$+=Se.runs);return{toLaunch:$,inProgress:ce,completed:A}}const N=le(()=>{var Se;const M=new Map;for(const p of m.steps){const fe=`${p.blueprintTypeId}_${p.activityType}`;let he=M.get(fe);if(!he){const ee=m.steps.filter(Be=>Be.blueprintTypeId===p.blueprintTypeId&&Be.activityType===p.activityType),Ae=((Se=ee.find(Be=>Be.totalGroupRuns))==null?void 0:Se.totalGroupRuns)??ee.reduce((Be,Ie)=>Be+Ie.runs,0);he={splitGroupId:fe,productTypeName:p.productTypeName,productTypeId:p.productTypeId,activityType:p.activityType,depth:p.depth,totalExpectedRuns:Ae,children:[],actualTotalRuns:0,isValid:!1,runsToLaunch:0,runsInProgress:0,runsCompleted:0,recommendedStructureName:p.recommendedStructureName,structureBonus:p.structureBonus,facilityInfoType:null,bestStructureName:null,bestMaterialBonus:null,actualFacilityName:null},M.set(fe,he)}he.children.push(p)}for(const p of M.values()){p.children.sort((ee,Ae)=>Ae.runs-ee.runs),p.actualTotalRuns=p.children.reduce((ee,Ae)=>ee+Ae.runs,0),p.isValid=p.actualTotalRuns===p.totalExpectedRuns;const fe=j(p.children);p.runsToLaunch=fe.toLaunch,p.runsInProgress=fe.inProgress,p.runsCompleted=fe.completed;const he=p.children.find(ee=>ee.facilityInfoType!==null);he&&(p.facilityInfoType=he.facilityInfoType,p.bestStructureName=he.bestStructureName,p.bestMaterialBonus=he.bestMaterialBonus,p.actualFacilityName=he.actualFacilityName)}const $=new Map;for(const p of M.values()){if(p.children.length===0)continue;const fe=p.children[0],he=S(fe);let ee=$.get(he);ee||(ee={label:he,items:[]},$.set(he,ee)),ee.items.push(p)}const ce=Array.from($.values());for(const p of ce)p.items.sort((fe,he)=>{const ee=T(fe)-T(he);return ee!==0?ee:fe.productTypeName.localeCompare(he.productTypeName)});const A={copy:0,reaction:1,manufacturing:2};return ce.sort((p,fe)=>{var U,y,R,_e;const he=Math.min(...p.items.map(T)),ee=Math.min(...fe.items.map(T));if(he!==ee)return he-ee;const Ae=(U=p.items[0])==null?void 0:U.activityType,Be=(y=fe.items[0])==null?void 0:y.activityType,Ie=(A[Ae??""]??99)-(A[Be??""]??99);if(Ie!==0)return Ie;const pt=((R=p.items[0])==null?void 0:R.depth)??0;return(((_e=fe.items[0])==null?void 0:_e.depth)??0)-pt}),ce});function S(M){const $=M.activityType==="reaction"?"Réactions":M.activityType==="copy"?"Copies (BPC)":"Manufacturing";return`Profondeur ${M.depth} — ${$}`}function W(M){return M==="reaction"?"bg-purple-500/20 text-purple-400":M==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function ie(M){return M==="reaction"?"Réaction":M==="copy"?"BPC":"Fab"}function $e(M){return M.esiJobId!==null}function X(M){return M.map($=>{const ce=$.status==="active"?"en cours":"terminé",A=$.facilityName?` @ ${$.facilityName}`:"";return`${$.characterName}: ${$.runs} runs (${ce})${A}`}).join(`
`)}function V(M){if(M.structureBonus==null||M.bestMaterialBonus==null||M.structureBonus>=M.bestMaterialBonus)return"";const $=1-M.structureBonus/100,ce=1-M.bestMaterialBonus/100;return`+${(($/ce-1)*100).toFixed(1)}% matériaux`}function ge(M){if(M.inStockQuantity<=0||M.runs<=0)return 0;const $=M.quantity/M.runs;return Math.floor(M.inStockQuantity/$)}function we(M){if(M.inStock)return"En stock";if(M.inStockQuantity>0){const $=ge(M);return $>=M.runs?"En stock":`${$}/${M.runs} runs`}return M.purchased?"Acheté":M.esiJobStatus==="active"?"En cours":M.esiJobStatus==="delivered"||M.esiJobStatus==="ready"?"Terminé":"À lancer"}function Ce(M){return M.inStock?"bg-green-500/20 text-green-400":M.inStockQuantity>0||M.purchased?"bg-amber-500/20 text-amber-400":M.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":M.esiJobStatus==="delivered"||M.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400"}function Ue(M){m.readonly||i("toggle-purchased",M.id,!M.purchased)}function Re(M){return M.length>0&&M.every($=>$.purchased)}function ae(M){if(m.readonly)return;const $=!Re(M);for(const ce of M)ce.purchased!==$&&i("toggle-purchased",ce.id,$)}function K(M,$){m.readonly||(Q.value=M,k.value=$,J.value=!0,St(()=>{var ce;return(ce=E.value)==null?void 0:ce.focus()}))}function d(){Q.value&&i("delete-step",Q.value),J.value=!1,Q.value=null,k.value=""}function me(){J.value=!1,Q.value=null,k.value=""}function ue(M){m.readonly||(l.value=M.id,v.value=M.runs)}function Te(M){v.value>=1&&i("update-step-runs",M,v.value),l.value=null}function Fe(){l.value=null}function qe(M){m.readonly||(f.value=M,C.value=1)}function Le(M,$){C.value>=1&&(I.value=$,w.value.add(M),i("add-child-job",null,$,C.value)),f.value=null}function Je(){f.value=null}function Ee(M,$){const ce=Math.max(0,Math.min(10,parseInt($)||0));i("update-step-me",M,ce)}function Me(M,$){const ce=Math.max(0,Math.min(20,parseInt($)||0));i("update-step-te",M,ce)}function He(M){D.value=M,q.value=2}function Y(M){q.value>=2&&i("split-step",M,q.value),D.value=null}function je(){D.value=null}function Oe(M){i("merge-steps",M)}return(M,$)=>(t(),s("div",Rs,[(t(!0),s(O,null,pe(N.value,ce=>(t(),s("div",{key:ce.label},[e("h5",Js,o(ce.label),1),e("div",As,[(t(!0),s(O,null,pe(ce.items,A=>{var Se;return t(),s(O,{key:A.splitGroupId},[e("div",{class:G(["step-row flex items-center gap-3 px-4 py-3 rounded-lg border cursor-pointer",[A.isValid?"border-slate-700":"bg-red-900/20 border-red-500/50"]]),onClick:p=>b(A.splitGroupId)},[(t(),s("svg",{class:G(["w-4 h-4 text-slate-400 transition-transform",{"rotate-90":w.value.has(A.splitGroupId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...$[14]||($[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),e("img",{src:a(F)(A.productTypeId,32),class:"w-8 h-8 rounded",onError:$[0]||($[0]=(...p)=>a(P)&&a(P)(...p))},null,40,zs),e("div",Vs,[e("div",Us,[e("span",qs,o(A.productTypeName),1),A.children.length>1?(t(),s("span",Fs,"("+o(A.children.length)+" jobs)",1)):h("",!0),e("span",{class:G(["text-xs px-1.5 py-0.5 rounded",W(A.activityType)])},o(ie(A.activityType)),3),A.recommendedStructureName?(t(),s("span",{key:1,class:"text-xs text-slate-500 flex items-center gap-1",title:`Bonus: ${A.structureBonus}%`},[$[15]||($[15]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),se(" "+o(A.recommendedStructureName)+" ",1),e("span",Os,"("+o(A.structureBonus)+"%)",1)],8,Hs)):h("",!0),A.facilityInfoType==="suboptimal"?(t(),s("span",Ks,[se(" ← Meilleure : "+o(A.bestStructureName)+" ("+o((Se=A.bestMaterialBonus)==null?void 0:Se.toFixed(1))+"%) ",1),V(A)?(t(),s(O,{key:0},[se("· "+o(V(A)),1)],64)):h("",!0)])):h("",!0),A.facilityInfoType==="unconfigured"?(t(),s("span",Qs,o(A.actualFacilityName)+" (non configurée) ",1)):h("",!0)]),e("div",Ws,[e("span",{class:G(["font-mono",A.isValid?"text-slate-400":"text-red-400"])},o(A.actualTotalRuns)+" / "+o(A.totalExpectedRuns)+" runs ",3),A.isValid?h("",!0):(t(),s("span",Xs," ("+o(A.actualTotalRuns>A.totalExpectedRuns?"+":"")+o(A.actualTotalRuns-A.totalExpectedRuns)+") ",1)),A.runsToLaunch>0?(t(),s("span",Zs,o(A.runsToLaunch)+" à lancer ",1)):h("",!0),A.runsInProgress>0?(t(),s("span",Ys,o(A.runsInProgress)+" en cours ",1)):h("",!0),A.runsCompleted>0?(t(),s("span",Gs,o(A.runsCompleted)+" terminés ",1)):h("",!0),B(A.children)?(t(),s("span",eo,[$[16]||($[16]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),se(" "+o(a(ut)(B(A.children))),1)])):h("",!0)])]),A.children.length>1&&A.depth>0&&!n.readonly?(t(),s("button",{key:0,onClick:ke(p=>Oe(A.children[0].id),["stop"]),class:"px-2 py-1 text-xs bg-slate-700 hover:bg-slate-600 border border-slate-600 rounded text-slate-300",title:"Fusionner les jobs"}," Fusionner ",8,to)):h("",!0),A.depth>0?(t(),s("label",{key:1,class:G(["flex items-center gap-1.5",n.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:$[1]||($[1]=ke(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:Re(A.children),disabled:n.readonly,onChange:p=>ae(A.children),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,so),$[17]||($[17]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)):h("",!0)],10,Ds),w.value.has(A.splitGroupId)?(t(),s(O,{key:0},[(t(!0),s(O,null,pe(A.children,(p,fe)=>{var he;return t(),s("div",{key:p.id,class:"step-row flex items-center gap-3 px-4 py-3 ml-6 rounded-lg border border-slate-700"},[A.children.length>1?(t(),s("div",oo)):h("",!0),e("img",{src:a(F)(p.productTypeId,32),class:"w-8 h-8 rounded",onError:$[2]||($[2]=(...ee)=>a(P)&&a(P)(...ee))},null,40,no),e("div",ro,[e("div",ao,[e("span",lo,o(p.productTypeName),1),e("span",io,"×"+o(p.quantity.toLocaleString()),1),!$e(p)&&!n.readonly?(t(),s(O,{key:0},[l.value===p.id?(t(),s("span",uo,[$[18]||($[18]=e("span",{class:"text-xs text-slate-600"},"(",-1)),de(e("input",{"onUpdate:modelValue":$[3]||($[3]=ee=>v.value=ee),type:"number",min:"1",class:"w-16 px-1 py-0.5 bg-slate-700 border border-cyan-500 rounded text-xs text-slate-200 focus:outline-none",onKeydown:[xe(ee=>Te(p.id),["enter"]),xe(Fe,["escape"])],onBlur:ee=>Te(p.id),onFocus:$[4]||($[4]=ee=>ee.target.select()),onClick:$[5]||($[5]=ke(()=>{},["stop"])),autofocus:""},null,40,co),[[be,v.value,void 0,{number:!0}]]),$[19]||($[19]=e("span",{class:"text-xs text-slate-600"},"runs)",-1))])):(t(),s("span",{key:1,onDblclick:ke(ee=>ue(p),["stop"]),class:"text-xs text-slate-600 cursor-pointer hover:text-cyan-400",title:"Double-cliquer pour modifier"}," ("+o(p.runs)+" runs) ",41,po))],64)):(t(),s("span",{key:1,class:"text-xs text-slate-600",title:$e(p)?"Lié à ESI - non modifiable":"Projet terminé"}," ("+o(p.runs)+" runs) ",9,mo)),A.children.length>1?(t(),s("span",xo,"Split "+o(fe+1)+"/"+o(A.children.length),1)):h("",!0),!n.readonly&&!$e(p)?(t(),s(O,{key:3},[e("span",{class:"inline-flex items-center gap-0.5",onClick:$[7]||($[7]=ke(()=>{},["stop"]))},[$[20]||($[20]=e("span",{class:"text-slate-500 text-xs"},"ME",-1)),e("input",{type:"number",value:p.meLevel,min:"0",max:"10",class:"w-10 bg-slate-800 border border-slate-700 rounded px-1 py-0.5 text-xs text-center focus:border-cyan-500 focus:outline-none",onChange:ee=>Ee(p.id,ee.target.value),onClick:$[6]||($[6]=ke(()=>{},["stop"]))},null,40,vo)]),e("span",{class:"inline-flex items-center gap-0.5",onClick:$[9]||($[9]=ke(()=>{},["stop"]))},[$[21]||($[21]=e("span",{class:"text-slate-500 text-xs"},"TE",-1)),e("input",{type:"number",value:p.teLevel,min:"0",max:"20",class:"w-10 bg-slate-800 border border-slate-700 rounded px-1 py-0.5 text-xs text-center focus:border-cyan-500 focus:outline-none",onChange:ee=>Me(p.id,ee.target.value),onClick:$[8]||($[8]=ke(()=>{},["stop"]))},null,40,fo)])],64)):(t(),s(O,{key:4},[e("span",yo,"ME"+o(p.meLevel),1),e("span",bo,"TE"+o(p.teLevel),1)],64)),p.recommendedStructureName?(t(),s("span",{key:5,class:"bg-slate-800/50 border border-slate-700/50 rounded px-2 py-1 text-xs text-slate-400",title:p.recommendedStructureName},o(p.recommendedStructureName)+" — "+o(p.structureBonus)+"%",9,ho)):h("",!0),$e(p)?(t(),s("span",go,[$[22]||($[22]=e("span",{class:"text-xs px-1.5 py-0.5 rounded bg-blue-500/20 text-blue-400",title:"Lié à un job ESI"}," ESI ",-1)),!n.readonly&&p.jobMatches&&p.jobMatches.length>0?(t(),s("button",{key:0,onClick:ke(ee=>i("unlink-job",p.jobMatches[0].id),["stop"]),class:"text-xs px-1 py-0.5 rounded bg-red-500/10 text-red-400 hover:bg-red-500/20 border border-red-500/20",title:"Délier le job ESI"}," × ",8,ko)):h("",!0)])):h("",!0),p.esiJobCharacterName?(t(),s("span",wo,o(p.esiJobCharacterName),1)):p.recommendedCharacterName&&!p.purchased&&!p.inStock?(t(),s("span",So,o(p.recommendedCharacterName),1)):h("",!0),p.facilityInfoType==="suboptimal"?(t(),s("span",$o,[se(" Sous-optimal — Meilleure : "+o(p.bestStructureName)+" ("+o((he=p.bestMaterialBonus)==null?void 0:he.toFixed(2))+"%) ",1),V(p)?(t(),s(O,{key:0},[se("· "+o(V(p)),1)],64)):h("",!0)])):h("",!0),p.facilityInfoType==="unconfigured"?(t(),s("span",_o,o(p.actualFacilityName)+" (non configurée) ",1)):h("",!0),p.similarJobs&&p.similarJobs.length>0?(t(),s("span",{key:11,class:"text-xs px-1.5 py-0.5 rounded bg-amber-500/20 text-amber-400 cursor-help",title:X(p.similarJobs)},o(p.similarJobs.length)+" job"+o(p.similarJobs.length>1?"s":"")+" similaire"+o(p.similarJobs.length>1?"s":""),9,Co)):h("",!0)]),p.esiJobId||p.manualJobData?(t(),s("div",Po,[p.esiJobsCount&&p.esiJobsCount>1?(t(),s("span",jo," ("+o(p.esiJobsCount)+" jobs) ",1)):h("",!0),e("span",{class:G(["font-mono",p.esiJobsTotalRuns&&p.esiJobsTotalRuns>=p.runs?"text-emerald-400":"text-amber-400"])},o(p.esiJobsTotalRuns||p.esiJobRuns||0)+" / "+o(p.runs)+" runs ",3),p.esiJobsActiveRuns||p.esiJobsDeliveredRuns?(t(),s("span",To," ("+o(p.esiJobsDeliveredRuns||0)+" livrés, "+o(p.esiJobsActiveRuns||0)+" en cours) ",1)):h("",!0),p.manualJobData&&!p.esiJobCharacterName?(t(),s("span",Mo,"(manuel)")):h("",!0)])):h("",!0),z(p)&&!p.purchased&&!p.inStock?(t(),s("div",Io,[$[23]||($[23]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),se(" "+o(a(ut)(z(p)))+" ",1),p.runs>1?(t(),s("span",Eo,"("+o(a(ut)(p.timePerRun))+"/run)",1)):h("",!0)])):h("",!0)]),e("span",{class:G(["text-xs px-2 py-1 rounded",Ce(p)])},o(we(p)),3),p.depth>0&&!p.inStock?(t(),s("label",{key:1,class:G(["flex items-center gap-1.5",n.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:$[10]||($[10]=ke(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:p.purchased,disabled:n.readonly,onChange:ee=>Ue(p),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,Bo),$[24]||($[24]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)):h("",!0),!$e(p)&&!n.readonly&&p.depth>0?(t(),s(O,{key:2},[D.value===p.id?(t(),s("div",{key:0,class:"flex items-center gap-1",onClick:$[12]||($[12]=ke(()=>{},["stop"]))},[de(e("input",{"onUpdate:modelValue":$[11]||($[11]=ee=>q.value=ee),type:"number",min:"2",max:"20",class:"w-12 px-1 py-0.5 bg-slate-700 border border-cyan-500 rounded text-xs text-center",onKeydown:[xe(ee=>Y(p.id),["enter"]),xe(je,["escape"])],autofocus:""},null,40,Lo),[[be,q.value,void 0,{number:!0}]]),e("button",{onClick:ke(ee=>Y(p.id),["stop"]),class:"px-1.5 py-0.5 bg-cyan-600 hover:bg-cyan-500 rounded text-xs text-white"}," OK ",8,No),e("button",{onClick:ke(je,["stop"]),class:"px-1.5 py-0.5 bg-slate-700 hover:bg-slate-600 rounded text-xs text-slate-300"}," ✗ ")])):(t(),s("button",{key:1,onClick:ke(ee=>He(p.id),["stop"]),class:"px-2 py-1 rounded text-xs bg-slate-800 text-slate-400 hover:text-cyan-400 border border-slate-700",title:"Splitter ce step"}," Splitter ▾ ",8,Ro))],64)):h("",!0),p.esiJobCost?(t(),s("span",Jo,o(a(H)(p.esiJobCost)),1)):h("",!0),!$e(p)&&!n.readonly?(t(),s("button",{key:4,onClick:ke(ee=>K(p.id,p.productTypeName),["stop"]),class:"p-1.5 text-slate-500 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer cette étape"},[...$[25]||($[25]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ao)):(t(),s("div",Do))])}),128)),n.readonly?h("",!0):(t(),s("div",zo,[f.value===A.splitGroupId?(t(),s("div",Vo,[$[26]||($[26]=e("span",{class:"text-sm text-slate-400"},"Runs:",-1)),de(e("input",{"onUpdate:modelValue":$[13]||($[13]=p=>C.value=p),type:"number",min:"1",class:"w-20 px-2 py-1 bg-slate-700 border border-cyan-500 rounded text-sm text-slate-200 focus:outline-none",onKeydown:[xe(p=>{var fe;return Le(A.splitGroupId,(fe=A.children[0])==null?void 0:fe.id)},["enter"]),xe(Je,["escape"])],autofocus:""},null,40,Uo),[[be,C.value,void 0,{number:!0}]]),e("button",{onClick:p=>{var fe;return Le(A.splitGroupId,(fe=A.children[0])==null?void 0:fe.id)},class:"px-3 py-1 bg-cyan-600 hover:bg-cyan-500 rounded text-sm text-white"}," Ajouter ",8,qo),e("button",{onClick:Je,class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm text-slate-300"}," Annuler ")])):(t(),s("button",{key:1,onClick:p=>qe(A.splitGroupId),class:"flex items-center gap-2 text-slate-500 hover:text-cyan-400 transition-colors"},[...$[27]||($[27]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"text-sm"},"Ajouter un job",-1)])],8,Fo))]))],64)):h("",!0)],64)}),128))])]))),128)),(t(),et(ft,{to:"body"},[J.value?(t(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",onKeydown:[xe(d,["enter"]),xe(me,["escape"])]},[e("div",{class:"absolute inset-0 bg-black/70",onClick:me}),e("div",{class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 p-6",tabindex:"-1",ref_key:"deleteModalRef",ref:E},[$[30]||($[30]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-2"},"Supprimer l'étape",-1)),e("p",Ho,[$[28]||($[28]=se(" Voulez-vous vraiment supprimer l'étape ",-1)),e("span",Oo,'"'+o(k.value)+'"',1),$[29]||($[29]=se(" ? ",-1))]),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:me,class:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg text-slate-300 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:d,class:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white text-sm font-medium transition-colors"}," Supprimer ")])],512)],32)):h("",!0)]))]))}}),Qo={class:"space-y-2"},Wo={class:"bg-slate-800/50 border border-slate-700 rounded-lg p-3"},Xo={class:"flex items-center gap-3"},Zo=["src"],Yo={class:"flex-1 min-w-0"},Go={class:"flex items-center gap-2 flex-wrap"},en={class:"font-medium text-slate-200"},tn={class:"text-xs text-slate-500"},sn={class:"text-xs text-slate-600"},on={key:0,class:"text-xs text-slate-500 flex items-center gap-1 mt-1"},nn={class:"text-emerald-400"},rn=["checked","disabled"],an={key:0,class:"pl-6 border-l-2 border-slate-700 ml-4 space-y-2"},ln={key:0,class:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-2"},un={class:"flex items-center gap-2"},cn=["src"],dn={class:"text-sm text-slate-400"},pn={class:"text-xs text-slate-500 ml-auto"},mn=Ve({__name:"StepHierarchyTree",props:{tree:{},steps:{},readonly:{type:Boolean}},emits:["toggle-purchased"],setup(n,{emit:c}){const m=n,i=c,{getTypeIconUrl:l,onImageError:v}=dt();function f(k){return m.steps.find(E=>E.blueprintTypeId===k.blueprintTypeId&&E.activityType===k.activityType)}function C(k){return k==="reaction"?"bg-purple-500/20 text-purple-400":k==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function I(k){return k==="reaction"?"Réaction":k==="copy"?"BPC":"Fab"}function D(k){if(!k||k.inStockQuantity<=0||k.runs<=0)return 0;const E=k.quantity/k.runs;return Math.floor(k.inStockQuantity/E)}function q(k){if(!k)return"-";if(k.inStock)return"En stock";if(k.inStockQuantity>0){const E=D(k);return E>=k.runs?"En stock":`${E}/${k.runs} runs`}return k.purchased?"Acheté":k.esiJobStatus==="active"?"En cours":k.esiJobStatus==="delivered"||k.esiJobStatus==="ready"?"Terminé":"À lancer"}function J(k){return k?k.inStock?"bg-green-500/20 text-green-400":k.inStockQuantity>0||k.purchased?"bg-amber-500/20 text-amber-400":k.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":k.esiJobStatus==="delivered"||k.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400":"bg-slate-500/20 text-slate-400"}function Q(k){m.readonly||i("toggle-purchased",k.id,!k.purchased)}return(k,E)=>{var F,P,z;const H=qt("StepHierarchyTree",!0);return t(),s("div",Qo,[e("div",Wo,[e("div",Xo,[e("img",{src:a(l)(n.tree.productTypeId,32),class:"w-8 h-8 rounded",onError:E[0]||(E[0]=(...B)=>a(v)&&a(v)(...B))},null,40,Zo),e("div",Yo,[e("div",Go,[e("span",en,o(n.tree.productTypeName),1),e("span",tn,"×"+o(n.tree.quantity.toLocaleString()),1),e("span",sn,"("+o(n.tree.runs)+" runs)",1),e("span",{class:G(["text-xs px-1.5 py-0.5 rounded",C(n.tree.activityType)])},o(I(n.tree.activityType)),3)]),n.tree.structureName?(t(),s("div",on,[E[4]||(E[4]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),se(" "+o(n.tree.structureName)+" ",1),e("span",nn,"("+o(n.tree.structureBonus)+"%)",1)])):h("",!0)]),f(n.tree)?(t(),s(O,{key:0},[e("span",{class:G(["text-xs px-2 py-1 rounded",J(f(n.tree))])},o(q(f(n.tree))),3),(((F=f(n.tree))==null?void 0:F.depth)??0)>0&&!((P=f(n.tree))!=null&&P.inStock)?(t(),s("label",{key:0,class:G(["flex items-center gap-1.5",n.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"])},[e("input",{type:"checkbox",checked:(z=f(n.tree))==null?void 0:z.purchased,disabled:n.readonly,onChange:E[1]||(E[1]=B=>Q(f(n.tree))),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,rn),E[5]||(E[5]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)):h("",!0)],64)):h("",!0)])]),n.tree.materials&&n.tree.materials.length>0?(t(),s("div",an,[(t(!0),s(O,null,pe(n.tree.materials,B=>(t(),s("div",{key:B.typeId,class:"relative"},[E[6]||(E[6]=e("div",{class:"absolute -left-6 top-4 w-6 h-0.5 bg-slate-700"},null,-1)),B.isBuildable?B.blueprint?(t(),et(H,{key:1,tree:B.blueprint,steps:n.steps,readonly:n.readonly,onTogglePurchased:E[3]||(E[3]=(w,b)=>i("toggle-purchased",w,b))},null,8,["tree","steps","readonly"])):h("",!0):(t(),s("div",ln,[e("div",un,[e("img",{src:a(l)(B.typeId,32),class:"w-6 h-6 rounded",onError:E[2]||(E[2]=(...w)=>a(v)&&a(v)(...w))},null,40,cn),e("span",dn,o(B.typeName),1),e("span",pn,"×"+o(B.quantity.toLocaleString()),1)])]))]))),128))])):h("",!0)])}}}),xn={key:0,class:"mb-4 p-3 bg-amber-500/20 border border-amber-500/50 rounded-lg flex items-center gap-3"},vn={class:"text-amber-200 text-sm"},fn={class:"mb-4 flex items-center justify-between"},yn={class:"flex items-center gap-4"},bn={class:"flex items-center gap-1 bg-slate-800 rounded-lg p-1"},hn={key:1,class:"mb-4 eve-card p-4"},gn={class:"flex items-center justify-between mb-3"},kn={class:"text-sm font-semibold text-slate-300 flex items-center gap-2"},wn={class:"text-xs text-slate-500"},Sn=["disabled"],$n={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_n={key:1,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Cn={key:0,class:"text-center py-4 text-slate-500 text-sm"},Pn={key:1,class:"text-center py-4 text-slate-500 text-sm"},jn={key:2,class:"overflow-x-auto"},Tn={class:"w-full text-sm"},Mn={class:"py-2 px-2 text-slate-300"},In={class:"py-2 px-2 text-slate-200"},En={class:"py-2 px-2 text-right font-mono text-slate-300"},Bn={class:"py-2 px-2"},Ln={class:"py-2 px-2 text-xs text-slate-500"},Nn={class:"py-2 px-2 text-right font-mono text-slate-400"},Rn={class:"py-2 px-2"},Jn={key:0,class:"text-xs text-blue-400"},An={key:1,class:"text-xs text-slate-600"},Dn={class:"py-2 px-2 text-center"},zn=["onClick"],Vn=["onChange"],Un=["value"],qn={key:2,class:"text-xs text-slate-600"},Fn={key:2},Hn={key:0},On={key:1,class:"text-center py-8 text-slate-500"},Kn={key:3},Qn={key:0},Wn={key:1,class:"text-center py-8 text-slate-500"},Xn=Ve({__name:"StepsTab",props:{projectId:{}},emits:["open-bpc-modal"],setup(n,{expose:c,emit:m}){const i=n,l=m,v=ot(),f=Rt(),C=Lt(),{formatIsk:I,formatDateTime:D}=bt(),q=x("flat"),J=x(!1),Q=x(!1),k=x(null),E=x(!1),H=le(()=>C.getSyncProgress("industry-project"));Ge(H,X=>{(X==null?void 0:X.status)==="completed"&&(v.fetchProject(i.projectId),J.value=!1)});function F(){var X,V;return((V=(X=v.currentProject)==null?void 0:X.steps)==null?void 0:V.some(ge=>ge.activityType==="copy"))??!1}async function P(X,V){await v.toggleStepPurchased(i.projectId,X,V)}async function z(){Q.value=!0,k.value=null;try{const X=await v.matchJobs(i.projectId);k.value=X,await Promise.all([v.fetchProject(i.projectId),f.fetchAvailableJobs(i.projectId)])}finally{Q.value=!1}}async function B(X){await v.deleteStep(i.projectId,X)}async function w(X,V,ge){await v.addChildJob(i.projectId,X,V,ge)}async function b(X,V){await v.updateStepRuns(i.projectId,X,V)}async function u(X,V){await f.updateStepMeLevel(i.projectId,X,V)}async function T(X,V){await f.updateStepTeLevel(i.projectId,X,V)}async function j(X,V){await f.splitStep(i.projectId,X,V)}async function N(X){await f.mergeSteps(i.projectId,X)}async function S(){E.value=!E.value,E.value&&await f.fetchAvailableJobs(i.projectId)}async function W(X,V){await f.linkJob(i.projectId,X,V)}async function ie(X){await f.unlinkJob(i.projectId,X)}function $e(X){var V,ge;return((ge=(V=v.currentProject)==null?void 0:V.steps)==null?void 0:ge.filter(we=>we.blueprintTypeId===X&&we.activityType!=="copy"))??[]}return c({matchJobsLoading:Q,matchJobsWarning:k,matchJobs:z,togglePurchased:P,showAvailableJobs:E}),(X,V)=>{var ge,we,Ce,Ue,Re;return t(),s("div",null,[k.value?(t(),s("div",xn,[V[5]||(V[5]=e("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",vn,o(k.value),1),e("button",{onClick:V[0]||(V[0]=ae=>k.value=null),class:"ml-auto p-1 hover:bg-amber-500/30 rounded text-amber-400"},[...V[4]||(V[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):h("",!0),e("div",fn,[e("div",yn,[F()&&((ge=a(v).currentProject)==null?void 0:ge.status)!=="completed"?(t(),s("button",{key:0,onClick:V[1]||(V[1]=ae=>l("open-bpc-modal")),class:"flex items-center gap-2 text-sm px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/50 rounded-lg text-blue-400"},[...V[6]||(V[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),se(" BPC Kit ",-1)])])):h("",!0),((we=a(v).currentProject)==null?void 0:we.status)!=="completed"?(t(),s("button",{key:1,onClick:S,class:G(["flex items-center gap-2 text-sm px-3 py-1.5 rounded-lg border transition-colors",E.value?"bg-cyan-600/20 border-cyan-500/50 text-cyan-400":"bg-slate-800 border-slate-700 text-slate-400 hover:text-slate-200"])},[...V[7]||(V[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})],-1),se(" Jobs ESI ",-1)])],2)):h("",!0)]),e("div",bn,[e("button",{onClick:V[2]||(V[2]=ae=>q.value="flat"),class:G(["px-3 py-1.5 text-xs font-medium rounded transition-colors",q.value==="flat"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...V[8]||(V[8]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})]),se(" Liste ")],-1)])],2),e("button",{onClick:V[3]||(V[3]=ae=>q.value="tree"),class:G(["px-3 py-1.5 text-xs font-medium rounded transition-colors",q.value==="tree"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...V[9]||(V[9]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4h4v4H3V4zm0 8h4v4H3v-4zm0 8h4v4H3v-4zm8-16h10M11 12h10M11 20h10"})]),se(" Arbre ")],-1)])],2)])]),E.value?(t(),s("div",hn,[e("div",gn,[e("h4",kn,[V[10]||(V[10]=e("svg",{class:"w-4 h-4 text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})],-1)),V[11]||(V[11]=se(" Jobs ESI disponibles ",-1)),e("span",wn,"("+o(a(f).availableJobs.length)+")",1)]),e("button",{onClick:z,disabled:Q.value,class:"px-3 py-1.5 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-lg text-xs font-medium flex items-center gap-1.5 hover:bg-cyan-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[Q.value?(t(),s("svg",$n,[...V[12]||(V[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(t(),s("svg",_n,[...V[13]||(V[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])),se(" "+o(Q.value?"Sync...":"Sync Jobs"),1)],8,Sn)]),a(f).availableJobsLoading&&a(f).availableJobs.length===0?(t(),s("div",Cn," Chargement... ")):a(f).availableJobs.length===0?(t(),s("div",Pn," Aucun job ESI trouvé pour ce projet ")):(t(),s("div",jn,[e("table",Tn,[V[15]||(V[15]=e("thead",null,[e("tr",{class:"text-xs text-slate-500 uppercase tracking-wider border-b border-slate-700"},[e("th",{class:"text-left py-2 px-2"},"Personnage"),e("th",{class:"text-left py-2 px-2"},"Produit"),e("th",{class:"text-right py-2 px-2"},"Runs"),e("th",{class:"text-left py-2 px-2"},"Statut"),e("th",{class:"text-left py-2 px-2"},"Début"),e("th",{class:"text-right py-2 px-2"},"Coût"),e("th",{class:"text-left py-2 px-2"},"Lié à"),e("th",{class:"text-center py-2 px-2"},"Action")])],-1)),e("tbody",null,[(t(!0),s(O,null,pe(a(f).availableJobs,ae=>(t(),s("tr",{key:ae.esiJobId,class:"border-b border-slate-800 hover:bg-slate-800/50"},[e("td",Mn,o(ae.characterName),1),e("td",In,o(ae.productTypeName),1),e("td",En,o(ae.runs),1),e("td",Bn,[e("span",{class:G(["text-xs px-1.5 py-0.5 rounded",ae.status==="active"?"bg-cyan-500/20 text-cyan-400":"bg-emerald-500/20 text-emerald-400"])},o(ae.status==="active"?"En cours":"Terminé"),3)]),e("td",Ln,o(a(D)(ae.startDate)),1),e("td",Nn,o(a(I)(ae.cost)),1),e("td",Rn,[ae.linkedToStepId?(t(),s("span",Jn,o(ae.linkedToStepName),1)):(t(),s("span",An,"—"))]),e("td",Dn,[ae.matchId?(t(),s("button",{key:0,onClick:K=>ie(ae.matchId),class:"px-2 py-1 text-xs bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded border border-red-500/30",title:"Délier"}," Délier ",8,zn)):$e(ae.blueprintTypeId).length>0?(t(),s("select",{key:1,onChange:K=>{const d=K.target.value;d&&W(d,ae.esiJobId),K.target.value=""},class:"bg-slate-800 border border-slate-700 rounded px-2 py-1 text-xs text-slate-300 focus:outline-none focus:border-cyan-500"},[V[14]||(V[14]=e("option",{value:""},"Lier au step...",-1)),(t(!0),s(O,null,pe($e(ae.blueprintTypeId),K=>(t(),s("option",{key:K.id,value:K.id},o(K.productTypeName)+" ("+o(K.runs)+" runs) ",9,Un))),128))],40,Vn)):(t(),s("span",qn,"—"))])]))),128))])])]))])):h("",!0),q.value==="flat"?(t(),s("div",Fn,[(Ce=a(v).currentProject)!=null&&Ce.steps&&a(v).currentProject.steps.length>0?(t(),s("div",Hn,[Ye(Ko,{steps:a(v).currentProject.steps,readonly:a(v).currentProject.status==="completed",onTogglePurchased:P,onUpdateStepRuns:b,onUpdateStepMe:u,onUpdateStepTe:T,onDeleteStep:B,onAddChildJob:w,onSplitStep:j,onMergeSteps:N,onUnlinkJob:ie},null,8,["steps","readonly"])])):(t(),s("div",On," Aucune étape de production "))])):q.value==="tree"?(t(),s("div",Kn,[(Ue=a(v).currentProject)!=null&&Ue.tree&&((Re=a(v).currentProject)!=null&&Re.steps)?(t(),s("div",Qn,[Ye(mn,{tree:a(v).currentProject.tree,steps:a(v).currentProject.steps,readonly:a(v).currentProject.status==="completed",onTogglePurchased:P},null,8,["tree","steps","readonly"])])):(t(),s("div",Wn," Arbre de production non disponible "))])):h("",!0)])}}}),Zn=yt("industry-purchases",()=>{const n=x([]),c=x(null);async function m(v){try{const f=await ne(`/industry/projects/${v}/purchase-suggestions`);return n.value=f.suggestions,f}catch(f){return c.value=f instanceof Error?f.message:"Failed to fetch suggestions",null}}async function i(v,f,C){try{return await ne(`/industry/projects/${v}/steps/${f}/purchases`,{method:"POST",body:JSON.stringify(C)})}catch(I){throw c.value=ze(I,"Échec de création de l'achat"),I}}async function l(v,f,C){try{await ne(`/industry/projects/${v}/steps/${f}/purchases/${C}`,{method:"DELETE"})}catch(I){throw c.value=I instanceof Error?I.message:"Failed to delete purchase",I}}return{suggestions:n,error:c,fetchSuggestions:m,createPurchase:i,deletePurchase:l}});function Yn(n){if(!n.trim())return[];const c=n.trim().split(/\r?\n/),m=[];function i(l){const v=l.trim().replace(/[\s,]/g,"").replace(/\.(?=\d{3})/g,"");return parseInt(v,10)}for(const l of c){const v=l.trim();if(!v||v.toLowerCase().startsWith("total:"))continue;if(v.includes("	")){const I=v.split(/\t+/);if(I.length>=2){const D=I[0].trim(),q=i(I[1]);if(D&&/[A-Za-z]/.test(D)&&!isNaN(q)&&q>0){m.push({name:D,quantity:q});continue}}}const f=v.match(/^(.+?)\s+([\d\s,.]+)\s*(?:m[³3]|units?)?\s*$/i);if(f){const I=f[1].trim(),D=i(f[2]);if(I&&/[A-Za-z]/.test(I)&&!isNaN(D)&&D>0){m.push({name:I,quantity:D});continue}}const C=v.split(/\s+/);if(C.length>=2){const I=C[C.length-1],D=i(I);if(!isNaN(D)&&D>0&&/^\d/.test(I)){const q=C.slice(0,-1).join(" ").trim();if(q&&/[A-Za-z]/.test(q)){m.push({name:q,quantity:D});continue}}}/[A-Za-z]/.test(v)&&!v.includes("	")&&m.push({name:v,quantity:1})}return m}const Gn={key:0,class:"text-center py-8 text-slate-500"},er={key:1,class:"text-center py-8"},tr={class:"bg-red-900/20 border border-red-500/30 rounded-xl p-6 max-w-md mx-auto"},sr={class:"text-slate-400 text-sm mb-4"},or={key:2,class:"text-center py-8 text-slate-500"},nr={key:3,class:"space-y-4"},rr={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},ar={class:"eve-card p-4"},lr={class:"relative"},ir=["placeholder"],ur={class:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center"},cr={key:0,class:"w-4 h-4 animate-spin text-cyan-400",fill:"none",viewBox:"0 0 24 24"},dr={key:0,class:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-48 overflow-y-auto"},pr=["onMousedown"],mr={class:"truncate"},xr={key:0,class:"px-3 py-2 text-slate-400 text-sm"},vr=["disabled"],fr={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},yr={class:"eve-card p-4"},br={class:"flex items-center gap-1.5"},hr={class:"eve-card p-4"},gr={class:"flex gap-2 mt-2"},kr=["disabled"],wr={key:1,class:"p-3 bg-cyan-900/20 border border-cyan-500/30 rounded-lg flex items-center gap-3"},Sr={class:"flex-1"},$r={class:"text-sm text-cyan-300"},_r={key:0,class:"mt-1 h-1.5 bg-slate-700 rounded-full overflow-hidden"},Cr={key:2,class:"bg-amber-900/30 border border-amber-500/50 rounded-lg p-3"},Pr={class:"flex items-center gap-3"},jr={class:"text-sm"},Tr={class:"text-amber-400/70 text-xs mt-0.5"},Mr={key:3,class:"p-3 bg-red-900/20 border border-red-500/30 rounded-lg flex items-center gap-2"},Ir={class:"text-red-400 text-sm"},Er={key:4,class:"bg-amber-500/10 border border-amber-500/30 text-amber-300 rounded-lg p-3"},Br={class:"flex items-start justify-between gap-2"},Lr={class:"mt-1 text-xs text-amber-400/80 space-y-0.5"},Nr={key:5,class:"eve-card p-4"},Rr={class:"grid grid-cols-5 gap-6 text-center"},Jr={class:"font-mono text-slate-200"},Ar={class:"font-mono text-slate-200"},Dr={class:"font-mono text-slate-200"},zr={class:"font-mono text-emerald-400 text-lg font-bold"},Vr={class:"flex items-center justify-center gap-2"},Ur={key:6,class:"bg-slate-900 rounded-xl border border-slate-800"},qr={class:"w-full text-sm"},Fr={class:"divide-y divide-slate-800"},Hr={class:"py-3 px-3"},Or={class:"flex items-center gap-2"},Kr=["src"],Qr={class:"text-slate-200"},Wr={class:"py-3 px-2 text-right font-mono text-slate-300"},Xr=["title"],Zr={class:"py-3 px-2 text-center"},Yr={class:"flex items-center justify-center gap-1.5"},Gr=["onKeydown","onBlur"],ea=["onClick"],ta={class:"py-3 px-2 text-right font-mono text-slate-400"},sa={class:"py-3 px-2 text-right font-mono text-emerald-400"},oa={class:"py-3 px-2 text-right font-mono text-emerald-400"},na={class:"flex items-center gap-3"},ra={class:"flex-1 bg-cyan-900/20 border border-cyan-500/20 rounded-lg px-3 py-2 flex items-center gap-2"},aa={class:"text-cyan-300/80 text-xs"},la={key:0,class:"ml-auto text-xs text-slate-500 flex items-center gap-1"},ia={key:7,class:"text-center py-6 text-slate-500"},ua={class:"bg-slate-800/50 rounded-xl border border-slate-700 p-4"},ca={class:"flex items-center justify-between mb-3"},da={class:"text-sm font-semibold text-slate-200"},pa={key:0,class:"text-slate-500 font-normal"},ma={key:0,class:"text-center py-6 text-slate-500 text-sm"},xa={key:1,class:"overflow-x-auto"},va={class:"w-full text-sm"},fa={class:"py-2 px-3 text-slate-400 text-xs"},ya={class:"py-2 px-3 text-slate-200"},ba={class:"py-2 px-3 text-right font-mono text-slate-300"},ha={class:"py-2 px-3 text-right font-mono text-slate-400"},ga={class:"py-2 px-3 text-right font-mono text-slate-200"},ka={class:"py-2 px-3 text-slate-400 text-xs"},wa={class:"py-2 px-3 text-center"},Sa={key:0,class:"px-2 py-0.5 rounded text-xs bg-emerald-500/10 text-emerald-400"},$a=["onClick","disabled"],_a={key:0,class:"w-3 h-3 animate-spin inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ca={key:2,class:"text-xs text-slate-600"},Pa={key:0,class:"flex items-center justify-between px-3 py-2 border-t border-slate-700"},ja={class:"text-xs text-slate-500"},Ta={class:"flex items-center gap-2"},Ma=["disabled"],Ia={class:"text-xs text-slate-400"},Ea=["disabled"],Ba={key:0,class:"bg-slate-800/50 rounded-xl border border-slate-700 p-4"},La={class:"text-sm font-semibold text-slate-200 mb-3"},Na={key:0,class:"text-slate-500 font-normal"},Ra={key:0,class:"text-center py-4 text-slate-500 text-sm"},Ja={key:1,class:"overflow-x-auto"},Aa={class:"w-full text-sm"},Da={class:"py-2 px-3 text-slate-400 text-xs"},za={class:"py-2 px-3 text-slate-200"},Va={class:"py-2 px-3 text-right font-mono text-slate-300"},Ua={class:"py-2 px-3 text-right font-mono text-slate-400"},qa={class:"py-2 px-3 text-right font-mono text-slate-200"},Fa={class:"py-2 px-3 text-center"},Ha={class:"py-2 px-3 text-center"},Oa=["onClick"],Ka={key:0,class:"flex items-center justify-between px-3 py-2 border-t border-slate-700"},Qa={class:"text-xs text-slate-500"},Wa={class:"flex items-center gap-2"},Xa=["disabled"],Za={class:"text-xs text-slate-400"},Ya=["disabled"],Ga={key:1,class:"mt-4 pt-3 border-t border-slate-700 flex items-center gap-6 text-sm"},el={class:"font-mono text-slate-200"},tl={class:"font-mono text-slate-400"},kt="industry_shopping_structure",Mt=0xf460548cc5,wt="C-J6MT - 1st Taj Mahgoon",it=15,sl=Ve({__name:"ShoppingTab",props:{projectId:{}},setup(n,{expose:c}){const m=n,i=ot(),l=Ft(),v=Lt(),f=Zn(),{formatIsk:C,formatDateTime:I}=bt(),{getTypeIconUrl:D,onImageError:q}=dt(),J=x([]),Q=x(""),k=x(!1),E=x(!1),H=x(null),F=x(null),P=x(null),z=x(!1),B=x(!1),w=x(1200),b=x(!1),u=x(!1),T=x(""),j=x([]),N=x([]),S=x([]),W=x(null),ie=x(!1),$e=x(!1),X=x(new Map),V=x([]),ge=x(null),we=x(""),Ce=le(()=>v.getSyncProgress("market-structure"));Ge(Ce,_=>{(_==null?void 0:_.status)==="completed"&&A()}),Ge(()=>{var _;return(_=i.currentProject)==null?void 0:_.tree},_=>{_&&pt(_)},{immediate:!0});function Ue(){const _=localStorage.getItem(kt);if(_)try{const r=JSON.parse(_);if(r.id&&r.name)return r}catch{}return{id:Mt,name:wt}}function Re(_){_.id?localStorage.setItem(kt,JSON.stringify(_)):localStorage.removeItem(kt)}const ae=x(Ue()),K=x(""),d=x([]),me=x(!1),ue=x(!1);let Te=null;Ge(K,_=>{if(Te&&clearTimeout(Te),_.length<3){d.value=[];return}Te=setTimeout(()=>{Fe(_)},300)});async function Fe(_){me.value=!0;try{const r=await Ht(`/api/shopping-list/search-structures?q=${encodeURIComponent(_)}`,{headers:{Authorization:`Bearer ${l.token}`,"X-Requested-With":"XMLHttpRequest"}});if(r.ok){const Z=await Ot(r);d.value=Z.results,ue.value=!0}}catch(r){console.error("Structure search failed:",r)}finally{me.value=!1}}function qe(_){ae.value={id:_.id,name:_.name},Re(ae.value),K.value="",d.value=[],ue.value=!1}function Le(){ae.value={id:Mt,name:wt},Re(ae.value),K.value="",d.value=[]}function Je(){setTimeout(()=>{ue.value=!1},200)}const Ee=le(()=>{const _=new Map;for(const r of j.value){const Z=r.name.toLowerCase();_.set(Z,(_.get(Z)??0)+r.quantity)}return J.value.map(r=>{const Z=r.typeName.toLowerCase(),ye=(_.get(Z)??0)+(r.purchasedQuantity??0),ve=r.quantity+(r.extraQuantity??0),re=Math.max(0,ve-ye);let Pe="missing";ye>=ve?Pe="ok":ye>0&&(Pe="partial");let L=null;r.bestPrice!==null&&r.quantity>0?L=re/r.quantity*r.bestPrice:r.jitaWithImport!==null&&r.quantity>0&&(L=re/r.quantity*r.jitaWithImport);const oe=r.quantity>0?re/r.quantity:0,g=r.volume*re,te=r.jitaWithImport!==null?r.jitaWithImport*oe:null,Ke=r.structureTotal!==null?r.structureTotal*oe:null,Xe=r.bestPrice!==null?r.bestPrice*oe:null,Vt=r.savings!==null?r.savings*oe:null;return{...r,inStock:ye,missing:re,missingPrice:L,missingVolume:g,missingJita:te,missingStructure:Ke,missingBest:Xe,missingSavings:Vt,status:Pe}})}),Me=le(()=>{let _=0,r=0,Z=0,ye=0,ve=0;for(const re of Ee.value)re.missing>0&&(re.missingPrice!==null&&(_+=re.missingPrice),r+=re.volume*re.missing,re.missingJita!==null&&(Z+=re.missingJita),re.missingStructure!==null&&(ye+=re.missingStructure),re.missingSavings!==null&&(ve+=re.missingSavings));return{price:_,volume:r,jita:Z,structure:ye,savings:ve}}),He=le(()=>j.value.length>0),Y=le(()=>Q.value||ae.value.name||"Structure"),je=le(()=>Ee.value.filter(_=>(_.bestLocation==="jita"||_.bestLocation===null)&&_.missing>0)),Oe=le(()=>Ee.value.filter(_=>_.bestLocation==="structure"&&_.missing>0)),M=le(()=>je.value.map(_=>`${_.typeName}	${_.missing}`).join(`
`)),$=le(()=>Oe.value.map(_=>`${_.typeName}	${_.missing}`).join(`
`));function ce(_){return Math.ceil(_/1e6)*1e6}async function A(){z.value=!0,P.value=null;try{const _=ae.value.id??void 0,r=await i.fetchShoppingList(m.projectId,_,w.value);if(r){if(J.value=r.materials,Q.value=r.structureName,k.value=r.structureAccessible,E.value=r.structureFromCache,H.value=r.structureLastSync,F.value=r.totals,P.value=r.priceError,i.currentProject&&(i.currentProject.materialCost===null||i.currentProject.materialCost===0)&&r.totals.best>0){const Z=ce(r.totals.best);await i.updateProject(m.projectId,{materialCost:Z})}}else J.value=[],F.value=null,k.value=!1,P.value=i.error}catch(_){J.value=[],F.value=null,k.value=!1,P.value=_ instanceof Error?_.message:"Erreur lors du chargement"}finally{z.value=!1}}async function Se(){B.value=!0,P.value=null;try{const _=ae.value.id??void 0;await ne("/shopping-list/sync-structure-market",{method:"POST",body:JSON.stringify({structureId:_})}),await A()}catch(_){P.value=_ instanceof Error?_.message:"Sync failed"}finally{B.value=!1}}async function p(){if(!F.value||!i.currentProject)return;const _=Me.value.price>0?Me.value.price:F.value.best,r=ce(_);await i.updateProject(m.projectId,{materialCost:r})}function fe(_,r){_&&(navigator.clipboard.writeText(_),r==="jita"?(b.value=!0,setTimeout(()=>b.value=!1,2e3)):(u.value=!0,setTimeout(()=>u.value=!1,2e3)))}function he(_){if(!_)return"";const r=new Date(_),ye=new Date().getTime()-r.getTime(),ve=Math.floor(ye/6e4),re=Math.floor(ve/60);return ve<1?"il y a moins d'une minute":ve<60?`il y a ${ve} min`:re<24?`il y a ${re}h`:I(_)}function ee(){return`industry_stock_${m.projectId}`}function Ae(){const _=localStorage.getItem(ee());if(_)try{const r=JSON.parse(_);T.value=r.raw||"",j.value=r.parsed||[]}catch{}}function Be(){localStorage.setItem(ee(),JSON.stringify({raw:T.value,parsed:j.value}))}function Ie(){var Pe;if(J.value.length===0){N.value=[],S.value=[];return}const _=new Map;for(const L of j.value){const oe=L.name.toLowerCase();_.set(oe,(_.get(oe)??0)+L.quantity)}const r=new Map,Z=((Pe=i.currentProject)==null?void 0:Pe.steps)??[],ye=new Set(Z.filter(L=>L.depth===0&&(L.activityType==="manufacturing"||L.activityType==="reaction")).map(L=>L.productTypeId));for(const L of Z){if(L.activityType!=="manufacturing"&&L.activityType!=="reaction"||ye.has(L.productTypeId)||L.purchased||L.inStock)continue;const oe=L.productTypeName.toLowerCase(),g=_.get(oe)??0,te=r.get(L.productTypeId);if(te)te.needed+=L.quantity,te.runsNeeded+=L.runs,te.runsCovered=te.needed>0?Math.min(te.runsNeeded,Math.floor(te.runsNeeded*te.inStock/te.needed)):0,te.inStock>=te.needed?te.status="ok":te.inStock>0?te.status="partial":te.status="missing";else{const Ke=L.quantity>0?Math.min(L.runs,Math.floor(L.runs*g/L.quantity)):0;let Xe="missing";g>=L.quantity?Xe="ok":g>0&&(Xe="partial"),r.set(L.productTypeId,{typeId:L.productTypeId,name:L.productTypeName,inStock:g,needed:L.quantity,stepId:L.id,blueprintTypeId:L.blueprintTypeId,runsNeeded:L.runs,runsCovered:Ke,status:Xe,activityType:L.activityType})}}S.value=Array.from(r.values()).sort((L,oe)=>L.inStock>0&&oe.inStock===0?-1:L.inStock===0&&oe.inStock>0?1:L.name.localeCompare(oe.name));const ve=[];for(const L of J.value){const oe=L.typeName.toLowerCase(),g=(_.get(oe)??0)+(L.purchasedQuantity??0),te=L.quantity+(L.extraQuantity??0);if(g>0||te>0){const Ke=Math.max(0,te-g);let Xe="missing";g>=te?Xe="ok":g>0&&(Xe="partial"),ve.push({typeId:L.typeId,name:L.typeName,needed:te,inStock:g,missing:Ke,status:Xe})}}const re={missing:0,partial:1,ok:2};ve.sort((L,oe)=>re[L.status]!==re[oe.status]?re[L.status]-re[oe.status]:L.name.localeCompare(oe.name)),N.value=ve}function pt(_){X.value.clear();function r(Z){var re,Pe;const ye=`${Z.blueprintTypeId}_${Z.activityType}`,ve=[];for(const L of Z.materials)ve.push({typeId:L.typeId,typeName:L.typeName,blueprintTypeId:((re=L.blueprint)==null?void 0:re.blueprintTypeId)??0,activityType:((Pe=L.blueprint)==null?void 0:Pe.activityType)??"",quantityPerUnit:Z.quantity>0?L.quantity/Z.quantity:0,isBuildable:L.isBuildable}),L.isBuildable&&L.blueprint&&r(L.blueprint);ve.length>0&&X.value.set(ye,ve)}r(_)}async function mt(_,r,Z){var re,Pe;const ye=`${_}_${r}`,ve=X.value.get(ye);if(!(!ve||Z<=0))for(const L of ve){const oe=Math.ceil(Z*L.quantityPerUnit);if(L.isBuildable&&L.blueprintTypeId>0){const g=(Pe=(re=i.currentProject)==null?void 0:re.steps)==null?void 0:Pe.find(te=>te.blueprintTypeId===L.blueprintTypeId&&te.activityType===L.activityType);if(g&&g.depth>0){const te=Math.min(g.inStockQuantity+oe,g.quantity);te>g.inStockQuantity&&await i.toggleStepInStock(m.projectId,g.id,te)}await mt(L.blueprintTypeId,L.activityType,oe)}else{const g=j.value.findIndex(te=>te.name.toLowerCase()===L.typeName.toLowerCase());g>=0?j.value[g].quantity+=oe:j.value.push({name:L.typeName,quantity:oe})}}}async function U(){var re,Pe;if(W.value=null,!T.value.trim()){W.value="Collez votre inventaire EVE dans la zone de texte";return}const _=Yn(T.value);if(_.length===0){W.value="Aucun item détecté. Vérifiez le format (copier depuis EVE avec Ctrl+A puis Ctrl+C)",N.value=[],S.value=[];return}const r=[];for(const L of _){const oe=J.value.find(g=>g.typeName.toLowerCase()===L.name.toLowerCase());oe&&(oe.purchasedQuantity??0)>0&&r.push({name:oe.typeName,stockQty:L.quantity,purchasedQty:oe.purchasedQuantity})}V.value=r;for(const L of _){const oe=j.value.findIndex(g=>g.name.toLowerCase()===L.name.toLowerCase());oe>=0?j.value[oe].quantity=L.quantity:j.value.push(L)}if(T.value="",Be(),J.value.length===0){ie.value=!0;try{await A()}finally{ie.value=!1}}if(J.value.length===0){W.value="Impossible de charger la liste de courses. Réessayez.",N.value=[];return}const Z=((re=i.currentProject)==null?void 0:re.steps)??[],ye=new Set(Z.filter(L=>L.depth===0&&(L.activityType==="manufacturing"||L.activityType==="reaction")).map(L=>L.productTypeId));let ve=!1;for(const L of _){const oe=Z.find(g=>g.productTypeName.toLowerCase()===L.name.toLowerCase()&&(g.activityType==="manufacturing"||g.activityType==="reaction")&&!ye.has(g.productTypeId)&&g.depth>0&&!g.purchased&&!g.inStock);if(oe&&L.quantity>0){const g=(((Pe=j.value.find(Ke=>Ke.name.toLowerCase()===L.name.toLowerCase()))==null?void 0:Pe.quantity)??0)-L.quantity,te=Math.max(0,L.quantity-Math.max(0,g));if(te>0){const Ke=Math.min(oe.inStockQuantity+te,oe.quantity);Ke>oe.inStockQuantity&&await i.toggleStepInStock(m.projectId,oe.id,Ke),await mt(oe.blueprintTypeId,oe.activityType,te),ve=!0}}}ve&&(Be(),await i.fetchProject(m.projectId)),Ie()}function y(){T.value="",j.value=[],W.value=null,V.value=[],localStorage.removeItem(ee()),$e.value=!1,Ie()}function R(){$e.value=!0}function _e(_){ge.value=_.typeId,we.value=_.inStock>0?String(_.inStock):""}function Ne(_){if(ge.value===null)return;ge.value=null;const r=parseInt(we.value,10),Z=isNaN(r)||r<0?0:r,ye=_.toLowerCase(),ve=j.value.findIndex(re=>re.name.toLowerCase()===ye);Z>0?ve>=0?j.value[ve].quantity=Z:j.value.push({name:_,quantity:Z}):ve>=0&&j.value.splice(ve,1),Be(),Ie()}function xt(){ge.value=null}async function Qe(){var _;if(((_=i.currentProject)==null?void 0:_.status)!=="completed"){if(J.value.length===0){ie.value=!0;try{await A()}finally{ie.value=!1}}Ie()}}async function rt(){if(j.value.length!==0){if(J.value.length===0){ie.value=!0;try{await A()}finally{ie.value=!1}}Ie()}}async function De(){await A(),Ie()}const nt=x(!1),at=x(null),tt=x(1),st=x(1),We=le(()=>{var r;if(!((r=i.currentProject)!=null&&r.steps))return[];const _=[];for(const Z of i.currentProject.steps)if(Z.purchases&&Z.purchases.length>0)for(const ye of Z.purchases)_.push({id:ye.id,stepId:Z.id,stepName:Z.productTypeName,typeName:ye.typeName,quantity:ye.quantity,unitPrice:ye.unitPrice,totalPrice:ye.totalPrice,source:ye.source,transactionId:ye.transactionId});return _}),lt=le(()=>We.value.reduce((_,r)=>_+r.totalPrice,0)),Jt=le(()=>{const _=(tt.value-1)*it;return f.suggestions.slice(_,_+it)}),ht=le(()=>Math.ceil(f.suggestions.length/it)),At=le(()=>{const _=(st.value-1)*it;return We.value.slice(_,_+it)}),gt=le(()=>Math.ceil(We.value.length/it));function Ct(_){var r;if(!((r=i.currentProject)!=null&&r.steps))return null;for(const Z of i.currentProject.steps)if(Z.depth>0&&Z.activityType!=="copy"&&Z.productTypeId===_)return{id:Z.id,name:Z.productTypeName};for(const Z of i.currentProject.steps)if(Z.depth===0&&Z.activityType!=="copy")return{id:Z.id,name:Z.productTypeName};return null}async function Dt(_){const r=Ct(_.typeId);if(r){at.value=_.transactionId;try{await f.createPurchase(m.projectId,r.id,{transactionId:_.transactionUuid}),await Promise.all([i.fetchProject(m.projectId),f.fetchSuggestions(m.projectId)]),await A(),Ie()}finally{at.value=null}}}async function zt(_,r){await f.deletePurchase(m.projectId,_,r),await Promise.all([i.fetchProject(m.projectId),f.fetchSuggestions(m.projectId)]),await A(),Ie()}async function Pt(){nt.value=!0;try{await f.fetchSuggestions(m.projectId)}finally{nt.value=!1}}return c({shoppingTotals:F,enrichedShoppingList:Ee,missingTotals:Me,loadPersistedStock:Ae,reanalyzeStock:rt,activate:Qe,loadShoppingList:A,refreshAfterPurchaseChange:De,showClearStockModal:$e,parsedStock:j,clearStock:y,projectPurchasesTotalCost:lt,loadSuggestions:Pt}),(_,r)=>{var Z,ye,ve,re,Pe,L,oe;return t(),s("div",null,[z.value||ie.value?(t(),s("div",Gn,[...r[13]||(r[13]=[e("svg",{class:"w-6 h-6 animate-spin mx-auto mb-2 text-cyan-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),se(" Chargement... ",-1)])])):P.value&&J.value.length===0?(t(),s("div",er,[e("div",tr,[r[15]||(r[15]=e("svg",{class:"w-10 h-10 mx-auto mb-3 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),r[16]||(r[16]=e("p",{class:"text-red-400 font-medium mb-2"},"Erreur de chargement",-1)),e("p",sr,o(P.value),1),e("button",{onClick:A,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2 mx-auto"},[...r[14]||(r[14]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),se(" Réessayer ",-1)])])])])):J.value.length===0?(t(),s("div",or,[...r[17]||(r[17]=[e("svg",{class:"w-12 h-12 mx-auto mb-3 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",null,"Aucun matériau requis pour ce projet",-1)])])):(t(),s("div",nr,[((Z=a(i).currentProject)==null?void 0:Z.status)!=="completed"?(t(),s("div",rr,[e("div",ar,[r[22]||(r[22]=e("label",{class:"block text-xs text-slate-500 uppercase tracking-wider mb-2"},"Structure marché",-1)),e("div",lr,[de(e("input",{"onUpdate:modelValue":r[0]||(r[0]=g=>K.value=g),type:"text",placeholder:ae.value.name||wt,class:G(["w-full bg-slate-800 border rounded pl-3 pr-8 py-1.5 text-sm focus:outline-none",ae.value.id?"border-cyan-500/50 text-cyan-400 placeholder-cyan-400":"border-slate-600 text-slate-200 placeholder-slate-400 focus:border-cyan-500/50"]),onFocus:r[1]||(r[1]=g=>ue.value=!0),onBlur:Je},null,42,ir),[[be,K.value]]),e("div",ur,[me.value?(t(),s("svg",cr,[...r[18]||(r[18]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):ae.value.id||K.value?(t(),s("button",{key:1,onMousedown:ke(Le,["prevent"]),class:"text-slate-400 hover:text-slate-200",title:"Revenir au défaut"},[...r[19]||(r[19]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],32)):h("",!0)]),ue.value&&(d.value.length>0||K.value.length>=3&&!me.value)?(t(),s("div",dr,[(t(!0),s(O,null,pe(d.value,g=>(t(),s("button",{key:g.id,onMousedown:ke(te=>qe(g),["prevent"]),class:"w-full px-3 py-2 text-left text-sm text-slate-200 hover:bg-slate-700/50 transition-colors border-b border-slate-700/50 last:border-0"},[e("div",mr,o(g.name),1)],40,pr))),128)),K.value.length>=3&&d.value.length===0&&!me.value?(t(),s("div",xr," Aucune structure trouvée ")):h("",!0)])):h("",!0)]),e("button",{onClick:Se,disabled:B.value||((ye=Ce.value)==null?void 0:ye.status)==="started"||((ve=Ce.value)==null?void 0:ve.status)==="in_progress",class:"mt-2 w-full px-3 py-1.5 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded text-xs font-medium disabled:opacity-50 flex items-center justify-center gap-1.5 hover:bg-cyan-500/30 transition-colors"},[B.value?(t(),s("svg",fr,[...r[20]||(r[20]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):h("",!0),r[21]||(r[21]=se(" Synchroniser ",-1))],8,vr)]),e("div",yr,[r[24]||(r[24]=e("label",{class:"block text-xs text-slate-500 uppercase tracking-wider mb-2"},"Coût transport / m³",-1)),e("div",br,[de(e("input",{"onUpdate:modelValue":r[2]||(r[2]=g=>w.value=g),type:"number",min:"0",step:"100",class:"w-full px-2 py-1.5 bg-slate-800 border border-slate-600 rounded text-slate-200 text-sm font-mono focus:outline-none focus:border-cyan-500"},null,512),[[be,w.value,void 0,{number:!0}]]),r[23]||(r[23]=e("span",{class:"text-xs text-slate-500 whitespace-nowrap"},"ISK/m³",-1))]),e("button",{onClick:A,class:"mt-2 w-full px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded text-white text-xs font-medium"}," Recalculer ")]),e("div",hr,[r[25]||(r[25]=e("label",{class:"block text-xs text-slate-500 uppercase tracking-wider mb-2"},"Stock rapide",-1)),de(e("textarea",{"onUpdate:modelValue":r[3]||(r[3]=g=>T.value=g),placeholder:"Coller inventaire EVE...",class:"w-full h-12 bg-slate-800 border border-slate-700 rounded p-2 text-xs font-mono text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500 resize-none"},null,512),[[be,T.value]]),e("div",gr,[e("button",{onClick:U,disabled:ie.value,class:"flex-1 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 rounded text-white text-xs font-medium"}," Appliquer ",8,kr),j.value.length>0?(t(),s("button",{key:0,onClick:R,class:"px-3 py-1.5 text-red-400 hover:bg-red-500/10 border border-red-500/30 rounded text-xs"}," Effacer ")):h("",!0)])])])):h("",!0),Ce.value&&(Ce.value.status==="started"||Ce.value.status==="in_progress")?(t(),s("div",wr,[r[26]||(r[26]=e("svg",{class:"w-5 h-5 text-cyan-400 animate-spin flex-shrink-0",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),e("div",Sr,[e("div",$r,o(Ce.value.message||"Synchronisation du marché..."),1),Ce.value.progress!==null?(t(),s("div",_r,[e("div",{class:"h-full bg-cyan-500 transition-all duration-300",style:Et({width:`${Ce.value.progress}%`})},null,4)])):h("",!0)])])):h("",!0),k.value===!1&&!P.value&&((re=a(i).currentProject)==null?void 0:re.status)!=="completed"?(t(),s("div",Cr,[e("div",Pr,[r[28]||(r[28]=e("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",jr,[r[27]||(r[27]=e("p",{class:"text-amber-300"},"Prix de la structure non disponibles",-1)),e("p",Tr," Les données de marché pour "+o(Q.value)+` n'ont pas été synchronisées. Utilisez le bouton "Synchroniser" ci-dessus. `,1)])])])):h("",!0),W.value?(t(),s("div",Mr,[r[29]||(r[29]=e("svg",{class:"w-5 h-5 text-red-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",Ir,o(W.value),1)])):h("",!0),V.value.length>0?(t(),s("div",Er,[e("div",Br,[e("div",null,[r[30]||(r[30]=e("p",{class:"text-sm font-medium"},"Attention doublons potentiels : certains materiaux colles ont aussi des achats lies.",-1)),e("ul",Lr,[(t(!0),s(O,null,pe(V.value,g=>(t(),s("li",{key:g.name},o(g.name)+" : "+o(g.stockQty.toLocaleString())+" en stock + "+o(g.purchasedQty.toLocaleString())+" achetes ",1))),128))]),r[31]||(r[31]=e("p",{class:"mt-1 text-xs text-amber-400/60"},"Les achats lies sont peut-etre deja dans votre inventaire.",-1))]),e("button",{onClick:r[4]||(r[4]=g=>V.value=[]),class:"text-amber-400 hover:text-amber-300 flex-shrink-0 p-0.5"},[...r[32]||(r[32]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):h("",!0),F.value?(t(),s("div",Nr,[e("div",Rr,[e("div",null,[r[33]||(r[33]=e("div",{class:"text-xs text-slate-500 uppercase mb-1"},"Volume à acheter",-1)),e("div",Jr,o(Me.value.volume.toLocaleString())+" m³",1)]),e("div",null,[r[34]||(r[34]=e("div",{class:"text-xs text-slate-500 uppercase mb-1"},"Jita + Import",-1)),e("div",Ar,o(a(C)(He.value?Me.value.jita:F.value.jitaWithImport)),1)]),e("div",null,[r[35]||(r[35]=e("div",{class:"text-xs text-slate-500 uppercase mb-1"},"Structure",-1)),e("div",Dr,o(a(C)(He.value?Me.value.structure:F.value.structure)),1)]),e("div",null,[r[36]||(r[36]=e("div",{class:"text-xs text-slate-500 uppercase mb-1"},"Meilleur total",-1)),e("div",zr,o(a(C)(He.value?Me.value.price:F.value.best)),1)]),e("div",Vr,[je.value.length>0?(t(),s("button",{key:0,onClick:r[5]||(r[5]=g=>fe(M.value,"jita")),class:"px-3 py-2 bg-amber-500/20 border border-amber-500/50 text-amber-400 rounded-lg text-xs hover:bg-amber-500/30 transition-colors"},o(b.value?"✓ Copié":"Jita Multibuy"),1)):h("",!0),Oe.value.length>0?(t(),s("button",{key:1,onClick:r[6]||(r[6]=g=>fe($.value,"structure")),class:"px-3 py-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-lg text-xs hover:bg-cyan-500/30 transition-colors"},o(u.value?"✓ Copié":"Structure Multibuy"),1)):h("",!0)])])])):h("",!0),Ee.value.length>0?(t(),s("div",Ur,[e("table",qr,[r[37]||(r[37]=e("thead",null,[e("tr",{class:"border-b border-slate-700 text-slate-400 text-xs uppercase tracking-wider"},[e("th",{class:"text-left py-3 px-3"},"Matériau"),e("th",{class:"text-right py-3 px-2"},"Quantité"),e("th",{class:"text-center py-3 px-2"},"Stock"),e("th",{class:"text-right py-3 px-2"},"À acheter"),e("th",{class:"text-right py-3 px-2"},"Volume"),e("th",{class:"text-right py-3 px-2"},"Jita + Import"),e("th",{class:"text-right py-3 px-2"},"Structure"),e("th",{class:"text-right py-3 px-2"},"Meilleur"),e("th",{class:"text-right py-3 px-2"},"Économie")])],-1)),e("tbody",Fr,[(t(!0),s(O,null,pe(Ee.value,g=>(t(),s("tr",{key:g.typeId,class:"hover:bg-slate-800/50"},[e("td",Hr,[e("div",Or,[e("img",{src:a(D)(g.typeId,32),class:"w-5 h-5 rounded",onError:r[7]||(r[7]=(...te)=>a(q)&&a(q)(...te))},null,40,Kr),e("span",Qr,o(g.typeName),1)])]),e("td",Wr,[se(o(g.quantity.toLocaleString())+" ",1),g.extraQuantity>0?(t(),s("span",{key:0,class:"text-amber-400 text-xs",title:`+${g.extraQuantity.toLocaleString()} dû à des structures sous-optimales`}," (+"+o(g.extraQuantity.toLocaleString())+") ",9,Xr)):h("",!0)]),e("td",Zr,[e("div",Yr,[e("span",{class:G(["w-2 h-2 rounded-full flex-shrink-0",[g.status==="ok"?"bg-emerald-500":g.status==="partial"?"bg-amber-500":"bg-red-500"]])},null,2),ge.value===g.typeId?de((t(),s("input",{key:0,"onUpdate:modelValue":r[8]||(r[8]=te=>we.value=te),type:"number",min:"0",class:"w-16 bg-slate-700 border border-cyan-500 rounded px-1.5 py-0.5 text-xs text-right font-mono focus:outline-none",onKeydown:[xe(te=>Ne(g.typeName),["enter"]),xe(xt,["escape"])],onBlur:te=>Ne(g.typeName),autofocus:""},null,40,Gr)),[[be,we.value]]):(t(),s("span",{key:1,onClick:te=>_e(g),class:G(["font-mono text-xs cursor-pointer hover:text-cyan-400 min-w-[2rem]",g.inStock>0?"text-slate-300":"text-slate-600"]),title:"Cliquer pour modifier"},o(g.inStock>0?g.inStock.toLocaleString():"-"),11,ea))])]),e("td",{class:G(["py-3 px-2 text-right font-mono",g.missing>0?"text-slate-200":"text-emerald-400"])},o(g.missing>0?g.missing.toLocaleString():"0"),3),e("td",ta,o(g.missingVolume.toLocaleString())+" m³",1),e("td",{class:G(["py-3 px-2 text-right font-mono",g.bestLocation==="jita"&&g.missing>0?"text-emerald-400":"text-slate-300"])},o(g.missingJita!==null?a(C)(g.missingJita):"-"),3),e("td",{class:G(["py-3 px-2 text-right font-mono",g.bestLocation==="structure"&&g.missing>0?"text-emerald-400":"text-slate-300"])},o(g.missingStructure!==null?a(C)(g.missingStructure):"-"),3),e("td",sa,o(g.missingBest!==null?a(C)(g.missingBest):"-"),1),e("td",oa,o(g.missingSavings!==null?a(C)(g.missingSavings):"-"),1)]))),128))])])])):h("",!0),e("div",na,[e("div",ra,[r[39]||(r[39]=e("svg",{class:"w-4 h-4 text-cyan-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",aa," Prix = ordres de vente les plus bas (Jita Sell + import vs "+o(Y.value)+" Sell) ",1),E.value&&H.value?(t(),s("div",la,[r[38]||(r[38]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),se(" "+o(he(H.value)),1)])):h("",!0)]),F.value&&F.value.best>0&&((Pe=a(i).currentProject)==null?void 0:Pe.status)!=="completed"?(t(),s("button",{key:0,onClick:p,class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-500 rounded-lg text-white text-sm font-medium flex items-center gap-2 flex-shrink-0"},[...r[40]||(r[40]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),se(" Appliquer comme coût matériaux ",-1)])])):h("",!0)]),nt.value?(t(),s("div",ia,[...r[41]||(r[41]=[e("svg",{class:"w-5 h-5 animate-spin mx-auto mb-2 text-cyan-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),se(" Chargement des suggestions d'achats... ",-1)])])):(t(),s(O,{key:8},[e("div",ua,[e("div",ca,[e("h4",da,[r[42]||(r[42]=se(" Suggestions d'achats (wallet ESI) ",-1)),a(f).suggestions.length>0?(t(),s("span",pa,"("+o(a(f).suggestions.length)+")",1)):h("",!0)]),e("button",{onClick:Pt,class:"px-3 py-1.5 bg-slate-700 hover:bg-slate-600 border border-slate-600 rounded-lg text-slate-300 text-xs flex items-center gap-1.5"},[...r[43]||(r[43]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),se(" Actualiser ",-1)])])]),a(f).suggestions.length===0?(t(),s("div",ma," Aucune transaction wallet correspondant aux matériaux du projet. ")):(t(),s("div",xa,[e("table",va,[r[45]||(r[45]=e("thead",null,[e("tr",{class:"border-b border-slate-700 text-slate-400 text-xs uppercase"},[e("th",{class:"text-left py-2 px-3"},"Date"),e("th",{class:"text-left py-2 px-3"},"Item"),e("th",{class:"text-right py-2 px-3"},"Qté"),e("th",{class:"text-right py-2 px-3"},"Prix unit."),e("th",{class:"text-right py-2 px-3"},"Total"),e("th",{class:"text-left py-2 px-3"},"Perso"),e("th",{class:"text-center py-2 px-3"},"Action")])],-1)),e("tbody",null,[(t(!0),s(O,null,pe(Jt.value,g=>(t(),s("tr",{key:g.transactionId,class:G(["border-b border-slate-800/50 hover:bg-slate-800/30",{"opacity-50":g.alreadyLinked}])},[e("td",fa,o(a(I)(g.date)),1),e("td",ya,o(g.typeName),1),e("td",ba,o(g.quantity.toLocaleString()),1),e("td",ha,o(a(C)(g.unitPrice)),1),e("td",ga,o(a(C)(g.totalPrice)),1),e("td",ka,o(g.characterName),1),e("td",wa,[g.alreadyLinked?(t(),s("span",Sa,"Lié")):Ct(g.typeId)?(t(),s("button",{key:1,onClick:te=>Dt(g),disabled:at.value===g.transactionId,class:"px-2 py-0.5 rounded text-xs bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 hover:bg-cyan-500/20 disabled:opacity-50"},[at.value===g.transactionId?(t(),s("svg",_a,[...r[44]||(r[44]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(t(),s(O,{key:1},[se("Lier")],64))],8,$a)):(t(),s("span",Ca,"—"))])],2))),128))])]),ht.value>1?(t(),s("div",Pa,[e("span",ja,o(a(f).suggestions.length)+" résultat(s)",1),e("div",Ta,[e("button",{onClick:r[9]||(r[9]=g=>tt.value--),disabled:tt.value<=1,class:"px-2 py-1 rounded text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 disabled:opacity-40 disabled:cursor-not-allowed"}," Précédent ",8,Ma),e("span",Ia,o(tt.value)+" / "+o(ht.value),1),e("button",{onClick:r[10]||(r[10]=g=>tt.value++),disabled:tt.value>=ht.value,class:"px-2 py-1 rounded text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 disabled:opacity-40 disabled:cursor-not-allowed"}," Suivant ",8,Ea)])])):h("",!0)]))]),(L=a(i).currentProject)!=null&&L.steps?(t(),s("div",Ba,[e("h4",La,[r[46]||(r[46]=se(" Achats liés au projet ",-1)),We.value.length>0?(t(),s("span",Na,"("+o(We.value.length)+")",1)):h("",!0)]),We.value.length===0?(t(),s("div",Ra," Aucun achat lié à ce projet. ")):(t(),s("div",Ja,[e("table",Aa,[r[48]||(r[48]=e("thead",null,[e("tr",{class:"border-b border-slate-700 text-slate-400 text-xs uppercase"},[e("th",{class:"text-left py-2 px-3"},"Step"),e("th",{class:"text-left py-2 px-3"},"Item"),e("th",{class:"text-right py-2 px-3"},"Qté"),e("th",{class:"text-right py-2 px-3"},"Prix unit."),e("th",{class:"text-right py-2 px-3"},"Total"),e("th",{class:"text-center py-2 px-3"},"Source"),e("th",{class:"text-center py-2 px-3"},"Action")])],-1)),e("tbody",null,[(t(!0),s(O,null,pe(At.value,g=>(t(),s("tr",{key:g.id,class:"border-b border-slate-800/50 hover:bg-slate-800/30"},[e("td",Da,o(g.stepName),1),e("td",za,o(g.typeName),1),e("td",Va,o(g.quantity.toLocaleString()),1),e("td",Ua,o(a(C)(g.unitPrice)),1),e("td",qa,o(a(C)(g.totalPrice)),1),e("td",Fa,[e("span",{class:G(["px-2 py-0.5 rounded text-xs",g.source==="esi_wallet"?"bg-cyan-500/10 text-cyan-400":"bg-amber-500/10 text-amber-400"])},o(g.source==="esi_wallet"?"ESI":"Manuel"),3)]),e("td",Ha,[e("button",{onClick:te=>zt(g.stepId,g.id),class:"text-slate-500 hover:text-red-400",title:"Délier"},[...r[47]||(r[47]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Oa)])]))),128))])]),gt.value>1?(t(),s("div",Ka,[e("span",Qa,o(We.value.length)+" résultat(s)",1),e("div",Wa,[e("button",{onClick:r[11]||(r[11]=g=>st.value--),disabled:st.value<=1,class:"px-2 py-1 rounded text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 disabled:opacity-40 disabled:cursor-not-allowed"}," Précédent ",8,Xa),e("span",Za,o(st.value)+" / "+o(gt.value),1),e("button",{onClick:r[12]||(r[12]=g=>st.value++),disabled:st.value>=gt.value,class:"px-2 py-1 rounded text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 disabled:opacity-40 disabled:cursor-not-allowed"}," Suivant ",8,Ya)])])):h("",!0),lt.value>0?(t(),s("div",Ga,[r[50]||(r[50]=e("span",{class:"text-slate-400"},"Coût réel achats :",-1)),e("span",el,o(a(C)(lt.value)),1),(oe=a(i).currentProject)!=null&&oe.materialCost?(t(),s(O,{key:0},[r[49]||(r[49]=e("span",{class:"text-slate-400"},"Estimé :",-1)),e("span",tl,o(a(C)(a(i).currentProject.materialCost)),1),e("span",{class:G(["font-mono",lt.value<=a(i).currentProject.materialCost?"text-emerald-400":"text-red-400"])},o(lt.value<=a(i).currentProject.materialCost?"-":"+")+o(a(C)(Math.abs(lt.value-a(i).currentProject.materialCost))),3)],64)):h("",!0)])):h("",!0)]))])):h("",!0)],64))]))])}}}),ol={class:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden"},nl={class:"px-6 py-4 border-b border-slate-800 flex items-center justify-between group"},rl={class:"flex items-center gap-4"},al={key:0,class:"flex items-center gap-4"},ll=["src"],il={key:1,class:"flex -space-x-2"},ul=["src","title"],cl={key:0,class:"w-14 h-14 rounded-lg border-2 border-slate-900 bg-slate-700 flex items-center justify-center text-xs text-slate-300"},dl={class:"flex items-center gap-2"},pl={key:0,class:"text-2xl font-bold text-slate-100"},ml={key:0,class:"flex items-center gap-2 text-sm text-slate-500 flex-wrap"},xl={key:0,class:"text-slate-400"},vl={class:"text-slate-400"},fl={key:1,class:"text-cyan-400 font-mono"},yl={class:"flex items-center gap-1 text-xs text-slate-500"},bl=["value","disabled"],hl={key:1,class:"text-sm text-slate-500"},gl={class:"flex flex-wrap gap-x-3 gap-y-1"},kl={class:"text-slate-500"},wl={class:"flex items-center gap-2 mt-1"},Sl={class:"flex items-center gap-1 text-xs text-slate-500"},$l=["value","disabled"],_l={key:0,class:"text-cyan-400 font-mono text-xs"},Cl={class:"flex items-center gap-2"},Pl={class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},jl={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},Tl={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},Ml={key:0,class:"p-8 text-center text-slate-500"},Il={key:1,class:"p-6"},El={class:"eve-card p-4 mb-6"},Bl={class:"grid grid-cols-4 md:grid-cols-8 gap-4"},Ll={class:"text-sm font-mono text-slate-400"},Nl={class:"text-sm font-mono text-emerald-400"},Rl={class:"text-sm font-mono text-slate-400"},Jl={key:1,class:"text-sm font-mono text-slate-600"},Al={key:1,class:"text-sm font-mono text-slate-600"},Dl={key:1,class:"text-lg font-mono text-slate-600"},zl={class:"flex gap-2 mb-6"},Vl=["disabled","title"],Ul={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},ql={class:"px-6 py-4"},Fl={class:"px-6 py-4 border-t border-slate-700 flex justify-end gap-3"},Hl=["disabled"],Ol={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Kl={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ql={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},Wl={class:"px-6 py-4 border-b border-slate-700 flex items-center justify-between"},Xl={class:"px-6 py-4"},Zl={key:0,class:"mt-3 max-h-60 overflow-y-auto space-y-1 pr-1"},Yl={class:"text-slate-300 truncate mr-3"},Gl={class:"text-slate-500 tabular-nums shrink-0"},ei={class:"px-6 py-4 border-t border-slate-700 flex justify-end gap-3"},ti=Ve({__name:"ProjectDetail",props:{projectId:{}},emits:["close"],setup(n,{emit:c}){const m=n,i=c,l=ot(),{formatIsk:v,formatDateTime:f}=bt(),{getTypeIconUrl:C,onImageError:I}=dt(),D=le(()=>l.currentProject),{estimatedProjectTime:q}=Ns(D),J=x("steps"),Q=x(null),k=x(null),E=x(!1),H=x("");function F(){var K,d;H.value=((K=l.currentProject)==null?void 0:K.name)||((d=l.currentProject)==null?void 0:d.productTypeName)||"",E.value=!0}async function P(){var me,ue;if(!E.value)return;E.value=!1;const K=H.value.trim(),d=K&&K!==((me=l.currentProject)==null?void 0:me.productTypeName)?K:null;d!==((ue=l.currentProject)==null?void 0:ue.name)&&await l.updateProject(m.projectId,{name:d})}function z(){E.value=!1}const B=le(()=>{var me;const K=(me=l.currentProject)==null?void 0:me.steps;if(!K||K.length===0)return[];const d=new Map;for(const ue of K)if(ue.depth===0&&(ue.activityType==="manufacturing"||ue.activityType==="reaction")){const Te=d.get(ue.productTypeId);Te?(Te.runs+=ue.runs,Te.count++):d.set(ue.productTypeId,{typeId:ue.productTypeId,typeName:ue.productTypeName,runs:ue.runs,count:1})}return Array.from(d.values())}),w=le(()=>B.value.reduce((K,d)=>K+d.count,0)),b=le(()=>B.value.length>1||w.value>1),u=le(()=>{var K;return((K=k.value)==null?void 0:K.shoppingTotals)??null}),T=le(()=>{var K;return((K=k.value)==null?void 0:K.projectPurchasesTotalCost)??0}),j=x(!1),N=x(""),S=x(!1);function W(){N.value="",j.value=!0}function ie(){j.value=!1,N.value=""}async function $e(){var K;if((K=l.currentProject)!=null&&K.steps){S.value=!0;try{const d=$t(N.value)??0,me=l.currentProject.steps.filter(ue=>ue.activityType==="copy"&&ue.depth>0);for(const ue of me)if(!ue.purchased)try{await l.toggleStepPurchased(m.projectId,ue.id,!0)}catch{}await l.updateProject(m.projectId,{bpoCost:d}),ie()}finally{S.value=!1}}}const X=x(null),V=x("");function ge(K){var me,ue;if(((me=l.currentProject)==null?void 0:me.status)==="completed")return;const d=(ue=l.currentProject)==null?void 0:ue[K];V.value=d!=null?String(d):"",X.value=K}async function we(){if(!X.value||!l.currentProject)return;const K=X.value,d=$t(V.value);X.value=null,await l.updateProject(m.projectId,{[K]:d})}function Ce(){X.value=null}async function Ue(K){const me=K.target.value;me&&await l.updateProject(m.projectId,{jobsStartDate:me+"T00:00:00+00:00"})}async function Re(){if(!l.currentProject)return;const K=l.currentProject.status==="completed"?"active":"completed";await l.updateProject(m.projectId,{status:K}),K==="completed"&&(J.value="steps")}async function ae(K){var d,me;J.value=K,K==="shopping"&&(await((d=k.value)==null?void 0:d.activate()),await((me=k.value)==null?void 0:me.loadSuggestions()))}return ct(async()=>{var K,d,me;await l.fetchProject(m.projectId),(K=k.value)==null||K.loadPersistedStock(),(d=k.value)!=null&&d.parsedStock&&k.value.parsedStock.length>0&&await((me=k.value)==null?void 0:me.reanalyzeStock())}),(K,d)=>{var me,ue,Te,Fe,qe,Le,Je,Ee,Me,He;return t(),s(O,null,[e("div",ol,[e("div",nl,[e("div",rl,[e("button",{onClick:d[0]||(d[0]=Y=>i("close")),class:"p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-slate-200"},[...d[20]||(d[20]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),a(l).currentProject?(t(),s("div",al,[b.value?(t(),s("div",il,[(t(!0),s(O,null,pe(B.value.slice(0,4),(Y,je)=>(t(),s("img",{key:Y.typeId,src:a(C)(Y.typeId,64),class:"w-14 h-14 rounded-lg border-2 border-slate-900",style:Et({zIndex:10-je}),title:Y.typeName,onError:d[2]||(d[2]=(...Oe)=>a(I)&&a(I)(...Oe))},null,44,ul))),128)),B.value.length>4?(t(),s("div",cl," +"+o(B.value.length-4),1)):h("",!0)])):(t(),s("img",{key:0,src:a(C)(a(l).currentProject.productTypeId,64),class:"w-14 h-14 rounded-lg border border-slate-700",onError:d[1]||(d[1]=(...Y)=>a(I)&&a(I)(...Y))},null,40,ll)),e("div",null,[e("div",dl,[E.value?de((t(),s("input",{key:1,"onUpdate:modelValue":d[3]||(d[3]=Y=>H.value=Y),type:"text",class:"text-lg font-semibold bg-slate-800 border border-cyan-500 rounded px-2 py-0.5 focus:outline-none",onKeydown:[xe(P,["enter"]),xe(z,["escape"])],onBlur:P,autofocus:""},null,544)),[[be,H.value]]):(t(),s("h3",pl,o(a(l).currentProject.displayName),1)),!E.value&&a(l).currentProject.status!=="completed"?(t(),s("button",{key:2,onClick:F,class:"p-1 text-slate-500 hover:text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Modifier le nom"},[...d[21]||(d[21]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])])):h("",!0)]),b.value?(t(),s("div",hl,[e("div",gl,[(t(!0),s(O,null,pe(B.value,Y=>(t(),s("span",{key:Y.typeId,class:"text-slate-400"},[se(o(Y.typeName)+" ",1),e("span",kl,o(Y.count>1?`${Y.count} × ${Y.runs/Y.count} runs`:`×${Y.runs}`),1)]))),128))]),e("div",wl,[e("p",null,o(w.value)+" steps - Créé le "+o(a(f)(a(l).currentProject.createdAt)),1),d[25]||(d[25]=e("span",{class:"text-slate-600"},"·",-1)),e("label",Sl,[d[24]||(d[24]=e("span",null,"Début:",-1)),e("input",{type:"date",value:a(l).currentProject.jobsStartDate?a(l).currentProject.jobsStartDate.slice(0,10):"",disabled:a(l).currentProject.status==="completed",class:"bg-slate-800 border border-slate-700 rounded px-1.5 py-0.5 text-xs text-slate-300 focus:border-cyan-500 focus:outline-none disabled:opacity-50",onChange:Ue},null,40,$l)]),a(q)?(t(),s("span",_l,o(a(ut)(a(q))),1)):h("",!0)])])):(t(),s("div",ml,[e("span",{class:G(["text-xs px-2 py-0.5 rounded",a(l).currentProject.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-cyan-500/20 text-cyan-400"])},o(a(l).currentProject.status==="completed"?"Terminé":"Actif"),3),a(l).currentProject.name?(t(),s("span",xl,o(a(l).currentProject.productTypeName),1)):h("",!0),e("span",vl,o(a(l).currentProject.runs)+" run"+o(a(l).currentProject.runs>1?"s":"")+" · ME "+o(a(l).currentProject.meLevel)+" · TE "+o(a(l).currentProject.teLevel),1),a(q)?(t(),s("span",fl,o(a(ut)(a(q))),1)):h("",!0),d[23]||(d[23]=e("span",{class:"text-slate-600"},"·",-1)),e("label",yl,[d[22]||(d[22]=e("span",null,"Début:",-1)),e("input",{type:"date",value:a(l).currentProject.jobsStartDate?a(l).currentProject.jobsStartDate.slice(0,10):"",disabled:a(l).currentProject.status==="completed",class:"bg-slate-800 border border-slate-700 rounded px-1.5 py-0.5 text-xs text-slate-300 focus:border-cyan-500 focus:outline-none disabled:opacity-50",onChange:Ue},null,40,bl)])]))])])):h("",!0)]),e("div",Cl,[e("button",{onClick:Re,class:G(["px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors",((me=a(l).currentProject)==null?void 0:me.status)==="completed"?"bg-amber-500/20 border border-amber-500/50 text-amber-400 hover:bg-amber-500/30":"bg-emerald-500/20 border border-emerald-500/50 text-emerald-400 hover:bg-emerald-500/30"])},[(t(),s("svg",Pl,[((ue=a(l).currentProject)==null?void 0:ue.status)==="completed"?(t(),s("path",jl)):(t(),s("path",Tl))])),se(" "+o(((Te=a(l).currentProject)==null?void 0:Te.status)==="completed"?"Réactiver":"Terminé"),1)],2)])]),a(l).isLoading&&!a(l).currentProject?(t(),s("div",Ml,[...d[26]||(d[26]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),se(" Chargement... ",-1)])])):a(l).currentProject?(t(),s("div",Il,[e("div",El,[e("div",Bl,[e("div",null,[d[27]||(d[27]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"BPC Kit",-1)),X.value==="bpoCost"?de((t(),s("input",{key:0,"onUpdate:modelValue":d[4]||(d[4]=Y=>V.value=Y),type:"text",placeholder:"ex: 50M",class:"w-full text-sm font-mono bg-slate-800 border border-cyan-500 rounded px-1.5 py-0.5 focus:outline-none",onKeydown:[xe(we,["enter"]),xe(Ce,["escape"])],onBlur:we,autofocus:""},null,544)),[[be,V.value]]):(t(),s("p",{key:1,class:"text-sm font-mono text-slate-200 editable",onClick:d[5]||(d[5]=Y=>ge("bpoCost")),title:"Cliquer pour modifier"},o(a(l).currentProject.bpoCost!==null?a(v)(a(l).currentProject.bpoCost):"-"),1))]),e("div",null,[d[28]||(d[28]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Mat. estimé",-1)),e("p",Ll,o((Fe=u.value)!=null&&Fe.best?a(v)(u.value.best):"-"),1)]),e("div",null,[d[29]||(d[29]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Mat. réel",-1)),e("p",Nl,o(T.value>0?a(v)(T.value):"-"),1)]),e("div",null,[d[30]||(d[30]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Transport",-1)),X.value==="transportCost"?de((t(),s("input",{key:0,"onUpdate:modelValue":d[6]||(d[6]=Y=>V.value=Y),type:"text",placeholder:"ex: 50M",class:"w-full text-sm font-mono bg-slate-800 border border-cyan-500 rounded px-1.5 py-0.5 focus:outline-none",onKeydown:[xe(we,["enter"]),xe(Ce,["escape"])],onBlur:we,autofocus:""},null,544)),[[be,V.value]]):(t(),s("p",{key:1,class:"text-sm font-mono text-slate-200 editable",onClick:d[7]||(d[7]=Y=>ge("transportCost")),title:"Cliquer pour modifier"},o(a(l).currentProject.transportCost!==null?a(v)(a(l).currentProject.transportCost):"-"),1))]),e("div",null,[d[31]||(d[31]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Jobs ESI",-1)),e("p",Rl,o(a(v)(a(l).currentProject.jobsCost)),1)]),e("div",null,[d[32]||(d[32]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Taxes",-1)),a(l).currentProject.personalUse?(t(),s("p",Jl,"—")):(t(),s(O,{key:0},[X.value==="taxAmount"?de((t(),s("input",{key:0,"onUpdate:modelValue":d[8]||(d[8]=Y=>V.value=Y),type:"text",placeholder:"ex: 50M",class:"w-full text-sm font-mono bg-slate-800 border border-cyan-500 rounded px-1.5 py-0.5 focus:outline-none",onKeydown:[xe(we,["enter"]),xe(Ce,["escape"])],onBlur:we,autofocus:""},null,544)),[[be,V.value]]):(t(),s("p",{key:1,class:"text-sm font-mono text-slate-200 editable",onClick:d[9]||(d[9]=Y=>ge("taxAmount")),title:"Cliquer pour modifier"},o(a(l).currentProject.taxAmount!==null?a(v)(a(l).currentProject.taxAmount):"-"),1))],64))]),e("div",null,[d[33]||(d[33]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Vente",-1)),a(l).currentProject.personalUse?(t(),s("p",Al,"—")):(t(),s(O,{key:0},[X.value==="sellPrice"?de((t(),s("input",{key:0,"onUpdate:modelValue":d[10]||(d[10]=Y=>V.value=Y),type:"text",placeholder:"ex: 1.5B",class:"w-full text-sm font-mono bg-slate-800 border border-cyan-500 rounded px-1.5 py-0.5 focus:outline-none",onKeydown:[xe(we,["enter"]),xe(Ce,["escape"])],onBlur:we,autofocus:""},null,544)),[[be,V.value]]):(t(),s("p",{key:1,class:"text-sm font-mono text-slate-200 editable",onClick:d[11]||(d[11]=Y=>ge("sellPrice")),title:"Cliquer pour modifier"},o(a(l).currentProject.sellPrice!==null?a(v)(a(l).currentProject.sellPrice):"-"),1))],64))]),e("div",null,[d[34]||(d[34]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-1"},"Profit",-1)),a(l).currentProject.personalUse?(t(),s("p",Dl,"—")):(t(),s(O,{key:0},[e("p",{class:G(["text-lg font-bold font-mono",a(l).currentProject.profit!==null?a(l).currentProject.profit>=0?"text-emerald-400":"text-red-400":"text-slate-400"])},o(a(l).currentProject.profit!==null?a(v)(a(l).currentProject.profit):"-"),3),a(l).currentProject.profitPercent!==null?(t(),s("p",{key:0,class:G(["text-xs font-mono",a(l).currentProject.profitPercent>=0?"text-emerald-400":"text-red-400"])},o(a(l).currentProject.profitPercent)+"% ",3)):h("",!0)],64))])])]),e("div",zl,[e("button",{onClick:d[12]||(d[12]=Y=>ae("steps")),class:G(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",J.value==="steps"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Étapes ",2),e("button",{onClick:d[13]||(d[13]=Y=>{var je;return((je=a(l).currentProject)==null?void 0:je.status)!=="completed"&&ae("shopping")}),disabled:((qe=a(l).currentProject)==null?void 0:qe.status)==="completed",class:G(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",((Le=a(l).currentProject)==null?void 0:Le.status)==="completed"?"bg-slate-800 text-slate-600 cursor-not-allowed":J.value==="shopping"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"]),title:((Je=a(l).currentProject)==null?void 0:Je.status)==="completed"?"Non disponible pour les projets terminés":""}," Approvisionnement ",10,Vl)]),de(Ye(Xn,{ref_key:"stepsTabRef",ref:Q,"project-id":n.projectId,onOpenBpcModal:W},null,8,["project-id"]),[[jt,J.value==="steps"]]),de(Ye(sl,{ref_key:"shoppingTabRef",ref:k,"project-id":n.projectId},null,8,["project-id"]),[[jt,J.value==="shopping"]])])):h("",!0)]),(t(),et(ft,{to:"body"},[j.value?(t(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",onKeydown:xe(ie,["escape"])},[e("div",{class:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:ie}),e("div",Ul,[e("div",{class:"px-6 py-4 border-b border-slate-700 flex items-center justify-between"},[d[36]||(d[36]=e("h3",{class:"text-lg font-semibold text-slate-100 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),se(" BPC Kit ")],-1)),e("button",{onClick:ie,class:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-slate-200"},[...d[35]||(d[35]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ql,[d[39]||(d[39]=e("p",{class:"text-sm text-slate-400 mb-4"}," Cette action va marquer toutes les étapes BPC comme achetées et définir le coût du kit. ",-1)),e("div",null,[d[37]||(d[37]=e("label",{class:"block text-sm font-medium text-slate-300 mb-2"}," Prix du kit BPC ",-1)),de(e("input",{"onUpdate:modelValue":d[14]||(d[14]=Y=>N.value=Y),type:"text",placeholder:"ex: 50M, 1.5B, 500000 (vide = 0)",class:"w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 font-mono",onKeydown:[xe($e,["enter"]),xe(ie,["escape"])],autofocus:""},null,544),[[be,N.value]]),d[38]||(d[38]=e("p",{class:"text-xs text-slate-500 mt-2"}," Formats acceptés : 50M, 1.5B, 500K, 1000000 ",-1))])]),e("div",Fl,[e("button",{onClick:ie,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:$e,disabled:S.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-blue-800 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[S.value?(t(),s("svg",Ol,[...d[40]||(d[40]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(t(),s("svg",Kl,[...d[41]||(d[41]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),d[42]||(d[42]=se(" Confirmer ",-1))],8,Hl)])])],32)):h("",!0)])),(t(),et(ft,{to:"body"},[(Ee=k.value)!=null&&Ee.showClearStockModal?(t(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",onKeydown:d[19]||(d[19]=xe(Y=>k.value.showClearStockModal=!1,["escape"]))},[e("div",{class:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:d[15]||(d[15]=Y=>k.value.showClearStockModal=!1)}),e("div",Ql,[e("div",Wl,[d[44]||(d[44]=e("h3",{class:"text-lg font-semibold text-slate-100 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),se(" Effacer le stock ? ")],-1)),e("button",{onClick:d[16]||(d[16]=Y=>k.value.showClearStockModal=!1),class:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-slate-200"},[...d[43]||(d[43]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Xl,[d[45]||(d[45]=e("p",{class:"text-sm text-slate-400"}," Cette action supprimera toutes les données de stock enregistrées pour ce projet. ",-1)),(He=(Me=k.value)==null?void 0:Me.parsedStock)!=null&&He.length?(t(),s("ul",Zl,[(t(!0),s(O,null,pe(k.value.parsedStock,Y=>(t(),s("li",{key:Y.name,class:"flex justify-between text-sm px-2 py-1 rounded bg-slate-800/50"},[e("span",Yl,o(Y.name),1),e("span",Gl,"× "+o(Y.quantity.toLocaleString()),1)]))),128))])):h("",!0)]),e("div",ei,[e("button",{onClick:d[17]||(d[17]=Y=>k.value.showClearStockModal=!1),class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:d[18]||(d[18]=Y=>{var je;return(je=k.value)==null?void 0:je.clearStock()}),class:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[...d[46]||(d[46]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),se(" Effacer ",-1)])])])])],32)):h("",!0)]))],64)}}}),si={class:"bg-slate-900 rounded-xl border border-slate-800"},oi={class:"p-6 space-y-6"},ni={key:0,class:"text-center py-8 text-slate-500"},ri={class:"grid grid-cols-2 md:grid-cols-4 gap-2"},ai=["checked","onChange"],li={class:"text-sm text-slate-200"},ii={class:"relative mb-3"},ui={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ci=["onMousedown"],di=["src"],pi={class:"text-sm text-slate-200"},mi={key:0,class:"text-xs text-slate-500 ml-auto"},xi={key:0,class:"flex flex-wrap gap-2 max-h-64 overflow-y-auto"},vi=["src"],fi={class:"text-sm text-slate-200"},yi=["onClick"],bi={key:1,class:"text-sm text-slate-500"},hi=Ve({__name:"BlacklistConfig",setup(n){const c=ot(),{getTypeIconUrl:m,onImageError:i}=dt(),l=x(""),v=x([]),f=x(!1);let C=null;ct(()=>{c.fetchBlacklist()});const I=le(()=>{if(!c.blacklist)return new Set;const E=new Set;for(const H of c.blacklist.categories)if(H.blacklisted)for(const F of H.groupIds)E.add(F);return E}),D=le(()=>c.blacklist?new Set(c.blacklist.items.map(E=>E.typeId)):new Set);async function q(E){if(!c.blacklist)return;const H=c.blacklist.categories.find(z=>z.key===E);if(!H)return;const F=[...I.value];let P;H.blacklisted?P=F.filter(z=>!H.groupIds.includes(z)):P=[...new Set([...F,...H.groupIds])],await c.updateBlacklist(P,[...D.value])}async function J(E){const H=[...D.value].filter(F=>F!==E);await c.updateBlacklist([...I.value],H)}async function Q(E){if(D.value.has(E))return;const H=[...D.value,E];await c.updateBlacklist([...I.value],H),l.value="",v.value=[],f.value=!1}Ge(l,E=>{if(C&&clearTimeout(C),E.length<2){v.value=[],f.value=!1;return}C=setTimeout(async()=>{v.value=await c.searchBlacklistItems(E),f.value=v.value.length>0},300)});function k(){window.setTimeout(()=>{f.value=!1},200)}return(E,H)=>(t(),s("div",si,[H[7]||(H[7]=e("div",{class:"px-6 py-4 border-b border-slate-800"},[e("h3",{class:"text-lg font-semibold text-slate-100 mb-1"},"Construction Blacklist"),e("p",{class:"text-sm text-slate-400"}," Sélectionnez les catégories et items que vous ne fabriquez pas. Ils seront traités comme des achats dans tous vos projets. ")],-1)),e("div",oi,[a(c).blacklist?(t(),s(O,{key:1},[e("div",null,[H[4]||(H[4]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Catégories",-1)),e("div",ri,[(t(!0),s(O,null,pe(a(c).blacklist.categories,F=>(t(),s("label",{key:F.key,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700 cursor-pointer hover:bg-slate-800"},[e("input",{type:"checkbox",checked:F.blacklisted,onChange:P=>q(F.key),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500 focus:ring-offset-slate-900"},null,40,ai),e("span",li,o(F.label),1)]))),128))])]),e("div",null,[H[6]||(H[6]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Items individuels",-1)),e("div",ii,[de(e("input",{"onUpdate:modelValue":H[0]||(H[0]=F=>l.value=F),type:"text",placeholder:"Rechercher un item à blacklister...",class:"w-full px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500",onFocus:H[1]||(H[1]=F=>f.value=v.value.length>0),onBlur:k},null,544),[[be,l.value]]),f.value?(t(),s("div",ui,[(t(!0),s(O,null,pe(v.value,F=>(t(),s("button",{key:F.typeId,onMousedown:ke(P=>Q(F.typeId),["prevent"]),class:G(["w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-700 text-left",D.value.has(F.typeId)?"opacity-50":""])},[e("img",{src:a(m)(F.typeId,32),class:"w-6 h-6 rounded",onError:H[2]||(H[2]=(...P)=>a(i)&&a(i)(...P))},null,40,di),e("span",pi,o(F.typeName),1),D.value.has(F.typeId)?(t(),s("span",mi," déjà ajouté ")):h("",!0)],42,ci))),128))])):h("",!0)]),a(c).blacklist.items.length>0?(t(),s("div",xi,[(t(!0),s(O,null,pe(a(c).blacklist.items,F=>(t(),s("div",{key:F.typeId,class:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800/50 border border-slate-700"},[e("img",{src:a(m)(F.typeId,32),class:"w-5 h-5 rounded",onError:H[3]||(H[3]=(...P)=>a(i)&&a(i)(...P))},null,40,vi),e("span",fi,o(F.typeName),1),e("button",{onClick:P=>J(F.typeId),class:"p-0.5 hover:bg-slate-700 rounded text-slate-500 hover:text-red-400"},[...H[5]||(H[5]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,yi)]))),128))])):(t(),s("p",bi," Aucun item individuel blacklisté. "))])],64)):(t(),s("div",ni," Chargement... "))])]))}}),gi={class:"mb-6 p-4 bg-slate-800/50 rounded-lg border border-slate-700"},ki={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wi={class:"relative"},Si={key:0,class:"flex items-center gap-2 bg-slate-700 rounded-lg px-3 py-2"},$i={class:"text-sm text-slate-200 flex-1"},_i={key:1},Ci={key:0,class:"absolute z-20 mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-48 overflow-y-auto"},Pi=["onMousedown"],ji={class:"text-slate-200"},Ti={class:"text-xs flex items-center gap-2"},Mi={class:"text-slate-500"},Ii={class:"relative"},Ei={key:0,class:"flex items-center gap-2 bg-slate-700 rounded-lg px-3 py-2"},Bi={class:"text-sm text-slate-200 flex-1"},Li={key:1},Ni={key:0,class:"absolute z-20 mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-48 overflow-y-auto"},Ri=["onMousedown"],Ji={class:"text-slate-200"},Ai={class:"text-xs flex items-center gap-2"},Di={class:"text-slate-500"},zi=Ve({__name:"FavoriteSystemsConfig",setup(n){const c=_t(),m=x(""),i=x([]),l=x(!1);let v=null;const f=x(""),C=x([]),I=x(!1);let D=null;ct(()=>{c.fetchUserSettings()});function q(P){return P>=.5?"text-emerald-400":P>0?"text-amber-400":"text-red-400"}async function J(P,z){if(P.length<2){z==="mfg"?i.value=[]:C.value=[];return}try{const B=await ne(`/sde/solar-systems?q=${encodeURIComponent(P)}`);z==="mfg"?(i.value=B,l.value=!0):(C.value=B,I.value=!0)}catch{}}Ge(m,P=>{if(v&&clearTimeout(v),P.length<2){i.value=[];return}v=setTimeout(()=>J(P,"mfg"),300)}),Ge(f,P=>{if(D&&clearTimeout(D),P.length<2){C.value=[];return}D=setTimeout(()=>J(P,"rxn"),300)});async function Q(P){m.value="",i.value=[],l.value=!1,await c.updateUserSettings({favoriteManufacturingSystemId:P.solarSystemId})}async function k(P){f.value="",C.value=[],I.value=!1,await c.updateUserSettings({favoriteReactionSystemId:P.solarSystemId})}async function E(){await c.updateUserSettings({favoriteManufacturingSystemId:0})}async function H(){await c.updateUserSettings({favoriteReactionSystemId:0})}function F(P){setTimeout(()=>{P==="mfg"?l.value=!1:I.value=!1},200)}return(P,z)=>{var B,w;return t(),s("div",gi,[z[8]||(z[8]=e("h4",{class:"text-sm font-medium text-slate-300 mb-3"},"Systèmes favoris",-1)),z[9]||(z[9]=e("p",{class:"text-xs text-slate-500 mb-4"}," La meilleure structure dans le système favori sera automatiquement suggérée pour chaque step. ",-1)),e("div",ki,[e("div",null,[z[5]||(z[5]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Système favori manufacture",-1)),e("div",wi,[(B=a(c).userSettings)!=null&&B.favoriteManufacturingSystemId?(t(),s("div",Si,[e("span",$i,o(a(c).userSettings.favoriteManufacturingSystemName||`#${a(c).userSettings.favoriteManufacturingSystemId}`),1),e("button",{onClick:E,class:"text-slate-400 hover:text-red-400"},[...z[4]||(z[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):(t(),s("div",_i,[de(e("input",{"onUpdate:modelValue":z[0]||(z[0]=b=>m.value=b),type:"text",placeholder:"Rechercher un système...",class:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-cyan-500 placeholder-slate-500",onBlur:z[1]||(z[1]=b=>F("mfg"))},null,544),[[be,m.value]]),l.value&&i.value.length>0?(t(),s("div",Ci,[(t(!0),s(O,null,pe(i.value,b=>(t(),s("button",{key:b.solarSystemId,onMousedown:ke(u=>Q(b),["prevent"]),class:"w-full px-3 py-2 text-left hover:bg-slate-700 text-sm flex items-center justify-between"},[e("span",ji,o(b.solarSystemName),1),e("span",Ti,[e("span",{class:G(q(b.security))},o(b.security.toFixed(1)),3),e("span",Mi,o(b.regionName),1)])],40,Pi))),128))])):h("",!0)]))])]),e("div",null,[z[7]||(z[7]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Système favori réactions",-1)),e("div",Ii,[(w=a(c).userSettings)!=null&&w.favoriteReactionSystemId?(t(),s("div",Ei,[e("span",Bi,o(a(c).userSettings.favoriteReactionSystemName||`#${a(c).userSettings.favoriteReactionSystemId}`),1),e("button",{onClick:H,class:"text-slate-400 hover:text-red-400"},[...z[6]||(z[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):(t(),s("div",Li,[de(e("input",{"onUpdate:modelValue":z[2]||(z[2]=b=>f.value=b),type:"text",placeholder:"Rechercher un système...",class:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-cyan-500 placeholder-slate-500",onBlur:z[3]||(z[3]=b=>F("rxn"))},null,544),[[be,f.value]]),I.value&&C.value.length>0?(t(),s("div",Ni,[(t(!0),s(O,null,pe(C.value,b=>(t(),s("button",{key:b.solarSystemId,onMousedown:ke(u=>k(b),["prevent"]),class:"w-full px-3 py-2 text-left hover:bg-slate-700 text-sm flex items-center justify-between"},[e("span",Ji,o(b.solarSystemName),1),e("span",Ai,[e("span",{class:G(q(b.security))},o(b.security.toFixed(1)),3),e("span",Di,o(b.regionName),1)])],40,Ri))),128))])):h("",!0)]))])])])])}}}),Vi={class:"bg-slate-900 rounded-xl border border-slate-800 p-6 space-y-4"},Ui={class:"flex items-center justify-between"},qi={key:0,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700"},Fi={class:"text-sm font-medium text-slate-300 mb-4"},Hi={class:"space-y-4"},Oi={key:0},Ki={key:0,class:"text-xs text-slate-500"},Qi={key:1,class:"text-xs text-slate-500 bg-slate-900/50 rounded-lg p-2 border border-slate-700"},Wi=["value"],Xi={class:"mt-3 relative"},Zi={key:0,class:"absolute right-3 top-7"},Yi={key:1,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Gi=["onMousedown"],eu={class:"text-sm text-slate-200"},tu={key:0,class:"text-slate-400"},su={class:"text-xs text-slate-500"},ou={key:2,class:"mt-1 text-xs text-amber-400"},nu={key:1,class:"bg-cyan-900/20 border border-cyan-700/50 rounded-lg p-3"},ru={class:"flex gap-3"},au=["value"],lu={class:"text-sm text-slate-300"},iu={class:"block text-xs text-slate-400 mb-2"},uu={class:"relative"},cu=["placeholder","disabled"],du={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto"},pu=["onMousedown"],mu={class:"flex items-center justify-between"},xu={class:"text-sm text-slate-200"},vu={class:"text-xs ml-2"},fu={class:"text-emerald-400"},yu={class:"text-amber-400 ml-1"},bu={key:1,class:"text-emerald-400"},hu={class:"text-slate-500 ml-1"},gu={class:"text-xs text-slate-500 mt-0.5"},ku={key:1,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg p-3 text-sm text-slate-400"},wu={key:0,class:"mt-3 space-y-1"},Su={class:"flex items-center justify-between"},$u={class:"flex items-center gap-2 flex-1 min-w-0"},_u={class:"text-sm text-slate-300 truncate"},Cu={class:"text-xs shrink-0"},Pu={class:"text-emerald-400"},ju={class:"text-amber-400 ml-1"},Tu={key:1,class:"text-emerald-400"},Mu={class:"text-slate-500 ml-1"},Iu=["onClick"],Eu={class:"text-xs text-slate-500 mt-0.5"},Bu={key:1,class:"mt-2 text-xs text-slate-500"},Lu={class:"bg-slate-900/50 rounded-lg p-3 border border-slate-700"},Nu={class:"space-y-2"},Ru={key:0,class:"flex flex-wrap gap-4"},Ju={class:"text-sm text-emerald-400 ml-1"},Au={class:"text-sm text-amber-400 ml-1"},Du={key:1,class:"flex flex-wrap gap-4"},zu={class:"text-sm text-emerald-400 ml-1"},Vu={class:"text-sm text-amber-400 ml-1"},Uu={key:2,class:"text-slate-500 text-sm"},qu={class:"flex gap-3 pt-2"},Fu=["disabled"],Hu={key:1,class:"space-y-2"},Ou={class:"flex items-start justify-between"},Ku={class:"flex-1"},Qu={class:"flex items-center gap-2"},Wu={class:"text-sm font-medium text-slate-200"},Xu={key:0,class:"px-1.5 py-0.5 bg-cyan-900/50 text-cyan-400 text-xs rounded border border-cyan-700/50"},Zu={class:"text-xs text-slate-500 mt-1"},Yu={class:"flex flex-wrap gap-x-4 gap-y-1 mt-2"},Gu={class:"text-sm text-emerald-400 ml-1"},ec={class:"text-sm text-amber-400 ml-1"},tc={class:"text-sm text-emerald-400 ml-1"},sc={class:"text-sm text-amber-400 ml-1"},oc={key:0,class:"mt-2 flex flex-wrap gap-1"},nc={class:"flex items-center gap-2"},rc=["onClick"],ac=["onClick"],lc={key:2,class:"text-center py-8 text-slate-500"},ic={class:"text-slate-400 mb-6"},uc={class:"text-slate-200 font-medium"},It=3,cc=Ve({__name:"StructureConfig",setup(n){const c=ot(),m=x(!1),i=x(null),l=x(""),v=x(null),f=x("nullsec"),C=x("raitaru"),I=x([]),D=x(""),q=x(!1),J=x(""),Q=x([]),k=x(!1),E=x(!1),H=x(!1);ct(async()=>{c.fetchStructures(),await c.fetchCorporationStructures(),H.value=!0});const F=x(null),P=x(!1);function z(){if(F.value){const U=F.value;l.value=U.locationName,v.value=U.locationId,U.isCorporationOwned&&(P.value=!0),U.sharedConfig?(f.value=U.sharedConfig.securityType,C.value=U.sharedConfig.structureType,I.value=[...U.sharedConfig.rigs]):U.structureType&&(C.value=U.structureType),F.value=null}}function B(){v.value=null,P.value=!1}let w;const b=x(null);function u(){if(clearTimeout(w),b.value=null,J.value.length<3){Q.value=[],E.value=!1;return}w=window.setTimeout(async()=>{k.value=!0;const U=await c.searchStructures(J.value);Q.value=U.structures,b.value=U.error||null,E.value=U.structures.length>0,k.value=!1},500)}function T(U){l.value=U.locationName,v.value=U.locationId,U.structureType&&(C.value=U.structureType),U.isCorporationOwned&&(P.value=!0),J.value="",Q.value=[],E.value=!1}function j(){window.setTimeout(()=>{E.value=!1},200)}const N={highsec:1,lowsec:1.9,nullsec:2.1},S={highsec:"High-Sec (x1.0)",lowsec:"Low-Sec (x1.9)",nullsec:"Null-Sec (x2.1)"},W={station:"Station NPC (aucun bonus)",raitaru:"Raitaru (EC Medium) - 1% ME",azbel:"Azbel (EC Large) - 1% ME, 20% TE",sotiyo:"Sotiyo (EC X-Large) - 1% ME, 30% TE",athanor:"Athanor (Refinery Medium) - 25% TE",tatara:"Tatara (Refinery Large) - 25% TE",engineering_complex:"Engineering Complex (legacy)",refinery:"Refinery (legacy)"},ie={raitaru:"M",azbel:"L",sotiyo:"XL",athanor:"M",tatara:"L"},$e=le(()=>{if(!c.rigOptions)return[];const U=ie[C.value];if(["athanor","tatara","refinery"].includes(C.value)){const y=c.rigOptions.reaction;return U?y.filter(R=>R.size===U):y}if(["raitaru","azbel","sotiyo","engineering_complex"].includes(C.value)){const y=c.rigOptions.manufacturing;return U?y.filter(R=>R.size===U):y}return[]}),X=le(()=>{const U=D.value.toLowerCase().trim();return U.length<2?[]:$e.value.filter(y=>I.value.includes(y.name)?!1:y.name.toLowerCase().includes(U)).slice(0,10)}),V=le(()=>I.value.map(U=>$e.value.find(R=>R.name===U)||{name:U,bonus:0,category:"",size:"M",targetCategories:[]}));Ge(C,()=>{D.value="";const U=new Set($e.value.map(y=>y.name));I.value=I.value.filter(y=>U.has(y))});function ge(){l.value="",v.value=null,f.value="nullsec",C.value="raitaru",I.value=[],P.value=!1,i.value=null,D.value="",q.value=!1,F.value=null,J.value="",Q.value=[],E.value=!1}const we=le(()=>["athanor","tatara","refinery"].includes(C.value)),Ce=le(()=>["raitaru","azbel","sotiyo","engineering_complex"].includes(C.value));function Ue(){ge(),m.value=!0}function Re(U){l.value=U.name,v.value=U.locationId,f.value=U.securityType,C.value=U.structureType,I.value=[...U.rigs],i.value=U,D.value="",q.value=!1,m.value=!0}function ae(){m.value=!1,ge()}const K=x(!1),d=x(!1);function me(){if(!i.value||!i.value.isCorporationStructure)return!1;const U=[...i.value.rigs].sort(),y=[...I.value].sort();return JSON.stringify(U)!==JSON.stringify(y)||i.value.structureType!==C.value||i.value.securityType!==f.value}async function ue(){if(i.value&&me()&&!d.value){K.value=!0,St(()=>{var U;return(U=Me.value)==null?void 0:U.focus()});return}try{i.value?await c.updateStructure(i.value.id,{name:l.value,securityType:f.value,structureType:C.value,rigs:I.value}):await c.createStructure({name:l.value,locationId:v.value,securityType:f.value,structureType:C.value,rigs:I.value}),m.value=!1,ge(),d.value=!1}catch{d.value=!1}}async function Te(){K.value=!1,d.value=!0,await ue()}function Fe(){K.value=!1,d.value=!1}const qe=x(!1),Le=x(null),Je=x(""),Ee=x(null),Me=x(null);function He(U){Le.value=U.id,Je.value=U.name,qe.value=!0,St(()=>{var y;return(y=Ee.value)==null?void 0:y.focus()})}async function Y(){Le.value&&await c.deleteStructure(Le.value),qe.value=!1,Le.value=null,Je.value=""}function je(){qe.value=!1,Le.value=null,Je.value=""}const Oe=le(()=>I.value.length<It);function M(U){Oe.value&&(I.value.includes(U.name)||I.value.push(U.name),D.value="",q.value=!1)}function $(U){const y=I.value.indexOf(U);y!==-1&&I.value.splice(y,1)}function ce(){window.setTimeout(()=>{q.value=!1},200)}function A(U){return U.replace("Standup M-Set ","").replace("Standup L-Set ","").replace("Standup XL-Set ","")}const Se={basic_small_ship:"T1 Small Ships",basic_medium_ship:"T1 Medium Ships",basic_large_ship:"T1 Large Ships",advanced_small_ship:"T2 Small Ships",advanced_medium_ship:"T2 Medium Ships",advanced_large_ship:"T2 Large Ships",capital_ship:"Capitals",basic_capital_component:"Capital Components",advanced_component:"T2/T3 Components",structure_component:"Structure Components",equipment:"Modules",ammunition:"Ammo",drone:"Drones",fighter:"Fighters",structure:"Structures",composite_reaction:"Composites",biochemical_reaction:"Biochem",hybrid_reaction:"Hybrid",research:"Research/Invention/Copy"};function p(U){return!U||U.length===0?"":U.map(y=>Se[y]||y).join(", ")}function fe(U){const y=U.includes("Efficiency")&&!U.includes("Material Efficiency"),R=U.includes("L-Set")||U.includes("XL-Set"),_e=U.includes("Reactor Efficiency");return y&&R||_e}function he(U,y,R){if(!c.rigOptions)return 0;const _e=y==="reaction"?c.rigOptions.reaction:c.rigOptions.manufacturing;let Ne=0;for(const Qe of U){const rt=_e.find(De=>De.name===Qe);rt&&(Ne+=rt.bonus)}const xt=N[R]??1;return Math.round(Ne*xt*100)/100}const ee={highsec:1,lowsec:1,nullsec:1.1};function Ae(U,y,R,_e){let Ne=0;if(R==="manufacturing"?Ne={raitaru:15,azbel:20,sotiyo:30}[U]??0:Ne={athanor:25,tatara:25}[U]??0,!c.rigOptions)return Ne;const xt=R==="reaction"?c.rigOptions.reaction:c.rigOptions.manufacturing;let Qe=0;for(const De of y){const nt=xt.find(We=>We.name===De);if(!nt)continue;const at=De.includes("Efficiency")&&!De.includes("Material Efficiency"),tt=De.includes("L-Set")||De.includes("XL-Set"),st=De.includes("Reactor Efficiency");(R==="manufacturing"&&at&&tt||R==="reaction"&&st)&&(Qe+=nt.bonus)}const rt=R==="reaction"?ee[_e]??1:N[_e]??1;if(Qe*=rt,Ne>0||Qe>0){const De=1-(1-Ne/100)*(1-Qe/100);return Math.round(De*1e4)/100}return 0}const Be=le(()=>he(I.value,"manufacturing",f.value)),Ie=le(()=>he(I.value,"reaction",f.value)),pt=le(()=>Ae(C.value,I.value,"manufacturing",f.value)),mt=le(()=>Ae(C.value,I.value,"reaction",f.value));return(U,y)=>(t(),s("div",Vi,[Ye(zi),e("div",Ui,[y[10]||(y[10]=e("h3",{class:"text-lg font-semibold text-slate-200"},"Structures de production",-1)),m.value?h("",!0):(t(),s("button",{key:0,onClick:Ue,class:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2"},[...y[9]||(y[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),se(" Ajouter ",-1)])]))]),y[41]||(y[41]=e("p",{class:"text-sm text-slate-400"}," Configurez vos structures de production pour calculer les bonus de matériaux appliqués aux projets. ",-1)),m.value?(t(),s("div",qi,[e("h4",Fi,o(i.value?"Modifier la structure":"Nouvelle structure"),1),e("div",Hi,[i.value?h("",!0):(t(),s("div",Oi,[y[15]||(y[15]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Structures partagées par la corporation",-1)),H.value?a(c).corporationStructures.length===0?(t(),s("div",Qi," Aucune structure trouvée. Vérifiez que les assets de corporation sont synchronisés. ")):(t(),s(O,{key:2},[de(e("select",{"onUpdate:modelValue":y[0]||(y[0]=R=>F.value=R),onChange:z,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},[y[11]||(y[11]=e("option",{value:null},"-- Sélectionner une structure --",-1)),(t(!0),s(O,null,pe(a(c).corporationStructures,R=>(t(),s("option",{key:R.locationId,value:R},o(R.locationName)+" ("+o(R.solarSystemName||"Système inconnu")+") "+o(R.sharedConfig?" - Rigs configurés":""),9,Wi))),128))],544),[[Tt,F.value]]),y[12]||(y[12]=e("p",{class:"text-xs text-slate-500 mt-1"}," Sélectionnez une structure ou laissez vide pour une configuration personnalisée ",-1))],64)):(t(),s("div",Ki," Chargement... ")),e("div",Xi,[y[14]||(y[14]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Ou rechercher par nom (ESI)",-1)),de(e("input",{"onUpdate:modelValue":y[1]||(y[1]=R=>J.value=R),type:"text",placeholder:"Rechercher une structure...",onInput:u,onFocus:y[2]||(y[2]=R=>E.value=Q.value.length>0),onBlur:j,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},null,544),[[be,J.value]]),k.value?(t(),s("div",Zi,[...y[13]||(y[13]=[e("svg",{class:"animate-spin h-4 w-4 text-slate-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):h("",!0),E.value&&Q.value.length>0?(t(),s("div",Yi,[(t(!0),s(O,null,pe(Q.value,R=>(t(),s("button",{key:R.locationId,onMousedown:ke(_e=>T(R),["prevent"]),class:"w-full px-3 py-2 hover:bg-slate-700 text-left"},[e("div",eu,[se(o(R.isCorporationOwned?"★ ":"")+o(R.locationName)+" ",1),R.solarSystemName?(t(),s("span",tu,"("+o(R.solarSystemName)+")",1)):h("",!0)]),e("div",su,o(R.structureType?R.structureType.charAt(0).toUpperCase()+R.structureType.slice(1):"Structure")+" "+o(R.isCorporationOwned?" - Structure corpo":""),1)],40,Gi))),128))])):h("",!0),b.value?(t(),s("div",ou,o(b.value),1)):h("",!0)])])),v.value?(t(),s("div",nu,[e("div",{class:"flex items-center justify-between"},[y[16]||(y[16]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-4 h-4 text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})]),e("span",{class:"text-sm text-cyan-300"},"Structure de corporation")],-1)),e("button",{onClick:B,class:"text-xs text-slate-400 hover:text-slate-200"}," Passer en mode personnalisé ")]),y[17]||(y[17]=e("p",{class:"text-xs text-slate-400 mt-1"}," Les rigs configurés seront partagés avec les autres membres de votre corporation. ",-1))])):h("",!0),e("div",null,[y[18]||(y[18]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Nom",-1)),de(e("input",{"onUpdate:modelValue":y[3]||(y[3]=R=>l.value=R),type:"text",placeholder:"Ex: Tatara C-J6MT",class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[be,l.value]])]),e("div",null,[y[20]||(y[20]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Type de structure",-1)),de(e("select",{"onUpdate:modelValue":y[4]||(y[4]=R=>C.value=R),class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},[...y[19]||(y[19]=[Bt('<optgroup label="NPC"><option value="station">Station NPC (aucun bonus)</option></optgroup><optgroup label="Engineering Complex"><option value="raitaru">Raitaru (Medium) - 1% ME, 15% TE</option><option value="azbel">Azbel (Large) - 1% ME, 20% TE</option><option value="sotiyo">Sotiyo (X-Large) - 1% ME, 30% TE</option></optgroup><optgroup label="Refinery"><option value="athanor">Athanor (Medium) - 25% TE reactions</option><option value="tatara">Tatara (Large) - 25% TE reactions</option></optgroup>',3)])],512),[[Tt,C.value]])]),e("div",null,[y[21]||(y[21]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Sécurité",-1)),e("div",ru,[(t(),s(O,null,pe(S,(R,_e)=>e("label",{key:_e,class:"flex items-center gap-2 cursor-pointer"},[de(e("input",{type:"radio",value:_e,"onUpdate:modelValue":y[5]||(y[5]=Ne=>f.value=Ne),class:"text-cyan-500 focus:ring-cyan-500"},null,8,au),[[Kt,f.value]]),e("span",lu,o(R),1)])),64))])]),e("div",null,[e("label",iu," Rigs (bonus matériaux) - "+o(I.value.length)+"/"+o(It),1),e("div",uu,[de(e("input",{"onUpdate:modelValue":y[6]||(y[6]=R=>D.value=R),type:"text",placeholder:Oe.value?"Rechercher un rig...":"Maximum de rigs atteint",disabled:!Oe.value,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed",onFocus:y[7]||(y[7]=R=>q.value=X.value.length>0),onBlur:ce,onInput:y[8]||(y[8]=R=>q.value=!0)},null,40,cu),[[be,D.value]]),q.value&&X.value.length>0?(t(),s("div",du,[(t(!0),s(O,null,pe(X.value,R=>(t(),s("button",{key:R.name,onMousedown:ke(_e=>M(R),["prevent"]),class:"w-full px-3 py-2 hover:bg-slate-700 text-left"},[e("div",mu,[e("span",xu,o(A(R.name)),1),e("span",vu,[fe(R.name)?(t(),s(O,{key:0},[e("span",fu,"ME: -"+o(R.bonus)+"%",1),e("span",yu,"TE: -"+o(R.bonus)+"%",1)],64)):(t(),s("span",bu,"ME: -"+o(R.bonus)+"%",1)),e("span",hu,"("+o(R.size)+")",1)])]),e("div",gu,o(p(R.targetCategories)),1)],40,pu))),128))])):h("",!0),q.value&&D.value.length>=2&&X.value.length===0?(t(),s("div",ku," Aucun rig trouvé ")):h("",!0)]),I.value.length>0?(t(),s("div",wu,[(t(!0),s(O,null,pe(V.value,R=>(t(),s("div",{key:R.name,class:"bg-slate-900/50 rounded-lg px-3 py-2"},[e("div",Su,[e("div",$u,[e("span",_u,o(A(R.name)),1),e("span",Cu,[fe(R.name)?(t(),s(O,{key:0},[e("span",Pu,"ME: -"+o(R.bonus)+"%",1),e("span",ju,"TE: -"+o(R.bonus)+"%",1)],64)):(t(),s("span",Tu,"ME: -"+o(R.bonus)+"%",1)),e("span",Mu,"("+o(R.size)+")",1)])]),e("button",{onClick:_e=>$(R.name),class:"ml-2 p-1 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded shrink-0",title:"Retirer"},[...y[22]||(y[22]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Iu)]),e("div",Eu,o(p(R.targetCategories)),1)]))),128))])):(t(),s("p",Bu," Aucun rig sélectionné. Recherchez et ajoutez des rigs pour appliquer des bonus. "))]),e("div",Lu,[y[27]||(y[27]=e("p",{class:"text-xs text-slate-400 mb-2"},"Bonus calculé (base structure + rigs × sécurité)",-1)),e("div",Nu,[Ce.value?(t(),s("div",Ru,[e("div",null,[y[23]||(y[23]=e("span",{class:"text-xs text-slate-500"},"ME Manufacturing:",-1)),e("span",Ju,"-"+o(Be.value)+"%",1)]),e("div",null,[y[24]||(y[24]=e("span",{class:"text-xs text-slate-500"},"TE Manufacturing:",-1)),e("span",Au,"-"+o(pt.value)+"%",1)])])):h("",!0),we.value?(t(),s("div",Du,[e("div",null,[y[25]||(y[25]=e("span",{class:"text-xs text-slate-500"},"ME Reactions:",-1)),e("span",zu,"-"+o(Ie.value)+"%",1)]),e("div",null,[y[26]||(y[26]=e("span",{class:"text-xs text-slate-500"},"TE Reactions:",-1)),e("span",Vu,"-"+o(mt.value)+"%",1)])])):h("",!0),C.value==="station"?(t(),s("div",Uu," Les stations NPC n'ont pas de bonus ")):h("",!0)])]),e("div",qu,[e("button",{onClick:ue,disabled:!l.value.trim(),class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-600 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium"},o(i.value?"Enregistrer":"Ajouter"),9,Fu),e("button",{onClick:ae,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm"}," Annuler ")])])])):h("",!0),a(c).structures.length>0?(t(),s("div",Hu,[(t(!0),s(O,null,pe(a(c).structures,R=>(t(),s("div",{key:R.id,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700 hover:border-slate-600"},[e("div",Ou,[e("div",Ku,[e("div",Qu,[e("h4",Wu,o(R.name),1),R.isCorporationStructure?(t(),s("span",Xu," CORPO ")):h("",!0)]),e("p",Zu,o(W[R.structureType])+" - "+o(S[R.securityType]),1),e("div",Yu,[R.manufacturingMaterialBonus>0||R.manufacturingTimeBonus>0?(t(),s(O,{key:0},[e("div",null,[y[28]||(y[28]=e("span",{class:"text-xs text-slate-500"},"ME Manuf:",-1)),e("span",Gu,"-"+o(R.manufacturingMaterialBonus)+"%",1)]),e("div",null,[y[29]||(y[29]=e("span",{class:"text-xs text-slate-500"},"TE Manuf:",-1)),e("span",ec,"-"+o(R.manufacturingTimeBonus)+"%",1)])],64)):h("",!0),R.reactionMaterialBonus>0||R.reactionTimeBonus>0?(t(),s(O,{key:1},[e("div",null,[y[30]||(y[30]=e("span",{class:"text-xs text-slate-500"},"ME Reactions:",-1)),e("span",tc,"-"+o(R.reactionMaterialBonus)+"%",1)]),e("div",null,[y[31]||(y[31]=e("span",{class:"text-xs text-slate-500"},"TE Reactions:",-1)),e("span",sc,"-"+o(R.reactionTimeBonus)+"%",1)])],64)):h("",!0)]),R.rigs.length>0?(t(),s("div",oc,[(t(!0),s(O,null,pe(R.rigs,_e=>(t(),s("span",{key:_e,class:"px-2 py-0.5 bg-slate-700 text-slate-300 text-xs rounded"},o(A(_e)),1))),128))])):h("",!0)]),e("div",nc,[e("button",{onClick:_e=>Re(R),class:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded",title:"Modifier"},[...y[32]||(y[32]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,rc),e("button",{onClick:_e=>He(R),class:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer"},[...y[33]||(y[33]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ac)])])]))),128))])):m.value?h("",!0):(t(),s("div",lc,[...y[34]||(y[34]=[e("p",null,"Aucune structure configurée",-1),e("p",{class:"text-sm mt-1"},"Ajoutez vos structures pour calculer les bonus de matériaux",-1)])])),(t(),et(ft,{to:"body"},[qe.value?(t(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:ke(je,["self"]),onKeydown:[xe(Y,["enter"]),xe(je,["escape"])]},[e("div",{class:"bg-slate-900 rounded-xl border border-slate-700 max-w-md w-full p-6",tabindex:"-1",ref_key:"deleteModalRef",ref:Ee},[y[37]||(y[37]=e("h3",{class:"text-lg font-semibold text-slate-200 mb-2"},"Supprimer la structure",-1)),e("p",ic,[y[35]||(y[35]=se(" Voulez-vous vraiment supprimer ",-1)),e("span",uc,o(Je.value),1),y[36]||(y[36]=se(" ? ",-1))]),e("div",{class:"flex gap-3"},[e("button",{onClick:je,class:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300"}," Annuler "),e("button",{onClick:Y,class:"flex-1 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white font-medium"}," Supprimer ")])],512)],32)):h("",!0)])),(t(),et(ft,{to:"body"},[K.value?(t(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:ke(Fe,["self"]),onKeydown:[xe(Te,["enter"]),xe(Fe,["escape"])]},[e("div",{class:"bg-slate-900 rounded-xl border border-amber-700/50 max-w-md w-full p-6",tabindex:"-1",ref_key:"corpEditModalRef",ref:Me},[y[38]||(y[38]=e("div",{class:"flex items-center gap-3 mb-4"},[e("div",{class:"p-2 bg-amber-500/20 rounded-lg"},[e("svg",{class:"w-6 h-6 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])]),e("h3",{class:"text-lg font-semibold text-slate-200"},"Modifier une structure corpo")],-1)),y[39]||(y[39]=e("p",{class:"text-slate-400 mb-2"}," Cette structure est partagée avec votre corporation. ",-1)),y[40]||(y[40]=e("p",{class:"text-slate-400 mb-6"}," Les modifications (rigs, type, sécurité) seront visibles par tous les membres de la corpo. Voulez-vous continuer ? ",-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:Fe,class:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300"}," Annuler "),e("button",{onClick:Te,class:"flex-1 py-2 bg-amber-600 hover:bg-amber-500 rounded-lg text-white font-medium"}," Confirmer ")])],512)],32)):h("",!0)]))]))}}),dc={class:"bg-slate-900 rounded-xl border border-slate-800"},pc={class:"px-6 py-4 border-b border-slate-800 flex items-center justify-between"},mc=["disabled"],xc={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vc={class:"p-6"},fc={key:0,class:"mb-4 p-3 bg-amber-500/20 border border-amber-500/30 rounded-lg text-amber-400 text-sm"},yc={key:1,class:"text-slate-500 text-sm py-4"},bc={key:2,class:"overflow-x-auto"},hc={class:"w-full text-sm"},gc={class:"py-3 px-3"},kc={class:"flex items-center gap-3"},wc={class:"w-8 h-8 rounded bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center text-cyan-400 text-xs font-bold ring-1 ring-cyan-500/30"},Sc={class:"text-slate-200 font-medium"},$c={class:"py-3 px-3 text-center"},_c=["value","onChange"],Cc=["value"],Pc={class:"py-3 px-3 text-center"},jc=["value","onChange"],Tc=["value"],Mc={class:"py-3 px-3 text-center"},Ic=["value","onChange"],Ec=["value"],Bc={class:"py-3 px-3 text-center"},Lc={class:"py-3 px-3 text-center text-slate-500 text-xs"},Nc=Ve({__name:"SkillsConfig",setup(n){const c=_t(),m=x(!1),i=x(null);ct(()=>{c.fetchCharacterSkills()});async function l(){m.value=!0,i.value=null;try{const I=await c.syncCharacterSkills();i.value=I}catch{}finally{m.value=!1}}async function v(I,D,q){const J=Math.max(0,Math.min(5,q)),Q={};D==="industry"?Q.industry=J:D==="advancedIndustry"?Q.advancedIndustry=J:D==="reactions"&&(Q.reactions=J),await c.updateCharacterSkill(I.characterId,Q)}function f(I){return I.split(" ").map(D=>D[0]).join("").substring(0,2).toUpperCase()}function C(I){if(!I)return"-";const D=new Date(I),J=new Date().getTime()-D.getTime(),Q=Math.floor(J/6e4),k=Math.floor(Q/60),E=Math.floor(k/24);return Q<1?"à l'instant":Q<60?`il y a ${Q}min`:k<24?`il y a ${k}h`:E<7?`il y a ${E}j`:D.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}return(I,D)=>(t(),s("div",dc,[e("div",pc,[D[2]||(D[2]=Bt('<div><h3 class="text-lg font-semibold text-slate-100">Skills industrie</h3><p class="text-sm text-slate-400 mt-1"> Les skills industrie affectent le temps de production. Synchronisez depuis ESI ou saisissez manuellement. <span class="group relative inline-block ml-1 cursor-help"><svg class="w-3.5 h-3.5 inline-block text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="2"></circle><path stroke-linecap="round" stroke-width="2" d="M12 16h.01M12 8v4"></path></svg><span class="invisible group-hover:visible absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-72 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-xs text-slate-300 shadow-lg z-10"> La synchronisation récupère aussi les skills scientifiques requis par les blueprints (ex: Graviton Physics, Mechanical Engineering…). Ils ne sont pas affichés ici mais sont utilisés dans le calcul des temps de production. </span></span></p></div>',1)),e("button",{onClick:l,disabled:m.value,class:"px-4 py-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-lg text-sm font-medium disabled:opacity-50 flex items-center gap-2 hover:bg-cyan-500/30 transition-colors"},[m.value?(t(),s("svg",xc,[...D[0]||(D[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):h("",!0),D[1]||(D[1]=se(" Sync tous les skills (ESI) ",-1))],8,mc)]),e("div",vc,[i.value?(t(),s("div",fc,o(i.value),1)):h("",!0),a(c).characterSkills.length===0?(t(),s("div",yc," Aucun personnage trouvé. Ajoutez un personnage via le menu principal. ")):(t(),s("div",bc,[e("table",hc,[D[3]||(D[3]=e("thead",null,[e("tr",{class:"border-b border-slate-800 text-slate-400 text-xs uppercase"},[e("th",{class:"text-left py-3 px-3"},"Personnage"),e("th",{class:"text-center py-3 px-3"},"Industry"),e("th",{class:"text-center py-3 px-3"},"Adv. Industry"),e("th",{class:"text-center py-3 px-3"},"Reactions"),e("th",{class:"text-center py-3 px-3"},"Source"),e("th",{class:"text-center py-3 px-3"},"Dernière sync")])],-1)),e("tbody",null,[(t(!0),s(O,null,pe(a(c).characterSkills,q=>(t(),s("tr",{key:q.characterId,class:"border-b border-slate-800/50 hover:bg-slate-800/30"},[e("td",gc,[e("div",kc,[e("div",wc,o(f(q.characterName)),1),e("div",Sc,o(q.characterName),1)])]),e("td",$c,[e("select",{value:q.industry,onChange:J=>v(q,"industry",parseInt(J.target.value)),class:"bg-slate-800 border border-slate-700 rounded px-2 py-1 text-sm text-center text-cyan-400 font-mono focus:outline-none focus:border-cyan-500"},[(t(),s(O,null,pe(6,J=>e("option",{key:J-1,value:J-1},o(J-1),9,Cc)),64))],40,_c)]),e("td",Pc,[e("select",{value:q.advancedIndustry,onChange:J=>v(q,"advancedIndustry",parseInt(J.target.value)),class:"bg-slate-800 border border-slate-700 rounded px-2 py-1 text-sm text-center text-cyan-400 font-mono focus:outline-none focus:border-cyan-500"},[(t(),s(O,null,pe(6,J=>e("option",{key:J-1,value:J-1},o(J-1),9,Tc)),64))],40,jc)]),e("td",Mc,[e("select",{value:q.reactions,onChange:J=>v(q,"reactions",parseInt(J.target.value)),class:"bg-slate-800 border border-slate-700 rounded px-2 py-1 text-sm text-center text-cyan-400 font-mono focus:outline-none focus:border-cyan-500"},[(t(),s(O,null,pe(6,J=>e("option",{key:J-1,value:J-1},o(J-1),9,Ec)),64))],40,Ic)]),e("td",Bc,[e("span",{class:G(["px-2 py-1 rounded text-xs",q.source==="esi"?"bg-cyan-500/10 text-cyan-400 border border-cyan-500/20":"bg-amber-500/10 text-amber-400 border border-amber-500/20"])},o(q.source==="esi"?"ESI":"Manuel"),3)]),e("td",Lc,o(C(q.lastSyncAt)),1)]))),128))])])]))])]))}}),Rc={class:"mb-6 flex items-center justify-between"},Jc={key:0,class:"flex gap-2"},Ac={key:0,class:"mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 flex items-center justify-between"},Dc={class:"flex items-center gap-4 mb-6 bg-slate-900 rounded-xl border border-slate-800 px-6 py-4"},zc={class:"w-48"},Vc=["value"],Uc={class:"flex gap-2 mb-6"},qc={key:0},Fc={key:1},Hc={key:2},Oc={class:"bg-slate-900 rounded-xl border border-slate-800 p-6 mb-6"},Kc={key:0,class:"mb-4"},Qc={key:1,class:"mb-4 space-y-2"},Wc={class:"flex-1 text-slate-200"},Xc={class:"flex items-center gap-1"},Zc=["onUpdate:modelValue"],Yc={class:"flex items-center gap-1"},Gc=["onUpdate:modelValue"],ed={class:"flex items-center gap-1"},td=["onUpdate:modelValue"],sd=["onClick"],od={class:"flex items-end gap-4 flex-wrap"},nd={class:"flex-1 relative min-w-[200px]"},rd={class:"block text-sm text-slate-400 mb-1"},ad={key:0,class:"text-cyan-400 ml-2"},ld={class:"w-24"},id={class:"w-24"},ud={class:"w-24"},cd=["disabled"],dd=["disabled"],pd={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},md={class:"bg-slate-900 rounded-xl border border-slate-800"},xd={key:0,class:"p-8 text-center text-slate-500"},gd=Ve({__name:"Industry",setup(n){const c=ot(),m=x(null),i=x(1),l=x(0),v=x(0),f=x(""),C=x([]),I=x(!1),D=x(null);function q(b){return b.replace(/\s*\(BPC\)\s*$/i,"").trim()}const J=x(null),Q=x("projects"),k=x("skills");ct(()=>{c.fetchProjects()});function E(b){m.value=b}function H(){m.value&&C.value.push({typeId:m.value.typeId,typeName:q(m.value.typeName),runs:i.value,meLevel:l.value,teLevel:v.value})}function F(b){C.value.splice(b,1)}async function P(){if(C.value.length===0&&m.value&&H(),C.value.length!==0){I.value=!0;try{const b=C.value[0],u=await c.createProject(b.typeId,b.runs,b.meLevel,b.teLevel,c.defaultMaxJobDurationDays,f.value.trim()||null);for(let T=1;T<C.value.length;T++){const j=C.value[T];await c.createStep(u.id,j.typeId,j.runs,j.meLevel,j.teLevel)}m.value=null,i.value=1,l.value=0,v.value=0,f.value="",C.value=[],await c.fetchProjects()}finally{I.value=!1}}}function z(b){J.value=b}function B(){J.value=null,c.fetchProjects()}async function w(b){I.value=!0;try{await c.createProject(b.productTypeId,b.runs,b.meLevel,b.teLevel,c.defaultMaxJobDurationDays),await c.fetchProjects()}finally{I.value=!1}}return(b,u)=>(t(),et(Wt,null,{default:Qt(()=>[e("div",Rc,[u[11]||(u[11]=e("p",{class:"text-slate-400"},"Suivi de projets de construction",-1)),J.value?h("",!0):(t(),s("div",Jc,[e("button",{onClick:u[0]||(u[0]=T=>Q.value="projects"),class:G(["px-4 py-2 rounded-lg text-sm font-medium",Q.value==="projects"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Projets ",2),e("button",{onClick:u[1]||(u[1]=T=>Q.value="config"),class:G(["px-4 py-2 rounded-lg text-sm font-medium",Q.value==="config"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Configuration ",2)]))]),a(c).error?(t(),s("div",Ac,[e("span",null,o(a(c).error),1),e("button",{onClick:u[2]||(u[2]=T=>a(c).clearError()),class:"text-red-400 hover:text-red-300"},[...u[12]||(u[12]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):h("",!0),J.value?(t(),et(ti,{key:1,"project-id":J.value,onClose:B},null,8,["project-id"])):Q.value==="config"?(t(),s(O,{key:2},[e("div",Dc,[e("div",zc,[u[13]||(u[13]=e("label",{class:"block text-xs text-slate-500 mb-1"},"Durée max job (jours)",-1)),e("input",{value:a(c).defaultMaxJobDurationDays.toFixed(1),onChange:u[3]||(u[3]=T=>a(c).setDefaultMaxJobDurationDays(parseFloat(T.target.value)||2)),type:"number",min:"0.5",step:"0.1",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-cyan-500"},null,40,Vc)]),u[14]||(u[14]=e("p",{class:"text-xs text-slate-500 self-end pb-1"}," Les jobs dépassant cette durée seront découpés en plusieurs étapes. ",-1))]),e("div",Uc,[e("button",{onClick:u[4]||(u[4]=T=>k.value="skills"),class:G(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",k.value==="skills"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Skills ",2),e("button",{onClick:u[5]||(u[5]=T=>k.value="structures"),class:G(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",k.value==="structures"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Structures ",2),e("button",{onClick:u[6]||(u[6]=T=>k.value="blacklist"),class:G(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",k.value==="blacklist"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Blacklist ",2)]),k.value==="skills"?(t(),s("div",qc,[Ye(Nc)])):k.value==="structures"?(t(),s("div",Fc,[Ye(cc)])):(t(),s("div",Hc,[Ye(hi)]))],64)):(t(),s(O,{key:3},[e("div",Oc,[u[26]||(u[26]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-4"},"Nouveau projet",-1)),C.value.length>0||f.value?(t(),s("div",Kc,[u[15]||(u[15]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Nom du projet",-1)),de(e("input",{"onUpdate:modelValue":u[7]||(u[7]=T=>f.value=T),type:"text",placeholder:"Ex: Rorqual Fleet",class:"w-64 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500 placeholder-slate-600"},null,512),[[be,f.value]])])):h("",!0),C.value.length>0?(t(),s("div",Qc,[(t(!0),s(O,null,pe(C.value,(T,j)=>(t(),s("div",{key:j,class:"flex items-center gap-3 bg-slate-800/50 rounded-lg px-4 py-2"},[e("span",Wc,o(T.typeName),1),e("div",Xc,[de(e("input",{"onUpdate:modelValue":N=>T.runs=N,type:"number",min:"1",class:"w-16 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm text-center"},null,8,Zc),[[be,T.runs,void 0,{number:!0}]]),u[16]||(u[16]=e("span",{class:"text-slate-500 text-xs"},"runs",-1))]),e("div",Yc,[u[17]||(u[17]=e("span",{class:"text-slate-500 text-xs"},"ME",-1)),de(e("input",{"onUpdate:modelValue":N=>T.meLevel=N,type:"number",min:"0",max:"10",class:"w-12 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm text-center"},null,8,Gc),[[be,T.meLevel,void 0,{number:!0}]])]),e("div",ed,[u[18]||(u[18]=e("span",{class:"text-slate-500 text-xs"},"TE",-1)),de(e("input",{"onUpdate:modelValue":N=>T.teLevel=N,type:"number",min:"0",max:"20",class:"w-12 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm text-center"},null,8,td),[[be,T.teLevel,void 0,{number:!0}]])]),e("button",{onClick:N=>F(j),class:"p-1 text-slate-500 hover:text-red-400",title:"Retirer"},[...u[19]||(u[19]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,sd)]))),128))])):h("",!0),e("div",od,[e("div",nd,[e("label",rd,[se(o(C.value.length>0?"Ajouter un produit":"Produit")+" ",1),m.value?(t(),s("span",ad," — "+o(m.value.typeName),1)):h("",!0)]),Ye(ts,{ref_key:"productSearchRef",ref:D,onSelect:E},null,512)]),e("div",ld,[u[20]||(u[20]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Runs",-1)),de(e("input",{"onUpdate:modelValue":u[8]||(u[8]=T=>i.value=T),type:"number",min:"1",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[be,i.value,void 0,{number:!0}]])]),e("div",id,[u[21]||(u[21]=e("label",{class:"block text-sm text-slate-400 mb-1"},"ME",-1)),de(e("input",{"onUpdate:modelValue":u[9]||(u[9]=T=>l.value=T),type:"number",min:"0",max:"10",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[be,l.value,void 0,{number:!0}]])]),e("div",ud,[u[22]||(u[22]=e("label",{class:"block text-sm text-slate-400 mb-1"},"TE",-1)),de(e("input",{"onUpdate:modelValue":u[10]||(u[10]=T=>v.value=T),type:"number",min:"0",max:"20",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[be,v.value,void 0,{number:!0}]])]),C.value.length>0?(t(),s("button",{key:0,onClick:H,disabled:!m.value,class:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-white text-sm font-medium disabled:opacity-50 flex items-center gap-2",title:"Ajouter à la liste"},[...u[23]||(u[23]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),se(" Ajouter ",-1)])],8,cd)):h("",!0),e("button",{onClick:P,disabled:!m.value&&C.value.length===0||I.value,class:"px-6 py-2.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium disabled:opacity-50 flex items-center gap-2"},[I.value?(t(),s("svg",pd,[...u[24]||(u[24]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):h("",!0),se(" "+o(I.value?"Création...":C.value.length>0?"Créer le projet":"Créer"),1)],8,dd),C.value.length===0&&m.value?(t(),s("button",{key:1,onClick:H,class:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm font-medium flex items-center gap-2",title:"Ajouter un autre produit"},[...u[25]||(u[25]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),se(" Multi-produit ",-1)])])):h("",!0)])]),e("div",md,[u[28]||(u[28]=e("div",{class:"px-6 py-4 border-b border-slate-800"},[e("h3",{class:"text-lg font-semibold text-slate-100"},"Historique des projets")],-1)),a(c).isLoading?(t(),s("div",xd,[...u[27]||(u[27]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),se(" Chargement... ",-1)])])):(t(),et(Ls,{key:1,onViewProject:z,onDuplicateProject:w}))])],64))]),_:1}))}});export{gd as default};
