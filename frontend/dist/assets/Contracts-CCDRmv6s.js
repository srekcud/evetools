import{d as U,u as q,o as O,i as G,w as R,j as K,r as c,h as o,b as e,y as Q,z as W,c as r,m as k,t as l,F as g,n as x,l as D,e as n,k as d,p as y}from"./index-eOzsbP3j.js";import{u as X}from"./useFormatters-SlNtu6dn.js";import{u as Y}from"./useEveImages-B3tDia7r.js";import{_ as Z}from"./MainLayout.vue_vue_type_style_index_0_lang-BsVw6yHB.js";const ee={class:"flex items-center justify-end mb-6"},te={class:"flex items-center gap-3"},se=["value"],le=["disabled"],oe={key:0,class:"mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 flex items-center justify-between"},re={key:1,class:"flex flex-col items-center justify-center py-20"},ae={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8"},ie={class:"group relative bg-gradient-to-br from-slate-800/80 to-slate-900/80 rounded-2xl p-5 border border-slate-700/50 backdrop-blur-sm overflow-hidden transition-all duration-300 hover:border-cyan-500/40 hover:shadow-lg hover:shadow-cyan-500/10 hover:-translate-y-1"},ne={class:"relative"},de={class:"text-3xl font-bold text-cyan-400"},ue={class:"group relative bg-gradient-to-br from-slate-800/80 to-slate-900/80 rounded-2xl p-5 border border-slate-700/50 backdrop-blur-sm overflow-hidden transition-all duration-300 hover:border-amber-500/40 hover:shadow-lg hover:shadow-amber-500/10 hover:-translate-y-1"},xe={class:"relative"},pe={class:"text-3xl font-bold text-amber-400"},ve={class:"group relative bg-gradient-to-br from-slate-800/80 to-slate-900/80 rounded-2xl p-5 border border-slate-700/50 backdrop-blur-sm overflow-hidden transition-all duration-300 hover:border-emerald-500/40 hover:shadow-lg hover:shadow-emerald-500/10 hover:-translate-y-1"},me={class:"relative"},ce={class:"text-3xl font-bold text-emerald-400"},fe={class:"group relative bg-gradient-to-br from-slate-800/80 to-slate-900/80 rounded-2xl p-5 border border-slate-700/50 backdrop-blur-sm overflow-hidden transition-all duration-300 hover:border-red-500/40 hover:shadow-lg hover:shadow-red-500/10 hover:-translate-y-1"},ge={class:"relative"},he={class:"text-3xl font-bold text-red-400"},be={key:0,class:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden"},_e={class:"divide-y divide-slate-800"},ke=["onClick"],ye={class:"flex items-center justify-between"},we={class:"flex items-center gap-4"},Ce={class:"flex items-center gap-2 mb-1"},je={class:"text-xs text-slate-500"},Se={class:"text-sm text-slate-300"},De={class:"text-xs text-slate-500 mt-1"},Ee={key:0},Ie={class:"text-right"},Te={class:"flex items-center gap-4"},Pe={class:"text-lg font-bold text-slate-200"},Be={key:0},Ae={class:"text-sm font-medium text-slate-400"},Me={key:1},Ve={class:"text-sm font-medium text-slate-400"},Le={key:2,class:"min-w-24"},Fe={class:"text-xs text-slate-500 uppercase"},ze={class:"text-sm font-medium text-slate-400"},Je={class:"min-w-10"},Ne={key:0,class:"w-6 h-6 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$e={key:1,class:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},He={key:2,class:"text-xs text-slate-600"},Ue={key:0,class:"px-5 pb-4 bg-slate-800/30"},qe={class:"border-t border-slate-700/50 pt-4"},Oe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},Ge=["src","alt"],Re={class:"flex-1 min-w-0"},Ke={class:"text-sm text-slate-300 truncate"},Qe={class:"text-xs text-slate-500"},We={class:"text-right flex gap-4"},Xe={key:0},Ye={class:"text-xs text-slate-400"},Ze={key:1},et={class:"text-xs text-slate-400"},tt={key:2},st={key:1,class:"bg-slate-900 rounded-xl border border-slate-800 p-12 text-center"},nt=U({__name:"Contracts",setup(lt){const E=q(),{formatIsk:p,formatDate:I,formatDateTime:T}=X(),{getTypeIconUrl:P,onImageError:w}=Y(),u=c([]),v=c(!1),m=c(""),h=c("outstanding"),f=c(null),B=[{value:"outstanding",label:"En cours"},{value:"finished",label:"Termin√©s"},{value:"all",label:"Tous"}];async function b(){v.value=!0,m.value="";try{const a=await K(`/api/contracts?status=${h.value}`,{headers:{Authorization:`Bearer ${E.token}`}});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to fetch contracts")}const t=await a.json();u.value=t.contracts}catch(a){m.value=a.message||"Erreur lors du chargement des contrats",console.error(a)}finally{v.value=!1}}const A={outstanding:"En cours",finished:"Termine",completed:"Complete",cancelled:"Annule",rejected:"Rejete",failed:"Echoue",deleted:"Supprime",reversed:"Inverse",in_progress:"En traitement"},M={outstanding:"bg-cyan-500/20 text-cyan-400",finished:"bg-emerald-500/20 text-emerald-400",completed:"bg-emerald-500/20 text-emerald-400",cancelled:"bg-red-500/20 text-red-400",rejected:"bg-red-500/20 text-red-400",failed:"bg-red-500/20 text-red-400",deleted:"bg-red-500/20 text-red-400"};function V(a){return A[a]??a}function L(a){return M[a]??"bg-slate-500/20 text-slate-400"}function _(a,t){return a===null?"text-slate-400":(t?a<=0:a>=0)?"text-emerald-400":"text-red-400"}function F(a){f.value=f.value===a?null:a}const z=y(()=>u.value.filter(a=>a.isSeller)),J=y(()=>u.value.filter(a=>a.isCompetitive===!0).length),N=y(()=>u.value.filter(a=>a.isCompetitive===!1).length);O(()=>{b()});function $(){b()}return(a,t)=>(o(),G(Z,null,{default:R(()=>[e("div",ee,[e("div",te,[Q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),onChange:$,class:"bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-cyan-500"},[(o(),r(g,null,k(B,s=>e("option",{key:s.value,value:s.value},l(s.label),9,se)),64))],544),[[W,h.value]]),e("button",{onClick:b,disabled:v.value,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2 disabled:opacity-50"},[(o(),r("svg",{class:x(["w-4 h-4",v.value&&"animate-spin"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),D(" "+l(v.value?"Chargement...":"Actualiser"),1)],8,le)])]),m.value?(o(),r("div",oe,[e("span",null,l(m.value),1),e("button",{onClick:t[1]||(t[1]=s=>m.value=""),class:"text-red-400 hover:text-red-300"},[...t[4]||(t[4]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):n("",!0),v.value&&u.value.length===0?(o(),r("div",re,[...t[5]||(t[5]=[e("svg",{class:"w-10 h-10 animate-spin text-cyan-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),e("p",{class:"text-slate-400"},"Chargement des contrats et prix marche...",-1),e("p",{class:"text-slate-500 text-sm mt-1"},"Cela peut prendre quelques secondes",-1)])])):(o(),r(g,{key:2},[e("div",ae,[e("div",ie,[t[7]||(t[7]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-cyan-500/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-in-out"},null,-1)),e("div",ne,[t[6]||(t[6]=e("p",{class:"text-slate-500 text-sm uppercase tracking-wider mb-1"},"Total contrats",-1)),e("p",de,l(u.value.length),1)])]),e("div",ue,[t[9]||(t[9]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-amber-500/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-in-out"},null,-1)),e("div",xe,[t[8]||(t[8]=e("p",{class:"text-slate-500 text-sm uppercase tracking-wider mb-1"},"Ventes",-1)),e("p",pe,l(z.value.length),1)])]),e("div",ve,[t[11]||(t[11]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-emerald-500/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-in-out"},null,-1)),e("div",me,[t[10]||(t[10]=e("p",{class:"text-slate-500 text-sm uppercase tracking-wider mb-1"},"Competitifs",-1)),e("p",ce,l(J.value),1)])]),e("div",fe,[t[13]||(t[13]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-red-500/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-in-out"},null,-1)),e("div",ge,[t[12]||(t[12]=e("p",{class:"text-slate-500 text-sm uppercase tracking-wider mb-1"},"Trop chers",-1)),e("p",he,l(N.value),1)])])]),u.value.length>0?(o(),r("div",be,[t[24]||(t[24]=e("div",{class:"px-5 py-4 border-b border-slate-800"},[e("h3",{class:"font-semibold"},"Contrats Item Exchange"),e("p",{class:"text-sm text-slate-500"},"Prix compares avec le marche Jita (The Forge)"),e("p",{class:"text-xs text-slate-600 mt-1"}," Seuils : max +5% vs contrats similaires, max +10% vs Jita (0 ISK = toujours competitif pour les achats) ")],-1)),e("div",_e,[(o(!0),r(g,null,k(u.value,s=>{var C,j,S;return o(),r("div",{key:s.contractId,class:"transition-colors hover:bg-slate-800/30"},[e("div",{onClick:i=>F(s.contractId),class:"px-5 py-4 cursor-pointer"},[e("div",ye,[e("div",we,[(o(),r("svg",{class:x(["w-5 h-5 text-slate-500 transition-transform",f.value===s.contractId&&"rotate-90"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[14]||(t[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),e("div",null,[e("div",Ce,[e("span",{class:x(["text-xs px-2 py-0.5 rounded",L(s.status)])},l(V(s.status)),3),e("span",{class:x(["text-xs px-2 py-0.5 rounded",s.isSeller?"bg-amber-500/20 text-amber-400":"bg-blue-500/20 text-blue-400"])},l(s.isSeller?"Vente":"Achat"),3),e("span",je," #"+l(s.contractId),1)]),e("p",Se,l(s.title||`${s.itemCount} item(s)`),1),e("p",De,[D(l(d(T)(s.dateIssued))+" ",1),s.dateExpired?(o(),r("span",Ee," - Expire: "+l(d(I)(s.dateExpired)),1)):n("",!0)])])]),e("div",Ie,[e("div",Te,[e("div",null,[t[15]||(t[15]=e("p",{class:"text-xs text-slate-500 uppercase"},"Prix contrat",-1)),e("p",Pe,l(d(p)(s.price)),1)]),s.jitaValue?(o(),r("div",Be,[t[16]||(t[16]=e("p",{class:"text-xs text-slate-500 uppercase"},"Jita",-1)),e("p",Ae,l(d(p)(s.jitaValue)),1),s.jitaDiffPercent!==null?(o(),r("p",{key:0,class:x(["text-xs",_(s.jitaDiff,s.isSeller)])},l(s.jitaDiff&&s.jitaDiff>=0?"+":"")+l((C=s.jitaDiffPercent)==null?void 0:C.toFixed(0))+"% ",3)):n("",!0)])):n("",!0),s.delveValue?(o(),r("div",Me,[t[17]||(t[17]=e("p",{class:"text-xs text-slate-500 uppercase"},"C-J6MT",-1)),e("p",Ve,l(d(p)(s.delveValue)),1),s.delveDiffPercent!==null?(o(),r("p",{key:0,class:x(["text-xs",_(s.delveDiff,s.isSeller)])},l(s.delveDiff&&s.delveDiff>=0?"+":"")+l((j=s.delveDiffPercent)==null?void 0:j.toFixed(0))+"% ",3)):n("",!0)])):n("",!0),s.similarCount>0?(o(),r("div",Le,[e("p",Fe,"Similaires ("+l(s.similarCount)+")",1),e("p",ze,l(d(p)(s.lowestSimilar)),1),s.similarDiffPercent!==null?(o(),r("p",{key:0,class:x(["text-xs",_(s.similarDiff,s.isSeller)])},l(s.similarDiff&&s.similarDiff>=0?"+":"")+l((S=s.similarDiffPercent)==null?void 0:S.toFixed(0))+"% ",3)):n("",!0)])):n("",!0),e("div",Je,[s.isCompetitive===!0?(o(),r("svg",Ne,[...t[18]||(t[18]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):s.isCompetitive===!1?(o(),r("svg",$e,[...t[19]||(t[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])])):(o(),r("span",He,"-"))])])])])],8,ke),f.value===s.contractId?(o(),r("div",Ue,[e("div",qe,[t[23]||(t[23]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider mb-3"},"Contenu du contrat",-1)),e("div",Oe,[(o(!0),r(g,null,k(s.items,i=>(o(),r("div",{key:i.typeId,class:"flex items-center gap-3 bg-slate-800/50 rounded-lg p-3"},[e("img",{src:d(P)(i.typeId,32),alt:i.typeName,class:"w-8 h-8 rounded",onError:t[2]||(t[2]=(...H)=>d(w)&&d(w)(...H))},null,40,Ge),e("div",Re,[e("p",Ke,l(i.typeName),1),e("p",Qe,"x"+l(i.quantity.toLocaleString()),1)]),e("div",We,[i.jitaPrice?(o(),r("div",Xe,[t[20]||(t[20]=e("p",{class:"text-xs text-slate-500"},"Jita",-1)),e("p",Ye,l(d(p)(i.jitaPrice))+"/u",1)])):n("",!0),i.delvePrice?(o(),r("div",Ze,[t[21]||(t[21]=e("p",{class:"text-xs text-slate-500"},"C-J6MT",-1)),e("p",et,l(d(p)(i.delvePrice))+"/u",1)])):n("",!0),!i.jitaPrice&&!i.delvePrice?(o(),r("div",tt,[...t[22]||(t[22]=[e("p",{class:"text-xs text-slate-600"},"N/A",-1)])])):n("",!0)])]))),128))])])])):n("",!0)])}),128))])])):(o(),r("div",st,[...t[25]||(t[25]=[e("svg",{class:"w-16 h-16 mx-auto text-slate-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-slate-400 text-lg"},"Aucun contrat trouve",-1),e("p",{class:"text-slate-500 text-sm mt-1"},"Creez des contrats Item Exchange pour les voir apparaitre ici",-1)])]))],64))]),_:1}))}});export{nt as default};
