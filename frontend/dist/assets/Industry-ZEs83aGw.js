import{B as De,r as f,C as q,d as fe,h as t,c as o,y as te,A as re,b as e,k as d,F as O,m as Z,v as pe,t as u,e as w,L as ie,n as U,x as _e,l as X,i as ye,T as Me,p as me,M as Ve,u as ze,o as Ce,q as ke,w as Je,j as He,N as Fe,z as Ue,a as Oe,O as qe}from"./index-eOzsbP3j.js";import{_ as Ke}from"./MainLayout.vue_vue_type_style_index_0_lang-BsVw6yHB.js";import{u as Be}from"./useFormatters-SlNtu6dn.js";import{u as Se}from"./useEveImages-B3tDia7r.js";import{_ as Xe}from"./ShoppingListResults.vue_vue_type_script_setup_true_lang-yJZ7kDGW.js";const we=De("industry",()=>{const _=f([]),i=f(null),g=f([]),h=f(null),r=f([]),C=f(null),b=f(!1),p=f(null),J=f(0);async function D(c){if(c.length<2){g.value=[];return}try{const x=await q(`/industry/search?q=${encodeURIComponent(c)}`);g.value=x.results}catch{g.value=[]}}async function H(c,x,S){p.value=null;try{const y=await q("/industry/projects",{method:"POST",body:JSON.stringify({typeId:c,runs:x,meLevel:S})});return _.value.unshift(y),y}catch(y){throw p.value=y instanceof Error?y.message:"Failed to create project",y}}async function A(){b.value=!0,p.value=null;try{const c=await q("/industry/projects");_.value=c.projects,J.value=c.totalProfit}catch(c){p.value=c instanceof Error?c.message:"Failed to fetch projects"}finally{b.value=!1}}async function k(c){b.value=!0,p.value=null;try{i.value=await q(`/industry/projects/${c}`)}catch(x){p.value=x instanceof Error?x.message:"Failed to fetch project"}finally{b.value=!1}}async function v(c,x){var S;p.value=null;try{const y=await q(`/industry/projects/${c}`,{method:"PATCH",body:JSON.stringify(x)}),R=_.value.findIndex(F=>F.id===c);return R!==-1&&(_.value[R]={..._.value[R],...y}),((S=i.value)==null?void 0:S.id)===c&&(i.value={...i.value,...y}),y}catch(y){throw p.value=y instanceof Error?y.message:"Failed to update project",y}}async function I(c){p.value=null;try{await q(`/industry/projects/${c}`,{method:"DELETE"}),_.value=_.value.filter(x=>x.id!==c)}catch(x){p.value=x instanceof Error?x.message:"Failed to delete project"}}async function M(c,x,S){var y;try{const R=await q(`/industry/projects/${c}/steps/${x}`,{method:"PATCH",body:JSON.stringify({purchased:S})});if((y=i.value)!=null&&y.steps){const F=i.value.steps.findIndex($=>$.id===x);F!==-1&&(i.value.steps[F]=R)}}catch(R){p.value=R instanceof Error?R.message:"Failed to update step"}}async function P(c,x,S){var y;try{const R=await q(`/industry/projects/${c}/steps/${x}`,{method:"PATCH",body:JSON.stringify(S)});if((y=i.value)!=null&&y.steps){const F=i.value.steps.findIndex($=>$.id===x);F!==-1&&(i.value.steps[F]=R)}return R}catch(R){throw p.value=R instanceof Error?R.message:"Failed to update step",R}}async function V(c,x){var S;try{const y=await q(`/industry/projects/${c}/steps/${x}`,{method:"PATCH",body:JSON.stringify({clearJobData:!0})});if((S=i.value)!=null&&S.steps){const R=i.value.steps.findIndex(F=>F.id===x);R!==-1&&(i.value.steps[R]=y)}return y}catch(y){throw p.value=y instanceof Error?y.message:"Failed to clear step job data",y}}async function T(c,x,S,y){var R;try{const F={typeId:x,runs:S};y&&(F.splitGroupId=y);const $=await q(`/industry/projects/${c}/steps`,{method:"POST",body:JSON.stringify(F)});return((R=i.value)==null?void 0:R.id)===c&&i.value.steps&&i.value.steps.push($),$}catch(F){throw p.value=F instanceof Error?F.message:"Failed to create step",F}}async function E(c,x,S,y){var R,F;try{const $={runs:y};if(x?$.splitGroupId=x:S&&($.stepId=S),S){const s=await q(`/industry/projects/${c}/steps`,{method:"POST",body:JSON.stringify($)});if(((R=i.value)==null?void 0:R.id)===c&&i.value.steps){const l=i.value.steps.findIndex(z=>z.id===S);l!==-1&&(i.value.steps[l]=s.updatedStep),i.value.steps.push(s.newStep)}return s.newStep}else{const s=await q(`/industry/projects/${c}/steps`,{method:"POST",body:JSON.stringify($)});return((F=i.value)==null?void 0:F.id)===c&&i.value.steps&&i.value.steps.push(s),s}}catch($){throw p.value=$ instanceof Error?$.message:"Failed to add child job",$}}async function m(c,x){var S;try{await q(`/industry/projects/${c}/steps/${x}`,{method:"DELETE"}),((S=i.value)==null?void 0:S.id)===c&&i.value.steps&&(i.value.steps=i.value.steps.filter(y=>y.id!==x))}catch(y){throw p.value=y instanceof Error?y.message:"Failed to delete step",y}}async function N(c,x,S){var y;try{const R=await q(`/industry/projects/${c}/steps/${x}`,{method:"PATCH",body:JSON.stringify({runs:S})});if(((y=i.value)==null?void 0:y.id)===c&&i.value.steps){const F=i.value.steps.findIndex($=>$.id===x);F!==-1&&(i.value.steps[F]=R)}return R}catch(R){throw p.value=R instanceof Error?R.message:"Failed to update step runs",R}}async function Q(c){var x;try{const S=await q(`/industry/projects/${c}/match-jobs`,{method:"POST"});return((x=i.value)==null?void 0:x.id)===c&&(i.value.steps=S.steps,i.value.jobsCost=S.jobsCost),S.warning}catch(S){return p.value=S instanceof Error?S.message:"Failed to match jobs",null}}async function ne(c,x,S){try{const y=new URLSearchParams;x&&y.set("structureId",x.toString()),S!==void 0&&y.set("transportCost",S.toString());const R=y.toString()?`?${y.toString()}`:"";return await q(`/industry/projects/${c}/shopping-list${R}`)}catch(y){return p.value=y instanceof Error?y.message:"Failed to fetch shopping list",null}}async function G(){try{h.value=await q("/industry/blacklist")}catch(c){p.value=c instanceof Error?c.message:"Failed to fetch blacklist"}}async function se(c,x){try{h.value=await q("/industry/blacklist",{method:"PUT",body:JSON.stringify({groupIds:c,typeIds:x})})}catch(S){p.value=S instanceof Error?S.message:"Failed to update blacklist"}}async function ve(c){if(c.length<2)return[];try{return(await q(`/industry/blacklist/search?q=${encodeURIComponent(c)}`)).results}catch{return[]}}async function le(){try{const c=await q("/industry/structures");r.value=c.structures,C.value=c.rigOptions}catch(c){p.value=c instanceof Error?c.message:"Failed to fetch structures"}}async function ee(c){try{const x=await q("/industry/structures",{method:"POST",body:JSON.stringify({...c,isDefault:!1})});return r.value.push(x),x}catch(x){throw p.value=x instanceof Error?x.message:"Failed to create structure",x}}async function ae(c,x){try{const S=await q(`/industry/structures/${c}`,{method:"PATCH",body:JSON.stringify(x)}),y=r.value.findIndex(R=>R.id===c);return y!==-1&&(r.value[y]=S),S}catch(S){throw p.value=S instanceof Error?S.message:"Failed to update structure",S}}async function ue(c){try{await q(`/industry/structures/${c}`,{method:"DELETE"}),r.value=r.value.filter(x=>x.id!==c)}catch(x){throw p.value=x instanceof Error?x.message:"Failed to delete structure",x}}function de(){p.value=null}return{projects:_,currentProject:i,searchResults:g,blacklist:h,structures:r,rigOptions:C,isLoading:b,error:p,totalProfit:J,searchProducts:D,createProject:H,fetchProjects:A,fetchProject:k,updateProject:v,deleteProject:I,toggleStepPurchased:M,updateStepJobData:P,clearStepJobData:V,matchJobs:Q,fetchShoppingList:ne,fetchBlacklist:G,updateBlacklist:se,searchBlacklistItems:ve,fetchStructures:le,createStructure:ee,updateStructure:ae,deleteStructure:ue,createStep:T,addChildJob:E,deleteStep:m,updateStepRuns:N,clearError:de}}),Qe={class:"relative"},We={key:0,class:"absolute z-20 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto"},Ye=["onMousedown"],Ze=["src"],Ge=fe({__name:"ProductSearch",emits:["select"],setup(_,{emit:i}){const g=i,h=we(),r=f(""),C=f(!1);let b=null;function p(){if(b&&clearTimeout(b),r.value.length<2){h.searchResults=[],C.value=!1;return}b=setTimeout(async()=>{await h.searchProducts(r.value),C.value=h.searchResults.length>0},300)}function J(H){g("select",H),r.value=H.typeName,C.value=!1,h.searchResults=[]}function D(){setTimeout(()=>{C.value=!1},200)}return(H,A)=>(t(),o("div",Qe,[te(e("input",{"onUpdate:modelValue":A[0]||(A[0]=k=>r.value=k),onInput:p,onFocus:A[1]||(A[1]=k=>C.value=d(h).searchResults.length>0),onBlur:D,type:"text",placeholder:"Rechercher un produit (ex: Nomad, Raven...)",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-cyan-500 pr-10"},null,544),[[re,r.value]]),A[3]||(A[3]=e("svg",{class:"absolute right-3 top-3 w-4 h-4 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),C.value&&d(h).searchResults.length>0?(t(),o("div",We,[(t(!0),o(O,null,Z(d(h).searchResults,k=>(t(),o("button",{key:k.typeId,onMousedown:pe(v=>J(k),["prevent"]),class:"w-full px-4 py-2.5 text-left hover:bg-slate-700 text-sm flex items-center gap-3 transition-colors"},[e("img",{src:`https://images.evetech.net/types/${k.typeId}/icon?size=32`,class:"w-6 h-6 rounded",onError:A[2]||(A[2]=v=>v.target.style.display="none")},null,40,Ze),e("span",null,u(k.typeName),1)],40,Ye))),128))])):w("",!0)]))}});function et(_){if(!_||_.trim()==="")return null;let i=_.trim().replace(/[\s,]/g,"");const g=i.slice(-1).toLowerCase();let h=1;g==="k"?(h=1e3,i=i.slice(0,-1)):g==="m"?(h=1e6,i=i.slice(0,-1)):g==="b"&&(h=1e9,i=i.slice(0,-1));const r=parseFloat(i);return isNaN(r)?null:Math.round(r*h*100)/100}const tt={class:"overflow-x-auto"},st={class:"w-full text-sm"},ot={class:"divide-y divide-slate-800"},nt={class:"py-3 px-3"},lt=["onClick"],rt={class:"py-3 px-2"},at=["onKeydown","onBlur"],it=["onDblclick","title"],ut={class:"py-3 px-2 text-slate-300"},dt={class:"py-3 px-2 text-center"},ct=["onClick","disabled","title"],pt=["onKeydown","onBlur"],vt=["onDblclick","title"],mt={class:"py-3 px-2 text-right font-mono text-slate-400"},xt=["onKeydown","onBlur"],ft=["onDblclick","title"],bt={class:"py-3 px-2 text-center"},yt=["onClick"],ht={class:"py-3 px-2 text-center"},gt={class:"flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},kt=["onClick"],wt=["onClick"],$t={key:0},_t={class:"border-t border-slate-600 font-semibold text-slate-200"},Ct={key:0,class:"text-center py-12 text-slate-500"},St=fe({__name:"ProjectTable",emits:["view-project"],setup(_,{emit:i}){const g=i,h=we(),{formatIsk:r}=Be(),C=f(null),b=f("");function p(T,E){if(T.status==="completed")return;const m=T[E];b.value=m!=null?String(m):"",C.value={id:T.id,field:E}}async function J(T){if(!C.value)return;const E=C.value.field;let m;if(E==="runs"){const N=parseInt(b.value,10);m=isNaN(N)||N<1?T.runs:N}else m=et(b.value);C.value=null,await h.updateProject(T.id,{[E]:m}),await h.fetchProjects()}function D(){C.value=null}function H(T,E){var m,N;return((m=C.value)==null?void 0:m.id)===T&&((N=C.value)==null?void 0:N.field)===E}function A(T){return T==null?"-":r(T)}function k(T){return T==null?"text-slate-400":T>=0?"text-emerald-400":"text-red-400"}async function v(T){const E=T.status==="active"?"completed":"active";await h.updateProject(T.id,{status:E}),await h.fetchProjects()}async function I(T){await h.deleteProject(T)}async function M(T){T.status!=="completed"&&(await h.updateProject(T.id,{personalUse:!T.personalUse}),await h.fetchProjects())}const P=["bpoCost","materialCost","transportCost"],V=["taxAmount","sellPrice"];return(T,E)=>(t(),o("div",tt,[e("table",st,[E[11]||(E[11]=e("thead",null,[e("tr",{class:"border-b border-slate-700 text-slate-400 text-xs uppercase tracking-wider"},[e("th",{class:"text-left py-3 px-3"},"Produit"),e("th",{class:"text-left py-3 px-2"},"Runs"),e("th",{class:"text-left py-3 px-2"},"ME"),e("th",{class:"text-center py-3 px-2"},"Perso"),e("th",{class:"text-right py-3 px-2"},"BPC Kit"),e("th",{class:"text-right py-3 px-2"},"Matériaux"),e("th",{class:"text-right py-3 px-2"},"Transport"),e("th",{class:"text-right py-3 px-2"},"Jobs"),e("th",{class:"text-right py-3 px-2"},"Taxes"),e("th",{class:"text-right py-3 px-2"},"Vente"),e("th",{class:"text-right py-3 px-2"},"Profit"),e("th",{class:"text-right py-3 px-2"},"%"),e("th",{class:"text-center py-3 px-2"},"Status"),e("th",{class:"text-center py-3 px-2"})])],-1)),e("tbody",ot,[(t(!0),o(O,null,Z(d(h).projects,m=>(t(),o("tr",{key:m.id,class:"hover:bg-slate-800/50 group"},[e("td",nt,[e("button",{onClick:N=>g("view-project",m.id),class:"text-cyan-400 hover:text-cyan-300 font-medium"},u(m.productTypeName),9,lt)]),e("td",rt,[H(m.id,"runs")?te((t(),o("input",{key:0,"onUpdate:modelValue":E[0]||(E[0]=N=>b.value=N),type:"number",min:"1",class:"w-16 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-sm focus:outline-none",onKeydown:[ie(N=>J(m),["enter"]),ie(D,["escape"])],onBlur:N=>J(m),autofocus:""},null,40,at)),[[re,b.value]]):(t(),o("span",{key:1,onDblclick:N=>p(m,"runs"),class:U(["text-slate-300",m.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:m.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},u(m.runs),43,it))]),e("td",ut,u(m.meLevel),1),e("td",dt,[e("button",{onClick:N=>M(m),disabled:m.status==="completed",class:U(["text-xs px-2 py-1 rounded",m.personalUse?"bg-amber-500/20 text-amber-400":"bg-slate-600/20 text-slate-500",m.status==="completed"?"opacity-50 cursor-not-allowed":""]),title:m.status==="completed"?"Projet terminé":m.personalUse?"Usage personnel":"À vendre"},u(m.personalUse?"Perso":"Vente"),11,ct)]),(t(),o(O,null,Z(P,N=>e("td",{key:N,class:"py-3 px-2 text-right"},[H(m.id,N)?te((t(),o("input",{key:0,"onUpdate:modelValue":E[1]||(E[1]=Q=>b.value=Q),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[ie(Q=>J(m),["enter"]),ie(D,["escape"])],onBlur:Q=>J(m),autofocus:""},null,40,pt)),[[re,b.value]]):(t(),o("span",{key:1,onDblclick:Q=>p(m,N),class:U(["font-mono text-slate-300",m.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:m.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},u(A(m[N])),43,vt))])),64)),e("td",mt,u(A(m.jobsCost)),1),m.personalUse?(t(),o(O,{key:1},[E[3]||(E[3]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),E[4]||(E[4]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),E[5]||(E[5]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),E[6]||(E[6]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1))],64)):(t(),o(O,{key:0},[(t(),o(O,null,Z(V,N=>e("td",{key:N,class:"py-3 px-2 text-right"},[H(m.id,N)?te((t(),o("input",{key:0,"onUpdate:modelValue":E[2]||(E[2]=Q=>b.value=Q),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[ie(Q=>J(m),["enter"]),ie(D,["escape"])],onBlur:Q=>J(m),autofocus:""},null,40,xt)),[[re,b.value]]):(t(),o("span",{key:1,onDblclick:Q=>p(m,N),class:U(["font-mono text-slate-300",m.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:m.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},u(A(m[N])),43,ft))])),64)),e("td",{class:U(["py-3 px-2 text-right font-mono",k(m.profit)])},u(A(m.profit)),3),e("td",{class:U(["py-3 px-2 text-right font-mono",k(m.profitPercent)])},u(m.profitPercent!==null?`${m.profitPercent}%`:"-"),3)],64)),e("td",bt,[e("button",{onClick:N=>v(m),class:U(["text-xs px-2 py-1 rounded",m.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-cyan-500/20 text-cyan-400"])},u(m.status==="completed"?"Terminé":"Actif"),11,yt)]),e("td",ht,[e("div",gt,[e("button",{onClick:N=>g("view-project",m.id),class:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-cyan-400",title:"Détails"},[...E[7]||(E[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,kt),e("button",{onClick:N=>I(m.id),class:"p-1 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400",title:"Supprimer"},[...E[8]||(E[8]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,wt)])])]))),128))]),d(h).projects.length>0?(t(),o("tfoot",$t,[e("tr",_t,[E[9]||(E[9]=e("td",{colspan:"10",class:"py-3 px-3 text-right"},"Total Profit",-1)),e("td",{class:U(["py-3 px-2 text-right font-mono",k(d(h).totalProfit)])},u(A(d(h).totalProfit)),3),E[10]||(E[10]=e("td",{colspan:"3"},null,-1))])])):w("",!0)]),d(h).projects.length===0?(t(),o("div",Ct," Aucun projet. Créez votre premier projet de construction ci-dessus. ")):w("",!0)]))}}),jt={class:"space-y-6"},Pt={class:"text-xs font-semibold uppercase tracking-wider text-slate-500 mb-2"},Tt={class:"space-y-1"},Mt=["onClick"],Bt=["src"],Et={class:"flex-1 min-w-0"},It={class:"flex items-center gap-2 flex-wrap"},Rt={class:"font-medium text-slate-200"},At={key:0,class:"text-xs text-slate-500"},Lt=["title"],Nt={class:"text-emerald-400"},Jt={class:"flex items-center gap-3 mt-1 text-xs"},Dt={key:0,class:"text-red-400"},Vt={key:1,class:"text-slate-500"},zt={key:2,class:"text-cyan-400"},Ht={key:3,class:"text-emerald-400"},Ft=["checked","disabled","onChange"],Ut=["src"],Ot={class:"flex-1 min-w-0"},qt={class:"flex items-center gap-2 flex-wrap"},Kt={class:"font-medium text-slate-200"},Xt={class:"text-xs text-slate-500"},Qt={key:0,class:"inline-flex items-center gap-1"},Wt=["onKeydown","onBlur"],Yt=["onDblclick"],Zt=["title"],Gt={key:2,class:"text-xs text-slate-500"},es={key:3,class:"text-xs px-1.5 py-0.5 rounded bg-blue-500/20 text-blue-400",title:"Lié à un job ESI"},ts={key:0,class:"flex items-center gap-2 mt-1 text-xs flex-wrap"},ss={key:0,class:"text-slate-500"},os={key:1,class:"text-slate-600"},ns={key:2,class:"text-slate-500"},ls={key:3,class:"text-amber-400"},rs=["checked","disabled","onChange"],as={key:0,class:"text-xs font-mono text-slate-400"},is=["onClick"],us={key:2,class:"w-7"},ds={key:0,class:"flex items-center gap-3 p-3 ml-6 rounded-lg border border-dashed border-slate-600 hover:border-cyan-500/50 transition-colors"},cs={key:0,class:"flex items-center gap-2 flex-1"},ps=["onKeydown"],vs=["onClick"],ms=["onClick"],xs={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},fs={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 p-6"},bs={class:"text-slate-400 mb-6"},ys={class:"text-slate-200 font-medium"},hs=fe({__name:"StepTree",props:{steps:{},readonly:{type:Boolean}},emits:["toggle-purchased","update-step-runs","delete-step","add-child-job"],setup(_,{emit:i}){const g=_,h=i,r=f(null),C=f(0),b=f(null),p=f(1),J=f(null),D=f(!1),H=f(null),A=f("");_e(()=>g.steps,s=>{if(J.value){const l=s.find(z=>z.id===J.value);l!=null&&l.splitGroupId&&M.value.add(l.splitGroupId),J.value=null}},{deep:!0});const{formatIsk:k}=Be(),{getTypeIconUrl:v,onImageError:I}=Se(),M=f(new Set);function P(s){M.value.has(s)?M.value.delete(s):M.value.add(s)}function V(s){return s.purchased?3:s.esiJobStatus==="delivered"||s.esiJobStatus==="ready"?2:s.esiJobStatus==="active"?1:0}function T(s){return s.children.length===0?99:Math.min(...s.children.map(V))}function E(s){let l=0,z=0,j=0;for(const a of s)a.purchased||(a.esiJobId?a.esiJobStatus==="active"?z+=a.runs:a.esiJobStatus==="delivered"||a.esiJobStatus==="ready"?j+=a.runs:z+=a.runs:l+=a.runs);return{toLaunch:l,inProgress:z,completed:j}}const m=me(()=>{const s=new Map;for(const a of g.steps){const L=a.isSplit&&a.splitGroupId?a.splitGroupId:`single_${a.id}`;let K=s.get(L);K||(K={splitGroupId:L,productTypeName:a.productTypeName,productTypeId:a.productTypeId,activityType:a.activityType,depth:a.depth,totalExpectedRuns:a.isSplit?a.totalGroupRuns??a.runs:a.runs,children:[],actualTotalRuns:0,isValid:!1,runsToLaunch:0,runsInProgress:0,runsCompleted:0,recommendedStructureName:a.recommendedStructureName,structureBonus:a.structureBonus},s.set(L,K)),K.children.push(a)}for(const a of s.values()){a.children.sort((K,Y)=>Y.runs-K.runs),a.actualTotalRuns=a.children.reduce((K,Y)=>K+Y.runs,0),a.isValid=a.actualTotalRuns===a.totalExpectedRuns;const L=E(a.children);a.runsToLaunch=L.toLaunch,a.runsInProgress=L.inProgress,a.runsCompleted=L.completed}const l=new Map;for(const a of s.values()){if(a.children.length===0)continue;const L=a.children[0],K=N(L);let Y=l.get(K);Y||(Y={label:K,items:[]},l.set(K,Y)),Y.items.push(a)}const z=Array.from(l.values());for(const a of z)a.items.sort((L,K)=>{const Y=T(L)-T(K);return Y!==0?Y:L.productTypeName.localeCompare(K.productTypeName)});const j={copy:0,reaction:1,manufacturing:2};return z.sort((a,L)=>{var B,n,oe,ce;const K=Math.min(...a.items.map(T)),Y=Math.min(...L.items.map(T));if(K!==Y)return K-Y;const je=(B=a.items[0])==null?void 0:B.activityType,Pe=(n=L.items[0])==null?void 0:n.activityType,xe=(j[je??""]??99)-(j[Pe??""]??99);if(xe!==0)return xe;const $e=((oe=a.items[0])==null?void 0:oe.depth)??0;return(((ce=L.items[0])==null?void 0:ce.depth)??0)-$e}),z});function N(s){return`${s.activityType==="reaction"?"Réactions":s.activityType==="copy"?"Copies (BPC)":"Manufacturing"} — Niveau ${s.depth}`}function Q(s){return s==="reaction"?"bg-purple-500/20 text-purple-400":s==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function ne(s){return s==="reaction"?"Réaction":s==="copy"?"BPC":"Fab"}function G(s){return s.esiJobId!==null}function se(s){return s.purchased?"Acheté":s.esiJobStatus==="active"?"En cours":s.esiJobStatus==="delivered"||s.esiJobStatus==="ready"?"Terminé":"À lancer"}function ve(s){return s.purchased?"bg-amber-500/20 text-amber-400":s.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":s.esiJobStatus==="delivered"||s.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400"}function le(s){g.readonly||h("toggle-purchased",s.id,!s.purchased)}function ee(s){return s.length>0&&s.every(l=>l.purchased)}function ae(s){if(g.readonly)return;const l=!ee(s);for(const z of s)z.purchased!==l&&h("toggle-purchased",z.id,l)}function ue(s,l){g.readonly||(H.value=s,A.value=l,D.value=!0)}function de(){H.value&&h("delete-step",H.value),D.value=!1,H.value=null,A.value=""}function c(){D.value=!1,H.value=null,A.value=""}function x(s){g.readonly||(r.value=s.id,C.value=s.runs)}function S(s){C.value>=1&&h("update-step-runs",s,C.value),r.value=null}function y(){r.value=null}function R(s){g.readonly||(b.value=s,p.value=1)}function F(s,l){p.value>=1&&(s.startsWith("single_")?(J.value=l,h("add-child-job",null,l,p.value)):(M.value.add(s),h("add-child-job",s,null,p.value))),b.value=null}function $(){b.value=null}return(s,l)=>(t(),o("div",jt,[(t(!0),o(O,null,Z(m.value,z=>(t(),o("div",{key:z.label},[e("h5",Pt,u(z.label),1),e("div",Tt,[(t(!0),o(O,null,Z(z.items,j=>(t(),o(O,{key:j.splitGroupId},[e("div",{class:U(["flex items-center gap-3 p-3 rounded-lg border cursor-pointer",[j.isValid?"bg-slate-800/70 border-slate-600":"bg-red-900/20 border-red-500/50"]]),onClick:a=>P(j.splitGroupId)},[(t(),o("svg",{class:U(["w-4 h-4 text-slate-400 transition-transform",{"rotate-90":M.value.has(j.splitGroupId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...l[8]||(l[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),e("img",{src:d(v)(j.productTypeId,32),class:"w-8 h-8 rounded",onError:l[0]||(l[0]=(...a)=>d(I)&&d(I)(...a))},null,40,Bt),e("div",Et,[e("div",It,[e("span",Rt,u(j.productTypeName),1),j.children.length>1?(t(),o("span",At,"("+u(j.children.length)+" jobs)",1)):w("",!0),e("span",{class:U(["text-xs px-1.5 py-0.5 rounded",Q(j.activityType)])},u(ne(j.activityType)),3),j.recommendedStructureName?(t(),o("span",{key:1,class:"text-xs text-slate-500 flex items-center gap-1",title:`Bonus: ${j.structureBonus}%`},[l[9]||(l[9]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),X(" "+u(j.recommendedStructureName)+" ",1),e("span",Nt,"("+u(j.structureBonus)+"%)",1)],8,Lt)):w("",!0)]),e("div",Jt,[e("span",{class:U(["font-mono",j.isValid?"text-slate-400":"text-red-400"])},u(j.actualTotalRuns)+" / "+u(j.totalExpectedRuns)+" runs ",3),j.isValid?w("",!0):(t(),o("span",Dt," ("+u(j.actualTotalRuns>j.totalExpectedRuns?"+":"")+u(j.actualTotalRuns-j.totalExpectedRuns)+") ",1)),j.runsToLaunch>0?(t(),o("span",Vt,u(j.runsToLaunch)+" à lancer ",1)):w("",!0),j.runsInProgress>0?(t(),o("span",zt,u(j.runsInProgress)+" en cours ",1)):w("",!0),j.runsCompleted>0?(t(),o("span",Ht,u(j.runsCompleted)+" terminés ",1)):w("",!0)])]),e("label",{class:U(["flex items-center gap-1.5",_.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:l[1]||(l[1]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:ee(j.children),disabled:_.readonly,onChange:a=>ae(j.children),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,Ft),l[10]||(l[10]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)],10,Mt),M.value.has(j.splitGroupId)?(t(),o(O,{key:0},[(t(!0),o(O,null,Z(j.children,a=>(t(),o("div",{key:a.id,class:"flex items-center gap-3 p-3 ml-6 rounded-lg bg-slate-800/50 border border-slate-700"},[e("img",{src:d(v)(a.productTypeId,32),class:"w-8 h-8 rounded",onError:l[2]||(l[2]=(...L)=>d(I)&&d(I)(...L))},null,40,Ut),e("div",Ot,[e("div",qt,[e("span",Kt,u(a.productTypeName),1),e("span",Xt,"×"+u(a.quantity.toLocaleString()),1),!G(a)&&!_.readonly?(t(),o(O,{key:0},[r.value===a.id?(t(),o("span",Qt,[l[11]||(l[11]=e("span",{class:"text-xs text-slate-600"},"(",-1)),te(e("input",{"onUpdate:modelValue":l[3]||(l[3]=L=>C.value=L),type:"number",min:"1",class:"w-16 px-1 py-0.5 bg-slate-700 border border-cyan-500 rounded text-xs text-slate-200 focus:outline-none",onKeydown:[ie(L=>S(a.id),["enter"]),ie(y,["escape"])],onBlur:L=>S(a.id),onFocus:l[4]||(l[4]=L=>L.target.select()),onClick:l[5]||(l[5]=pe(()=>{},["stop"])),autofocus:""},null,40,Wt),[[re,C.value,void 0,{number:!0}]]),l[12]||(l[12]=e("span",{class:"text-xs text-slate-600"},"runs)",-1))])):(t(),o("span",{key:1,onDblclick:pe(L=>x(a),["stop"]),class:"text-xs text-slate-600 cursor-pointer hover:text-cyan-400",title:"Double-cliquer pour modifier"}," ("+u(a.runs)+" runs) ",41,Yt))],64)):(t(),o("span",{key:1,class:"text-xs text-slate-600",title:G(a)?"Lié à ESI - non modifiable":"Projet terminé"}," ("+u(a.runs)+" runs) ",9,Zt)),a.isSplit?(t(),o("span",Gt,"#"+u(a.splitIndex+1),1)):w("",!0),G(a)?(t(),o("span",es," ESI ")):w("",!0)]),a.esiJobId||a.manualJobData?(t(),o("div",ts,[a.esiJobCharacterName?(t(),o("span",ss,u(a.esiJobCharacterName),1)):w("",!0),a.esiJobsCount&&a.esiJobsCount>1?(t(),o("span",os," ("+u(a.esiJobsCount)+" jobs) ",1)):w("",!0),e("span",{class:U(["font-mono",a.esiJobsTotalRuns&&a.esiJobsTotalRuns>=a.runs?"text-emerald-400":"text-amber-400"])},u(a.esiJobsTotalRuns||a.esiJobRuns||0)+" / "+u(a.runs)+" runs ",3),a.esiJobsActiveRuns||a.esiJobsDeliveredRuns?(t(),o("span",ns," ("+u(a.esiJobsDeliveredRuns||0)+" livrés, "+u(a.esiJobsActiveRuns||0)+" en cours) ",1)):w("",!0),a.manualJobData?(t(),o("span",ls,"(manuel)")):w("",!0)])):w("",!0)]),e("span",{class:U(["text-xs px-2 py-1 rounded",ve(a)])},u(se(a)),3),e("label",{class:U(["flex items-center gap-1.5",_.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:l[6]||(l[6]=pe(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:a.purchased,disabled:_.readonly,onChange:L=>le(a),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,rs),l[13]||(l[13]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2),a.esiJobCost?(t(),o("span",as,u(d(k)(a.esiJobCost)),1)):w("",!0),!G(a)&&!_.readonly?(t(),o("button",{key:1,onClick:pe(L=>ue(a.id,a.productTypeName),["stop"]),class:"p-1.5 text-slate-500 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer cette étape"},[...l[14]||(l[14]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,is)):(t(),o("div",us))]))),128)),_.readonly?w("",!0):(t(),o("div",ds,[b.value===j.splitGroupId?(t(),o("div",cs,[l[15]||(l[15]=e("span",{class:"text-sm text-slate-400"},"Runs:",-1)),te(e("input",{"onUpdate:modelValue":l[7]||(l[7]=a=>p.value=a),type:"number",min:"1",class:"w-20 px-2 py-1 bg-slate-700 border border-cyan-500 rounded text-sm text-slate-200 focus:outline-none",onKeydown:[ie(a=>{var L;return F(j.splitGroupId,(L=j.children[0])==null?void 0:L.id)},["enter"]),ie($,["escape"])],autofocus:""},null,40,ps),[[re,p.value,void 0,{number:!0}]]),e("button",{onClick:a=>{var L;return F(j.splitGroupId,(L=j.children[0])==null?void 0:L.id)},class:"px-3 py-1 bg-cyan-600 hover:bg-cyan-500 rounded text-sm text-white"}," Ajouter ",8,vs),e("button",{onClick:$,class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm text-slate-300"}," Annuler ")])):(t(),o("button",{key:1,onClick:a=>R(j.splitGroupId),class:"flex items-center gap-2 text-slate-500 hover:text-cyan-400 transition-colors"},[...l[16]||(l[16]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"text-sm"},"Ajouter un job",-1)])],8,ms))]))],64)):w("",!0)],64))),128))])]))),128)),(t(),ye(Me,{to:"body"},[D.value?(t(),o("div",xs,[e("div",{class:"absolute inset-0 bg-black/70",onClick:c}),e("div",fs,[l[19]||(l[19]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-2"},"Supprimer l'étape",-1)),e("p",bs,[l[17]||(l[17]=X(" Voulez-vous vraiment supprimer l'étape ",-1)),e("span",ys,'"'+u(A.value)+'"',1),l[18]||(l[18]=X(" ? ",-1))]),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:c,class:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg text-slate-300 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:de,class:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white text-sm font-medium transition-colors"}," Supprimer ")])])])):w("",!0)]))]))}}),gs={class:"space-y-2"},ks={class:"bg-slate-800/50 border border-slate-700 rounded-lg p-3"},ws={class:"flex items-center gap-3"},$s=["src"],_s={class:"flex-1 min-w-0"},Cs={class:"flex items-center gap-2 flex-wrap"},Ss={class:"font-medium text-slate-200"},js={class:"text-xs text-slate-500"},Ps={class:"text-xs text-slate-600"},Ts={key:0,class:"text-xs text-slate-500 flex items-center gap-1 mt-1"},Ms={class:"text-emerald-400"},Bs=["checked","disabled"],Es={key:0,class:"pl-6 border-l-2 border-slate-700 ml-4 space-y-2"},Is={key:0,class:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-2"},Rs={class:"flex items-center gap-2"},As=["src"],Ls={class:"text-sm text-slate-400"},Ns={class:"text-xs text-slate-500 ml-auto"},Js=fe({__name:"StepHierarchyTree",props:{tree:{},steps:{},readonly:{type:Boolean}},emits:["toggle-purchased"],setup(_,{emit:i}){const g=_,h=i,{getTypeIconUrl:r,onImageError:C}=Se();function b(k){return g.steps.find(v=>v.blueprintTypeId===k.blueprintTypeId&&v.activityType===k.activityType)}function p(k){return k==="reaction"?"bg-purple-500/20 text-purple-400":k==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function J(k){return k==="reaction"?"Réaction":k==="copy"?"BPC":"Fab"}function D(k){return k?k.purchased?"Acheté":k.esiJobStatus==="active"?"En cours":k.esiJobStatus==="delivered"||k.esiJobStatus==="ready"?"Terminé":"À lancer":"-"}function H(k){return k?k.purchased?"bg-amber-500/20 text-amber-400":k.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":k.esiJobStatus==="delivered"||k.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400":"bg-slate-500/20 text-slate-400"}function A(k){g.readonly||h("toggle-purchased",k.id,!k.purchased)}return(k,v)=>{var M;const I=Ve("StepHierarchyTree",!0);return t(),o("div",gs,[e("div",ks,[e("div",ws,[e("img",{src:d(r)(_.tree.productTypeId,32),class:"w-8 h-8 rounded",onError:v[0]||(v[0]=(...P)=>d(C)&&d(C)(...P))},null,40,$s),e("div",_s,[e("div",Cs,[e("span",Ss,u(_.tree.productTypeName),1),e("span",js,"×"+u(_.tree.quantity.toLocaleString()),1),e("span",Ps,"("+u(_.tree.runs)+" runs)",1),e("span",{class:U(["text-xs px-1.5 py-0.5 rounded",p(_.tree.activityType)])},u(J(_.tree.activityType)),3)]),_.tree.structureName?(t(),o("div",Ts,[v[4]||(v[4]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),X(" "+u(_.tree.structureName)+" ",1),e("span",Ms,"("+u(_.tree.structureBonus)+"%)",1)])):w("",!0)]),b(_.tree)?(t(),o(O,{key:0},[e("span",{class:U(["text-xs px-2 py-1 rounded",H(b(_.tree))])},u(D(b(_.tree))),3),e("label",{class:U(["flex items-center gap-1.5",_.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"])},[e("input",{type:"checkbox",checked:(M=b(_.tree))==null?void 0:M.purchased,disabled:_.readonly,onChange:v[1]||(v[1]=P=>A(b(_.tree))),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,Bs),v[5]||(v[5]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)],64)):w("",!0)])]),_.tree.materials&&_.tree.materials.length>0?(t(),o("div",Es,[(t(!0),o(O,null,Z(_.tree.materials,P=>(t(),o("div",{key:P.typeId,class:"relative"},[v[6]||(v[6]=e("div",{class:"absolute -left-6 top-4 w-6 h-0.5 bg-slate-700"},null,-1)),P.isBuildable?P.blueprint?(t(),ye(I,{key:1,tree:P.blueprint,steps:_.steps,readonly:_.readonly,onTogglePurchased:v[3]||(v[3]=(V,T)=>h("toggle-purchased",V,T))},null,8,["tree","steps","readonly"])):w("",!0):(t(),o("div",Is,[e("div",Rs,[e("img",{src:d(r)(P.typeId,32),class:"w-6 h-6 rounded",onError:v[2]||(v[2]=(...V)=>d(C)&&d(C)(...V))},null,40,As),e("span",Ls,u(P.typeName),1),e("span",Ns,"×"+u(P.quantity.toLocaleString()),1)])]))]))),128))])):w("",!0)])}}}),Ds={class:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden"},Vs={class:"px-6 py-4 border-b border-slate-800 flex items-center justify-between"},zs={class:"flex items-center gap-4"},Hs={key:0,class:"flex items-center gap-3"},Fs=["src"],Us={class:"text-lg font-semibold text-slate-100"},Os={class:"text-sm text-slate-500"},qs={class:"flex items-center gap-2"},Ks=["disabled"],Xs={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qs={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ws={class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ys={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},Zs={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},Gs={key:0,class:"p-8 text-center text-slate-500"},eo={key:1,class:"p-6"},to={key:0,class:"mb-4 p-3 bg-amber-500/20 border border-amber-500/50 rounded-lg flex items-center gap-3"},so={class:"text-amber-200 text-sm"},oo={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},no={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},lo={class:"text-lg font-mono text-slate-200 mt-1"},ro={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},ao={class:"text-lg font-mono text-slate-200 mt-1"},io={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},uo={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},co={class:"flex gap-4 mb-4 border-b border-slate-700"},po=["disabled","title"],vo={key:1},mo={class:"mb-4 flex items-center justify-between"},xo={class:"flex items-center gap-4"},fo={class:"flex items-center gap-1 bg-slate-800 rounded-lg p-1"},bo={key:0},yo={key:0},ho={key:1,class:"text-center py-8 text-slate-500"},go={key:1},ko={key:0},wo={key:1,class:"text-center py-8 text-slate-500"},$o={key:2},_o={key:0,class:"text-center py-8 text-slate-500"},Co={key:1,class:"text-center py-8"},So={class:"bg-red-900/20 border border-red-500/30 rounded-xl p-6 max-w-md mx-auto"},jo={class:"text-slate-400 text-sm mb-4"},Po={key:2,class:"text-center py-8 text-slate-500"},To={key:3},Mo={key:0,class:"mb-4 flex flex-wrap items-center gap-4"},Bo={class:"relative min-w-[280px]"},Eo={class:"relative"},Io=["placeholder"],Ro={class:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center"},Ao={key:0,class:"w-4 h-4 animate-spin text-cyan-400",fill:"none",viewBox:"0 0 24 24"},Lo={key:0,class:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-48 overflow-y-auto"},No=["onMousedown"],Jo={class:"truncate"},Do={key:0,class:"px-3 py-2 text-slate-400 text-sm"},Vo={class:"flex items-center gap-2"},zo={key:0,class:"flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg border border-slate-700"},Ho={class:"text-sm text-slate-400"},Fo={class:"font-mono text-slate-200"},Uo={class:"font-mono text-emerald-400"},Oo={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},qo={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},Ko={class:"px-6 py-4"},Xo={class:"px-6 py-4 border-t border-slate-700 flex justify-end gap-3"},Qo=["disabled"],Wo={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Yo={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Zo="C-J6MT - 1st Taj Mahgoon",Go=fe({__name:"ProjectDetail",props:{projectId:{}},emits:["close"],setup(_,{emit:i}){const g=_,h=i,r=we(),C=ze(),{formatIsk:b,formatDateTime:p}=Be(),{getTypeIconUrl:J,onImageError:D}=Se(),H=f("steps"),A=f("flat"),k=f([]),v=f(""),I=f(!1),M=f(!1),P=f(null),V=f(null),T=f(null),E=f(!1),m=f(!1),N=f(1200),Q=f(!1),ne=f(null),G=f(!1),se=f(""),ve=f(!1),le=f({id:null,name:""}),ee=f(""),ae=f([]),ue=f(!1),de=f(!1);let c=null;_e(ee,B=>{if(c&&clearTimeout(c),B.length<3){ae.value=[];return}c=setTimeout(()=>{x(B)},300)});async function x(B){ue.value=!0;try{const n=await He(`/api/shopping-list/search-structures?q=${encodeURIComponent(B)}`,{headers:{Authorization:`Bearer ${C.token}`,"X-Requested-With":"XMLHttpRequest"}});if(n.ok){const oe=await Fe(n);ae.value=oe.results,de.value=!0}}catch(n){console.error("Structure search failed:",n)}finally{ue.value=!1}}function S(B){le.value={id:B.id,name:B.name},ee.value="",ae.value=[],de.value=!1}function y(){le.value={id:null,name:""},ee.value="",ae.value=[]}function R(){setTimeout(()=>{de.value=!1},200)}Ce(()=>{r.fetchProject(g.projectId)});async function F(B,n){await r.toggleStepPurchased(g.projectId,B,n),H.value==="shopping"&&await l()}async function $(){Q.value=!0,ne.value=null;try{const B=await r.matchJobs(g.projectId);ne.value=B,await r.fetchProject(g.projectId)}finally{Q.value=!1}}function s(B){return Math.ceil(B/1e6)*1e6}async function l(){E.value=!0,T.value=null;try{const B=le.value.id??void 0,n=await r.fetchShoppingList(g.projectId,B,N.value);if(n){if(k.value=n.materials,v.value=n.structureName,I.value=n.structureAccessible,M.value=n.structureFromCache,P.value=n.structureLastSync,V.value=n.totals,T.value=n.priceError,r.currentProject&&(r.currentProject.materialCost===null||r.currentProject.materialCost===0)&&n.totals.best>0){const oe=s(n.totals.best);await r.updateProject(g.projectId,{materialCost:oe})}}else k.value=[],V.value=null,I.value=!1,T.value=r.error}catch(B){k.value=[],V.value=null,I.value=!1,T.value=B instanceof Error?B.message:"Erreur lors du chargement"}finally{E.value=!1}}async function z(){m.value=!0;try{const B=le.value.id??void 0;await q("/shopping-list/sync-structure-market",{method:"POST",body:JSON.stringify({structureId:B})}),await l()}catch(B){T.value=B instanceof Error?B.message:"Sync failed"}finally{m.value=!1}}async function j(){if(!V.value||!r.currentProject)return;const B=s(V.value.best);await r.updateProject(g.projectId,{materialCost:B})}async function a(B){var n;H.value=B,B==="shopping"&&k.value.length===0&&((n=r.currentProject)==null?void 0:n.status)!=="completed"&&await l()}async function L(B){await r.deleteStep(g.projectId,B)}async function K(B,n,oe){await r.addChildJob(g.projectId,B,n,oe)}async function Y(B,n){await r.updateStepRuns(g.projectId,B,n)}async function je(){if(!r.currentProject)return;const B=r.currentProject.status==="completed"?"active":"completed";await r.updateProject(g.projectId,{status:B}),B==="completed"&&(H.value="steps")}function Pe(){se.value="",G.value=!0}function xe(){G.value=!1,se.value=""}async function $e(){var B;if((B=r.currentProject)!=null&&B.steps){ve.value=!0;try{let n=null;if(se.value.trim()){const he=se.value.trim().toLowerCase().replace(/,/g,".").match(/^([\d.]+)\s*([kmb])?$/);if(he){let be=parseFloat(he[1]);const ge=he[2];ge==="k"?be*=1e3:ge==="m"?be*=1e6:ge==="b"&&(be*=1e9),n=Math.round(be)}}const oe=r.currentProject.steps.filter(ce=>ce.activityType==="copy");for(const ce of oe)ce.purchased||await r.toggleStepPurchased(g.projectId,ce.id,!0);n!==null&&n>0&&await r.updateProject(g.projectId,{bpoCost:n}),xe()}finally{ve.value=!1}}}function Ee(){var B,n;return((n=(B=r.currentProject)==null?void 0:B.steps)==null?void 0:n.some(oe=>oe.activityType==="copy"))??!1}return(B,n)=>{var oe,ce,he,be,ge,Ie,Re,Ae,Le,Ne;return t(),o(O,null,[e("div",Ds,[e("div",Vs,[e("div",zs,[e("button",{onClick:n[0]||(n[0]=W=>h("close")),class:"p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-slate-200"},[...n[11]||(n[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),d(r).currentProject?(t(),o("div",Hs,[e("img",{src:d(J)(d(r).currentProject.productTypeId,64),class:"w-10 h-10 rounded",onError:n[1]||(n[1]=(...W)=>d(D)&&d(D)(...W))},null,40,Fs),e("div",null,[e("h3",Us,u(d(r).currentProject.productTypeName),1),e("p",Os,u(d(r).currentProject.runs)+" runs - ME "+u(d(r).currentProject.meLevel)+" - Créé le "+u(d(p)(d(r).currentProject.createdAt)),1)])])):w("",!0)]),e("div",qs,[((oe=d(r).currentProject)==null?void 0:oe.status)!=="completed"?(t(),o("button",{key:0,onClick:$,disabled:Q.value,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-cyan-800 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium flex items-center gap-2"},[Q.value?(t(),o("svg",Xs,[...n[12]||(n[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(t(),o("svg",Qs,[...n[13]||(n[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"},null,-1)])])),X(" "+u(Q.value?"Synchronisation...":"Lier jobs ESI"),1)],8,Ks)):w("",!0),e("button",{onClick:je,class:U(["px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2",((ce=d(r).currentProject)==null?void 0:ce.status)==="completed"?"bg-amber-600 hover:bg-amber-500 text-white":"bg-emerald-600 hover:bg-emerald-500 text-white"])},[(t(),o("svg",Ws,[((he=d(r).currentProject)==null?void 0:he.status)==="completed"?(t(),o("path",Ys)):(t(),o("path",Zs))])),X(" "+u(((be=d(r).currentProject)==null?void 0:be.status)==="completed"?"Réactiver":"Terminé"),1)],2)])]),d(r).isLoading?(t(),o("div",Gs,[...n[14]||(n[14]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),X(" Chargement... ",-1)])])):d(r).currentProject?(t(),o("div",eo,[ne.value?(t(),o("div",to,[n[16]||(n[16]=e("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",so,u(ne.value),1),e("button",{onClick:n[2]||(n[2]=W=>ne.value=null),class:"ml-auto p-1 hover:bg-amber-500/30 rounded text-amber-400"},[...n[15]||(n[15]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):w("",!0),e("div",oo,[e("div",no,[n[17]||(n[17]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Coût total",-1)),e("p",lo,u(d(b)(d(r).currentProject.totalCost)),1)]),e("div",ro,[n[18]||(n[18]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Coût jobs",-1)),e("p",ao,u(d(b)(d(r).currentProject.jobsCost)),1)]),e("div",io,[n[19]||(n[19]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Prix de vente",-1)),e("p",{class:U(["text-lg font-mono mt-1",d(r).currentProject.personalUse?"text-slate-600":"text-slate-200"])},u(d(r).currentProject.personalUse?"N/A":d(r).currentProject.sellPrice!==null?d(b)(d(r).currentProject.sellPrice):"-"),3)]),e("div",uo,[n[20]||(n[20]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Profit",-1)),e("p",{class:U(["text-lg font-mono mt-1",d(r).currentProject.personalUse?"text-slate-600":d(r).currentProject.profit!==null?d(r).currentProject.profit>=0?"text-emerald-400":"text-red-400":"text-slate-400"])},u(d(r).currentProject.personalUse?"N/A":d(r).currentProject.profit!==null?d(b)(d(r).currentProject.profit):"-"),3)])]),e("div",co,[e("button",{onClick:n[3]||(n[3]=W=>a("steps")),class:U(["pb-2 text-sm font-medium border-b-2 -mb-px",H.value==="steps"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 hover:text-slate-300"])}," Étapes de production ",2),e("button",{onClick:n[4]||(n[4]=W=>{var Te;return((Te=d(r).currentProject)==null?void 0:Te.status)!=="completed"&&a("shopping")}),disabled:((ge=d(r).currentProject)==null?void 0:ge.status)==="completed",class:U(["pb-2 text-sm font-medium border-b-2 -mb-px",((Ie=d(r).currentProject)==null?void 0:Ie.status)==="completed"?"border-transparent text-slate-600 cursor-not-allowed":H.value==="shopping"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 hover:text-slate-300"]),title:((Re=d(r).currentProject)==null?void 0:Re.status)==="completed"?"Non disponible pour les projets terminés":""}," Liste de courses ",10,po)]),H.value==="steps"?(t(),o("div",vo,[e("div",mo,[e("div",xo,[Ee()&&((Ae=d(r).currentProject)==null?void 0:Ae.status)!=="completed"?(t(),o("button",{key:0,onClick:Pe,class:"flex items-center gap-2 text-sm px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/50 rounded-lg text-blue-400"},[...n[21]||(n[21]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),X(" BPC Kit ",-1)])])):w("",!0)]),e("div",fo,[e("button",{onClick:n[5]||(n[5]=W=>A.value="flat"),class:U(["px-3 py-1.5 text-xs font-medium rounded transition-colors",A.value==="flat"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...n[22]||(n[22]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})]),X(" Liste ")],-1)])],2),e("button",{onClick:n[6]||(n[6]=W=>A.value="tree"),class:U(["px-3 py-1.5 text-xs font-medium rounded transition-colors",A.value==="tree"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...n[23]||(n[23]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4h4v4H3V4zm0 8h4v4H3v-4zm0 8h4v4H3v-4zm8-16h10M11 12h10M11 20h10"})]),X(" Arbre ")],-1)])],2)])]),A.value==="flat"?(t(),o("div",bo,[d(r).currentProject.steps&&d(r).currentProject.steps.length>0?(t(),o("div",yo,[ke(hs,{steps:d(r).currentProject.steps,readonly:d(r).currentProject.status==="completed",onTogglePurchased:F,onUpdateStepRuns:Y,onDeleteStep:L,onAddChildJob:K},null,8,["steps","readonly"])])):(t(),o("div",ho," Aucune étape de production "))])):A.value==="tree"?(t(),o("div",go,[d(r).currentProject.tree&&d(r).currentProject.steps?(t(),o("div",ko,[ke(Js,{tree:d(r).currentProject.tree,steps:d(r).currentProject.steps,readonly:d(r).currentProject.status==="completed",onTogglePurchased:F},null,8,["tree","steps","readonly"])])):(t(),o("div",wo," Arbre de production non disponible "))])):w("",!0)])):w("",!0),H.value==="shopping"?(t(),o("div",$o,[E.value?(t(),o("div",_o,[...n[24]||(n[24]=[e("svg",{class:"w-6 h-6 animate-spin mx-auto mb-2 text-cyan-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),X(" Chargement des prix... ",-1)])])):T.value&&k.value.length===0?(t(),o("div",Co,[e("div",So,[n[26]||(n[26]=e("svg",{class:"w-10 h-10 mx-auto mb-3 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),n[27]||(n[27]=e("p",{class:"text-red-400 font-medium mb-2"},"Erreur de chargement",-1)),e("p",jo,u(T.value),1),e("button",{onClick:l,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2 mx-auto"},[...n[25]||(n[25]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),X(" Réessayer ",-1)])])])])):k.value.length===0?(t(),o("div",Po," Aucun materiau requis ")):(t(),o("div",To,[((Le=d(r).currentProject)==null?void 0:Le.status)!=="completed"?(t(),o("div",Mo,[e("div",Bo,[n[30]||(n[30]=e("label",{class:"block text-xs text-slate-500 mb-1"},"Structure (avec Jita)",-1)),e("div",Eo,[te(e("input",{"onUpdate:modelValue":n[7]||(n[7]=W=>ee.value=W),type:"text",placeholder:le.value.id?le.value.name:Zo+" (défaut)",class:U(["w-full bg-slate-800 border rounded pl-3 pr-8 py-1.5 text-sm focus:outline-none",le.value.id?"border-cyan-500/50 text-cyan-400 placeholder-cyan-400":"border-slate-600 text-slate-200 placeholder-slate-400 focus:border-cyan-500/50"]),onFocus:n[8]||(n[8]=W=>de.value=!0),onBlur:R},null,42,Io),[[re,ee.value]]),e("div",Ro,[ue.value?(t(),o("svg",Ao,[...n[28]||(n[28]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):le.value.id||ee.value?(t(),o("button",{key:1,onMousedown:pe(y,["prevent"]),class:"text-slate-400 hover:text-slate-200",title:"Revenir au défaut"},[...n[29]||(n[29]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],32)):w("",!0)]),de.value&&(ae.value.length>0||ee.value.length>=3&&!ue.value)?(t(),o("div",Lo,[(t(!0),o(O,null,Z(ae.value,W=>(t(),o("button",{key:W.id,onMousedown:pe(Te=>S(W),["prevent"]),class:"w-full px-3 py-2 text-left text-sm text-slate-200 hover:bg-slate-700/50 transition-colors border-b border-slate-700/50 last:border-0"},[e("div",Jo,u(W.name),1)],40,No))),128)),ee.value.length>=3&&ae.value.length===0&&!ue.value?(t(),o("div",Do," Aucune structure trouvée ")):w("",!0)])):w("",!0)])]),e("div",null,[n[32]||(n[32]=e("label",{class:"block text-xs text-slate-500 mb-1"},"Transport",-1)),e("div",Vo,[te(e("input",{"onUpdate:modelValue":n[9]||(n[9]=W=>N.value=W),type:"number",min:"0",step:"100",class:"w-24 px-2 py-1.5 bg-slate-800 border border-slate-600 rounded text-slate-200 text-sm font-mono focus:outline-none focus:border-cyan-500"},null,512),[[re,N.value,void 0,{number:!0}]]),n[31]||(n[31]=e("span",{class:"text-xs text-slate-500"},"ISK/m³",-1))])]),e("div",{class:"pt-4"},[e("button",{onClick:l,class:"px-4 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded text-white text-sm font-medium"}," Recalculer ")])])):w("",!0),ke(Xe,{items:k.value,totals:V.value,"structure-name":v.value,"price-error":T.value,"structure-accessible":I.value,"structure-from-cache":M.value,"structure-last-sync":P.value,"is-syncing":m.value,readonly:((Ne=d(r).currentProject)==null?void 0:Ne.status)==="completed",onSyncStructure:z},{"after-summary":Je(()=>{var W;return[V.value&&V.value.best>0?(t(),o("div",zo,[e("span",Ho,[n[33]||(n[33]=X(" Meilleur prix total: ",-1)),e("span",Fo,u(d(b)(V.value.best)),1),n[34]||(n[34]=X(" → Arrondi au million: ",-1)),e("span",Uo,u(d(b)(s(V.value.best))),1)]),((W=d(r).currentProject)==null?void 0:W.status)!=="completed"?(t(),o("button",{key:0,onClick:j,class:"ml-auto px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded text-white text-sm font-medium flex items-center gap-2"},[...n[35]||(n[35]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),X(" Appliquer comme coût matériaux ",-1)])])):w("",!0)])):w("",!0)]}),_:1},8,["items","totals","structure-name","price-error","structure-accessible","structure-from-cache","structure-last-sync","is-syncing","readonly"])]))])):w("",!0)])):w("",!0)]),(t(),ye(Me,{to:"body"},[G.value?(t(),o("div",Oo,[e("div",{class:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:xe}),e("div",qo,[e("div",{class:"px-6 py-4 border-b border-slate-700 flex items-center justify-between"},[n[37]||(n[37]=e("h3",{class:"text-lg font-semibold text-slate-100 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),X(" BPC Kit ")],-1)),e("button",{onClick:xe,class:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-slate-200"},[...n[36]||(n[36]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ko,[n[40]||(n[40]=e("p",{class:"text-sm text-slate-400 mb-4"}," Cette action va marquer toutes les étapes BPC comme achetées et définir le coût du kit. ",-1)),e("div",null,[n[38]||(n[38]=e("label",{class:"block text-sm font-medium text-slate-300 mb-2"}," Prix du kit BPC ",-1)),te(e("input",{"onUpdate:modelValue":n[10]||(n[10]=W=>se.value=W),type:"text",placeholder:"ex: 50M, 1.5B, 500000",class:"w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 font-mono",onKeydown:[ie($e,["enter"]),ie(xe,["escape"])],autofocus:""},null,544),[[re,se.value]]),n[39]||(n[39]=e("p",{class:"text-xs text-slate-500 mt-2"}," Formats acceptés : 50M, 1.5B, 500K, 1000000 ",-1))])]),e("div",Xo,[e("button",{onClick:xe,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:$e,disabled:ve.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-blue-800 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[ve.value?(t(),o("svg",Wo,[...n[41]||(n[41]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(t(),o("svg",Yo,[...n[42]||(n[42]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),n[43]||(n[43]=X(" Confirmer ",-1))],8,Qo)])])])):w("",!0)]))],64)}}}),en={class:"space-y-6"},tn={key:0,class:"text-center py-8 text-slate-500"},sn={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},on=["checked","onChange"],nn={class:"text-sm text-slate-200"},ln={class:"relative mb-3"},rn={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},an=["onMousedown"],un=["src"],dn={class:"text-sm text-slate-200"},cn={key:0,class:"text-xs text-slate-500 ml-auto"},pn={key:0,class:"space-y-1 max-h-64 overflow-y-auto"},vn=["src"],mn={class:"font-medium text-slate-200 flex-1"},xn=["onClick"],fn={key:1,class:"text-sm text-slate-500"},bn=fe({__name:"BlacklistConfig",setup(_){const i=we(),{getTypeIconUrl:g,onImageError:h}=Se(),r=f(""),C=f([]),b=f(!1);let p=null;Ce(()=>{i.fetchBlacklist()});const J=me(()=>{if(!i.blacklist)return new Set;const I=new Set;for(const M of i.blacklist.categories)if(M.blacklisted)for(const P of M.groupIds)I.add(P);return I}),D=me(()=>i.blacklist?new Set(i.blacklist.items.map(I=>I.typeId)):new Set);async function H(I){if(!i.blacklist)return;const M=i.blacklist.categories.find(T=>T.key===I);if(!M)return;const P=[...J.value];let V;M.blacklisted?V=P.filter(T=>!M.groupIds.includes(T)):V=[...new Set([...P,...M.groupIds])],await i.updateBlacklist(V,[...D.value])}async function A(I){const M=[...D.value].filter(P=>P!==I);await i.updateBlacklist([...J.value],M)}async function k(I){if(D.value.has(I))return;const M=[...D.value,I];await i.updateBlacklist([...J.value],M),r.value="",C.value=[],b.value=!1}_e(r,I=>{if(p&&clearTimeout(p),I.length<2){C.value=[],b.value=!1;return}p=setTimeout(async()=>{C.value=await i.searchBlacklistItems(I),b.value=C.value.length>0},300)});function v(){window.setTimeout(()=>{b.value=!1},200)}return(I,M)=>(t(),o("div",en,[M[7]||(M[7]=e("div",null,[e("h3",{class:"text-lg font-semibold text-slate-100 mb-1"},"Construction Blacklist"),e("p",{class:"text-sm text-slate-400"}," Sélectionnez les catégories et items que vous ne fabriquez pas. Ils seront traités comme des achats dans tous vos projets. ")],-1)),d(i).blacklist?(t(),o(O,{key:1},[e("div",null,[M[4]||(M[4]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Catégories",-1)),e("div",sn,[(t(!0),o(O,null,Z(d(i).blacklist.categories,P=>(t(),o("label",{key:P.key,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700 cursor-pointer hover:bg-slate-800"},[e("input",{type:"checkbox",checked:P.blacklisted,onChange:V=>H(P.key),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-red-500 focus:ring-red-500 focus:ring-offset-slate-900"},null,40,on),e("span",nn,u(P.label),1)]))),128))])]),e("div",null,[M[6]||(M[6]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Items individuels",-1)),e("div",ln,[te(e("input",{"onUpdate:modelValue":M[0]||(M[0]=P=>r.value=P),type:"text",placeholder:"Rechercher un item à blacklister...",class:"w-full px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",onFocus:M[1]||(M[1]=P=>b.value=C.value.length>0),onBlur:v},null,544),[[re,r.value]]),b.value?(t(),o("div",rn,[(t(!0),o(O,null,Z(C.value,P=>(t(),o("button",{key:P.typeId,onMousedown:pe(V=>k(P.typeId),["prevent"]),class:U(["w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-700 text-left",D.value.has(P.typeId)?"opacity-50":""])},[e("img",{src:d(g)(P.typeId,32),class:"w-6 h-6 rounded",onError:M[2]||(M[2]=(...V)=>d(h)&&d(h)(...V))},null,40,un),e("span",dn,u(P.typeName),1),D.value.has(P.typeId)?(t(),o("span",cn," déjà ajouté ")):w("",!0)],42,an))),128))])):w("",!0)]),d(i).blacklist.items.length>0?(t(),o("div",pn,[(t(!0),o(O,null,Z(d(i).blacklist.items,P=>(t(),o("div",{key:P.typeId,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700"},[e("img",{src:d(g)(P.typeId,32),class:"w-8 h-8 rounded",onError:M[3]||(M[3]=(...V)=>d(h)&&d(h)(...V))},null,40,vn),e("span",mn,u(P.typeName),1),e("button",{onClick:V=>A(P.typeId),class:"p-1 hover:bg-slate-700 rounded text-slate-500 hover:text-red-400"},[...M[5]||(M[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,xn)]))),128))])):(t(),o("p",fn," Aucun item individuel blacklisté. "))])],64)):(t(),o("div",tn," Chargement... "))]))}}),yn={class:"space-y-4"},hn={class:"flex items-center justify-between"},gn={key:0,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700"},kn={class:"text-sm font-medium text-slate-300 mb-4"},wn={class:"space-y-4"},$n={class:"flex gap-3"},_n=["value"],Cn={class:"text-sm text-slate-300"},Sn={class:"relative"},jn={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Pn=["onMousedown"],Tn={class:"flex items-center justify-between"},Mn={class:"text-sm text-slate-200"},Bn={class:"text-xs text-cyan-400 ml-2"},En={class:"text-xs text-slate-500 mt-0.5"},In={key:1,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg p-3 text-sm text-slate-400"},Rn={key:0,class:"mt-3 space-y-1"},An={class:"flex items-center justify-between"},Ln={class:"flex items-center gap-2 flex-1 min-w-0"},Nn={class:"text-sm text-slate-300 truncate"},Jn={class:"text-xs text-cyan-400 shrink-0"},Dn=["onClick"],Vn={class:"text-xs text-slate-500 mt-0.5"},zn={key:1,class:"mt-2 text-xs text-slate-500"},Hn={class:"bg-slate-900/50 rounded-lg p-3 border border-slate-700"},Fn={class:"flex gap-4"},Un={key:0},On={class:"text-sm text-emerald-400 ml-1"},qn={key:1},Kn={class:"text-sm text-emerald-400 ml-1"},Xn={key:2,class:"text-slate-500 text-sm"},Qn={class:"flex gap-3 pt-2"},Wn=["disabled"],Yn={key:1,class:"space-y-2"},Zn={class:"flex items-start justify-between"},Gn={class:"flex-1"},el={class:"text-sm font-medium text-slate-200"},tl={class:"text-xs text-slate-500 mt-1"},sl={class:"flex gap-4 mt-2"},ol={key:0},nl={class:"text-sm text-emerald-400 ml-1"},ll={key:1},rl={class:"text-sm text-emerald-400 ml-1"},al={key:0,class:"mt-2 flex flex-wrap gap-1"},il={class:"flex items-center gap-2"},ul=["onClick"],dl=["onClick"],cl={key:2,class:"text-center py-8 text-slate-500"},pl={class:"bg-slate-900 rounded-xl border border-slate-700 max-w-md w-full p-6"},vl={class:"text-slate-400 mb-6"},ml={class:"text-slate-200 font-medium"},xl=fe({__name:"StructureConfig",setup(_){const i=we(),g=f(!1),h=f(null),r=f(""),C=f("nullsec"),b=f("raitaru"),p=f([]),J=f(""),D=f(!1);Ce(()=>{i.fetchStructures()});const H={highsec:1,lowsec:1.9,nullsec:2.1},A={highsec:"High-Sec (x1.0)",lowsec:"Low-Sec (x1.9)",nullsec:"Null-Sec (x2.1)"},k={station:"Station NPC (aucun bonus)",raitaru:"Raitaru (EC Medium) - 1% ME",azbel:"Azbel (EC Large) - 1% ME, 20% TE",sotiyo:"Sotiyo (EC X-Large) - 1% ME, 30% TE",athanor:"Athanor (Refinery Medium) - 25% TE",tatara:"Tatara (Refinery Large) - 25% TE",engineering_complex:"Engineering Complex (legacy)",refinery:"Refinery (legacy)"},v=me(()=>i.rigOptions?["athanor","tatara","refinery"].includes(b.value)?i.rigOptions.reaction:["raitaru","azbel","sotiyo","engineering_complex"].includes(b.value)?i.rigOptions.manufacturing:[]:[]),I=me(()=>{const $=J.value.toLowerCase().trim();return $.length<2?[]:v.value.filter(s=>p.value.includes(s.name)?!1:s.name.toLowerCase().includes($)).slice(0,10)}),M=me(()=>p.value.map($=>v.value.find(l=>l.name===$)||{name:$,bonus:0,category:"",size:"M",targetCategories:[]}));_e(b,()=>{J.value="";const $=new Set(v.value.map(s=>s.name));p.value=p.value.filter(s=>$.has(s))});function P(){r.value="",C.value="nullsec",b.value="raitaru",p.value=[],h.value=null,J.value="",D.value=!1}const V=me(()=>["athanor","tatara","refinery"].includes(b.value)),T=me(()=>["raitaru","azbel","sotiyo","engineering_complex"].includes(b.value));function E(){P(),g.value=!0}function m($){r.value=$.name,C.value=$.securityType,b.value=$.structureType,p.value=[...$.rigs],h.value=$,J.value="",D.value=!1,g.value=!0}function N(){g.value=!1,P()}async function Q(){const $={name:r.value,securityType:C.value,structureType:b.value,rigs:p.value};try{h.value?await i.updateStructure(h.value.id,$):await i.createStructure($),g.value=!1,P()}catch{}}const ne=f(!1),G=f(null),se=f("");function ve($){G.value=$.id,se.value=$.name,ne.value=!0}async function le(){G.value&&await i.deleteStructure(G.value),ne.value=!1,G.value=null,se.value=""}function ee(){ne.value=!1,G.value=null,se.value=""}function ae($){p.value.includes($.name)||p.value.push($.name),J.value="",D.value=!1}function ue($){const s=p.value.indexOf($);s!==-1&&p.value.splice(s,1)}function de(){window.setTimeout(()=>{D.value=!1},200)}function c($){return $.replace("Standup M-Set ","").replace("Standup L-Set ","").replace("Standup XL-Set ","")}const x={basic_small_ship:"T1 Small Ships",basic_medium_ship:"T1 Medium Ships",basic_large_ship:"T1 Large Ships",advanced_small_ship:"T2 Small Ships",advanced_medium_ship:"T2 Medium Ships",advanced_large_ship:"T2 Large Ships",capital_ship:"Capitals",basic_capital_component:"Capital Components",advanced_component:"T2/T3 Components",structure_component:"Structure Components",equipment:"Modules",ammunition:"Ammo",drone:"Drones",fighter:"Fighters",structure:"Structures",composite_reaction:"Composites",biochemical_reaction:"Biochem",hybrid_reaction:"Hybrid"};function S($){return!$||$.length===0?"":$.map(s=>x[s]||s).join(", ")}function y($,s,l){if(!i.rigOptions)return 0;const z=s==="reaction"?i.rigOptions.reaction:i.rigOptions.manufacturing;let j=0;for(const L of $){const K=z.find(Y=>Y.name===L);K&&(j+=K.bonus)}const a=H[l]??1;return Math.round(j*a*100)/100}const R=me(()=>y(p.value,"manufacturing",C.value)),F=me(()=>y(p.value,"reaction",C.value));return($,s)=>(t(),o("div",yn,[e("div",hn,[s[7]||(s[7]=e("h3",{class:"text-lg font-semibold text-slate-200"},"Structures de production",-1)),g.value?w("",!0):(t(),o("button",{key:0,onClick:E,class:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2"},[...s[6]||(s[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),X(" Ajouter ",-1)])]))]),s[25]||(s[25]=e("p",{class:"text-sm text-slate-400"}," Configurez vos structures de production pour calculer les bonus de matériaux appliqués aux projets. ",-1)),g.value?(t(),o("div",gn,[e("h4",kn,u(h.value?"Modifier la structure":"Nouvelle structure"),1),e("div",wn,[e("div",null,[s[8]||(s[8]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Nom",-1)),te(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>r.value=l),type:"text",placeholder:"Ex: Tatara C-J6MT",class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[re,r.value]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Type de structure",-1)),te(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>b.value=l),class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},[...s[9]||(s[9]=[Oe('<optgroup label="NPC"><option value="station">Station NPC (aucun bonus)</option></optgroup><optgroup label="Engineering Complex"><option value="raitaru">Raitaru (Medium) - 1% ME, 15% TE</option><option value="azbel">Azbel (Large) - 1% ME, 20% TE</option><option value="sotiyo">Sotiyo (X-Large) - 1% ME, 30% TE</option></optgroup><optgroup label="Refinery"><option value="athanor">Athanor (Medium) - 25% TE reactions</option><option value="tatara">Tatara (Large) - 25% TE reactions</option></optgroup>',3)])],512),[[Ue,b.value]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Sécurité",-1)),e("div",$n,[(t(),o(O,null,Z(A,(l,z)=>e("label",{key:z,class:"flex items-center gap-2 cursor-pointer"},[te(e("input",{type:"radio",value:z,"onUpdate:modelValue":s[2]||(s[2]=j=>C.value=j),class:"text-cyan-500 focus:ring-cyan-500"},null,8,_n),[[qe,C.value]]),e("span",Cn,u(l),1)])),64))])]),e("div",null,[s[13]||(s[13]=e("label",{class:"block text-xs text-slate-400 mb-2"},"Rigs (bonus matériaux)",-1)),e("div",Sn,[te(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>J.value=l),type:"text",placeholder:"Rechercher un rig...",class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500",onFocus:s[4]||(s[4]=l=>D.value=I.value.length>0),onBlur:de,onInput:s[5]||(s[5]=l=>D.value=!0)},null,544),[[re,J.value]]),D.value&&I.value.length>0?(t(),o("div",jn,[(t(!0),o(O,null,Z(I.value,l=>(t(),o("button",{key:l.name,onMousedown:pe(z=>ae(l),["prevent"]),class:"w-full px-3 py-2 hover:bg-slate-700 text-left"},[e("div",Tn,[e("span",Mn,u(c(l.name)),1),e("span",Bn,"-"+u(l.bonus)+"% ("+u(l.size)+")",1)]),e("div",En,u(S(l.targetCategories)),1)],40,Pn))),128))])):w("",!0),D.value&&J.value.length>=2&&I.value.length===0?(t(),o("div",In," Aucun rig trouvé ")):w("",!0)]),p.value.length>0?(t(),o("div",Rn,[(t(!0),o(O,null,Z(M.value,l=>(t(),o("div",{key:l.name,class:"bg-slate-900/50 rounded-lg px-3 py-2"},[e("div",An,[e("div",Ln,[e("span",Nn,u(c(l.name)),1),e("span",Jn,"-"+u(l.bonus)+"% ("+u(l.size)+")",1)]),e("button",{onClick:z=>ue(l.name),class:"ml-2 p-1 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded shrink-0",title:"Retirer"},[...s[12]||(s[12]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Dn)]),e("div",Vn,u(S(l.targetCategories)),1)]))),128))])):(t(),o("p",zn," Aucun rig sélectionné. Recherchez et ajoutez des rigs pour appliquer des bonus. "))]),e("div",Hn,[s[16]||(s[16]=e("p",{class:"text-xs text-slate-400 mb-2"},"Bonus calculé (base structure + rigs × sécurité)",-1)),e("div",Fn,[T.value?(t(),o("div",Un,[s[14]||(s[14]=e("span",{class:"text-xs text-slate-500"},"Manufacturing:",-1)),e("span",On,"-"+u(R.value)+"%",1)])):w("",!0),V.value?(t(),o("div",qn,[s[15]||(s[15]=e("span",{class:"text-xs text-slate-500"},"Reactions:",-1)),e("span",Kn,"-"+u(F.value)+"%",1)])):w("",!0),b.value==="station"?(t(),o("div",Xn," Les stations NPC n'ont pas de bonus ")):w("",!0)])]),e("div",Qn,[e("button",{onClick:Q,disabled:!r.value.trim(),class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-600 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium"},u(h.value?"Enregistrer":"Ajouter"),9,Wn),e("button",{onClick:N,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm"}," Annuler ")])])])):w("",!0),d(i).structures.length>0?(t(),o("div",Yn,[(t(!0),o(O,null,Z(d(i).structures,l=>(t(),o("div",{key:l.id,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700 hover:border-slate-600"},[e("div",Zn,[e("div",Gn,[e("h4",el,u(l.name),1),e("p",tl,u(k[l.structureType])+" - "+u(A[l.securityType]),1),e("div",sl,[l.manufacturingMaterialBonus>0?(t(),o("div",ol,[s[17]||(s[17]=e("span",{class:"text-xs text-slate-500"},"Manufacturing:",-1)),e("span",nl,"-"+u(l.manufacturingMaterialBonus)+"%",1)])):w("",!0),l.reactionMaterialBonus>0?(t(),o("div",ll,[s[18]||(s[18]=e("span",{class:"text-xs text-slate-500"},"Reactions:",-1)),e("span",rl,"-"+u(l.reactionMaterialBonus)+"%",1)])):w("",!0)]),l.rigs.length>0?(t(),o("div",al,[(t(!0),o(O,null,Z(l.rigs,z=>(t(),o("span",{key:z,class:"px-2 py-0.5 bg-slate-700 text-slate-300 text-xs rounded"},u(c(z)),1))),128))])):w("",!0)]),e("div",il,[e("button",{onClick:z=>m(l),class:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded",title:"Modifier"},[...s[19]||(s[19]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ul),e("button",{onClick:z=>ve(l),class:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer"},[...s[20]||(s[20]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,dl)])])]))),128))])):g.value?w("",!0):(t(),o("div",cl,[...s[21]||(s[21]=[e("p",null,"Aucune structure configurée",-1),e("p",{class:"text-sm mt-1"},"Ajoutez vos structures pour calculer les bonus de matériaux",-1)])])),(t(),ye(Me,{to:"body"},[ne.value?(t(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:pe(ee,["self"])},[e("div",pl,[s[24]||(s[24]=e("h3",{class:"text-lg font-semibold text-slate-200 mb-2"},"Supprimer la structure",-1)),e("p",vl,[s[22]||(s[22]=X(" Voulez-vous vraiment supprimer ",-1)),e("span",ml,u(se.value),1),s[23]||(s[23]=X(" ? ",-1))]),e("div",{class:"flex gap-3"},[e("button",{onClick:ee,class:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300"}," Annuler "),e("button",{onClick:le,class:"flex-1 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white font-medium"}," Supprimer ")])])])):w("",!0)]))]))}}),fl={class:"mb-6 flex items-center justify-between"},bl={key:0,class:"flex gap-2"},yl={key:0,class:"mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 flex items-center justify-between"},hl={key:2,class:"space-y-6"},gl={class:"bg-slate-900 rounded-xl border border-slate-800 p-6"},kl={class:"bg-slate-900 rounded-xl border border-slate-800 p-6"},wl={class:"bg-slate-900 rounded-xl border border-slate-800 p-6 mb-6"},$l={class:"flex items-end gap-4"},_l={class:"flex-1"},Cl={key:0,class:"text-xs text-cyan-400 mt-1"},Sl={class:"w-24"},jl={class:"w-24"},Pl=["disabled"],Tl={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ml={class:"bg-slate-900 rounded-xl border border-slate-800"},Bl={key:0,class:"p-8 text-center text-slate-500"},Nl=fe({__name:"Industry",setup(_){const i=we(),g=f(null),h=f(1),r=f(0),C=f(!1),b=f(null),p=f("projects");Ce(()=>{i.fetchProjects()});function J(k){g.value=k}async function D(){if(g.value){C.value=!0;try{await i.createProject(g.value.typeId,h.value,r.value),g.value=null,h.value=1,r.value=0,await i.fetchProjects()}finally{C.value=!1}}}function H(k){b.value=k}function A(){b.value=null,i.fetchProjects()}return(k,v)=>(t(),ye(Ke,null,{default:Je(()=>[e("div",fl,[v[5]||(v[5]=e("p",{class:"text-slate-400"},"Suivi de projets de construction",-1)),b.value?w("",!0):(t(),o("div",bl,[e("button",{onClick:v[0]||(v[0]=I=>p.value="projects"),class:U(["px-4 py-2 rounded-lg text-sm font-medium",p.value==="projects"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Projets ",2),e("button",{onClick:v[1]||(v[1]=I=>p.value="config"),class:U(["px-4 py-2 rounded-lg text-sm font-medium",p.value==="config"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Configuration ",2)]))]),d(i).error?(t(),o("div",yl,[e("span",null,u(d(i).error),1),e("button",{onClick:v[2]||(v[2]=I=>d(i).clearError()),class:"text-red-400 hover:text-red-300"},[...v[6]||(v[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):w("",!0),b.value?(t(),ye(Go,{key:1,"project-id":b.value,onClose:A},null,8,["project-id"])):p.value==="config"?(t(),o("div",hl,[e("div",gl,[ke(bn)]),e("div",kl,[ke(xl)])])):(t(),o(O,{key:3},[e("div",wl,[v[11]||(v[11]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-4"},"Nouveau projet",-1)),e("div",$l,[e("div",_l,[v[7]||(v[7]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Produit",-1)),ke(Ge,{onSelect:J}),g.value?(t(),o("p",Cl," Sélectionné : "+u(g.value.typeName),1)):w("",!0)]),e("div",Sl,[v[8]||(v[8]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Runs",-1)),te(e("input",{"onUpdate:modelValue":v[3]||(v[3]=I=>h.value=I),type:"number",min:"1",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[re,h.value,void 0,{number:!0}]])]),e("div",jl,[v[9]||(v[9]=e("label",{class:"block text-sm text-slate-400 mb-1"},"ME",-1)),te(e("input",{"onUpdate:modelValue":v[4]||(v[4]=I=>r.value=I),type:"number",min:"0",max:"10",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[re,r.value,void 0,{number:!0}]])]),e("button",{onClick:D,disabled:!g.value||C.value,class:"px-6 py-2.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium disabled:opacity-50 flex items-center gap-2"},[C.value?(t(),o("svg",Tl,[...v[10]||(v[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):w("",!0),X(" "+u(C.value?"Création...":"Créer"),1)],8,Pl)])]),e("div",Ml,[v[13]||(v[13]=e("div",{class:"px-6 py-4 border-b border-slate-800"},[e("h3",{class:"text-lg font-semibold text-slate-100"},"Historique des projets")],-1)),d(i).isLoading?(t(),o("div",Bl,[...v[12]||(v[12]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),X(" Chargement... ",-1)])])):(t(),ye(St,{key:1,onViewProject:H}))])],64))]),_:1}))}});export{Nl as default};
