import{B as Ue,r as m,C as X,d as _e,h as t,c as s,y as te,A as ne,b as e,k as d,F as O,m as G,v as ue,t as a,e as y,L as ve,n as U,x as Re,l as W,i as Ce,T as Ie,p as ye,M as Oe,u as qe,o as Le,q as je,w as De,j as Ke,N as Xe,z as ze,a as Qe,O as We}from"./index-BmJN7W-L.js";import{_ as Ye}from"./MainLayout.vue_vue_type_style_index_0_lang-DgX5O-e0.js";import{u as Ne}from"./useFormatters-SlNtu6dn.js";import{u as Ae}from"./useEveImages-B3tDia7r.js";import{_ as Ze}from"./ShoppingListResults.vue_vue_type_script_setup_true_lang-C7t_vtmA.js";const Te=Ue("industry",()=>{const P=m([]),i=m(null),_=m([]),h=m(null),r=m([]),M=m(null),C=m([]),E=m(!1),x=m(null),H=m(0);async function D(p){if(p.length<2){_.value=[];return}try{const f=await X(`/industry/search?q=${encodeURIComponent(p)}`);_.value=f.results}catch{_.value=[]}}async function J(p,f,T){x.value=null;try{const w=await X("/industry/projects",{method:"POST",body:JSON.stringify({typeId:p,runs:f,meLevel:T})});return P.value.unshift(w),w}catch(w){throw x.value=w instanceof Error?w.message:"Failed to create project",w}}async function k(){E.value=!0,x.value=null;try{const p=await X("/industry/projects");P.value=p.projects,H.value=p.totalProfit}catch(p){x.value=p instanceof Error?p.message:"Failed to fetch projects"}finally{E.value=!1}}async function g(p){E.value=!0,x.value=null;try{i.value=await X(`/industry/projects/${p}`)}catch(f){x.value=f instanceof Error?f.message:"Failed to fetch project"}finally{E.value=!1}}async function A(p,f){var T;x.value=null;try{const w=await X(`/industry/projects/${p}`,{method:"PATCH",body:JSON.stringify(f)}),R=P.value.findIndex(u=>u.id===p);return R!==-1&&(P.value[R]={...P.value[R],...w}),((T=i.value)==null?void 0:T.id)===p&&(i.value={...i.value,...w}),w}catch(w){throw x.value=w instanceof Error?w.message:"Failed to update project",w}}async function I(p){x.value=null;try{await X(`/industry/projects/${p}`,{method:"DELETE"}),P.value=P.value.filter(f=>f.id!==p)}catch(f){x.value=f instanceof Error?f.message:"Failed to delete project"}}async function S(p,f,T){var w;try{const R=await X(`/industry/projects/${p}/steps/${f}`,{method:"PATCH",body:JSON.stringify({purchased:T})});if((w=i.value)!=null&&w.steps){const u=i.value.steps.findIndex(c=>c.id===f);u!==-1&&(i.value.steps[u]=R)}}catch(R){x.value=R instanceof Error?R.message:"Failed to update step"}}async function F(p,f,T){var w;try{const R=await X(`/industry/projects/${p}/steps/${f}`,{method:"PATCH",body:JSON.stringify(T)});if((w=i.value)!=null&&w.steps){const u=i.value.steps.findIndex(c=>c.id===f);u!==-1&&(i.value.steps[u]=R)}return R}catch(R){throw x.value=R instanceof Error?R.message:"Failed to update step",R}}async function B(p,f){var T;try{const w=await X(`/industry/projects/${p}/steps/${f}`,{method:"PATCH",body:JSON.stringify({clearJobData:!0})});if((T=i.value)!=null&&T.steps){const R=i.value.steps.findIndex(u=>u.id===f);R!==-1&&(i.value.steps[R]=w)}return w}catch(w){throw x.value=w instanceof Error?w.message:"Failed to clear step job data",w}}async function N(p,f,T,w){var R;try{const u={typeId:f,runs:T};w&&(u.splitGroupId=w);const c=await X(`/industry/projects/${p}/steps`,{method:"POST",body:JSON.stringify(u)});return((R=i.value)==null?void 0:R.id)===p&&i.value.steps&&i.value.steps.push(c),c}catch(u){throw x.value=u instanceof Error?u.message:"Failed to create step",u}}async function b(p,f,T,w){var R,u;try{const c={runs:w};if(f?c.splitGroupId=f:T&&(c.stepId=T),T){const q=await X(`/industry/projects/${p}/steps`,{method:"POST",body:JSON.stringify(c)});if(((R=i.value)==null?void 0:R.id)===p&&i.value.steps){const j=i.value.steps.findIndex(n=>n.id===T);j!==-1&&(i.value.steps[j]=q.updatedStep),i.value.steps.push(q.newStep)}return q.newStep}else{const q=await X(`/industry/projects/${p}/steps`,{method:"POST",body:JSON.stringify(c)});return((u=i.value)==null?void 0:u.id)===p&&i.value.steps&&i.value.steps.push(q),q}}catch(c){throw x.value=c instanceof Error?c.message:"Failed to add child job",c}}async function V(p,f){var T;try{await X(`/industry/projects/${p}/steps/${f}`,{method:"DELETE"}),((T=i.value)==null?void 0:T.id)===p&&i.value.steps&&(i.value.steps=i.value.steps.filter(w=>w.id!==f))}catch(w){throw x.value=w instanceof Error?w.message:"Failed to delete step",w}}async function Y(p,f,T){var w;try{const R=await X(`/industry/projects/${p}/steps/${f}`,{method:"PATCH",body:JSON.stringify({runs:T})});if(((w=i.value)==null?void 0:w.id)===p&&i.value.steps){const u=i.value.steps.findIndex(c=>c.id===f);u!==-1&&(i.value.steps[u]=R)}return R}catch(R){throw x.value=R instanceof Error?R.message:"Failed to update step runs",R}}async function me(p){var f;try{const T=await X(`/industry/projects/${p}/match-jobs`,{method:"POST"});return((f=i.value)==null?void 0:f.id)===p&&(i.value.steps=T.steps,i.value.jobsCost=T.jobsCost),T.warning}catch(T){return x.value=T instanceof Error?T.message:"Failed to match jobs",null}}async function ce(p,f,T){try{const w=new URLSearchParams;f&&w.set("structureId",f.toString()),T!==void 0&&w.set("transportCost",T.toString());const R=w.toString()?`?${w.toString()}`:"";return await X(`/industry/projects/${p}/shopping-list${R}`)}catch(w){return x.value=w instanceof Error?w.message:"Failed to fetch shopping list",null}}async function de(){try{h.value=await X("/industry/blacklist")}catch(p){x.value=p instanceof Error?p.message:"Failed to fetch blacklist"}}async function xe(p,f){try{h.value=await X("/industry/blacklist",{method:"PUT",body:JSON.stringify({groupIds:p,typeIds:f})})}catch(T){x.value=T instanceof Error?T.message:"Failed to update blacklist"}}async function re(p){if(p.length<2)return[];try{return(await X(`/industry/blacklist/search?q=${encodeURIComponent(p)}`)).results}catch{return[]}}async function le(){try{const p=await X("/industry/structures");r.value=p.structures,M.value=p.rigOptions}catch(p){x.value=p instanceof Error?p.message:"Failed to fetch structures"}}async function se(){try{const p=await X("/industry/corporation-structures");C.value=p.structures}catch(p){console.error("Failed to fetch corporation structures:",p)}}async function ae(p){try{const f=await X("/industry/structures",{method:"POST",body:JSON.stringify({...p,isDefault:!1})});return r.value.push(f),f}catch(f){throw x.value=f instanceof Error?f.message:"Failed to create structure",f}}async function fe(p,f){try{const T=await X(`/industry/structures/${p}`,{method:"PATCH",body:JSON.stringify(f)}),w=r.value.findIndex(R=>R.id===p);return w!==-1&&(r.value[w]=T),T}catch(T){throw x.value=T instanceof Error?T.message:"Failed to update structure",T}}async function be(p){try{await X(`/industry/structures/${p}`,{method:"DELETE"}),r.value=r.value.filter(f=>f.id!==p)}catch(f){throw x.value=f instanceof Error?f.message:"Failed to delete structure",f}}async function we(p){if(p.length<3)return{structures:[]};try{return{structures:(await X(`/industry/search-structure?q=${encodeURIComponent(p)}`)).structures}}catch(f){const T=f instanceof Error?f.message:"Erreur de recherche";return console.error("Failed to search structures:",f),{structures:[],error:T}}}function Se(){x.value=null}return{projects:P,currentProject:i,searchResults:_,blacklist:h,structures:r,rigOptions:M,corporationStructures:C,isLoading:E,error:x,totalProfit:H,searchProducts:D,createProject:J,fetchProjects:k,fetchProject:g,updateProject:A,deleteProject:I,toggleStepPurchased:S,updateStepJobData:F,clearStepJobData:B,matchJobs:me,fetchShoppingList:ce,fetchBlacklist:de,updateBlacklist:xe,searchBlacklistItems:re,fetchStructures:le,fetchCorporationStructures:se,createStructure:ae,updateStructure:fe,deleteStructure:be,searchStructures:we,createStep:N,addChildJob:b,deleteStep:V,updateStepRuns:Y,clearError:Se}}),Ge={class:"relative"},et={key:0,class:"absolute z-20 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto"},tt=["onMousedown"],st=["src"],ot=_e({__name:"ProductSearch",emits:["select"],setup(P,{emit:i}){const _=i,h=Te(),r=m(""),M=m(!1);let C=null;function E(){if(C&&clearTimeout(C),r.value.length<2){h.searchResults=[],M.value=!1;return}C=setTimeout(async()=>{await h.searchProducts(r.value),M.value=h.searchResults.length>0},300)}function x(D){_("select",D),r.value=D.typeName,M.value=!1,h.searchResults=[]}function H(){setTimeout(()=>{M.value=!1},200)}return(D,J)=>(t(),s("div",Ge,[te(e("input",{"onUpdate:modelValue":J[0]||(J[0]=k=>r.value=k),onInput:E,onFocus:J[1]||(J[1]=k=>M.value=d(h).searchResults.length>0),onBlur:H,type:"text",placeholder:"Rechercher un produit (ex: Nomad, Raven...)",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-cyan-500 pr-10"},null,544),[[ne,r.value]]),J[3]||(J[3]=e("svg",{class:"absolute right-3 top-3 w-4 h-4 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),M.value&&d(h).searchResults.length>0?(t(),s("div",et,[(t(!0),s(O,null,G(d(h).searchResults,k=>(t(),s("button",{key:k.typeId,onMousedown:ue(g=>x(k),["prevent"]),class:"w-full px-4 py-2.5 text-left hover:bg-slate-700 text-sm flex items-center gap-3 transition-colors"},[e("img",{src:`https://images.evetech.net/types/${k.typeId}/icon?size=32`,class:"w-6 h-6 rounded",onError:J[2]||(J[2]=g=>g.target.style.display="none")},null,40,st),e("span",null,a(k.typeName),1)],40,tt))),128))])):y("",!0)]))}});function nt(P){if(!P||P.trim()==="")return null;let i=P.trim().replace(/[\s,]/g,"");const _=i.slice(-1).toLowerCase();let h=1;_==="k"?(h=1e3,i=i.slice(0,-1)):_==="m"?(h=1e6,i=i.slice(0,-1)):_==="b"&&(h=1e9,i=i.slice(0,-1));const r=parseFloat(i);return isNaN(r)?null:Math.round(r*h*100)/100}const rt={class:"overflow-x-auto"},lt={class:"w-full text-sm"},at={class:"divide-y divide-slate-800"},it={class:"py-3 px-3"},ut=["onClick"],ct={class:"py-3 px-2"},dt=["onKeydown","onBlur"],pt=["onDblclick","title"],vt={class:"py-3 px-2 text-slate-300"},mt={class:"py-3 px-2 text-center"},xt=["onClick","disabled","title"],ft=["onKeydown","onBlur"],bt=["onDblclick","title"],yt={class:"py-3 px-2 text-right font-mono text-slate-400"},ht=["onKeydown","onBlur"],gt=["onDblclick","title"],kt={class:"py-3 px-2 text-center"},wt=["onClick"],$t={class:"py-3 px-2 text-center"},Ct={class:"flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},_t=["onClick"],St=["onClick"],jt={key:0},Tt={class:"border-t border-slate-600 font-semibold text-slate-200"},Pt={key:0,class:"text-center py-12 text-slate-500"},Mt=_e({__name:"ProjectTable",emits:["view-project"],setup(P,{emit:i}){const _=i,h=Te(),{formatIsk:r}=Ne(),M=m(null),C=m("");function E(B,N){if(B.status==="completed")return;const b=B[N];C.value=b!=null?String(b):"",M.value={id:B.id,field:N}}async function x(B){if(!M.value)return;const N=M.value.field;let b;if(N==="runs"){const V=parseInt(C.value,10);b=isNaN(V)||V<1?B.runs:V}else b=nt(C.value);M.value=null,await h.updateProject(B.id,{[N]:b}),await h.fetchProjects()}function H(){M.value=null}function D(B,N){var b,V;return((b=M.value)==null?void 0:b.id)===B&&((V=M.value)==null?void 0:V.field)===N}function J(B){return B==null?"-":r(B)}function k(B){return B==null?"text-slate-400":B>=0?"text-emerald-400":"text-red-400"}async function g(B){const N=B.status==="active"?"completed":"active";await h.updateProject(B.id,{status:N}),await h.fetchProjects()}async function A(B){await h.deleteProject(B)}async function I(B){B.status!=="completed"&&(await h.updateProject(B.id,{personalUse:!B.personalUse}),await h.fetchProjects())}const S=["bpoCost","materialCost","transportCost"],F=["taxAmount","sellPrice"];return(B,N)=>(t(),s("div",rt,[e("table",lt,[N[11]||(N[11]=e("thead",null,[e("tr",{class:"border-b border-slate-700 text-slate-400 text-xs uppercase tracking-wider"},[e("th",{class:"text-left py-3 px-3"},"Produit"),e("th",{class:"text-left py-3 px-2"},"Runs"),e("th",{class:"text-left py-3 px-2"},"ME"),e("th",{class:"text-center py-3 px-2"},"Perso"),e("th",{class:"text-right py-3 px-2"},"BPC Kit"),e("th",{class:"text-right py-3 px-2"},"Matériaux"),e("th",{class:"text-right py-3 px-2"},"Transport"),e("th",{class:"text-right py-3 px-2"},"Jobs"),e("th",{class:"text-right py-3 px-2"},"Taxes"),e("th",{class:"text-right py-3 px-2"},"Vente"),e("th",{class:"text-right py-3 px-2"},"Profit"),e("th",{class:"text-right py-3 px-2"},"%"),e("th",{class:"text-center py-3 px-2"},"Status"),e("th",{class:"text-center py-3 px-2"})])],-1)),e("tbody",at,[(t(!0),s(O,null,G(d(h).projects,b=>(t(),s("tr",{key:b.id,class:"hover:bg-slate-800/50 group"},[e("td",it,[e("button",{onClick:V=>_("view-project",b.id),class:"text-cyan-400 hover:text-cyan-300 font-medium"},a(b.productTypeName),9,ut)]),e("td",ct,[D(b.id,"runs")?te((t(),s("input",{key:0,"onUpdate:modelValue":N[0]||(N[0]=V=>C.value=V),type:"number",min:"1",class:"w-16 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-sm focus:outline-none",onKeydown:[ve(V=>x(b),["enter"]),ve(H,["escape"])],onBlur:V=>x(b),autofocus:""},null,40,dt)),[[ne,C.value]]):(t(),s("span",{key:1,onDblclick:V=>E(b,"runs"),class:U(["text-slate-300",b.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:b.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},a(b.runs),43,pt))]),e("td",vt,a(b.meLevel),1),e("td",mt,[e("button",{onClick:V=>I(b),disabled:b.status==="completed",class:U(["text-xs px-2 py-1 rounded",b.personalUse?"bg-amber-500/20 text-amber-400":"bg-slate-600/20 text-slate-500",b.status==="completed"?"opacity-50 cursor-not-allowed":""]),title:b.status==="completed"?"Projet terminé":b.personalUse?"Usage personnel":"À vendre"},a(b.personalUse?"Perso":"Vente"),11,xt)]),(t(),s(O,null,G(S,V=>e("td",{key:V,class:"py-3 px-2 text-right"},[D(b.id,V)?te((t(),s("input",{key:0,"onUpdate:modelValue":N[1]||(N[1]=Y=>C.value=Y),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[ve(Y=>x(b),["enter"]),ve(H,["escape"])],onBlur:Y=>x(b),autofocus:""},null,40,ft)),[[ne,C.value]]):(t(),s("span",{key:1,onDblclick:Y=>E(b,V),class:U(["font-mono text-slate-300",b.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:b.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},a(J(b[V])),43,bt))])),64)),e("td",yt,a(J(b.jobsCost)),1),b.personalUse?(t(),s(O,{key:1},[N[3]||(N[3]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),N[4]||(N[4]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),N[5]||(N[5]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1)),N[6]||(N[6]=e("td",{class:"py-3 px-2 text-right text-slate-600 font-mono"},"N/A",-1))],64)):(t(),s(O,{key:0},[(t(),s(O,null,G(F,V=>e("td",{key:V,class:"py-3 px-2 text-right"},[D(b.id,V)?te((t(),s("input",{key:0,"onUpdate:modelValue":N[2]||(N[2]=Y=>C.value=Y),type:"text",placeholder:"ex: 10M, 1.5B",class:"w-24 bg-slate-700 border border-cyan-500 rounded px-2 py-1 text-right text-sm focus:outline-none",onKeydown:[ve(Y=>x(b),["enter"]),ve(H,["escape"])],onBlur:Y=>x(b),autofocus:""},null,40,ht)),[[ne,C.value]]):(t(),s("span",{key:1,onDblclick:Y=>E(b,V),class:U(["font-mono text-slate-300",b.status!=="completed"?"cursor-pointer hover:text-cyan-400":""]),title:b.status!=="completed"?"Double-cliquer pour modifier":"Projet terminé"},a(J(b[V])),43,gt))])),64)),e("td",{class:U(["py-3 px-2 text-right font-mono",k(b.profit)])},a(J(b.profit)),3),e("td",{class:U(["py-3 px-2 text-right font-mono",k(b.profitPercent)])},a(b.profitPercent!==null?`${b.profitPercent}%`:"-"),3)],64)),e("td",kt,[e("button",{onClick:V=>g(b),class:U(["text-xs px-2 py-1 rounded",b.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-cyan-500/20 text-cyan-400"])},a(b.status==="completed"?"Terminé":"Actif"),11,wt)]),e("td",$t,[e("div",Ct,[e("button",{onClick:V=>_("view-project",b.id),class:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-cyan-400",title:"Détails"},[...N[7]||(N[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,_t),e("button",{onClick:V=>A(b.id),class:"p-1 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400",title:"Supprimer"},[...N[8]||(N[8]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,St)])])]))),128))]),d(h).projects.length>0?(t(),s("tfoot",jt,[e("tr",Tt,[N[9]||(N[9]=e("td",{colspan:"10",class:"py-3 px-3 text-right"},"Total Profit",-1)),e("td",{class:U(["py-3 px-2 text-right font-mono",k(d(h).totalProfit)])},a(J(d(h).totalProfit)),3),N[10]||(N[10]=e("td",{colspan:"3"},null,-1))])])):y("",!0)]),d(h).projects.length===0?(t(),s("div",Pt," Aucun projet. Créez votre premier projet de construction ci-dessus. ")):y("",!0)]))}}),Et={class:"space-y-6"},Bt={class:"text-xs font-semibold uppercase tracking-wider text-slate-500 mb-2"},It={class:"space-y-1"},Rt=["onClick"],Lt=["src"],At={class:"flex-1 min-w-0"},Nt={class:"flex items-center gap-2 flex-wrap"},Jt={class:"font-medium text-slate-200"},zt={key:0,class:"text-xs text-slate-500"},Vt=["title"],Dt={class:"text-emerald-400"},Ht={class:"flex items-center gap-3 mt-1 text-xs"},Ft={key:0,class:"text-red-400"},Ut={key:1,class:"text-slate-500"},Ot={key:2,class:"text-cyan-400"},qt={key:3,class:"text-emerald-400"},Kt=["checked","disabled","onChange"],Xt=["src"],Qt={class:"flex-1 min-w-0"},Wt={class:"flex items-center gap-2 flex-wrap"},Yt={class:"font-medium text-slate-200"},Zt={class:"text-xs text-slate-500"},Gt={key:0,class:"inline-flex items-center gap-1"},es=["onKeydown","onBlur"],ts=["onDblclick"],ss=["title"],os={key:2,class:"text-xs text-slate-500"},ns={key:3,class:"text-xs px-1.5 py-0.5 rounded bg-blue-500/20 text-blue-400",title:"Lie a un job ESI"},rs=["title"],ls={key:0,class:"flex items-center gap-2 mt-1 text-xs flex-wrap"},as={key:0,class:"text-slate-500"},is={key:1,class:"text-slate-600"},us={key:2,class:"text-slate-500"},cs={key:3,class:"text-amber-400"},ds=["checked","disabled","onChange"],ps={key:0,class:"text-xs font-mono text-slate-400"},vs=["onClick"],ms={key:2,class:"w-7"},xs={key:0,class:"flex items-center gap-3 p-3 ml-6 rounded-lg border border-dashed border-slate-600 hover:border-cyan-500/50 transition-colors"},fs={key:0,class:"flex items-center gap-2 flex-1"},bs=["onKeydown"],ys=["onClick"],hs=["onClick"],gs={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ks={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 p-6"},ws={class:"text-slate-400 mb-6"},$s={class:"text-slate-200 font-medium"},Cs=_e({__name:"StepTree",props:{steps:{},readonly:{type:Boolean}},emits:["toggle-purchased","update-step-runs","delete-step","add-child-job"],setup(P,{emit:i}){const _=P,h=i,r=m(null),M=m(0),C=m(null),E=m(1),x=m(null),H=m(!1),D=m(null),J=m("");Re(()=>_.steps,u=>{if(x.value){const c=u.find(q=>q.id===x.value);c!=null&&c.splitGroupId&&I.value.add(c.splitGroupId),x.value=null}},{deep:!0});const{formatIsk:k}=Ne(),{getTypeIconUrl:g,onImageError:A}=Ae(),I=m(new Set);function S(u){I.value.has(u)?I.value.delete(u):I.value.add(u)}function F(u){return u.purchased?3:u.esiJobStatus==="delivered"||u.esiJobStatus==="ready"?2:u.esiJobStatus==="active"?1:0}function B(u){return u.children.length===0?99:Math.min(...u.children.map(F))}function N(u){let c=0,q=0,j=0;for(const n of u)n.purchased||(n.esiJobId?n.esiJobStatus==="active"?q+=n.runs:n.esiJobStatus==="delivered"||n.esiJobStatus==="ready"?j+=n.runs:q+=n.runs:c+=n.runs);return{toLaunch:c,inProgress:q,completed:j}}const b=ye(()=>{const u=new Map;for(const n of _.steps){const z=n.isSplit&&n.splitGroupId?n.splitGroupId:`single_${n.id}`;let Q=u.get(z);Q||(Q={splitGroupId:z,productTypeName:n.productTypeName,productTypeId:n.productTypeId,activityType:n.activityType,depth:n.depth,totalExpectedRuns:n.isSplit?n.totalGroupRuns??n.runs:n.runs,children:[],actualTotalRuns:0,isValid:!1,runsToLaunch:0,runsInProgress:0,runsCompleted:0,recommendedStructureName:n.recommendedStructureName,structureBonus:n.structureBonus},u.set(z,Q)),Q.children.push(n)}for(const n of u.values()){n.children.sort((Q,ee)=>ee.runs-Q.runs),n.actualTotalRuns=n.children.reduce((Q,ee)=>Q+ee.runs,0),n.isValid=n.actualTotalRuns===n.totalExpectedRuns;const z=N(n.children);n.runsToLaunch=z.toLaunch,n.runsInProgress=z.inProgress,n.runsCompleted=z.completed}const c=new Map;for(const n of u.values()){if(n.children.length===0)continue;const z=n.children[0],Q=V(z);let ee=c.get(Q);ee||(ee={label:Q,items:[]},c.set(Q,ee)),ee.items.push(n)}const q=Array.from(c.values());for(const n of q)n.items.sort((z,Q)=>{const ee=B(z)-B(Q);return ee!==0?ee:z.productTypeName.localeCompare(Q.productTypeName)});const j={copy:0,reaction:1,manufacturing:2};return q.sort((n,z)=>{var o,Z,ie,pe;const Q=Math.min(...n.items.map(B)),ee=Math.min(...z.items.map(B));if(Q!==ee)return Q-ee;const Pe=(o=n.items[0])==null?void 0:o.activityType,he=(Z=z.items[0])==null?void 0:Z.activityType,ke=(j[Pe??""]??99)-(j[he??""]??99);if(ke!==0)return ke;const Me=((ie=n.items[0])==null?void 0:ie.depth)??0;return(((pe=z.items[0])==null?void 0:pe.depth)??0)-Me}),q});function V(u){return`${u.activityType==="reaction"?"Réactions":u.activityType==="copy"?"Copies (BPC)":"Manufacturing"} — Niveau ${u.depth}`}function Y(u){return u==="reaction"?"bg-purple-500/20 text-purple-400":u==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function me(u){return u==="reaction"?"Réaction":u==="copy"?"BPC":"Fab"}function ce(u){return u.esiJobId!==null}function de(u){return u.map(c=>`${c.characterName}: ${c.runs} runs (${c.status==="active"?"en cours":"termine"})`).join(`
`)}function xe(u){return u.purchased?"Acheté":u.esiJobStatus==="active"?"En cours":u.esiJobStatus==="delivered"||u.esiJobStatus==="ready"?"Terminé":"À lancer"}function re(u){return u.purchased?"bg-amber-500/20 text-amber-400":u.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":u.esiJobStatus==="delivered"||u.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400"}function le(u){_.readonly||h("toggle-purchased",u.id,!u.purchased)}function se(u){return u.length>0&&u.every(c=>c.purchased)}function ae(u){if(_.readonly)return;const c=!se(u);for(const q of u)q.purchased!==c&&h("toggle-purchased",q.id,c)}function fe(u,c){_.readonly||(D.value=u,J.value=c,H.value=!0)}function be(){D.value&&h("delete-step",D.value),H.value=!1,D.value=null,J.value=""}function we(){H.value=!1,D.value=null,J.value=""}function Se(u){_.readonly||(r.value=u.id,M.value=u.runs)}function p(u){M.value>=1&&h("update-step-runs",u,M.value),r.value=null}function f(){r.value=null}function T(u){_.readonly||(C.value=u,E.value=1)}function w(u,c){E.value>=1&&(u.startsWith("single_")?(x.value=c,h("add-child-job",null,c,E.value)):(I.value.add(u),h("add-child-job",u,null,E.value))),C.value=null}function R(){C.value=null}return(u,c)=>(t(),s("div",Et,[(t(!0),s(O,null,G(b.value,q=>(t(),s("div",{key:q.label},[e("h5",Bt,a(q.label),1),e("div",It,[(t(!0),s(O,null,G(q.items,j=>(t(),s(O,{key:j.splitGroupId},[e("div",{class:U(["flex items-center gap-3 p-3 rounded-lg border cursor-pointer",[j.isValid?"bg-slate-800/70 border-slate-600":"bg-red-900/20 border-red-500/50"]]),onClick:n=>S(j.splitGroupId)},[(t(),s("svg",{class:U(["w-4 h-4 text-slate-400 transition-transform",{"rotate-90":I.value.has(j.splitGroupId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...c[8]||(c[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),e("img",{src:d(g)(j.productTypeId,32),class:"w-8 h-8 rounded",onError:c[0]||(c[0]=(...n)=>d(A)&&d(A)(...n))},null,40,Lt),e("div",At,[e("div",Nt,[e("span",Jt,a(j.productTypeName),1),j.children.length>1?(t(),s("span",zt,"("+a(j.children.length)+" jobs)",1)):y("",!0),e("span",{class:U(["text-xs px-1.5 py-0.5 rounded",Y(j.activityType)])},a(me(j.activityType)),3),j.recommendedStructureName?(t(),s("span",{key:1,class:"text-xs text-slate-500 flex items-center gap-1",title:`Bonus: ${j.structureBonus}%`},[c[9]||(c[9]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),W(" "+a(j.recommendedStructureName)+" ",1),e("span",Dt,"("+a(j.structureBonus)+"%)",1)],8,Vt)):y("",!0)]),e("div",Ht,[e("span",{class:U(["font-mono",j.isValid?"text-slate-400":"text-red-400"])},a(j.actualTotalRuns)+" / "+a(j.totalExpectedRuns)+" runs ",3),j.isValid?y("",!0):(t(),s("span",Ft," ("+a(j.actualTotalRuns>j.totalExpectedRuns?"+":"")+a(j.actualTotalRuns-j.totalExpectedRuns)+") ",1)),j.runsToLaunch>0?(t(),s("span",Ut,a(j.runsToLaunch)+" à lancer ",1)):y("",!0),j.runsInProgress>0?(t(),s("span",Ot,a(j.runsInProgress)+" en cours ",1)):y("",!0),j.runsCompleted>0?(t(),s("span",qt,a(j.runsCompleted)+" terminés ",1)):y("",!0)])]),e("label",{class:U(["flex items-center gap-1.5",P.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:c[1]||(c[1]=ue(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:se(j.children),disabled:P.readonly,onChange:n=>ae(j.children),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,Kt),c[10]||(c[10]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)],10,Rt),I.value.has(j.splitGroupId)?(t(),s(O,{key:0},[(t(!0),s(O,null,G(j.children,n=>(t(),s("div",{key:n.id,class:"flex items-center gap-3 p-3 ml-6 rounded-lg bg-slate-800/50 border border-slate-700"},[e("img",{src:d(g)(n.productTypeId,32),class:"w-8 h-8 rounded",onError:c[2]||(c[2]=(...z)=>d(A)&&d(A)(...z))},null,40,Xt),e("div",Qt,[e("div",Wt,[e("span",Yt,a(n.productTypeName),1),e("span",Zt,"×"+a(n.quantity.toLocaleString()),1),!ce(n)&&!P.readonly?(t(),s(O,{key:0},[r.value===n.id?(t(),s("span",Gt,[c[11]||(c[11]=e("span",{class:"text-xs text-slate-600"},"(",-1)),te(e("input",{"onUpdate:modelValue":c[3]||(c[3]=z=>M.value=z),type:"number",min:"1",class:"w-16 px-1 py-0.5 bg-slate-700 border border-cyan-500 rounded text-xs text-slate-200 focus:outline-none",onKeydown:[ve(z=>p(n.id),["enter"]),ve(f,["escape"])],onBlur:z=>p(n.id),onFocus:c[4]||(c[4]=z=>z.target.select()),onClick:c[5]||(c[5]=ue(()=>{},["stop"])),autofocus:""},null,40,es),[[ne,M.value,void 0,{number:!0}]]),c[12]||(c[12]=e("span",{class:"text-xs text-slate-600"},"runs)",-1))])):(t(),s("span",{key:1,onDblclick:ue(z=>Se(n),["stop"]),class:"text-xs text-slate-600 cursor-pointer hover:text-cyan-400",title:"Double-cliquer pour modifier"}," ("+a(n.runs)+" runs) ",41,ts))],64)):(t(),s("span",{key:1,class:"text-xs text-slate-600",title:ce(n)?"Lié à ESI - non modifiable":"Projet terminé"}," ("+a(n.runs)+" runs) ",9,ss)),n.isSplit?(t(),s("span",os,"#"+a(n.splitIndex+1),1)):y("",!0),ce(n)?(t(),s("span",ns," ESI ")):y("",!0),n.similarJobs&&n.similarJobs.length>0?(t(),s("span",{key:4,class:"text-xs px-1.5 py-0.5 rounded bg-amber-500/20 text-amber-400 cursor-help",title:de(n.similarJobs)},a(n.similarJobs.length)+" job"+a(n.similarJobs.length>1?"s":"")+" similaire"+a(n.similarJobs.length>1?"s":""),9,rs)):y("",!0)]),n.esiJobId||n.manualJobData?(t(),s("div",ls,[n.esiJobCharacterName?(t(),s("span",as,a(n.esiJobCharacterName),1)):y("",!0),n.esiJobsCount&&n.esiJobsCount>1?(t(),s("span",is," ("+a(n.esiJobsCount)+" jobs) ",1)):y("",!0),e("span",{class:U(["font-mono",n.esiJobsTotalRuns&&n.esiJobsTotalRuns>=n.runs?"text-emerald-400":"text-amber-400"])},a(n.esiJobsTotalRuns||n.esiJobRuns||0)+" / "+a(n.runs)+" runs ",3),n.esiJobsActiveRuns||n.esiJobsDeliveredRuns?(t(),s("span",us," ("+a(n.esiJobsDeliveredRuns||0)+" livrés, "+a(n.esiJobsActiveRuns||0)+" en cours) ",1)):y("",!0),n.manualJobData?(t(),s("span",cs,"(manuel)")):y("",!0)])):y("",!0)]),e("span",{class:U(["text-xs px-2 py-1 rounded",re(n)])},a(xe(n)),3),e("label",{class:U(["flex items-center gap-1.5",P.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"]),onClick:c[6]||(c[6]=ue(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:n.purchased,disabled:P.readonly,onChange:z=>le(n),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,ds),c[13]||(c[13]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2),n.esiJobCost?(t(),s("span",ps,a(d(k)(n.esiJobCost)),1)):y("",!0),!ce(n)&&!P.readonly?(t(),s("button",{key:1,onClick:ue(z=>fe(n.id,n.productTypeName),["stop"]),class:"p-1.5 text-slate-500 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer cette étape"},[...c[14]||(c[14]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,vs)):(t(),s("div",ms))]))),128)),P.readonly?y("",!0):(t(),s("div",xs,[C.value===j.splitGroupId?(t(),s("div",fs,[c[15]||(c[15]=e("span",{class:"text-sm text-slate-400"},"Runs:",-1)),te(e("input",{"onUpdate:modelValue":c[7]||(c[7]=n=>E.value=n),type:"number",min:"1",class:"w-20 px-2 py-1 bg-slate-700 border border-cyan-500 rounded text-sm text-slate-200 focus:outline-none",onKeydown:[ve(n=>{var z;return w(j.splitGroupId,(z=j.children[0])==null?void 0:z.id)},["enter"]),ve(R,["escape"])],autofocus:""},null,40,bs),[[ne,E.value,void 0,{number:!0}]]),e("button",{onClick:n=>{var z;return w(j.splitGroupId,(z=j.children[0])==null?void 0:z.id)},class:"px-3 py-1 bg-cyan-600 hover:bg-cyan-500 rounded text-sm text-white"}," Ajouter ",8,ys),e("button",{onClick:R,class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm text-slate-300"}," Annuler ")])):(t(),s("button",{key:1,onClick:n=>T(j.splitGroupId),class:"flex items-center gap-2 text-slate-500 hover:text-cyan-400 transition-colors"},[...c[16]||(c[16]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"text-sm"},"Ajouter un job",-1)])],8,hs))]))],64)):y("",!0)],64))),128))])]))),128)),(t(),Ce(Ie,{to:"body"},[H.value?(t(),s("div",gs,[e("div",{class:"absolute inset-0 bg-black/70",onClick:we}),e("div",ks,[c[19]||(c[19]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-2"},"Supprimer l'étape",-1)),e("p",ws,[c[17]||(c[17]=W(" Voulez-vous vraiment supprimer l'étape ",-1)),e("span",$s,'"'+a(J.value)+'"',1),c[18]||(c[18]=W(" ? ",-1))]),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:we,class:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg text-slate-300 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:be,class:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white text-sm font-medium transition-colors"}," Supprimer ")])])])):y("",!0)]))]))}}),_s={class:"space-y-2"},Ss={class:"bg-slate-800/50 border border-slate-700 rounded-lg p-3"},js={class:"flex items-center gap-3"},Ts=["src"],Ps={class:"flex-1 min-w-0"},Ms={class:"flex items-center gap-2 flex-wrap"},Es={class:"font-medium text-slate-200"},Bs={class:"text-xs text-slate-500"},Is={class:"text-xs text-slate-600"},Rs={key:0,class:"text-xs text-slate-500 flex items-center gap-1 mt-1"},Ls={class:"text-emerald-400"},As=["checked","disabled"],Ns={key:0,class:"pl-6 border-l-2 border-slate-700 ml-4 space-y-2"},Js={key:0,class:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-2"},zs={class:"flex items-center gap-2"},Vs=["src"],Ds={class:"text-sm text-slate-400"},Hs={class:"text-xs text-slate-500 ml-auto"},Fs=_e({__name:"StepHierarchyTree",props:{tree:{},steps:{},readonly:{type:Boolean}},emits:["toggle-purchased"],setup(P,{emit:i}){const _=P,h=i,{getTypeIconUrl:r,onImageError:M}=Ae();function C(k){return _.steps.find(g=>g.blueprintTypeId===k.blueprintTypeId&&g.activityType===k.activityType)}function E(k){return k==="reaction"?"bg-purple-500/20 text-purple-400":k==="copy"?"bg-blue-500/20 text-blue-400":"bg-cyan-500/20 text-cyan-400"}function x(k){return k==="reaction"?"Réaction":k==="copy"?"BPC":"Fab"}function H(k){return k?k.purchased?"Acheté":k.esiJobStatus==="active"?"En cours":k.esiJobStatus==="delivered"||k.esiJobStatus==="ready"?"Terminé":"À lancer":"-"}function D(k){return k?k.purchased?"bg-amber-500/20 text-amber-400":k.esiJobStatus==="active"?"bg-cyan-500/20 text-cyan-400":k.esiJobStatus==="delivered"||k.esiJobStatus==="ready"?"bg-emerald-500/20 text-emerald-400":"bg-slate-500/20 text-slate-400":"bg-slate-500/20 text-slate-400"}function J(k){_.readonly||h("toggle-purchased",k.id,!k.purchased)}return(k,g)=>{var I;const A=Oe("StepHierarchyTree",!0);return t(),s("div",_s,[e("div",Ss,[e("div",js,[e("img",{src:d(r)(P.tree.productTypeId,32),class:"w-8 h-8 rounded",onError:g[0]||(g[0]=(...S)=>d(M)&&d(M)(...S))},null,40,Ts),e("div",Ps,[e("div",Ms,[e("span",Es,a(P.tree.productTypeName),1),e("span",Bs,"×"+a(P.tree.quantity.toLocaleString()),1),e("span",Is,"("+a(P.tree.runs)+" runs)",1),e("span",{class:U(["text-xs px-1.5 py-0.5 rounded",E(P.tree.activityType)])},a(x(P.tree.activityType)),3)]),P.tree.structureName?(t(),s("div",Rs,[g[4]||(g[4]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),W(" "+a(P.tree.structureName)+" ",1),e("span",Ls,"("+a(P.tree.structureBonus)+"%)",1)])):y("",!0)]),C(P.tree)?(t(),s(O,{key:0},[e("span",{class:U(["text-xs px-2 py-1 rounded",D(C(P.tree))])},a(H(C(P.tree))),3),e("label",{class:U(["flex items-center gap-1.5",P.readonly?"cursor-not-allowed opacity-50":"cursor-pointer"])},[e("input",{type:"checkbox",checked:(I=C(P.tree))==null?void 0:I.purchased,disabled:P.readonly,onChange:g[1]||(g[1]=S=>J(C(P.tree))),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-900 disabled:cursor-not-allowed"},null,40,As),g[5]||(g[5]=e("span",{class:"text-xs text-slate-400"},"Acheté",-1))],2)],64)):y("",!0)])]),P.tree.materials&&P.tree.materials.length>0?(t(),s("div",Ns,[(t(!0),s(O,null,G(P.tree.materials,S=>(t(),s("div",{key:S.typeId,class:"relative"},[g[6]||(g[6]=e("div",{class:"absolute -left-6 top-4 w-6 h-0.5 bg-slate-700"},null,-1)),S.isBuildable?S.blueprint?(t(),Ce(A,{key:1,tree:S.blueprint,steps:P.steps,readonly:P.readonly,onTogglePurchased:g[3]||(g[3]=(F,B)=>h("toggle-purchased",F,B))},null,8,["tree","steps","readonly"])):y("",!0):(t(),s("div",Js,[e("div",zs,[e("img",{src:d(r)(S.typeId,32),class:"w-6 h-6 rounded",onError:g[2]||(g[2]=(...F)=>d(M)&&d(M)(...F))},null,40,Vs),e("span",Ds,a(S.typeName),1),e("span",Hs,"×"+a(S.quantity.toLocaleString()),1)])]))]))),128))])):y("",!0)])}}}),Us={class:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden"},Os={class:"px-6 py-4 border-b border-slate-800 flex items-center justify-between"},qs={class:"flex items-center gap-4"},Ks={key:0,class:"flex items-center gap-3"},Xs=["src"],Qs={class:"text-lg font-semibold text-slate-100"},Ws={class:"text-sm text-slate-500"},Ys={class:"flex items-center gap-2"},Zs=["disabled"],Gs={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},eo={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},to={class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},so={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},oo={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},no={key:0,class:"p-8 text-center text-slate-500"},ro={key:1,class:"p-6"},lo={key:0,class:"mb-4 p-3 bg-amber-500/20 border border-amber-500/50 rounded-lg flex items-center gap-3"},ao={class:"text-amber-200 text-sm"},io={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},uo={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},co={class:"text-lg font-mono text-slate-200 mt-1"},po={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},vo={class:"text-lg font-mono text-slate-200 mt-1"},mo={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},xo={class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700/50"},fo={class:"flex gap-4 mb-4 border-b border-slate-700"},bo=["disabled","title"],yo={key:1},ho={class:"mb-4 flex items-center justify-between"},go={class:"flex items-center gap-4"},ko={class:"flex items-center gap-1 bg-slate-800 rounded-lg p-1"},wo={key:0},$o={key:0},Co={key:1,class:"text-center py-8 text-slate-500"},_o={key:1},So={key:0},jo={key:1,class:"text-center py-8 text-slate-500"},To={key:2},Po={key:0,class:"text-center py-8 text-slate-500"},Mo={key:1,class:"text-center py-8"},Eo={class:"bg-red-900/20 border border-red-500/30 rounded-xl p-6 max-w-md mx-auto"},Bo={class:"text-slate-400 text-sm mb-4"},Io={key:2,class:"text-center py-8 text-slate-500"},Ro={key:3},Lo={key:0,class:"mb-4 flex flex-wrap items-center gap-4"},Ao={class:"relative min-w-[280px]"},No={class:"relative"},Jo=["placeholder"],zo={class:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center"},Vo={key:0,class:"w-4 h-4 animate-spin text-cyan-400",fill:"none",viewBox:"0 0 24 24"},Do={key:0,class:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-48 overflow-y-auto"},Ho=["onMousedown"],Fo={class:"truncate"},Uo={key:0,class:"px-3 py-2 text-slate-400 text-sm"},Oo={class:"flex items-center gap-2"},qo={key:0,class:"flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg border border-slate-700"},Ko={class:"text-sm text-slate-400"},Xo={class:"font-mono text-slate-200"},Qo={class:"font-mono text-emerald-400"},Wo={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Yo={class:"relative bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},Zo={class:"px-6 py-4"},Go={class:"px-6 py-4 border-t border-slate-700 flex justify-end gap-3"},en=["disabled"],tn={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sn={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},on="C-J6MT - 1st Taj Mahgoon",nn=_e({__name:"ProjectDetail",props:{projectId:{}},emits:["close"],setup(P,{emit:i}){const _=P,h=i,r=Te(),M=qe(),{formatIsk:C,formatDateTime:E}=Ne(),{getTypeIconUrl:x,onImageError:H}=Ae(),D=m("steps"),J=m("flat"),k=m([]),g=m(""),A=m(!1),I=m(!1),S=m(null),F=m(null),B=m(null),N=m(!1),b=m(!1),V=m(1200),Y=m(!1),me=m(null),ce=m(!1),de=m(""),xe=m(!1),re=m({id:null,name:""}),le=m(""),se=m([]),ae=m(!1),fe=m(!1);let be=null;Re(le,L=>{if(be&&clearTimeout(be),L.length<3){se.value=[];return}be=setTimeout(()=>{we(L)},300)});async function we(L){ae.value=!0;try{const o=await Ke(`/api/shopping-list/search-structures?q=${encodeURIComponent(L)}`,{headers:{Authorization:`Bearer ${M.token}`,"X-Requested-With":"XMLHttpRequest"}});if(o.ok){const Z=await Xe(o);se.value=Z.results,fe.value=!0}}catch(o){console.error("Structure search failed:",o)}finally{ae.value=!1}}function Se(L){re.value={id:L.id,name:L.name},le.value="",se.value=[],fe.value=!1}function p(){re.value={id:null,name:""},le.value="",se.value=[]}function f(){setTimeout(()=>{fe.value=!1},200)}Le(()=>{r.fetchProject(_.projectId)});async function T(L,o){await r.toggleStepPurchased(_.projectId,L,o),D.value==="shopping"&&await u()}async function w(){Y.value=!0,me.value=null;try{const L=await r.matchJobs(_.projectId);me.value=L,await r.fetchProject(_.projectId)}finally{Y.value=!1}}function R(L){return Math.ceil(L/1e6)*1e6}async function u(){N.value=!0,B.value=null;try{const L=re.value.id??void 0,o=await r.fetchShoppingList(_.projectId,L,V.value);if(o){if(k.value=o.materials,g.value=o.structureName,A.value=o.structureAccessible,I.value=o.structureFromCache,S.value=o.structureLastSync,F.value=o.totals,B.value=o.priceError,r.currentProject&&(r.currentProject.materialCost===null||r.currentProject.materialCost===0)&&o.totals.best>0){const Z=R(o.totals.best);await r.updateProject(_.projectId,{materialCost:Z})}}else k.value=[],F.value=null,A.value=!1,B.value=r.error}catch(L){k.value=[],F.value=null,A.value=!1,B.value=L instanceof Error?L.message:"Erreur lors du chargement"}finally{N.value=!1}}async function c(){b.value=!0;try{const L=re.value.id??void 0;await X("/shopping-list/sync-structure-market",{method:"POST",body:JSON.stringify({structureId:L})}),await u()}catch(L){B.value=L instanceof Error?L.message:"Sync failed"}finally{b.value=!1}}async function q(){if(!F.value||!r.currentProject)return;const L=R(F.value.best);await r.updateProject(_.projectId,{materialCost:L})}async function j(L){var o;D.value=L,L==="shopping"&&k.value.length===0&&((o=r.currentProject)==null?void 0:o.status)!=="completed"&&await u()}async function n(L){await r.deleteStep(_.projectId,L)}async function z(L,o,Z){await r.addChildJob(_.projectId,L,o,Z)}async function Q(L,o){await r.updateStepRuns(_.projectId,L,o)}async function ee(){if(!r.currentProject)return;const L=r.currentProject.status==="completed"?"active":"completed";await r.updateProject(_.projectId,{status:L}),L==="completed"&&(D.value="steps")}function Pe(){de.value="",ce.value=!0}function he(){ce.value=!1,de.value=""}async function ke(){var L;if((L=r.currentProject)!=null&&L.steps){xe.value=!0;try{let o=null;if(de.value.trim()){const pe=de.value.trim().toLowerCase().replace(/,/g,".").match(/^([\d.]+)\s*([kmb])?$/);if(pe){let ge=parseFloat(pe[1]);const $e=pe[2];$e==="k"?ge*=1e3:$e==="m"?ge*=1e6:$e==="b"&&(ge*=1e9),o=Math.round(ge)}}const Z=r.currentProject.steps.filter(ie=>ie.activityType==="copy");for(const ie of Z)ie.purchased||await r.toggleStepPurchased(_.projectId,ie.id,!0);o!==null&&o>0&&await r.updateProject(_.projectId,{bpoCost:o}),he()}finally{xe.value=!1}}}function Me(){var L,o;return((o=(L=r.currentProject)==null?void 0:L.steps)==null?void 0:o.some(Z=>Z.activityType==="copy"))??!1}return(L,o)=>{var Z,ie,pe,ge,$e,Be,$,l,v,oe;return t(),s(O,null,[e("div",Us,[e("div",Os,[e("div",qs,[e("button",{onClick:o[0]||(o[0]=K=>h("close")),class:"p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-slate-200"},[...o[11]||(o[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),d(r).currentProject?(t(),s("div",Ks,[e("img",{src:d(x)(d(r).currentProject.productTypeId,64),class:"w-10 h-10 rounded",onError:o[1]||(o[1]=(...K)=>d(H)&&d(H)(...K))},null,40,Xs),e("div",null,[e("h3",Qs,a(d(r).currentProject.productTypeName),1),e("p",Ws,a(d(r).currentProject.runs)+" runs - ME "+a(d(r).currentProject.meLevel)+" - Créé le "+a(d(E)(d(r).currentProject.createdAt)),1)])])):y("",!0)]),e("div",Ys,[((Z=d(r).currentProject)==null?void 0:Z.status)!=="completed"?(t(),s("button",{key:0,onClick:w,disabled:Y.value,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-cyan-800 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium flex items-center gap-2"},[Y.value?(t(),s("svg",Gs,[...o[12]||(o[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(t(),s("svg",eo,[...o[13]||(o[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"},null,-1)])])),W(" "+a(Y.value?"Synchronisation...":"Lier jobs ESI"),1)],8,Zs)):y("",!0),e("button",{onClick:ee,class:U(["px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2",((ie=d(r).currentProject)==null?void 0:ie.status)==="completed"?"bg-amber-600 hover:bg-amber-500 text-white":"bg-emerald-600 hover:bg-emerald-500 text-white"])},[(t(),s("svg",to,[((pe=d(r).currentProject)==null?void 0:pe.status)==="completed"?(t(),s("path",so)):(t(),s("path",oo))])),W(" "+a(((ge=d(r).currentProject)==null?void 0:ge.status)==="completed"?"Réactiver":"Terminé"),1)],2)])]),d(r).isLoading?(t(),s("div",no,[...o[14]||(o[14]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),W(" Chargement... ",-1)])])):d(r).currentProject?(t(),s("div",ro,[me.value?(t(),s("div",lo,[o[16]||(o[16]=e("svg",{class:"w-5 h-5 text-amber-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",ao,a(me.value),1),e("button",{onClick:o[2]||(o[2]=K=>me.value=null),class:"ml-auto p-1 hover:bg-amber-500/30 rounded text-amber-400"},[...o[15]||(o[15]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):y("",!0),e("div",io,[e("div",uo,[o[17]||(o[17]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Coût total",-1)),e("p",co,a(d(C)(d(r).currentProject.totalCost)),1)]),e("div",po,[o[18]||(o[18]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Coût jobs",-1)),e("p",vo,a(d(C)(d(r).currentProject.jobsCost)),1)]),e("div",mo,[o[19]||(o[19]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Prix de vente",-1)),e("p",{class:U(["text-lg font-mono mt-1",d(r).currentProject.personalUse?"text-slate-600":"text-slate-200"])},a(d(r).currentProject.personalUse?"N/A":d(r).currentProject.sellPrice!==null?d(C)(d(r).currentProject.sellPrice):"-"),3)]),e("div",xo,[o[20]||(o[20]=e("p",{class:"text-xs text-slate-500 uppercase tracking-wider"},"Profit",-1)),e("p",{class:U(["text-lg font-mono mt-1",d(r).currentProject.personalUse?"text-slate-600":d(r).currentProject.profit!==null?d(r).currentProject.profit>=0?"text-emerald-400":"text-red-400":"text-slate-400"])},a(d(r).currentProject.personalUse?"N/A":d(r).currentProject.profit!==null?d(C)(d(r).currentProject.profit):"-"),3)])]),e("div",fo,[e("button",{onClick:o[3]||(o[3]=K=>j("steps")),class:U(["pb-2 text-sm font-medium border-b-2 -mb-px",D.value==="steps"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 hover:text-slate-300"])}," Étapes de production ",2),e("button",{onClick:o[4]||(o[4]=K=>{var Ee;return((Ee=d(r).currentProject)==null?void 0:Ee.status)!=="completed"&&j("shopping")}),disabled:(($e=d(r).currentProject)==null?void 0:$e.status)==="completed",class:U(["pb-2 text-sm font-medium border-b-2 -mb-px",((Be=d(r).currentProject)==null?void 0:Be.status)==="completed"?"border-transparent text-slate-600 cursor-not-allowed":D.value==="shopping"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 hover:text-slate-300"]),title:(($=d(r).currentProject)==null?void 0:$.status)==="completed"?"Non disponible pour les projets terminés":""}," Liste de courses ",10,bo)]),D.value==="steps"?(t(),s("div",yo,[e("div",ho,[e("div",go,[Me()&&((l=d(r).currentProject)==null?void 0:l.status)!=="completed"?(t(),s("button",{key:0,onClick:Pe,class:"flex items-center gap-2 text-sm px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/50 rounded-lg text-blue-400"},[...o[21]||(o[21]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),W(" BPC Kit ",-1)])])):y("",!0)]),e("div",ko,[e("button",{onClick:o[5]||(o[5]=K=>J.value="flat"),class:U(["px-3 py-1.5 text-xs font-medium rounded transition-colors",J.value==="flat"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...o[22]||(o[22]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})]),W(" Liste ")],-1)])],2),e("button",{onClick:o[6]||(o[6]=K=>J.value="tree"),class:U(["px-3 py-1.5 text-xs font-medium rounded transition-colors",J.value==="tree"?"bg-cyan-600 text-white":"text-slate-400 hover:text-slate-200"])},[...o[23]||(o[23]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4h4v4H3V4zm0 8h4v4H3v-4zm0 8h4v4H3v-4zm8-16h10M11 12h10M11 20h10"})]),W(" Arbre ")],-1)])],2)])]),J.value==="flat"?(t(),s("div",wo,[d(r).currentProject.steps&&d(r).currentProject.steps.length>0?(t(),s("div",$o,[je(Cs,{steps:d(r).currentProject.steps,readonly:d(r).currentProject.status==="completed",onTogglePurchased:T,onUpdateStepRuns:Q,onDeleteStep:n,onAddChildJob:z},null,8,["steps","readonly"])])):(t(),s("div",Co," Aucune étape de production "))])):J.value==="tree"?(t(),s("div",_o,[d(r).currentProject.tree&&d(r).currentProject.steps?(t(),s("div",So,[je(Fs,{tree:d(r).currentProject.tree,steps:d(r).currentProject.steps,readonly:d(r).currentProject.status==="completed",onTogglePurchased:T},null,8,["tree","steps","readonly"])])):(t(),s("div",jo," Arbre de production non disponible "))])):y("",!0)])):y("",!0),D.value==="shopping"?(t(),s("div",To,[N.value?(t(),s("div",Po,[...o[24]||(o[24]=[e("svg",{class:"w-6 h-6 animate-spin mx-auto mb-2 text-cyan-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),W(" Chargement des prix... ",-1)])])):B.value&&k.value.length===0?(t(),s("div",Mo,[e("div",Eo,[o[26]||(o[26]=e("svg",{class:"w-10 h-10 mx-auto mb-3 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),o[27]||(o[27]=e("p",{class:"text-red-400 font-medium mb-2"},"Erreur de chargement",-1)),e("p",Bo,a(B.value),1),e("button",{onClick:u,class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2 mx-auto"},[...o[25]||(o[25]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),W(" Réessayer ",-1)])])])])):k.value.length===0?(t(),s("div",Io," Aucun materiau requis ")):(t(),s("div",Ro,[((v=d(r).currentProject)==null?void 0:v.status)!=="completed"?(t(),s("div",Lo,[e("div",Ao,[o[30]||(o[30]=e("label",{class:"block text-xs text-slate-500 mb-1"},"Structure (avec Jita)",-1)),e("div",No,[te(e("input",{"onUpdate:modelValue":o[7]||(o[7]=K=>le.value=K),type:"text",placeholder:re.value.id?re.value.name:on+" (défaut)",class:U(["w-full bg-slate-800 border rounded pl-3 pr-8 py-1.5 text-sm focus:outline-none",re.value.id?"border-cyan-500/50 text-cyan-400 placeholder-cyan-400":"border-slate-600 text-slate-200 placeholder-slate-400 focus:border-cyan-500/50"]),onFocus:o[8]||(o[8]=K=>fe.value=!0),onBlur:f},null,42,Jo),[[ne,le.value]]),e("div",zo,[ae.value?(t(),s("svg",Vo,[...o[28]||(o[28]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):re.value.id||le.value?(t(),s("button",{key:1,onMousedown:ue(p,["prevent"]),class:"text-slate-400 hover:text-slate-200",title:"Revenir au défaut"},[...o[29]||(o[29]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],32)):y("",!0)]),fe.value&&(se.value.length>0||le.value.length>=3&&!ae.value)?(t(),s("div",Do,[(t(!0),s(O,null,G(se.value,K=>(t(),s("button",{key:K.id,onMousedown:ue(Ee=>Se(K),["prevent"]),class:"w-full px-3 py-2 text-left text-sm text-slate-200 hover:bg-slate-700/50 transition-colors border-b border-slate-700/50 last:border-0"},[e("div",Fo,a(K.name),1)],40,Ho))),128)),le.value.length>=3&&se.value.length===0&&!ae.value?(t(),s("div",Uo," Aucune structure trouvée ")):y("",!0)])):y("",!0)])]),e("div",null,[o[32]||(o[32]=e("label",{class:"block text-xs text-slate-500 mb-1"},"Transport",-1)),e("div",Oo,[te(e("input",{"onUpdate:modelValue":o[9]||(o[9]=K=>V.value=K),type:"number",min:"0",step:"100",class:"w-24 px-2 py-1.5 bg-slate-800 border border-slate-600 rounded text-slate-200 text-sm font-mono focus:outline-none focus:border-cyan-500"},null,512),[[ne,V.value,void 0,{number:!0}]]),o[31]||(o[31]=e("span",{class:"text-xs text-slate-500"},"ISK/m³",-1))])]),e("div",{class:"pt-4"},[e("button",{onClick:u,class:"px-4 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded text-white text-sm font-medium"}," Recalculer ")])])):y("",!0),je(Ze,{items:k.value,totals:F.value,"structure-name":g.value,"price-error":B.value,"structure-accessible":A.value,"structure-from-cache":I.value,"structure-last-sync":S.value,"is-syncing":b.value,readonly:((oe=d(r).currentProject)==null?void 0:oe.status)==="completed",onSyncStructure:c},{"after-summary":De(()=>{var K;return[F.value&&F.value.best>0?(t(),s("div",qo,[e("span",Ko,[o[33]||(o[33]=W(" Meilleur prix total: ",-1)),e("span",Xo,a(d(C)(F.value.best)),1),o[34]||(o[34]=W(" → Arrondi au million: ",-1)),e("span",Qo,a(d(C)(R(F.value.best))),1)]),((K=d(r).currentProject)==null?void 0:K.status)!=="completed"?(t(),s("button",{key:0,onClick:q,class:"ml-auto px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded text-white text-sm font-medium flex items-center gap-2"},[...o[35]||(o[35]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),W(" Appliquer comme coût matériaux ",-1)])])):y("",!0)])):y("",!0)]}),_:1},8,["items","totals","structure-name","price-error","structure-accessible","structure-from-cache","structure-last-sync","is-syncing","readonly"])]))])):y("",!0)])):y("",!0)]),(t(),Ce(Ie,{to:"body"},[ce.value?(t(),s("div",Wo,[e("div",{class:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:he}),e("div",Yo,[e("div",{class:"px-6 py-4 border-b border-slate-700 flex items-center justify-between"},[o[37]||(o[37]=e("h3",{class:"text-lg font-semibold text-slate-100 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),W(" BPC Kit ")],-1)),e("button",{onClick:he,class:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-slate-200"},[...o[36]||(o[36]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Zo,[o[40]||(o[40]=e("p",{class:"text-sm text-slate-400 mb-4"}," Cette action va marquer toutes les étapes BPC comme achetées et définir le coût du kit. ",-1)),e("div",null,[o[38]||(o[38]=e("label",{class:"block text-sm font-medium text-slate-300 mb-2"}," Prix du kit BPC ",-1)),te(e("input",{"onUpdate:modelValue":o[10]||(o[10]=K=>de.value=K),type:"text",placeholder:"ex: 50M, 1.5B, 500000",class:"w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 font-mono",onKeydown:[ve(ke,["enter"]),ve(he,["escape"])],autofocus:""},null,544),[[ne,de.value]]),o[39]||(o[39]=e("p",{class:"text-xs text-slate-500 mt-2"}," Formats acceptés : 50M, 1.5B, 500K, 1000000 ",-1))])]),e("div",Go,[e("button",{onClick:he,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Annuler "),e("button",{onClick:ke,disabled:xe.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-blue-800 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[xe.value?(t(),s("svg",tn,[...o[41]||(o[41]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(t(),s("svg",sn,[...o[42]||(o[42]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),o[43]||(o[43]=W(" Confirmer ",-1))],8,en)])])])):y("",!0)]))],64)}}}),rn={class:"space-y-6"},ln={key:0,class:"text-center py-8 text-slate-500"},an={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},un=["checked","onChange"],cn={class:"text-sm text-slate-200"},dn={class:"relative mb-3"},pn={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},vn=["onMousedown"],mn=["src"],xn={class:"text-sm text-slate-200"},fn={key:0,class:"text-xs text-slate-500 ml-auto"},bn={key:0,class:"space-y-1 max-h-64 overflow-y-auto"},yn=["src"],hn={class:"font-medium text-slate-200 flex-1"},gn=["onClick"],kn={key:1,class:"text-sm text-slate-500"},wn=_e({__name:"BlacklistConfig",setup(P){const i=Te(),{getTypeIconUrl:_,onImageError:h}=Ae(),r=m(""),M=m([]),C=m(!1);let E=null;Le(()=>{i.fetchBlacklist()});const x=ye(()=>{if(!i.blacklist)return new Set;const A=new Set;for(const I of i.blacklist.categories)if(I.blacklisted)for(const S of I.groupIds)A.add(S);return A}),H=ye(()=>i.blacklist?new Set(i.blacklist.items.map(A=>A.typeId)):new Set);async function D(A){if(!i.blacklist)return;const I=i.blacklist.categories.find(B=>B.key===A);if(!I)return;const S=[...x.value];let F;I.blacklisted?F=S.filter(B=>!I.groupIds.includes(B)):F=[...new Set([...S,...I.groupIds])],await i.updateBlacklist(F,[...H.value])}async function J(A){const I=[...H.value].filter(S=>S!==A);await i.updateBlacklist([...x.value],I)}async function k(A){if(H.value.has(A))return;const I=[...H.value,A];await i.updateBlacklist([...x.value],I),r.value="",M.value=[],C.value=!1}Re(r,A=>{if(E&&clearTimeout(E),A.length<2){M.value=[],C.value=!1;return}E=setTimeout(async()=>{M.value=await i.searchBlacklistItems(A),C.value=M.value.length>0},300)});function g(){window.setTimeout(()=>{C.value=!1},200)}return(A,I)=>(t(),s("div",rn,[I[7]||(I[7]=e("div",null,[e("h3",{class:"text-lg font-semibold text-slate-100 mb-1"},"Construction Blacklist"),e("p",{class:"text-sm text-slate-400"}," Sélectionnez les catégories et items que vous ne fabriquez pas. Ils seront traités comme des achats dans tous vos projets. ")],-1)),d(i).blacklist?(t(),s(O,{key:1},[e("div",null,[I[4]||(I[4]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Catégories",-1)),e("div",an,[(t(!0),s(O,null,G(d(i).blacklist.categories,S=>(t(),s("label",{key:S.key,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700 cursor-pointer hover:bg-slate-800"},[e("input",{type:"checkbox",checked:S.blacklisted,onChange:F=>D(S.key),class:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-red-500 focus:ring-red-500 focus:ring-offset-slate-900"},null,40,un),e("span",cn,a(S.label),1)]))),128))])]),e("div",null,[I[6]||(I[6]=e("h4",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Items individuels",-1)),e("div",dn,[te(e("input",{"onUpdate:modelValue":I[0]||(I[0]=S=>r.value=S),type:"text",placeholder:"Rechercher un item à blacklister...",class:"w-full px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",onFocus:I[1]||(I[1]=S=>C.value=M.value.length>0),onBlur:g},null,544),[[ne,r.value]]),C.value?(t(),s("div",pn,[(t(!0),s(O,null,G(M.value,S=>(t(),s("button",{key:S.typeId,onMousedown:ue(F=>k(S.typeId),["prevent"]),class:U(["w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-700 text-left",H.value.has(S.typeId)?"opacity-50":""])},[e("img",{src:d(_)(S.typeId,32),class:"w-6 h-6 rounded",onError:I[2]||(I[2]=(...F)=>d(h)&&d(h)(...F))},null,40,mn),e("span",xn,a(S.typeName),1),H.value.has(S.typeId)?(t(),s("span",fn," déjà ajouté ")):y("",!0)],42,vn))),128))])):y("",!0)]),d(i).blacklist.items.length>0?(t(),s("div",bn,[(t(!0),s(O,null,G(d(i).blacklist.items,S=>(t(),s("div",{key:S.typeId,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700"},[e("img",{src:d(_)(S.typeId,32),class:"w-8 h-8 rounded",onError:I[3]||(I[3]=(...F)=>d(h)&&d(h)(...F))},null,40,yn),e("span",hn,a(S.typeName),1),e("button",{onClick:F=>J(S.typeId),class:"p-1 hover:bg-slate-700 rounded text-slate-500 hover:text-red-400"},[...I[5]||(I[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,gn)]))),128))])):(t(),s("p",kn," Aucun item individuel blacklisté. "))])],64)):(t(),s("div",ln," Chargement... "))]))}}),$n={class:"space-y-4"},Cn={class:"flex items-center justify-between"},_n={key:0,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700"},Sn={class:"text-sm font-medium text-slate-300 mb-4"},jn={class:"space-y-4"},Tn={key:0},Pn={key:0,class:"text-xs text-slate-500"},Mn={key:1,class:"text-xs text-slate-500 bg-slate-900/50 rounded-lg p-2 border border-slate-700"},En=["value"],Bn={class:"mt-3 relative"},In={key:0,class:"absolute right-3 top-7"},Rn={key:1,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ln=["onMousedown"],An={class:"text-sm text-slate-200"},Nn={key:0,class:"text-slate-400"},Jn={class:"text-xs text-slate-500"},zn={key:2,class:"mt-1 text-xs text-amber-400"},Vn={key:1,class:"bg-cyan-900/20 border border-cyan-700/50 rounded-lg p-3"},Dn={class:"flex gap-3"},Hn=["value"],Fn={class:"text-sm text-slate-300"},Un={class:"block text-xs text-slate-400 mb-2"},On={class:"relative"},qn=["placeholder","disabled"],Kn={key:0,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Xn=["onMousedown"],Qn={class:"flex items-center justify-between"},Wn={class:"text-sm text-slate-200"},Yn={class:"text-xs text-slate-500 mt-0.5"},Zn={key:1,class:"absolute z-10 mt-1 w-full bg-slate-800 border border-slate-600 rounded-lg shadow-lg p-3 text-sm text-slate-400"},Gn={key:0,class:"mt-3 space-y-1"},er={class:"flex items-center justify-between"},tr={class:"flex items-center gap-2 flex-1 min-w-0"},sr={class:"text-sm text-slate-300 truncate"},or=["onClick"],nr={class:"text-xs text-slate-500 mt-0.5"},rr={key:1,class:"mt-2 text-xs text-slate-500"},lr={class:"bg-slate-900/50 rounded-lg p-3 border border-slate-700"},ar={class:"flex gap-4"},ir={key:0},ur={class:"text-sm text-emerald-400 ml-1"},cr={key:1},dr={class:"text-sm text-emerald-400 ml-1"},pr={key:2,class:"text-slate-500 text-sm"},vr={class:"flex gap-3 pt-2"},mr=["disabled"],xr={key:1,class:"space-y-2"},fr={class:"flex items-start justify-between"},br={class:"flex-1"},yr={class:"flex items-center gap-2"},hr={class:"text-sm font-medium text-slate-200"},gr={key:0,class:"px-1.5 py-0.5 bg-cyan-900/50 text-cyan-400 text-xs rounded border border-cyan-700/50"},kr={class:"text-xs text-slate-500 mt-1"},wr={class:"flex gap-4 mt-2"},$r={key:0},Cr={class:"text-sm text-emerald-400 ml-1"},_r={key:1},Sr={class:"text-sm text-emerald-400 ml-1"},jr={key:0,class:"mt-2 flex flex-wrap gap-1"},Tr={class:"flex items-center gap-2"},Pr=["onClick"],Mr=["onClick"],Er={key:2,class:"text-center py-8 text-slate-500"},Br={class:"bg-slate-900 rounded-xl border border-slate-700 max-w-md w-full p-6"},Ir={class:"text-slate-400 mb-6"},Rr={class:"text-slate-200 font-medium"},Ve=3,Lr=_e({__name:"StructureConfig",setup(P){const i=Te(),_=m(!1),h=m(null),r=m(""),M=m(null),C=m("nullsec"),E=m("raitaru"),x=m([]),H=m(""),D=m(!1),J=m(""),k=m([]),g=m(!1),A=m(!1),I=m(!1);Le(async()=>{i.fetchStructures(),await i.fetchCorporationStructures(),I.value=!0,console.log("Corporation structures loaded:",i.corporationStructures.length,i.corporationStructures)});const S=m(null),F=m(!1);function B(){if(S.value){const $=S.value;r.value=$.locationName,M.value=$.locationId,$.isCorporationOwned&&(F.value=!0),$.sharedConfig?(C.value=$.sharedConfig.securityType,E.value=$.sharedConfig.structureType,x.value=[...$.sharedConfig.rigs]):$.structureType&&(E.value=$.structureType),S.value=null}}function N(){M.value=null,F.value=!1}let b;const V=m(null);function Y(){if(clearTimeout(b),V.value=null,J.value.length<3){k.value=[],A.value=!1;return}b=window.setTimeout(async()=>{g.value=!0;const $=await i.searchStructures(J.value);k.value=$.structures,V.value=$.error||null,A.value=$.structures.length>0,g.value=!1},500)}function me($){r.value=$.locationName,M.value=$.locationId,$.structureType&&(E.value=$.structureType),$.isCorporationOwned&&(F.value=!0),J.value="",k.value=[],A.value=!1}function ce(){window.setTimeout(()=>{A.value=!1},200)}const de={highsec:1,lowsec:1.9,nullsec:2.1},xe={highsec:"High-Sec (x1.0)",lowsec:"Low-Sec (x1.9)",nullsec:"Null-Sec (x2.1)"},re={station:"Station NPC (aucun bonus)",raitaru:"Raitaru (EC Medium) - 1% ME",azbel:"Azbel (EC Large) - 1% ME, 20% TE",sotiyo:"Sotiyo (EC X-Large) - 1% ME, 30% TE",athanor:"Athanor (Refinery Medium) - 25% TE",tatara:"Tatara (Refinery Large) - 25% TE",engineering_complex:"Engineering Complex (legacy)",refinery:"Refinery (legacy)"},le={raitaru:"M",azbel:"L",sotiyo:"XL",athanor:"M",tatara:"L"},se=ye(()=>{if(!i.rigOptions)return[];const $=le[E.value];if(["athanor","tatara","refinery"].includes(E.value)){const l=i.rigOptions.reaction;return $?l.filter(v=>v.size===$):l}if(["raitaru","azbel","sotiyo","engineering_complex"].includes(E.value)){const l=i.rigOptions.manufacturing;return $?l.filter(v=>v.size===$):l}return[]}),ae=ye(()=>{const $=H.value.toLowerCase().trim();return $.length<2?[]:se.value.filter(l=>x.value.includes(l.name)?!1:l.name.toLowerCase().includes($)).slice(0,10)}),fe=ye(()=>x.value.map($=>se.value.find(v=>v.name===$)||{name:$,bonus:0,category:"",size:"M",targetCategories:[]}));Re(E,()=>{H.value="";const $=new Set(se.value.map(l=>l.name));x.value=x.value.filter(l=>$.has(l))});function be(){r.value="",M.value=null,C.value="nullsec",E.value="raitaru",x.value=[],F.value=!1,h.value=null,H.value="",D.value=!1,S.value=null,J.value="",k.value=[],A.value=!1}const we=ye(()=>["athanor","tatara","refinery"].includes(E.value)),Se=ye(()=>["raitaru","azbel","sotiyo","engineering_complex"].includes(E.value));function p(){be(),_.value=!0}function f($){r.value=$.name,M.value=$.locationId,C.value=$.securityType,E.value=$.structureType,x.value=[...$.rigs],h.value=$,H.value="",D.value=!1,_.value=!0}function T(){_.value=!1,be()}const w=m(!1),R=m(!1);function u(){if(!h.value||!h.value.isCorporationStructure)return!1;const $=[...h.value.rigs].sort(),l=[...x.value].sort();return JSON.stringify($)!==JSON.stringify(l)||h.value.structureType!==E.value||h.value.securityType!==C.value}async function c(){if(h.value&&u()&&!R.value){w.value=!0;return}try{h.value?await i.updateStructure(h.value.id,{name:r.value,securityType:C.value,structureType:E.value,rigs:x.value}):await i.createStructure({name:r.value,locationId:M.value,securityType:C.value,structureType:E.value,rigs:x.value}),_.value=!1,be(),R.value=!1}catch{R.value=!1}}async function q(){w.value=!1,R.value=!0,await c()}function j(){w.value=!1,R.value=!1}const n=m(!1),z=m(null),Q=m("");function ee($){z.value=$.id,Q.value=$.name,n.value=!0}async function Pe(){z.value&&await i.deleteStructure(z.value),n.value=!1,z.value=null,Q.value=""}function he(){n.value=!1,z.value=null,Q.value=""}const ke=ye(()=>x.value.length<Ve);function Me($){ke.value&&(x.value.includes($.name)||x.value.push($.name),H.value="",D.value=!1)}function L($){const l=x.value.indexOf($);l!==-1&&x.value.splice(l,1)}function o(){window.setTimeout(()=>{D.value=!1},200)}function Z($){return $.replace("Standup M-Set ","").replace("Standup L-Set ","").replace("Standup XL-Set ","")}const ie={basic_small_ship:"T1 Small Ships",basic_medium_ship:"T1 Medium Ships",basic_large_ship:"T1 Large Ships",advanced_small_ship:"T2 Small Ships",advanced_medium_ship:"T2 Medium Ships",advanced_large_ship:"T2 Large Ships",capital_ship:"Capitals",basic_capital_component:"Capital Components",advanced_component:"T2/T3 Components",structure_component:"Structure Components",equipment:"Modules",ammunition:"Ammo",drone:"Drones",fighter:"Fighters",structure:"Structures",composite_reaction:"Composites",biochemical_reaction:"Biochem",hybrid_reaction:"Hybrid",research:"Research/Invention/Copy"};function pe($){return!$||$.length===0?"":$.map(l=>ie[l]||l).join(", ")}function ge($,l,v){if(!i.rigOptions)return 0;const oe=l==="reaction"?i.rigOptions.reaction:i.rigOptions.manufacturing;let K=0;for(const He of $){const Je=oe.find(Fe=>Fe.name===He);Je&&(K+=Je.bonus)}const Ee=de[v]??1;return Math.round(K*Ee*100)/100}const $e=ye(()=>ge(x.value,"manufacturing",C.value)),Be=ye(()=>ge(x.value,"reaction",C.value));return($,l)=>(t(),s("div",$n,[e("div",Cn,[l[10]||(l[10]=e("h3",{class:"text-lg font-semibold text-slate-200"},"Structures de production",-1)),_.value?y("",!0):(t(),s("button",{key:0,onClick:p,class:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium flex items-center gap-2"},[...l[9]||(l[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),W(" Ajouter ",-1)])]))]),l[37]||(l[37]=e("p",{class:"text-sm text-slate-400"}," Configurez vos structures de production pour calculer les bonus de matériaux appliqués aux projets. ",-1)),_.value?(t(),s("div",_n,[e("h4",Sn,a(h.value?"Modifier la structure":"Nouvelle structure"),1),e("div",jn,[h.value?y("",!0):(t(),s("div",Tn,[l[15]||(l[15]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Structures partagées par la corporation",-1)),I.value?d(i).corporationStructures.length===0?(t(),s("div",Mn," Aucune structure trouvée. Vérifiez que les assets de corporation sont synchronisés. ")):(t(),s(O,{key:2},[te(e("select",{"onUpdate:modelValue":l[0]||(l[0]=v=>S.value=v),onChange:B,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},[l[11]||(l[11]=e("option",{value:null},"-- Sélectionner une structure --",-1)),(t(!0),s(O,null,G(d(i).corporationStructures,v=>(t(),s("option",{key:v.locationId,value:v},a(v.locationName)+" ("+a(v.solarSystemName||"Système inconnu")+") "+a(v.sharedConfig?" - Rigs configurés":""),9,En))),128))],544),[[ze,S.value]]),l[12]||(l[12]=e("p",{class:"text-xs text-slate-500 mt-1"}," Sélectionnez une structure ou laissez vide pour une configuration personnalisée ",-1))],64)):(t(),s("div",Pn," Chargement... ")),e("div",Bn,[l[14]||(l[14]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Ou rechercher par nom (ESI)",-1)),te(e("input",{"onUpdate:modelValue":l[1]||(l[1]=v=>J.value=v),type:"text",placeholder:"Rechercher une structure...",onInput:Y,onFocus:l[2]||(l[2]=v=>A.value=k.value.length>0),onBlur:ce,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},null,544),[[ne,J.value]]),g.value?(t(),s("div",In,[...l[13]||(l[13]=[e("svg",{class:"animate-spin h-4 w-4 text-slate-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):y("",!0),A.value&&k.value.length>0?(t(),s("div",Rn,[(t(!0),s(O,null,G(k.value,v=>(t(),s("button",{key:v.locationId,onMousedown:ue(oe=>me(v),["prevent"]),class:"w-full px-3 py-2 hover:bg-slate-700 text-left"},[e("div",An,[W(a(v.isCorporationOwned?"★ ":"")+a(v.locationName)+" ",1),v.solarSystemName?(t(),s("span",Nn,"("+a(v.solarSystemName)+")",1)):y("",!0)]),e("div",Jn,a(v.structureType?v.structureType.charAt(0).toUpperCase()+v.structureType.slice(1):"Structure")+" "+a(v.isCorporationOwned?" - Structure corpo":""),1)],40,Ln))),128))])):y("",!0),V.value?(t(),s("div",zn,a(V.value),1)):y("",!0)])])),M.value?(t(),s("div",Vn,[e("div",{class:"flex items-center justify-between"},[l[16]||(l[16]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-4 h-4 text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})]),e("span",{class:"text-sm text-cyan-300"},"Structure de corporation")],-1)),e("button",{onClick:N,class:"text-xs text-slate-400 hover:text-slate-200"}," Passer en mode personnalisé ")]),l[17]||(l[17]=e("p",{class:"text-xs text-slate-400 mt-1"}," Les rigs configurés seront partagés avec les autres membres de votre corporation. ",-1))])):y("",!0),e("div",null,[l[18]||(l[18]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Nom",-1)),te(e("input",{"onUpdate:modelValue":l[3]||(l[3]=v=>r.value=v),type:"text",placeholder:"Ex: Tatara C-J6MT",class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[ne,r.value]])]),e("div",null,[l[20]||(l[20]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Type de structure",-1)),te(e("select",{"onUpdate:modelValue":l[4]||(l[4]=v=>E.value=v),class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500"},[...l[19]||(l[19]=[Qe('<optgroup label="NPC"><option value="station">Station NPC (aucun bonus)</option></optgroup><optgroup label="Engineering Complex"><option value="raitaru">Raitaru (Medium) - 1% ME, 15% TE</option><option value="azbel">Azbel (Large) - 1% ME, 20% TE</option><option value="sotiyo">Sotiyo (X-Large) - 1% ME, 30% TE</option></optgroup><optgroup label="Refinery"><option value="athanor">Athanor (Medium) - 25% TE reactions</option><option value="tatara">Tatara (Large) - 25% TE reactions</option></optgroup>',3)])],512),[[ze,E.value]])]),e("div",null,[l[21]||(l[21]=e("label",{class:"block text-xs text-slate-400 mb-1"},"Sécurité",-1)),e("div",Dn,[(t(),s(O,null,G(xe,(v,oe)=>e("label",{key:oe,class:"flex items-center gap-2 cursor-pointer"},[te(e("input",{type:"radio",value:oe,"onUpdate:modelValue":l[5]||(l[5]=K=>C.value=K),class:"text-cyan-500 focus:ring-cyan-500"},null,8,Hn),[[We,C.value]]),e("span",Fn,a(v),1)])),64))])]),e("div",null,[e("label",Un," Rigs (bonus matériaux) - "+a(x.value.length)+"/"+a(Ve),1),e("div",On,[te(e("input",{"onUpdate:modelValue":l[6]||(l[6]=v=>H.value=v),type:"text",placeholder:ke.value?"Rechercher un rig...":"Maximum de rigs atteint",disabled:!ke.value,class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-slate-200 text-sm focus:outline-none focus:border-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed",onFocus:l[7]||(l[7]=v=>D.value=ae.value.length>0),onBlur:o,onInput:l[8]||(l[8]=v=>D.value=!0)},null,40,qn),[[ne,H.value]]),D.value&&ae.value.length>0?(t(),s("div",Kn,[(t(!0),s(O,null,G(ae.value,v=>(t(),s("button",{key:v.name,onMousedown:ue(oe=>Me(v),["prevent"]),class:"w-full px-3 py-2 hover:bg-slate-700 text-left"},[e("div",Qn,[e("span",Wn,a(Z(v.name)),1),e("span",{class:U(["text-xs ml-2",v.timeBonus?"text-amber-400":"text-cyan-400"])},a(v.timeBonus?`TE: -${v.timeBonus}%`:`ME: -${v.bonus}%`)+" ("+a(v.size)+") ",3)]),e("div",Yn,a(pe(v.targetCategories)),1)],40,Xn))),128))])):y("",!0),D.value&&H.value.length>=2&&ae.value.length===0?(t(),s("div",Zn," Aucun rig trouvé ")):y("",!0)]),x.value.length>0?(t(),s("div",Gn,[(t(!0),s(O,null,G(fe.value,v=>(t(),s("div",{key:v.name,class:"bg-slate-900/50 rounded-lg px-3 py-2"},[e("div",er,[e("div",tr,[e("span",sr,a(Z(v.name)),1),e("span",{class:U(["text-xs shrink-0",v.timeBonus?"text-amber-400":"text-cyan-400"])},a(v.timeBonus?`TE: -${v.timeBonus}%`:`ME: -${v.bonus}%`)+" ("+a(v.size)+") ",3)]),e("button",{onClick:oe=>L(v.name),class:"ml-2 p-1 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded shrink-0",title:"Retirer"},[...l[22]||(l[22]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,or)]),e("div",nr,a(pe(v.targetCategories)),1)]))),128))])):(t(),s("p",rr," Aucun rig sélectionné. Recherchez et ajoutez des rigs pour appliquer des bonus. "))]),e("div",lr,[l[25]||(l[25]=e("p",{class:"text-xs text-slate-400 mb-2"},"Bonus calculé (base structure + rigs × sécurité)",-1)),e("div",ar,[Se.value?(t(),s("div",ir,[l[23]||(l[23]=e("span",{class:"text-xs text-slate-500"},"Manufacturing:",-1)),e("span",ur,"-"+a($e.value)+"%",1)])):y("",!0),we.value?(t(),s("div",cr,[l[24]||(l[24]=e("span",{class:"text-xs text-slate-500"},"Reactions:",-1)),e("span",dr,"-"+a(Be.value)+"%",1)])):y("",!0),E.value==="station"?(t(),s("div",pr," Les stations NPC n'ont pas de bonus ")):y("",!0)])]),e("div",vr,[e("button",{onClick:c,disabled:!r.value.trim(),class:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-600 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium"},a(h.value?"Enregistrer":"Ajouter"),9,mr),e("button",{onClick:T,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm"}," Annuler ")])])])):y("",!0),d(i).structures.length>0?(t(),s("div",xr,[(t(!0),s(O,null,G(d(i).structures,v=>(t(),s("div",{key:v.id,class:"bg-slate-800/50 rounded-lg p-4 border border-slate-700 hover:border-slate-600"},[e("div",fr,[e("div",br,[e("div",yr,[e("h4",hr,a(v.name),1),v.isCorporationStructure?(t(),s("span",gr," CORPO ")):y("",!0)]),e("p",kr,a(re[v.structureType])+" - "+a(xe[v.securityType]),1),e("div",wr,[v.manufacturingMaterialBonus>0?(t(),s("div",$r,[l[26]||(l[26]=e("span",{class:"text-xs text-slate-500"},"Manufacturing:",-1)),e("span",Cr,"-"+a(v.manufacturingMaterialBonus)+"%",1)])):y("",!0),v.reactionMaterialBonus>0?(t(),s("div",_r,[l[27]||(l[27]=e("span",{class:"text-xs text-slate-500"},"Reactions:",-1)),e("span",Sr,"-"+a(v.reactionMaterialBonus)+"%",1)])):y("",!0)]),v.rigs.length>0?(t(),s("div",jr,[(t(!0),s(O,null,G(v.rigs,oe=>(t(),s("span",{key:oe,class:"px-2 py-0.5 bg-slate-700 text-slate-300 text-xs rounded"},a(Z(oe)),1))),128))])):y("",!0)]),e("div",Tr,[e("button",{onClick:oe=>f(v),class:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded",title:"Modifier"},[...l[28]||(l[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Pr),e("button",{onClick:oe=>ee(v),class:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded",title:"Supprimer"},[...l[29]||(l[29]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Mr)])])]))),128))])):_.value?y("",!0):(t(),s("div",Er,[...l[30]||(l[30]=[e("p",null,"Aucune structure configurée",-1),e("p",{class:"text-sm mt-1"},"Ajoutez vos structures pour calculer les bonus de matériaux",-1)])])),(t(),Ce(Ie,{to:"body"},[n.value?(t(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:ue(he,["self"])},[e("div",Br,[l[33]||(l[33]=e("h3",{class:"text-lg font-semibold text-slate-200 mb-2"},"Supprimer la structure",-1)),e("p",Ir,[l[31]||(l[31]=W(" Voulez-vous vraiment supprimer ",-1)),e("span",Rr,a(Q.value),1),l[32]||(l[32]=W(" ? ",-1))]),e("div",{class:"flex gap-3"},[e("button",{onClick:he,class:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300"}," Annuler "),e("button",{onClick:Pe,class:"flex-1 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white font-medium"}," Supprimer ")])])])):y("",!0)])),(t(),Ce(Ie,{to:"body"},[w.value?(t(),s("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:ue(j,["self"])},[e("div",{class:"bg-slate-900 rounded-xl border border-amber-700/50 max-w-md w-full p-6"},[l[34]||(l[34]=e("div",{class:"flex items-center gap-3 mb-4"},[e("div",{class:"p-2 bg-amber-500/20 rounded-lg"},[e("svg",{class:"w-6 h-6 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])]),e("h3",{class:"text-lg font-semibold text-slate-200"},"Modifier une structure corpo")],-1)),l[35]||(l[35]=e("p",{class:"text-slate-400 mb-2"}," Cette structure est partagée avec votre corporation. ",-1)),l[36]||(l[36]=e("p",{class:"text-slate-400 mb-6"}," Les modifications (rigs, type, sécurité) seront visibles par tous les membres de la corpo. Voulez-vous continuer ? ",-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:j,class:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300"}," Annuler "),e("button",{onClick:q,class:"flex-1 py-2 bg-amber-600 hover:bg-amber-500 rounded-lg text-white font-medium"}," Confirmer ")])])])):y("",!0)]))]))}}),Ar={class:"mb-6 flex items-center justify-between"},Nr={key:0,class:"flex gap-2"},Jr={key:0,class:"mb-6 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 flex items-center justify-between"},zr={key:2,class:"space-y-6"},Vr={class:"bg-slate-900 rounded-xl border border-slate-800 p-6"},Dr={class:"bg-slate-900 rounded-xl border border-slate-800 p-6"},Hr={class:"bg-slate-900 rounded-xl border border-slate-800 p-6 mb-6"},Fr={class:"flex items-end gap-4"},Ur={class:"flex-1"},Or={key:0,class:"text-xs text-cyan-400 mt-1"},qr={class:"w-24"},Kr={class:"w-24"},Xr=["disabled"],Qr={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wr={class:"bg-slate-900 rounded-xl border border-slate-800"},Yr={key:0,class:"p-8 text-center text-slate-500"},ol=_e({__name:"Industry",setup(P){const i=Te(),_=m(null),h=m(1),r=m(0),M=m(!1),C=m(null),E=m("projects");Le(()=>{i.fetchProjects()});function x(k){_.value=k}async function H(){if(_.value){M.value=!0;try{await i.createProject(_.value.typeId,h.value,r.value),_.value=null,h.value=1,r.value=0,await i.fetchProjects()}finally{M.value=!1}}}function D(k){C.value=k}function J(){C.value=null,i.fetchProjects()}return(k,g)=>(t(),Ce(Ye,null,{default:De(()=>[e("div",Ar,[g[5]||(g[5]=e("p",{class:"text-slate-400"},"Suivi de projets de construction",-1)),C.value?y("",!0):(t(),s("div",Nr,[e("button",{onClick:g[0]||(g[0]=A=>E.value="projects"),class:U(["px-4 py-2 rounded-lg text-sm font-medium",E.value==="projects"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Projets ",2),e("button",{onClick:g[1]||(g[1]=A=>E.value="config"),class:U(["px-4 py-2 rounded-lg text-sm font-medium",E.value==="config"?"bg-cyan-600 text-white":"bg-slate-800 text-slate-400 hover:text-slate-200"])}," Configuration ",2)]))]),d(i).error?(t(),s("div",Jr,[e("span",null,a(d(i).error),1),e("button",{onClick:g[2]||(g[2]=A=>d(i).clearError()),class:"text-red-400 hover:text-red-300"},[...g[6]||(g[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):y("",!0),C.value?(t(),Ce(nn,{key:1,"project-id":C.value,onClose:J},null,8,["project-id"])):E.value==="config"?(t(),s("div",zr,[e("div",Vr,[je(wn)]),e("div",Dr,[je(Lr)])])):(t(),s(O,{key:3},[e("div",Hr,[g[11]||(g[11]=e("h3",{class:"text-lg font-semibold text-slate-100 mb-4"},"Nouveau projet",-1)),e("div",Fr,[e("div",Ur,[g[7]||(g[7]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Produit",-1)),je(ot,{onSelect:x}),_.value?(t(),s("p",Or," Sélectionné : "+a(_.value.typeName),1)):y("",!0)]),e("div",qr,[g[8]||(g[8]=e("label",{class:"block text-sm text-slate-400 mb-1"},"Runs",-1)),te(e("input",{"onUpdate:modelValue":g[3]||(g[3]=A=>h.value=A),type:"number",min:"1",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[ne,h.value,void 0,{number:!0}]])]),e("div",Kr,[g[9]||(g[9]=e("label",{class:"block text-sm text-slate-400 mb-1"},"ME",-1)),te(e("input",{"onUpdate:modelValue":g[4]||(g[4]=A=>r.value=A),type:"number",min:"0",max:"10",class:"w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500"},null,512),[[ne,r.value,void 0,{number:!0}]])]),e("button",{onClick:H,disabled:!_.value||M.value,class:"px-6 py-2.5 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm font-medium disabled:opacity-50 flex items-center gap-2"},[M.value?(t(),s("svg",Qr,[...g[10]||(g[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):y("",!0),W(" "+a(M.value?"Création...":"Créer"),1)],8,Xr)])]),e("div",Wr,[g[13]||(g[13]=e("div",{class:"px-6 py-4 border-b border-slate-800"},[e("h3",{class:"text-lg font-semibold text-slate-100"},"Historique des projets")],-1)),d(i).isLoading?(t(),s("div",Yr,[...g[12]||(g[12]=[e("svg",{class:"w-8 h-8 animate-spin text-cyan-500 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),W(" Chargement... ",-1)])])):(t(),Ce(Mt,{key:1,onViewProject:D}))])],64))]),_:1}))}});export{ol as default};
