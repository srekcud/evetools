{
    frankenphp
    auto_https off
}

:80 {
    # Health check
    respond /health 200 {
        body `{"status":"ok"}`
        close
    }

    # Mercure real-time hub - must be before php_server
    @mercure path /.well-known/mercure*
    handle @mercure {
        mercure {
            publisher_jwt {env.MERCURE_PUBLISHER_JWT_KEY} HS256
            subscriber_jwt {env.MERCURE_SUBSCRIBER_JWT_KEY} HS256
            anonymous
            cors_origins *
        }
    }

    root * /app/public

    encode zstd gzip

    # PHP server handles everything else
    php_server

    log {
        output stdout
        format console
    }
}
