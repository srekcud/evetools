import{d as V,u as $,x as E,i as T,w as j,h as o,b as t,y as S,A as C,n as q,c as i,v as z,e as p,F as J,m as X,t as B,l as H,r,p as P,j as _,N as y}from"./index-BmJN7W-L.js";import{_ as O}from"./MainLayout.vue_vue_type_style_index_0_lang-DgX5O-e0.js";import{_ as U}from"./ShoppingListResults.vue_vue_type_script_setup_true_lang-C7t_vtmA.js";import"./useFormatters-SlNtu6dn.js";import"./useEveImages-B3tDia7r.js";const D={class:"space-y-6"},W={class:"bg-slate-900/50 backdrop-blur border border-cyan-500/20 rounded-xl p-6"},K={class:"space-y-4"},Q={class:"flex flex-wrap items-end gap-4"},G={class:"flex-1 min-w-[300px] max-w-[450px]"},Y={class:"relative"},Z=["placeholder"],ee={class:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1"},te={key:0,class:"w-4 h-4 animate-spin text-cyan-400",fill:"none",viewBox:"0 0 24 24"},se={key:0,class:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto"},ae=["onMousedown"],le={class:"font-medium truncate"},re={key:0,class:"px-3 py-2 text-slate-400 text-sm"},oe=["disabled"],ne=["disabled"],ue={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},ie={key:0,class:"bg-red-900/30 border border-red-500/30 rounded-xl p-4 text-red-400"},ye=V({__name:"ShoppingList",setup(ce){const b=$(),v=r(""),h=r(1200),n=r({id:null,name:""}),u=r(""),c=r([]),m=r(!1),f=r(!1),x=r(!1),g=r(!1),d=r(""),a=r(null),w=P(()=>v.value.trim().length>0);let k=null;E(u,s=>{if(k&&clearTimeout(k),s.length<3){c.value=[];return}k=setTimeout(()=>{I(s)},300)});async function I(s){m.value=!0;try{const e=await _(`/api/shopping-list/search-structures?q=${encodeURIComponent(s)}`,{headers:{Authorization:`Bearer ${b.token}`,"X-Requested-With":"XMLHttpRequest"}});if(e.ok){const l=await y(e);c.value=l.results,f.value=!0}}catch(e){console.error("Structure search failed:",e)}finally{m.value=!1}}function N(s){n.value={id:s.id,name:s.name},u.value="",c.value=[],f.value=!1}function A(){n.value={id:null,name:""},u.value="",c.value=[]}function L(){setTimeout(()=>{f.value=!1},200)}async function M(){if(w.value){x.value=!0,d.value="",a.value=null;try{const s=await _("/api/shopping-list/parse",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.token}`,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({text:v.value,transportCost:h.value,structureId:n.value.id})});if(!s.ok){const e=await y(s);throw new Error(e.error||"Failed to parse items")}a.value=await y(s)}catch(s){d.value=s instanceof Error?s.message:"An error occurred"}finally{x.value=!1}}}function R(){v.value="",a.value=null,d.value=""}async function F(){if(a.value){g.value=!0;try{const s=await _("/api/shopping-list/sync-structure-market",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.token}`,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({structureId:a.value.structureId||n.value.id})});if(!s.ok){const e=await y(s);throw new Error(e.error||"Sync failed")}await M()}catch(s){d.value=s instanceof Error?s.message:"Sync failed"}finally{g.value=!1}}}return(s,e)=>(o(),T(O,null,{default:j(()=>[t("div",D,[e[13]||(e[13]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-400"}," Liste de courses "),t("p",{class:"text-slate-400 text-sm mt-1"}," Collez une liste d'items pour calculer les prix et volumes ")])],-1)),t("div",W,[t("div",K,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-slate-300 mb-2"}," Collez votre liste d'items ",-1)),S(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),rows:"8",class:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/50 font-mono text-sm",placeholder:`Tritanium	10000
Pyerite	5000
Megacyte 100
200x Nocxium
...`},null,512),[[C,v.value]]),e[5]||(e[5]=t("p",{class:"text-xs text-slate-500 mt-2"},' Formats supportes: "Item Name 123", "Item Name 123", "123x Item Name", "Item Name x 123" ',-1))]),t("div",Q,[t("div",G,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"}," Structure de comparaison (avec Jita) ",-1)),t("div",Y,[S(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),type:"text",placeholder:n.value.id?n.value.name:"C-J6MT - 1st Taj Mahgoon (défaut)",onFocus:e[2]||(e[2]=l=>f.value=!0),onBlur:L,class:q(["w-full rounded-lg pl-3 pr-10 py-2 focus:outline-none",n.value.id?"bg-slate-800/50 border-2 border-cyan-500/50 text-cyan-400 placeholder-cyan-400":"bg-slate-800/50 border border-slate-700 text-slate-200 placeholder-slate-400 focus:border-cyan-500/50"])},null,42,Z),[[C,u.value]]),t("div",ee,[m.value?(o(),i("svg",te,[...e[6]||(e[6]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):n.value.id||u.value?(o(),i("button",{key:1,onMousedown:z(A,["prevent"]),class:"text-slate-400 hover:text-slate-200",title:"Revenir au defaut"},[...e[7]||(e[7]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],32)):p("",!0)]),f.value&&(c.value.length>0||u.value.length>=3&&!m.value)?(o(),i("div",se,[(o(!0),i(J,null,X(c.value,l=>(o(),i("button",{key:l.id,onMousedown:z(de=>N(l),["prevent"]),class:"w-full px-3 py-2 text-left text-slate-200 hover:bg-slate-700/50 transition-colors border-b border-slate-700/50 last:border-0"},[t("div",le,B(l.name),1)],40,ae))),128)),u.value.length>=3&&c.value.length===0&&!m.value?(o(),i("div",re," Aucune structure trouvee (verifiez le dock access) ")):p("",!0)])):p("",!0)])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-slate-300 mb-1"}," Transport (ISK/m³) ",-1)),S(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>h.value=l),type:"number",min:"0",step:"100",class:"w-28 bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-slate-200 focus:outline-none focus:border-cyan-500/50"},null,512),[[C,h.value,void 0,{number:!0}]])]),e[12]||(e[12]=t("div",{class:"flex-1"},null,-1)),t("button",{onClick:R,disabled:!w.value&&!a.value,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-slate-200 text-sm font-medium transition-colors"}," Effacer ",8,oe),t("button",{onClick:M,disabled:!w.value||x.value,class:"px-6 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-white text-sm font-medium transition-colors flex items-center gap-2"},[x.value?(o(),i("svg",ue,[...e[10]||(e[10]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):p("",!0),e[11]||(e[11]=H(" Calculer les prix ",-1))],8,ne)])])]),d.value?(o(),i("div",ie,B(d.value),1)):p("",!0),a.value?(o(),T(U,{key:1,items:a.value.items,totals:a.value.totals,"structure-name":a.value.structureName||"C-J6MT Keepstar","not-found":a.value.notFound,"price-error":a.value.priceError,"structure-accessible":a.value.structureAccessible,"structure-from-cache":a.value.structureFromCache,"structure-last-sync":a.value.structureLastSync,"is-syncing":g.value,onSyncStructure:F},null,8,["items","totals","structure-name","not-found","price-error","structure-accessible","structure-from-cache","structure-last-sync","is-syncing"])):p("",!0)])]),_:1}))}});export{ye as default};
